<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:discourse="http://www.discourse.org/" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>0x00sec - The Home of the Hacker - Latest posts</title>
    <link>https://d.clarkee.co.uk</link>
    <description>Latest posts</description>
      <item>
        <title>Antivirus runtime bypass</title>
        <dc:creator><![CDATA[@Ph03n1x_Crus4d3r]]></dc:creator>
        <description><![CDATA[ <p>Please do, sounds very interesting</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/antivirus-runtime-bypass/25574#post_12</link>
        <pubDate>Mon, 19 Apr 2021 13:26:04 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65566</guid>
      </item>
      <item>
        <title>Antivirus runtime bypass</title>
        <dc:creator><![CDATA[@nulled]]></dc:creator>
        <description><![CDATA[ <p>Yeah, that‚Äôs great idea. Maybe I will try to write entire guide.</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/antivirus-runtime-bypass/25574#post_11</link>
        <pubDate>Mon, 19 Apr 2021 07:28:27 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65564</guid>
      </item>
      <item>
        <title>Antivirus runtime bypass</title>
        <dc:creator><![CDATA[@messede Messede Degod]]></dc:creator>
        <description><![CDATA[ <p>Hi <a class="mention" href="https://d.clarkee.co.uk/u/nulled">@nulled</a> , looks like you went through a nice little roller coaster evading AV‚Äôs , could you please make a separate condensed post on the whole process you went throught ? , i am sure many folks here would appreciate  that , thanks in advance <img src="https://0x00sec.org/images/emoji/twitter/blush.png?v=9" title=":blush:" class="emoji" alt=":blush:">.</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/antivirus-runtime-bypass/25574#post_10</link>
        <pubDate>Mon, 19 Apr 2021 01:45:53 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65557</guid>
      </item>
      <item>
        <title>The &quot;quick way&quot; to learn about Pascal Programming Language</title>
        <dc:creator><![CDATA[@doctordoom Victor Von Doom]]></dc:creator>
        <description><![CDATA[ <aside class="quote no-group" data-username="crimsonRain" data-post="2" data-topic="25714">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="https://d.clarkee.co.uk/user_avatar/d.clarkee.co.uk/crimsonrain/48/42304_2.png" class="avatar"> crimsonRain:</div>
<blockquote>
<p>want to learn Algorithms and</p>
</blockquote>
</aside>
<p>Thank you! I very much appreciate it.</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/the-quick-way-to-learn-about-pascal-programming-language/25714#post_3</link>
        <pubDate>Sun, 18 Apr 2021 19:10:22 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65550</guid>
      </item>
      <item>
        <title>The &quot;quick way&quot; to learn about Pascal Programming Language</title>
        <dc:creator><![CDATA[@crimsonRain crimsonRain]]></dc:creator>
        <description><![CDATA[ <p>Well if you want to learn a language ‚Äúquickly‚Äù, you could check out <a href="https://learnxinyminutes.com/docs/pascal/" rel="noopener nofollow ugc">Learn Pascal in Y minutes</a>. And since you want to learn Algorithms and such, I‚Äôd also suggest the <a href="https://cses.fi/book/book.pdf" rel="noopener nofollow ugc">Competitive Programmer‚Äôs Handbook</a> if you know C++ already.</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/the-quick-way-to-learn-about-pascal-programming-language/25714#post_2</link>
        <pubDate>Sun, 18 Apr 2021 19:05:27 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65549</guid>
      </item>
      <item>
        <title>The &quot;quick way&quot; to learn about Pascal Programming Language</title>
        <dc:creator><![CDATA[@doctordoom Victor Von Doom]]></dc:creator>
        <description><![CDATA[ <p>I know that doesn‚Äôt exist a quick way to learn a programming language, so that‚Äôs why it is in a quote.<br>
The motive why I opened this topic is to ask where to learn Pascal programming language. The Internet is an ocean of good n‚Äô shit contents, and I don‚Äôt know a trustworthy font of the subject that I never stand up to until now.</p>
<p>I want to slowly dive into the algorithm with ‚Äú<a href="https://web.archive.org/web/20191211063215/http://www.ethoberon.ethz.ch/WirthPubl/AD.pdf" rel="noopener nofollow ugc">Algorithms and Data Structures</a>,‚Äù and does anyone knows if I need to learn Pascal first from external content to get that?</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/the-quick-way-to-learn-about-pascal-programming-language/25714#post_1</link>
        <pubDate>Sun, 18 Apr 2021 18:27:45 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65548</guid>
      </item>
      <item>
        <title>Antivirus runtime bypass</title>
        <dc:creator><![CDATA[@nulled]]></dc:creator>
        <description><![CDATA[ <p>Doing great! <img src="https://0x00sec.org/images/emoji/twitter/slight_smile.png?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"> Found reasons why I got scantime detections. Basically, I started uploading stub to <a href="http://antiscan.me" rel="noopener nofollow ugc">antiscan.me</a> with different functions to find out which methods are causing detections (some sort of detection debugging). Strangely, I always got the same detections. So, I decided to rewrite entire stub and I got very interesting results. To make your stub less detectable write it as small and as simple as you can. I mean by ‚Äúas small as‚Äù you need to write as little code as possible, it‚Äôs also very important to keep your functions very simple. I recommend avoiding Assembly.GetType, Assembly.Load etc. and writing directly RunPE into your main stub. Changing icon and program version also helps. And remember do not attempt connecting to the internet with your stub. Do it only in memory after RunPE injection.</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/antivirus-runtime-bypass/25574#post_9</link>
        <pubDate>Sun, 18 Apr 2021 18:25:17 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65547</guid>
      </item>
      <item>
        <title>Binary Armory Wiki</title>
        <dc:creator><![CDATA[@crimsonRain crimsonRain]]></dc:creator>
        <description><![CDATA[ <p>No, I don‚Äôt mind. In fact, contributions are welcome, so feel free.</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/binary-armory-wiki/25679#post_4</link>
        <pubDate>Sun, 18 Apr 2021 08:48:42 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65538</guid>
      </item>
      <item>
        <title>Antivirus runtime bypass</title>
        <dc:creator><![CDATA[@c0z Impetus Omnia Omnem Impetum]]></dc:creator>
        <description><![CDATA[ <p>How‚Äôs it going? I‚Äôm currently reading <a href="https://github.com/D3VI5H4/Antivirus-Artifacts" rel="noopener nofollow ugc">this</a> and thought I‚Äôd post it here as it may help.</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/antivirus-runtime-bypass/25574#post_8</link>
        <pubDate>Sun, 18 Apr 2021 06:26:31 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65536</guid>
      </item>
      <item>
        <title>Binary Armory Wiki</title>
        <dc:creator><![CDATA[@c0z Impetus Omnia Omnem Impetum]]></dc:creator>
        <description><![CDATA[ <p>I‚Äôm organizing some notes and will try to contribute here when I can. <a class="mention" href="https://d.clarkee.co.uk/u/crimsonrain">@crimsonRain</a> Do you mind if I send you my bookmarks that I have organized and you can sift through them?</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/binary-armory-wiki/25679#post_3</link>
        <pubDate>Sun, 18 Apr 2021 06:24:47 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65535</guid>
      </item>
      <item>
        <title>How do you learn WinApi</title>
        <dc:creator><![CDATA[@c0z Impetus Omnia Omnem Impetum]]></dc:creator>
        <description><![CDATA[ <p>Can‚Äôt forget about <a href="https://www.amazon.com/Windows-Internals-Part-architecture-management/dp/0735684189?tag=0x00sec03-20" rel="noopener nofollow ugc">Windows Internals Part 1</a> and <a href="https://www.amazon.com/Windows-Internals-Part-2-7th/dp/0135462401?tag=0x00sec03-20" rel="noopener nofollow ugc">Part 2</a>. I would recommend purchasing them used.</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/how-do-you-learn-winapi/25678#post_6</link>
        <pubDate>Sun, 18 Apr 2021 06:07:34 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65533</guid>
      </item>
      <item>
        <title>I want to be a hacker ,coder but my parents are against it</title>
        <dc:creator><![CDATA[@1094795585]]></dc:creator>
        <description><![CDATA[ <p>There are a lot of free resources to start hacking, naham put a rlly good github repository together with mainly web hacking but also coding and android hacking <a href="https://github.com/nahamsec/Resources-for-Beginner-Bug-Bounty-Hunters" rel="noopener nofollow ugc">here</a>. You can also save lunch money to pay for courses like I did. Try hack me and hack the box aint that expensive either, and they also have free courses. LiveOverFlow put a good video out explaining all the different topics he has covered <a href="https://www.youtube.com/watch?v=LMFY3NvNITY" rel="noopener nofollow ugc">here</a>. But seeing your 17 web hacking/bug bounty‚Äôs are the best way to make money, Stok has a good video on it <a href="https://www.youtube.com/watch?v=CU9Iafc-Igs" rel="noopener nofollow ugc">here</a>. Also good video interview type things to watch are <a href="https://www.youtube.com/watch?v=sp-hvw5rhy8&amp;t=3515s" class="inline-onebox" rel="noopener nofollow ugc">How to grow as a HACKER // ft. NahamSec (a hacker) - YouTube</a> and <a href="https://www.youtube.com/watch?v=HbcY1HQtLms&amp;t=3383s" class="inline-onebox" rel="noopener nofollow ugc">Bug Bounty (how to make money HACKING!!) // ft. ST√ñK - YouTube</a>. Hope this helped <img src="https://0x00sec.org/images/emoji/twitter/slight_smile.png?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p> ]]></description>
        <link>https://d.clarkee.co.uk/t/i-want-to-be-a-hacker-coder-but-my-parents-are-against-it/25374?page=2#post_37</link>
        <pubDate>Sun, 18 Apr 2021 05:01:14 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65531</guid>
      </item>
      <item>
        <title>How do you learn WinApi</title>
        <dc:creator><![CDATA[@n33ds0n n33ds0n]]></dc:creator>
        <description><![CDATA[ <p>Thanks <a class="mention" href="https://d.clarkee.co.uk/u/bass_r33v3s">@Bass_R33v3s</a>. I will check it out <img src="https://0x00sec.org/images/emoji/twitter/+1.png?v=9" title=":+1:" class="emoji" alt=":+1:"></p> ]]></description>
        <link>https://d.clarkee.co.uk/t/how-do-you-learn-winapi/25678#post_5</link>
        <pubDate>Sat, 17 Apr 2021 19:26:00 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65527</guid>
      </item>
      <item>
        <title>Why is post quantum cryptography important</title>
        <dc:creator><![CDATA[@Darkvault Darkvault]]></dc:creator>
        <description><![CDATA[ <p>Quantum  computers will break today‚Äôs  asymmetric public-keys cryptography algorithms used for web encryption (https),email encryption (gnupg‚Ä¶),ssh and others.</p>
<p>Quantum computers are designed to use something  called qubits,allowing multiple states being  expressed simultaneously. This allows for breakthrough in certain  types of math problems,solving them nearly  instantaneously. Quantum computers adhere to the law  of physics,and it is only a matter of time before engineer figures out how to build  them properly .</p>
<p>A small 20 qubits quantum computer has already been developed  for the IBM experienced project.</p>
<p>Here  are some software been developed that claims to be  quantum resistant :</p>
<p>‚óè  codecrypt</p>
<p>‚óè  TinySSH(PQC planned)</p>
<p>‚óè  Cyph</p>
<p>‚óè Onetime</p>
<p>This is a thread  to anyone relying on encryption.<br>
There are people out there  saving all  encrypted data and  downloading the encrypted  traffic,waiting for a way to decrypt it.</p>
<p>It is advised to learn the software sooner than later.</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/why-is-post-quantum-cryptography-important/25693#post_1</link>
        <pubDate>Sat, 17 Apr 2021 12:59:38 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65516</guid>
      </item>
      <item>
        <title>Need advise on dynamic reversing encrypted php file</title>
        <dc:creator><![CDATA[@messede Messede Degod]]></dc:creator>
        <description><![CDATA[ <p>i was able to dig this up , might help you.</p>
<aside class="onebox stackexchange">
  <header class="source">
      <a href="https://stackoverflow.com/questions/39825228/how-does-ioncube-work-internally/40139195#40139195" target="_blank" rel="noopener">stackoverflow.com</a>
  </header>
  <article class="onebox-body">
      <a href="https://stackoverflow.com/users/895163/nick" target="_blank" rel="noopener">
    <img alt="Nick" src="https://0x00sec.s3.amazonaws.com/original/3X/5/4/5491e8c29abb8a2f7176416176d532b266dc379b.png" class="thumbnail onebox-avatar" width="128" height="128">
  </a>
<h4>
  <a href="https://stackoverflow.com/questions/39825228/how-does-ioncube-work-internally/40139195#40139195" target="_blank" rel="noopener">How does ionCube work internally?</a>
</h4>

<div class="tags">
  <strong>php, encryption, ioncube</strong>
</div>

<div class="date">
  
  answered by
  <a href="https://stackoverflow.com/users/895163/nick" target="_blank" rel="noopener">
    Nick
  </a>
  on <a href="https://stackoverflow.com/questions/39825228/how-does-ioncube-work-internally/40139195#40139195" target="_blank" rel="noopener">06:39PM - 19 Oct 16 UTC</a>
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>(the author of the stack overflow answer is a ioncube employee)</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/need-advise-on-dynamic-reversing-encrypted-php-file/25659#post_4</link>
        <pubDate>Sat, 17 Apr 2021 11:57:10 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65515</guid>
      </item>
      <item>
        <title>Best language for write malware</title>
        <dc:creator><![CDATA[@mose3c]]></dc:creator>
        <description><![CDATA[ <p>maybe you mean exploit development here .<br>
so i recommended c/c++ , python , asm .<br>
it‚Äôs all used for windows exploit development and linux .<br>
but it‚Äôs al most  up to the hacker or developer what to use .</p>
<p>What about c# i dont recommended c# , vb ,</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/best-language-for-write-malware/25514#post_14</link>
        <pubDate>Sat, 17 Apr 2021 03:40:35 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65493</guid>
      </item>
      <item>
        <title>How do you learn WinApi</title>
        <dc:creator><![CDATA[@Bass_R33v3s]]></dc:creator>
        <description><![CDATA[ <p>If you can afford then I would recommend Windows 10 System Programming(Parts 1&amp;2) by Pavel Yosifovich - <a href="https://leanpub.com/u/zodiacon" rel="noopener nofollow ugc">Link</a></p>
<p>Otherwise the most comprehensive (FREE) source I‚Äôve found is Tenouks website. Its old from 2005-2008 but cross referencing with <a href="https://docs.microsoft.com/en-us/windows/win32/apiindex/windows-api-list" rel="noopener nofollow ugc">MSDN</a> should help. I don‚Äôt think the guy who made the tutorials is native English speaker so some of the grammar is off - <a href="https://www.tenouk.com/cnwin32tutorials.html" rel="noopener nofollow ugc">Link</a></p>
<p>Hope it helps.</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/how-do-you-learn-winapi/25678#post_4</link>
        <pubDate>Fri, 16 Apr 2021 22:30:38 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65489</guid>
      </item>
      <item>
        <title>Need advise on dynamic reversing encrypted php file</title>
        <dc:creator><![CDATA[@romzhke Roman]]></dc:creator>
        <description><![CDATA[ <p>Hi there. Thanks for the link. Sadly it is outdated a bit. See, ioncube has several updates of their protection mechanism ever since. But anyway, i am not interested in reversing ioncude itself. I mean, in the end of the day the bytecode will end up in the memory in the format appropriate for direct CPU consumption. Isn‚Äôt it? So my task is just to find the right mem region. I am right? Or it always stored as an intermediate bytecode and passes over Zend engine? This seems not realistic, because it would cause huge processing overhead.<br>
I couldn‚Äôt find any info in google about reversing PHP applications from that perspective. Maybe someone saw something?<br>
Another idea which came up to me, is just to use strace, for example, find out from where the sys calls are happening and go straight there. Here another question. How can i dump the whole mem region with the application to a file and just open it then with Ghidra and statically analize?</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/need-advise-on-dynamic-reversing-encrypted-php-file/25659#post_3</link>
        <pubDate>Fri, 16 Apr 2021 17:35:27 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65486</guid>
      </item>
      <item>
        <title>Can Responder take down infrastructure?</title>
        <dc:creator><![CDATA[@isamurai]]></dc:creator>
        <description><![CDATA[ <p>So I‚Äôm in a situation where Responder could be useful but I somehow remember hearing that i could take down the network with the LLMNR poisoning.</p>
<p>Would running Responder WPAD to certain targeted machines pose a real risk of taking down the infra?</p>
<p>thanks!<br>
Isamurai</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/can-responder-take-down-infrastructure/25683#post_1</link>
        <pubDate>Fri, 16 Apr 2021 16:08:57 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65485</guid>
      </item>
      <item>
        <title>How do you learn WinApi</title>
        <dc:creator><![CDATA[@n33ds0n n33ds0n]]></dc:creator>
        <description><![CDATA[ <p>Thanks <a class="mention" href="https://d.clarkee.co.uk/u/ripmeout">@ripmeout</a> <img src="https://0x00sec.org/images/emoji/twitter/heart.png?v=9" title=":heart:" class="emoji" alt=":heart:"><br>
I really appreciateüëç</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/how-do-you-learn-winapi/25678#post_3</link>
        <pubDate>Fri, 16 Apr 2021 06:08:47 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65482</guid>
      </item>
      <item>
        <title>Some books that you would recommend reading</title>
        <dc:creator><![CDATA[@Darkvault Darkvault]]></dc:creator>
        <description><![CDATA[ <p>Thanks for help !! Big brother.<img src="https://0x00sec.org/images/emoji/twitter/black_heart.png?v=9" title=":black_heart:" class="emoji" alt=":black_heart:"></p> ]]></description>
        <link>https://d.clarkee.co.uk/t/some-books-that-you-would-recommend-reading/25676#post_4</link>
        <pubDate>Fri, 16 Apr 2021 05:46:58 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65481</guid>
      </item>
      <item>
        <title>Phishing Guides for Pentesters?</title>
        <dc:creator><![CDATA[@pmalone Peter]]></dc:creator>
        <description><![CDATA[ <p>I recommend a book by Christopher Hadnagy, Social Engineering: The Science of Human Hacking.</p>
<p>It really puts you in the mindset of a hacker and gives tons or practical examples.</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/phishing-guides-for-pentesters/25313#post_9</link>
        <pubDate>Fri, 16 Apr 2021 05:33:02 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65480</guid>
      </item>
      <item>
        <title>Binary Armory Wiki</title>
        <dc:creator><![CDATA[@messede Messede Degod]]></dc:creator>
        <description><![CDATA[ <p>This is a nice compilation , thank you</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/binary-armory-wiki/25679#post_2</link>
        <pubDate>Fri, 16 Apr 2021 05:02:05 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65478</guid>
      </item>
      <item>
        <title>How do you learn WinApi</title>
        <dc:creator><![CDATA[@ripmeout Mohd Amri]]></dc:creator>
        <description><![CDATA[ <p>Can start <a href="https://www.fuzzysecurity.com" rel="noopener nofollow ugc">here</a></p> ]]></description>
        <link>https://d.clarkee.co.uk/t/how-do-you-learn-winapi/25678#post_2</link>
        <pubDate>Fri, 16 Apr 2021 03:12:07 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65477</guid>
      </item>
      <item>
        <title>Binary Armory Wiki</title>
        <dc:creator><![CDATA[@crimsonRain crimsonRain]]></dc:creator>
        <description><![CDATA[ <p>A compilation of resources to classical AntiRE techniques I‚Äôve collected over time. Note that some resources may seem to be redundant but are added for the sake of completeness. Feel free to add any if you wish.</p>
<h1>Packers/Obfuscators</h1>
<p><a href="https://medium.com/@polarply/build-your-first-llvm-obfuscator-80d16583392b" rel="noopener nofollow ugc">Build your first LLVM Obfuscator</a><br>
<a href="https://www.praetorian.com/blog/extending-llvm-for-code-obfuscation-part-1/" rel="noopener nofollow ugc"> Extending LLVM for Code Obfuscation 1</a><br>
<a href="https://www.praetorian.com/blog/extending-llvm-for-code-obfuscation-part-2/" rel="noopener nofollow ugc"> Extending LLVM for Code Obfuscation 2</a><br>
<a href="https://www.apriorit.com/dev-blog/687-reverse-engineering-llvm-obfuscation" rel="noopener nofollow ugc"> Using LLVM to Obfuscate Your Code During Compilation</a><br>
<a href="https://blog.quarkslab.com/turning-regular-code-into-atrocities-with-llvm.html" rel="noopener nofollow ugc">Turning Regular Code Into Atrocities With LLVM </a><br>
<a href="http://www.rohitab.com/discuss/index.php?app=core&amp;module=attach&amp;section=attach&amp;attach_id=4507" rel="noopener nofollow ugc">Simple Packer in C</a><br>
<a href="https://bidouillesecurity.com/tutorial-writing-a-pe-packer-intro/" rel="noopener nofollow ugc">Writing a PE packer series</a><br>
<a href="https://dl.packetstormsecurity.net/papers/general/Using_UPX_as_a_security_packer.pdf" rel="noopener nofollow ugc">Using UPX as a security packer</a><br>
<a href="https://www.stonedcoder.org/~kd/lib/61-267-1-PB.pdf" rel="noopener nofollow ugc">How to Write Your Own Packer</a></p>
<h1>Anti-Disassembly</h1>
<p><a href="https://www.malwinator.com/2015/11/22/anti-disassembly-used-in-malware-a-primer/" rel="noopener nofollow ugc">Anti-Disassembly techniques used by malware (a primer) 1</a><br>
<a href="https://www.malwinator.com/2015/11/27/anti-disassembly-techniques-used-by-malware-a-primer-part-2/" rel="noopener nofollow ugc">Anti-Disassembly techniques used by malware (a primer) 2</a><br>
<a href="https://grazfather.github.io/posts/2016-09-18-anti-disassembly/" rel="noopener nofollow ugc">Anti-Disassembly Techniques and Mitigation</a><br>
<a href="https://www.exploit-db.com/docs/48717" rel="noopener nofollow ugc">Assembly ‚Äúwrapping‚Äù: a technique for anti-disassembly</a><br>
<a href="https://yellowbyte.github.io/blog/2018/the_return_of_disassembly_desynchronization/" rel="noopener nofollow ugc">The Return of Disassembly Desynchronization</a></p>
<h1>Anti-Debug</h1>
<p><a href="https://anti-debug.checkpoint.com/" rel="noopener nofollow ugc">Anti-Debug Tricks Wiki</a><br>
<a href="https://anti-reversing.com/Downloads/Anti-Reversing/The_Ultimate_Anti-Reversing_Reference.pdf" rel="noopener nofollow ugc">[WIN]The Ultimate Anti Debugging Reference</a><br>
<a href="https://www.cs.utah.edu/~aburtsev/malw-sem/slides/02-anti-debugging.pdf" rel="noopener nofollow ugc">[WIN]Anti-Debugging Techniques and Mitigation</a><br>
<a href="https://www.apriorit.com/dev-blog/367-anti-reverse-engineering-protection-techniques-to-use-before-releasing-software" rel="noopener nofollow ugc">[WIN]Anti Debugging Protection Techniques with Examples</a><br>
<a href="https://community.broadcom.com/symantecenterprise/communities/community-home/librarydocuments/viewdocument?DocumentKey=230d68b2-c80f-4436-9c09-ff84d049da33&amp;CommunityKey=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&amp;tab=librarydocuments" rel="noopener nofollow ugc">Windows Anti-Debug Reference</a><br>
<a href="https://www.stonedcoder.org/~kd/lib/14-61-1-PB.pdf" rel="noopener nofollow ugc">Beginner‚Äôs Guide to Basic Linux Anti Anti Debugging Technique</a><br>
<a href="https://reverseengineering.stackexchange.com/questions/43/anti-debug-techniques-on-unix-platforms" rel="noopener nofollow ugc">Anti-Debug Techniques on Linux</a></p>
<h1>VM/Sandbox Detection</h1>
<p><a href="https://www.blueliv.com/cyber-security-and-cyber-threat-intelligence-blog-blueliv/research/playing-with-guloader-anti-vm-techniques-malware/" rel="noopener nofollow ugc">[WIN]Playing with GuLoader Anti-VM techniques</a><br>
<a href="https://www.cynet.com/evasion-techniques/malware-anti-vm-techniques/" rel="noopener nofollow ugc">Malware Anti-VM Techniques</a><br>
<a href="https://www.deepinstinct.com/2019/10/29/malware-evasion-techniques-part-2-anti-vm-blog/" rel="noopener nofollow ugc">Malware Evasion Techniques 2</a><br>
<a href="https://www.deepinstinct.com/2019/11/24/malware-evasion-techniques-part-3-anti-sandboxing/" rel="noopener nofollow ugc">Malware Evasion Techniques 3</a><br>
<a href="https://www.mcafee.com/blogs/other-blogs/mcafee-labs/evolution-of-malware-sandbox-evasion-tactics-a-retrospective-study/" rel="noopener nofollow ugc">[WIN]Evolution of Malware Sandbox Evasion Tactics ‚Äì A Retrospective Study</a><br>
<a href="https://blog.talosintelligence.com/2009/10/how-does-malware-know-difference.html" rel="noopener nofollow ugc">How does malware know the difference between the virtual world and the real world?</a><br>
<a href="https://www.baeldung.com/linux/determine-virtualization-tech" rel="noopener nofollow ugc">[LINUX]Easy Ways to Determine Virtualization Technology</a></p>
<h1>Source Code</h1>
<aside class="onebox githubfolder">
  <header class="source">
      <img src="https://github.githubassets.com/favicons/favicon.svg" class="site-icon" width="32" height="32">
      <a href="https://github.com/LordNoteworthy/al-khaser" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:400/400;"><img src="https://avatars.githubusercontent.com/u/5129564?s=400&amp;amp;v=4" class="thumbnail" width="400" height="400"></div>

<h3><a href="https://github.com/LordNoteworthy/al-khaser" target="_blank" rel="noopener nofollow ugc">LordNoteworthy/al-khaser</a></h3>


  <p><span class="label1">Public malware techniques used in the wild: Virtual Machine, Emulation, Debuggers, Sandbox detection. </span></p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<aside class="onebox githubfolder">
  <header class="source">
      <img src="https://github.githubassets.com/favicons/favicon.svg" class="site-icon" width="32" height="32">
      <a href="https://github.com/waleedassar/antidebug" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:420/420;"><img src="https://avatars.githubusercontent.com/u/5983995?s=400&amp;amp;v=4" class="thumbnail" width="420" height="420"></div>

<h3><a href="https://github.com/waleedassar/antidebug" target="_blank" rel="noopener nofollow ugc">waleedassar/antidebug</a></h3>


  <p><span class="label1">Collection Of Anti-Debugging Tricks. Contribute to waleedassar/antidebug development by creating an account on GitHub.</span></p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<aside class="onebox githubfolder">
  <header class="source">
      <img src="https://github.githubassets.com/favicons/favicon.svg" class="site-icon" width="32" height="32">
      <a href="https://github.com/ThomasThelen/Anti-Debugging" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:400/400;"><img src="https://avatars.githubusercontent.com/u/9289652?s=400&amp;amp;v=4" class="thumbnail" width="400" height="400"></div>

<h3><a href="https://github.com/ThomasThelen/Anti-Debugging" target="_blank" rel="noopener nofollow ugc">ThomasThelen/Anti-Debugging</a></h3>


  <p><span class="label1">A collection of c++ programs that demonstrate common ways to detect the presence of an attached debugger.</span></p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<aside class="onebox githubfolder">
  <header class="source">
      <img src="https://github.githubassets.com/favicons/favicon.svg" class="site-icon" width="32" height="32">
      <a href="https://github.com/a0rtega/pafish" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/345;"><img src="https://0x00sec.s3.amazonaws.com/optimized/3X/4/7/477f294ed2a52ac37bed5b143621236fd52132b6_2_690x345.png" class="thumbnail" width="690" height="345" srcset="https://0x00sec.s3.amazonaws.com/optimized/3X/4/7/477f294ed2a52ac37bed5b143621236fd52132b6_2_690x345.png, https://0x00sec.s3.amazonaws.com/optimized/3X/4/7/477f294ed2a52ac37bed5b143621236fd52132b6_2_1035x517.png 1.5x, https://0x00sec.s3.amazonaws.com/original/3X/4/7/477f294ed2a52ac37bed5b143621236fd52132b6.png 2x" data-small-upload="https://0x00sec.s3.amazonaws.com/optimized/3X/4/7/477f294ed2a52ac37bed5b143621236fd52132b6_2_10x10.png"></div>

<h3><a href="https://github.com/a0rtega/pafish" target="_blank" rel="noopener nofollow ugc">a0rtega/pafish</a></h3>


  <p><span class="label1">Pafish is a demonstration tool that employs several techniques to detect sandboxes and analysis environments in the same way as malware families do.</span></p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<aside class="onebox githubblob">
  <header class="source">
      <a href="https://github.com/hackedteam/scout-win/blob/master/core-scout-win32/antivm.cpp" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="https://github.com/hackedteam/scout-win/blob/master/core-scout-win32/antivm.cpp" target="_blank" rel="noopener nofollow ugc">hackedteam/scout-win/blob/master/core-scout-win32/antivm.cpp</a></h4>
<pre><code class="lang-cpp">#include &lt;Windows.h&gt;
#include "utils.h"
#include "proto.h"
#include "antivm.h"

//#define VMWARE_WORKSTATION_FAIL		"\x76\x6f\x73\x08\xb2\x72\x45\x1a\x87\x51\x30\x18\xc9\x88\x7c\xaa\x60\x75\x3c\x34" // "2d 94 e0 88 ff dc f3 45" -&gt; unicode
//#define VMWARE_WORKSTATION_FAIL2	"\x44\xb0\x73\xdc\x0d\x9d\x4c\x84\xd6\x13\x32\xe2\x70\x98\xc0\xf6\x67\x20\xe8\x0d" // "4e 60 5c 00 41 b6 4f f1 " -&gt; unicode

#define VBOX_FAIL					"\xee\xfb\x15\x51\x37\xa9\xa2\x67\x39\x4b\x9e\x9f\xa3\x05\x5f\xf0\xde\x09\xa4\xa7" // "PCI\\VEN_80EE&amp;DEV_CAFE"	-&gt; unicode
#define VMWARE_WHITELISTED			"\x83\xbe\x37\x16\x52\x97\x24\xc9\x73\xbe\x68\xbb\x0e\x46\x00\xa0\xc0\xf3\x74\x0d"  // VMware-aa aa aa aa aa aa aa aa
#define IS_VMWARE					"\x72\x19\x78\xcf\x34\x89\x66\x34\xe1\x10\x2f\x21\xf1\x5c\x73\x96\x38\x9e\xa7\x69"  // VMware


BOOL AntiVM()
{
	AntiCuckoo();
	BOOL bVMWare = AntiVMWare();
	BOOL bVBox = AntiVBox();

	if (bVMWare || bVBox)
</code></pre>

  This file has been truncated. <a href="https://github.com/hackedteam/scout-win/blob/master/core-scout-win32/antivm.cpp" target="_blank" rel="noopener nofollow ugc">show original</a>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<aside class="onebox githubfolder">
  <header class="source">
      <img src="https://github.githubassets.com/favicons/favicon.svg" class="site-icon" width="32" height="32">
      <a href="https://github.com/David-Reguera-Garcia-Dreg/anticuckoo" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:288/288;"><img src="https://avatars.githubusercontent.com/u/9882181?s=400&amp;amp;v=4" class="thumbnail" width="288" height="288"></div>

<h3><a href="https://github.com/David-Reguera-Garcia-Dreg/anticuckoo" target="_blank" rel="noopener nofollow ugc">David-Reguera-Garcia-Dreg/anticuckoo</a></h3>


  <p><span class="label1">A tool to detect and crash Cuckoo Sandbox . Contribute to David-Reguera-Garcia-Dreg/anticuckoo development by creating an account on GitHub.</span></p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<aside class="onebox githubfolder">
  <header class="source">
      <img src="https://github.githubassets.com/favicons/favicon.svg" class="site-icon" width="32" height="32">
      <a href="https://github.com/ricardojrdez/anti-analysis-tricks" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/345;"><img src="https://0x00sec.s3.amazonaws.com/optimized/3X/5/b/5bad70f90620c71b2416c12d0023a84abd3f0f72_2_690x345.png" class="thumbnail" width="690" height="345" srcset="https://0x00sec.s3.amazonaws.com/optimized/3X/5/b/5bad70f90620c71b2416c12d0023a84abd3f0f72_2_690x345.png, https://0x00sec.s3.amazonaws.com/optimized/3X/5/b/5bad70f90620c71b2416c12d0023a84abd3f0f72_2_1035x517.png 1.5x, https://0x00sec.s3.amazonaws.com/original/3X/5/b/5bad70f90620c71b2416c12d0023a84abd3f0f72.png 2x" data-small-upload="https://0x00sec.s3.amazonaws.com/optimized/3X/5/b/5bad70f90620c71b2416c12d0023a84abd3f0f72_2_10x10.png"></div>

<h3><a href="https://github.com/ricardojrdez/anti-analysis-tricks" target="_blank" rel="noopener nofollow ugc">ricardojrdez/anti-analysis-tricks</a></h3>


  <p><span class="label1">Bunch of techniques potentially used by malware to detect analysis environments</span></p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<aside class="onebox githubfolder">
  <header class="source">
      <img src="https://github.githubassets.com/favicons/favicon.svg" class="site-icon" width="32" height="32">
      <a href="https://github.com/hfiref0x/VMDE" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:393/393;"><img src="https://avatars.githubusercontent.com/u/10708977?s=400&amp;amp;v=4" class="thumbnail" width="393" height="393"></div>

<h3><a href="https://github.com/hfiref0x/VMDE" target="_blank" rel="noopener nofollow ugc">hfiref0x/VMDE</a></h3>


  <p><span class="label1">Source from VMDE paper, adapted to 2015. Contribute to hfiref0x/VMDE development by creating an account on GitHub.</span></p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<aside class="onebox githubfolder">
  <header class="source">
      <img src="https://github.githubassets.com/favicons/favicon.svg" class="site-icon" width="32" height="32">
      <a href="https://github.com/kgretzky/obfusion" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:400/400;"><img src="https://avatars.githubusercontent.com/u/19260967?s=400&amp;amp;v=4" class="thumbnail" width="400" height="400"></div>

<h3><a href="https://github.com/kgretzky/obfusion" target="_blank" rel="noopener nofollow ugc">kgretzky/obfusion</a></h3>


  <p><span class="label1">Obfusion - C++ X86 Code Obfuscation Library. Contribute to kgretzky/obfusion development by creating an account on GitHub.</span></p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<aside class="onebox githubfolder">
  <header class="source">
      <img src="https://github.githubassets.com/favicons/favicon.svg" class="site-icon" width="32" height="32">
      <a href="https://github.com/kirschju/debugmenot" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/345;"><img src="https://0x00sec.s3.amazonaws.com/optimized/3X/f/9/f9525263cf5f6c315f6499c5b100c330d9192ce9_2_690x345.png" class="thumbnail" width="690" height="345" srcset="https://0x00sec.s3.amazonaws.com/optimized/3X/f/9/f9525263cf5f6c315f6499c5b100c330d9192ce9_2_690x345.png, https://0x00sec.s3.amazonaws.com/optimized/3X/f/9/f9525263cf5f6c315f6499c5b100c330d9192ce9_2_1035x517.png 1.5x, https://0x00sec.s3.amazonaws.com/original/3X/f/9/f9525263cf5f6c315f6499c5b100c330d9192ce9.png 2x" data-small-upload="https://0x00sec.s3.amazonaws.com/optimized/3X/f/9/f9525263cf5f6c315f6499c5b100c330d9192ce9_2_10x10.png"></div>

<h3><a href="https://github.com/kirschju/debugmenot" target="_blank" rel="noopener nofollow ugc">kirschju/debugmenot</a></h3>


  <p><span class="label1">Collection of simple anti-debugging tricks for Linux</span></p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<p><a href="https://bitbucket.org/fkie_cd_dare/simplifire.antire/src/master/" class="onebox" target="_blank" rel="noopener nofollow ugc">https://bitbucket.org/fkie_cd_dare/simplifire.antire/src/master/</a></p>
<h1>Misc</h1>
<p><a href="https://www.lasca.ic.unicamp.br/paulo/papers/2017-SBSeg-marcus.botacin-anti.anti.analysis.evasive.malware.pdf" rel="noopener nofollow ugc">[WIN]Analysis, Anti-Analysis, Anti-Anti-Analysis: An Overview of the Evasive Malware Scenario</a><br>
<a href="https://blog.malwarebytes.com/threat-analysis/2014/09/five-anti-debugging-tricks-that-sometimes-fool-analysts/" rel="noopener nofollow ugc">Five Anti-Analysis Tricks That Sometimes Fool Analysts</a><br>
<a href="https://grazfather.github.io/posts/2016-10-12-obfuscation-techniques/" rel="noopener nofollow ugc">Obfuscation Techniques</a><br>
<a href="https://tgwbd.org/darwin/binaryprotection.html" rel="noopener nofollow ugc">Mac OS X Binary Protection</a><br>
<a href="https://permalink.lanl.gov/object/tr?what=info:lanl-repo/lareport/LA-UR-18-25476" rel="noopener nofollow ugc">[WIN] Anti Reverse Engineering</a><br>
<a href="https://evasions.checkpoint.com/" rel="noopener nofollow ugc">Evasion Techniques Wiki</a><br>
<a href="https://www.deepinstinct.com/2019/09/15/malware-evasion-techniques-part-1-process-injection-and-manipulation/" rel="noopener nofollow ugc">[WIN]Malware Evasion 1</a><br>
<a href="https://litigationconferences.com/wp-content/uploads/2017/05/Introduction-to-Evasive-Techniques-v1.0.pdf" rel="noopener nofollow ugc">Evasive Techniques: An Introduction</a><br>
<a href="https://www.ijitee.org/wp-content/uploads/papers/v8i6s3/F10670486S319.pdf" rel="noopener nofollow ugc">[WIN]Anti‚ÄìReverse Engineering Techniques Employed by Malware</a><br>
<a href="https://www.sciencedirect.com/science/article/pii/S2666281720302614" rel="noopener nofollow ugc">Hiding Process Memory Via Anti-Forensic Techniques</a><br>
<a href="https://yellowbyte.github.io/blog/2018/hiding-call-to-ptrace/" rel="noopener nofollow ugc">Hiding Call To Ptrace</a><br>
<a href="https://forum.tuts4you.com/files/file/1218-anti-reverse-engineering-guide/" rel="noopener nofollow ugc">[WIN]Anti-Reverse Engineering Guide</a><br>
<a href="https://leanpub.com/anti-reverse-engineering-linux" rel="noopener nofollow ugc">[LINUX]Programming Linux Anti-Reversing Techniques</a><br>
<a href="https://arxiv.org/pdf/1009.4000.pdf" rel="noopener nofollow ugc">Malicious cryptography techniques for unreversable (malicious or not) binaries</a><br>
<a href="https://www.ma.rhul.ac.uk/static/techrep/2012/MA-2012-10.pdf" rel="noopener nofollow ugc">Malware Armoring: The case against incident related binary analysis</a></p> ]]></description>
        <link>https://d.clarkee.co.uk/t/binary-armory-wiki/25679#post_1</link>
        <pubDate>Fri, 16 Apr 2021 00:03:53 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65475</guid>
      </item>
      <item>
        <title>How do you learn WinApi</title>
        <dc:creator><![CDATA[@n33ds0n n33ds0n]]></dc:creator>
        <description><![CDATA[ <p>1: Can you tell us how you learned all about the windows API</p>
<p>2: How do you master it.</p>
<p>3: What are the resources you used while learning the windows API</p>
<p>4: Share the resources you used with us</p>
<p>5: Which programing language you used C or C++</p>
<p>6: Tell us more</p>
<p>More important the resources(link, PDF video anything just where)</p>
<p>Thanks <img src="https://0x00sec.org/images/emoji/twitter/heart.png?v=9" title=":heart:" class="emoji" alt=":heart:"></p> ]]></description>
        <link>https://d.clarkee.co.uk/t/how-do-you-learn-winapi/25678#post_1</link>
        <pubDate>Thu, 15 Apr 2021 21:15:53 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65472</guid>
      </item>
      <item>
        <title>Programming for Wanabes VII. Finding files I</title>
        <dc:creator><![CDATA[@jeff jeff]]></dc:creator>
        <description><![CDATA[ <p>thank you for this amazing series!</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/programming-for-wanabes-vii-finding-files-i/25662#post_6</link>
        <pubDate>Thu, 15 Apr 2021 19:56:16 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65471</guid>
      </item>
      <item>
        <title>Some books that you would recommend reading</title>
        <dc:creator><![CDATA[@c0z Impetus Omnia Omnem Impetum]]></dc:creator>
        <description><![CDATA[ <p><a href="https://0x00sec.org/t/reading-material-just-for-fun/9888" class="onebox" target="_blank" rel="noopener nofollow ugc">https://0x00sec.org/t/reading-material-just-for-fun/9888</a><br>
<a href="https://0x00sec.org/t/cs-related-books-wiki/4854" class="onebox" target="_blank" rel="noopener nofollow ugc">https://0x00sec.org/t/cs-related-books-wiki/4854</a><br>
<a href="https://0x00sec.org/t/forgs-wiki/4857" class="onebox" target="_blank" rel="noopener nofollow ugc">https://0x00sec.org/t/forgs-wiki/4857</a><br>
<a href="https://0x00sec.org/t/useful-links-wiki/2787" class="onebox" target="_blank" rel="noopener nofollow ugc">https://0x00sec.org/t/useful-links-wiki/2787</a></p> ]]></description>
        <link>https://d.clarkee.co.uk/t/some-books-that-you-would-recommend-reading/25676#post_3</link>
        <pubDate>Thu, 15 Apr 2021 19:12:24 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65469</guid>
      </item>
      <item>
        <title>Programming for Wanabes VII. Finding files I</title>
        <dc:creator><![CDATA[@crimsonRain crimsonRain]]></dc:creator>
        <description><![CDATA[ <p>Really happy to hear that!</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/programming-for-wanabes-vii-finding-files-i/25662#post_5</link>
        <pubDate>Thu, 15 Apr 2021 18:35:41 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65468</guid>
      </item>
      <item>
        <title>Programming for Wanabes VII. Finding files I</title>
        <dc:creator><![CDATA[@0x00pf pico]]></dc:creator>
        <description><![CDATA[ <p>Thanks mate. Your post come just in time. I wrote that sentence and then I saw it and I have to add the reference. Great job!</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/programming-for-wanabes-vii-finding-files-i/25662#post_4</link>
        <pubDate>Thu, 15 Apr 2021 18:18:52 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65467</guid>
      </item>
      <item>
        <title>Obfuscated PHP Backdoor</title>
        <dc:creator><![CDATA[@full Full]]></dc:creator>
        <description><![CDATA[ <p>Yes i ve bought a tool to generate the backdoor and payloads</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/obfuscated-php-backdoor/25477#post_4</link>
        <pubDate>Thu, 15 Apr 2021 18:12:05 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65466</guid>
      </item>
      <item>
        <title>Programming for Wanabes VII. Finding files I</title>
        <dc:creator><![CDATA[@crimsonRain crimsonRain]]></dc:creator>
        <description><![CDATA[ <p>Once again, another great post. Looking forward to more.<br>
P.S. Thanks for referencing my post on CPE!</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/programming-for-wanabes-vii-finding-files-i/25662#post_3</link>
        <pubDate>Thu, 15 Apr 2021 18:04:57 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65465</guid>
      </item>
      <item>
        <title>Some books that you would recommend reading</title>
        <dc:creator><![CDATA[@crimsonRain crimsonRain]]></dc:creator>
        <description><![CDATA[ <p>Well if it were one book, it would definitely be <a href="https://nostarch.com/binaryanalysis" rel="noopener nofollow ugc">Practical Binary Analysis</a> by Dennis Andriesse.</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/some-books-that-you-would-recommend-reading/25676#post_2</link>
        <pubDate>Thu, 15 Apr 2021 17:57:43 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65464</guid>
      </item>
      <item>
        <title>Some books that you would recommend reading</title>
        <dc:creator><![CDATA[@Darkvault Darkvault]]></dc:creator>
        <description><![CDATA[ <p>Your favorite  book about computer  hacking.</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/some-books-that-you-would-recommend-reading/25676#post_1</link>
        <pubDate>Thu, 15 Apr 2021 17:53:04 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65463</guid>
      </item>
      <item>
        <title>0x00sec Wallpapers - 4K</title>
        <dc:creator><![CDATA[@shenlin Êûó Á•û]]></dc:creator>
        <description><![CDATA[ <p>Good job XD Ôºå i love it ÔºÅ</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/0x00sec-wallpapers-4k/24878#post_7</link>
        <pubDate>Thu, 15 Apr 2021 12:06:44 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65460</guid>
      </item>
      <item>
        <title>Need advise on dynamic reversing encrypted php file</title>
        <dc:creator><![CDATA[@messede Messede Degod]]></dc:creator>
        <description><![CDATA[ <aside class="quote no-group" data-username="romzhke" data-post="1" data-topic="25659">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="https://d.clarkee.co.uk/user_avatar/d.clarkee.co.uk/romzhke/48/9738_2.png" class="avatar"> romzhke:</div>
<blockquote>
<p>php interpreter generates some binary</p>
</blockquote>
</aside>
<p>Well interpreters dont generate binaries they generate intermediate (assembly) code which technically be baked into a  binary with some magic , what you need to understand is  how ioncube works  : ioncube basically captures the intermediate code generated by the php interpreter , obfusticates it , base64 encodes it (open any php file in the application you are analyzing you‚Äôll see a large chunk of base64 data) and passes it  to the ioncube loader , which inturn executes it (ioncube functions somewhat like JVM).</p>
<p>Here‚Äôs a very good resource which can help you :  <a href="https://media.blackhat.com/ad-12/Saher/bh-ad-12-stealing-from-thieves-Saher-slides.pdf">https://media.blackhat.com/ad-12/Saher/bh-ad-12-stealing-from-thieves-Saher-slides.pdf</a></p> ]]></description>
        <link>https://d.clarkee.co.uk/t/need-advise-on-dynamic-reversing-encrypted-php-file/25659#post_2</link>
        <pubDate>Thu, 15 Apr 2021 06:21:27 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65452</guid>
      </item>
      <item>
        <title>Multi Platform Execution</title>
        <dc:creator><![CDATA[@messede Messede Degod]]></dc:creator>
        <description><![CDATA[ <p>wow , this is amazing , i didnt know format polygots even existed , thanks for sharing.</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/multi-platform-execution/25663#post_2</link>
        <pubDate>Thu, 15 Apr 2021 05:56:25 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65450</guid>
      </item>
      <item>
        <title>Programming for Wanabes VII. Finding files I</title>
        <dc:creator><![CDATA[@messede Messede Degod]]></dc:creator>
        <description><![CDATA[ <p>Good stuff , as usual <img src="https://0x00sec.org/images/emoji/twitter/+1.png?v=9" title=":+1:" class="emoji" alt=":+1:"><img src="https://0x00sec.org/images/emoji/twitter/+1.png?v=9" title=":+1:" class="emoji" alt=":+1:"><img src="https://0x00sec.org/images/emoji/twitter/ok_hand.png?v=9" title=":ok_hand:" class="emoji" alt=":ok_hand:"></p> ]]></description>
        <link>https://d.clarkee.co.uk/t/programming-for-wanabes-vii-finding-files-i/25662#post_2</link>
        <pubDate>Thu, 15 Apr 2021 05:37:36 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65448</guid>
      </item>
      <item>
        <title>Multi Platform Execution</title>
        <dc:creator><![CDATA[@crimsonRain crimsonRain]]></dc:creator>
        <description><![CDATA[ <p>This is my first post so don‚Äôt expect anything much, just sharing an idea is all. Shoutout to <a class="mention" href="https://d.clarkee.co.uk/u/leeky">@Leeky</a> and <a class="mention" href="https://d.clarkee.co.uk/u/jeff">@jeff</a> for helping out in regards to OS detection as I‚Äôm pretty unfamiliar with it. I recently came across an interesting project called <a href="https://github.com/jart/cosmopolitan" rel="noopener nofollow ugc">cosmopolitan</a>. The part about this project that makes it interesting is that the binaries compiled using comopolitan is that it‚Äôs a compile once and run anywhere. What this means is that you can run the binary without it being compiled specifically for a single OS, but rather is able to be executed using a <a href="https://www.youtube.com/watch?v=VVdmmN0su6E" rel="noopener nofollow ugc">polyglot format</a> called Œ±cœÑ¬µŒ±lly pŒ¥rœÑŒ±blŒµ ŒµxŒµc¬µœÑŒ±blŒµ (pretty aesthetic name, I know) or APE for short. In a nutshell, polyglot formats are files that can be interpreted in different formats depending on what program opens that file. The case of binaries compiled with cosmopolitan falls under this case as different OS loaders are able to properly execute the binary.</p>
<p>I kept thinking of what could be made with such a project as there was no longer a limitation of compiling OS specific binaries. One of the things that came to mind was multi platform malware. I could easily see how malware could be made ‚Äúmulti platform‚Äù through scripts but I‚Äôve never heard of the binary itself being multi platform. Realizing this, I tried to see if there were any caveats using this project. Well, there were quite a few but they shouldn‚Äôt mean much in MalDev:</p>
<ul>
<li>The project doesn‚Äôt support any desktop GUIs hence ‚Äútextmode‚Äù in their github description.</li>
<li>The binary ‚Äúwill assimilate itself as a conventional resident of your platform after the first run‚Äù this means, after the first run, the binary is no longer multi platform sadly. Needless to say, if we require that the binary propagates, we need save a copy of it before execution. The only thing I could think of is the binary copying itself on disk during runtime, note that this may be entirely wrong as I‚Äôm assuming that the assimilation process happens at the end of execution.</li>
</ul>
<pre><code class="lang-auto">Note that I'm no way responsible for any damage the reader may do using this technique and I'm assuming the reader is a responsible person.
</code></pre>
<h1>Setup</h1>
<p>Now enough intro, let‚Äôs get started. We‚Äôre going to be developing in Linux since it‚Äôs far easier to set up due to the fact that developing on Mac or Windows would require installing gnu linux toolchain before compiling cosmopolitan. To get started we run the following as mentioned on the github:</p>
<pre><code class="lang-auto">mkdir mal &amp;&amp; cd mal
wget https://justine.lol/cosmopolitan/cosmopolitan-amalgamation-0.3.zip
unzip cosmopolitan-amalgamation-0.3.zip
</code></pre>
<p>And that‚Äôs it, we just need to stay in the current directory in order for this to work.</p>
<h1>Execution?</h1>
<p>It is commonly known that malware has OS specific techniques and the only thing in our way is to know when to use these OS specific techniques. The only challenge now is to when to use these OS specific techniques. There are two ways we could do this:</p>
<ol>
<li>
<p>A high level method such as looking for presence of paths such as /root, /lib, /bin vs C:\ (thanks uncle jeff)</p>
</li>
<li>
<p>A low level method of using <a href="https://modexp.wordpress.com/2016/06/02/shellcode-detection/" rel="noopener nofollow ugc">Assembly to detect the running OS</a> (thanks Leeky)</p>
</li>
</ol>
<p>Well the point of the post is not to write full fledged malware but rather prove that it is possible to produce a binary that does its malicious job regardless of the OS. In accordance to this, we‚Äôll try to execute payload that pops a shell. This doesn‚Äôt seem malicious you say? Well you can swap the payload for a reverse shell, a forkbomb or a nasty disk wipe if they make the binary qualify as malware.</p>
<h1>High Level</h1>
<p>Now let‚Äôs test if our OS detection techniques work before executing some payload. We‚Äôre going to start off with the first method since it seems to be the easier of the two to implement. The source code and the command to compile the source is as follows:</p>
<pre><code class="lang-auto">int main() {
        char * OS = "None";
        if(isdirectory("C:\\"))
                OS = "Windows";
        else if(isdirectory("/root"))
                OS = "Linux";

        printf("The current OS is %s\n", OS);
}
</code></pre>
<pre><code class="lang-auto">gcc -g -Os -static -nostdlib -nostdinc -fno-pie -no-pie -mno-red-zone \
  -fno-omit-frame-pointer -pg -mnop-mcount \
  -o test.com.dbg test.c -fuse-ld=bfd -Wl,-T,ape.lds \
  -include cosmopolitan.h crt.o ape.o cosmopolitan.a
objcopy -S -O binary test.com.dbg test.com
</code></pre>
<p>It‚Äôs nice how we don‚Äôt have to manually write out includes. Anyway, the code is fairly straightforward. The checking is done through looking for the existence of a particular root directory. If you run this binary in a Windows machine, ‚ÄúThe current OS is Windows‚Äù should be printed to stdout, otherwise it will output ‚ÄúThe current OS is Linux‚Äù. Upon execution, we get the following output on the Windows host and Linux VM respectively.</p>
<pre><code class="lang-auto">C:\Users\crimsonRain\Desktop&gt;test.com
The current OS is Windows
</code></pre>
<pre><code class="lang-auto">crimsonRain@Desktop:~/mal$./test.com
The current OS is Linux
</code></pre>
<p>Happily enough, this works on both Windows 10 and on Ubuntu. Note that I compiled the binary in WSL then copied it to the directory /mnt/c/Users/crimsonRain/Desktop. Since our first method works, let‚Äôs now try the second one.</p>
<h1>Low Level</h1>
<p>As expected, this was the lengthiest to implement as there is a lack of shellcode in regards to OS detection. Though <a href="https://modexp.wordpress.com/2016/06/02/shellcode-detection/" rel="noopener nofollow ugc">this</a> is the only available post on Multi OS Shellcode, it sadly doesn‚Äôt work for Windows 10. Luckily enough, using <a href="https://web.archive.org/web/20160409113027/http://www.chokepoint.net/2013/09/building-multiplatform-shellcode-header.html" rel="noopener nofollow ugc">this post</a> which was referenced in the previous one we are able to customize the given shellcode to suit our needs. The following is the shellcode creation process.</p>
<pre><code class="lang-auto">  bits 32
arch_detect:
  xor eax, eax
  dec eax
  jnz determine_32_os

determine_64_os:
  mov eax, ds
  test eax, eax
  jnz win64_code
  jmp lin64_code

determine_32_os:
  mov eax, fs
  test eax, eax
  jz lin32_code

win32_code:
  xor eax, eax
  ret

lin64_code:
  xor eax, eax
  mov al, 1
  ret

win64_code:
  xor eax, eax
  mov al, 2
  ret

lin32_code:
  xor eax, eax
  mov al, 3
  ret
</code></pre>
<p>Let‚Äôs go through the code for a bit. If we run this in a 32 bit system, the jnz under arch_detect would have eax set as -1. If we run this in a 64 bit system however, the dec eax instruction becomes the REX.W prefix for the jnz as outline in <a href="https://stackoverflow.com/questions/50978180/programmatically-detect-cpu-architecture-at-runtime" rel="noopener nofollow ugc">prl‚Äôs answer</a>. The next part is the determine_64_os label, if we are in a Linux system, the ds segment register is nearly always zero while the opposite is true for Windows. The determine_32_os label is somewhat similar where a Linux system sets the fs segment register to 0 while once again the opposite is true for Windows. The rest of the code is self explanatory as we set 0, 1, 2, 3 as markers to identify the running OS. Continuing on:</p>
<pre><code class="lang-auto">nasm -felf32 shellcode.asm
objcopy -O binary -j .text shellcode.o 
</code></pre>
<p>We have proper shellcode that we want to use, we then get the binary data as a hex string and use it in the following source code:</p>
<pre><code class="lang-auto">int get_os() {
        unsigned char * exec = "\x31\xc0\x48\x75\x08\x8c"
                               "\xd8\x85\xc0\x75\x10\xeb"
                               "\x09\x8c\xe0\x85\xc0\x74"
                               "\x0d\x31\xc0\xc3\x31\xc0"
                               "\xb0\x01\xc3\x31\xc0\xb0"
                               "\x02\xc3\x31\xc0\xb0\x03"
                               "\xc3";
        int (*_get_os)() = (int(*)())exec;
        return _get_os();
}

int main() {
        printf("%d\n", get_os());
        return 0;
}
</code></pre>
<p>As we can see from the source code, we use the classical shellcode execution technique in order to invoke the shellcode that we crafted. Upon execution, we get the following output on the Windows host and Linux VM respectively.</p>
<pre><code class="lang-auto">C:\Users\crimsonRain\Desktop&gt;test.com
1
</code></pre>
<pre><code class="lang-auto">crimsonRain@Desktop:~/mal$./test.com
2
</code></pre>
<p>And yes, I almost forgot to mention the systems are both 64 bit, so this method of OS detection works. We can conclude that both high and low level methods of OS detection work properly but their use case will be discussed further.</p>
<h1>High Level vs Low Level?</h1>
<ol>
<li>Speed and Size - It‚Äôs always a given that Low Level is king in this domain since we take control of constructing assembly instructions rather than handing it off to a compiler. So if you really want these tweaks in performance, you‚Äôre better off using the Low Level method of OS detection.</li>
<li>Ease of Development - Using the High Level method is best if the programmer lacks the appropriate skill to write assembly or wants to save time and effort as crafting shellcode can be fairly frustrating.</li>
<li>Portability - You could say this is a consequence of point 2, where if we used the High Level approach, we would just need to add a function that expects another parameter for another given OS. This is not the case with the Low Level approach as we are required to look for assembly tricks that take advantage of the differences in the given environments of each OS.</li>
</ol>
<h1>Payload Time</h1>
<p>Now we have all the pieces in place and we can finally construct a binary that guarantees execution of payload on either a Windows or Linux system. The following is the final source code with an inclusion of payload:</p>
<pre><code class="lang-auto">int get_os() {
        unsigned char * exec = "\x31\xc0\x48\x75\x08\x8c"
                               "\xd8\x85\xc0\x75\x10\xeb"
                               "\x09\x8c\xe0\x85\xc0\x74"
                               "\x0d\x31\xc0\xc3\x31\xc0"
                               "\xb0\x01\xc3\x31\xc0\xb0"
                               "\x02\xc3\x31\xc0\xb0\x03"
                               "\xc3";
        int (*_get_os)() = (int(*)())exec;
        return _get_os();
}

int main() {
        int OS = get_os();
        if(OS == 1 || OS == 3)
        	system("/bin/bash");
    	else
            system("cmd.exe");
        return 0;
}
</code></pre>
<h1>Conclusion</h1>
<p>It was never thought that cross platform binaries would be a thing, but surprisingly enough, they are here. But through utilizing both an archaic technique of low level OS detection and the new technology of multi platform binaries, we are able to show that it is possible to achieve Multi Platform Execution of a given payload. This idea could be further extended to conditionally executing whole routines for a given OS or be able to make most devices in a network a victim of malware since we don‚Äôt need any third party libraries, no interpreter and no virtual machine.</p>
<p>Well, I hope you enjoyed reading this small post and feel free to point out any mistakes as I‚Äôm also learning. And finally, thank you <a class="mention" href="https://d.clarkee.co.uk/u/0x00pf">@0x00pf</a> for writing out the Programming for Wanabes series which inspired me to write this post in order to share what I learnt.</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/multi-platform-execution/25663#post_1</link>
        <pubDate>Wed, 14 Apr 2021 23:26:59 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65427</guid>
      </item>
      <item>
        <title>Programming for Wanabes VII. Finding files I</title>
        <dc:creator><![CDATA[@0x00pf pico]]></dc:creator>
        <description><![CDATA[ <h1><a name="p-65426-programming-for-wanabes-vii-finding-files-i-1" class="anchor" href="https://d.clarkee.co.uk#p-65426-programming-for-wanabes-vii-finding-files-i-1"></a>Programming for Wanabes VII. Finding files I</h1>
<p>It is time to get started with more advanced code. We will be introducing multiple concepts from this point on and hopefully we will boost our programming skills in no time. In the previous instalment we identified the ability to find files in the disk as a feature required by several malwares.</p>
<p>Actually it is a feature required by many other applications and will let us learn about new system calls, loops and structures. Without further ado, let‚Äôs jump into the topic</p>
<h1><a name="p-65426-getting-ready-to-read-directories-2" class="anchor" href="https://d.clarkee.co.uk#p-65426-getting-ready-to-read-directories-2"></a>Getting Ready to Read directories</h1>
<p>Whenever you need to read the content of a folder and you want to be portable between platforms, the right way to proceed is using the POSIX interface.</p>
<p>I will first dump here a shrink down version of the general program from the <a href="https://0x00sec.org/t/programming-for-wannabes-part-vi-malware-introduction/25595/" rel="noopener nofollow ugc">previous instalment</a>. In the rest of this text we will just work out the <code>select_target</code> functions. Everything else will stay the same for the time being. So, this is our starting point:</p>
<pre data-code-wrap="C"><code class="lang-C">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;errno.h&gt;

#include &lt;sys/types.h&gt;  // POSIX directoy reading interface
#include &lt;dirent.h&gt;

char *the_folder="/tmp/";

typedef int (*PAYLOAD_FUNC)(char *);

int payload (char *target) {
  printf ("Doing malware things to %s\n", target);
}

int select_target (PAYLOAD_FUNC pf) {
  return 0;
}

int main () {
  while (select_target(payload));
}
</code></pre>
<p>No big surprises here, a bunch of include files with the functions and data structures we will need and the functions we introduced for our generic malware. The only tricky thing here is the definition of a function type. I introduced this silently in the previous instalment, but this time we should look deeper into this so you understand what we are doing.</p>
<h2><a name="p-65426-function-pointers-3" class="anchor" href="https://d.clarkee.co.uk#p-65426-function-pointers-3"></a>Function Pointers</h2>
<p>One of the data types that we can use in C are the so-called pointers. We had introduced them earlier in this series, but for completeness let‚Äôs quickly define them again: a pointer is just a variable that contains a memory address. It is said that it <em>Points to</em> that address, hence the name‚Ä¶ <em>Pointer</em>.</p>
<p>Usually pointers point to addresses containing data (variable pointers), but there is no reason why a pointer wouldn‚Äôt point to an address containing code‚Ä¶ a function for instance. In assembly this is very straight forward, we just need to do <code>call/jmp</code> with some kind of indirect addressing (that is, using a register or variable that contains the address to jump into, instead of the direct address, so we can control that value programatically). Let‚Äôs see this with an example</p>
<pre><code>DIRECT                 INDIRECT
                       mov    payload, %rax
call payload           callq  *%rax
</code></pre>
<p>In the direct code we are using the <code>payload</code> address directly. In the indirect code we load the function address in a register and then we jump to the address stored in that register. In general, when you declare a function pointer variable, that pointer will be stored somewhere in the stack, and instead of loading the address directly on <code>RAX</code> (like in this example), we will load <code>RAX</code> with that stack value.</p>
<p>Let‚Äôs change the <code>select_address</code> above to actually call <code>payload</code> and let‚Äôs take a look to the generated code:</p>
<pre data-code-wrap="C"><code class="lang-C">int select_target (PAYLOAD_FUNC pf) {
  pf (the_folder);
  return 0;
}
</code></pre>
<p>This produces the following assembler. You have to compile it with <code>-O2</code> so the code gets slightly optimised, otherwise, gcc will generate code to store the parameter (the function pointer) in the stack and just after that read that stack value and put it in <code>RAX</code>. In other words it just moves the parameter around doing nothing.</p>
<pre data-code-wrap="asm"><code class="lang-asm">00000000000006c0 &lt;select_target&gt;:
 6c0:   48 83 ec 08             sub    $0x8,%rsp
 6c4:   48 89 f8                mov    %rdi,%rax
 6c7:   48 8b 3d 42 09 20 00    mov    0x200942(%rip),%rdi        # 201010 &lt;the_folder&gt;
 6ce:   ff d0                   callq  *%rax
 6d0:   31 c0                   xor    %eax,%eax
 6d2:   48 83 c4 08             add    $0
 6d6:   c3                      retq

</code></pre>
<p>We already know all this, but let‚Äôs refresh our minds once again:</p>
<ul>
<li>We get our parameter (the <code>payload</code> address in this case) in <code>RDI</code></li>
<li>We copy it into <code>RAX</code></li>
<li>Put the <code>the_folder</code> variable in  <code>RDI</code> (remember <code>RDI</code> contains the first parameter)</li>
<li>Run the function indirectly (jump to the content of <code>RAX</code> that in this case is <code>payload</code>)</li>
</ul>
<p>So, that‚Äôs it. In this case we are using the pointer directly, but we could store it in memory and then we will be talking about a function pointer variable. This is obvious and straightforward in asm, but in C we need to use a kind of cryptic way to define function pointers:</p>
<pre data-code-wrap="C"><code class="lang-C">return_type (*var/type) (parameters);
</code></pre>
<p>So you just need to put parenthesis (and an <code>*</code>, after all we are defining a pointer) around the variable or type that you want to define. Let‚Äôs see a few examples:</p>
<pre data-code-wrap="C"><code class="lang-C">int (*func)(int, int);
</code></pre>
<p>This declares a variable named <code>func</code> that is a pointer to a function returning an integer, and expecting two integers as parameters.</p>
<pre data-code-wrap="C"><code class="lang-C">typedef int (*FUNC)(int, int);
FUNC func;
</code></pre>
<p>This renames a function pointer type (that is what <code>typepdef</code> does) to represent the same function we defined above. Then it declares the same variable but using the new type name. This makes the code more readable, but other than that, there is no difference at all.</p>
<p>Also note that the assembler generated to call our function (via the function pointer) is independent of the actual types in the declaration‚Ä¶ you can call the function with whatever you want‚Ä¶ but the function will likely not work as expected, or even crash. The types definitions are just used by the compile to let us know that we are doing what we are suppose to do. Just change the type definition and recompile, you will get the same code.</p>
<h1><a name="p-65426-reading-a-directory-the-posix-way-4" class="anchor" href="https://d.clarkee.co.uk#p-65426-reading-a-directory-the-posix-way-4"></a>Reading a directory the POSIX way</h1>
<p>Now we can get back to the main topic, how to read the content of a directory. Remember, virus, ransomware, spyware, all of them need to scan the disk to find different types of files. Let‚Äôs see how to do this.</p>
<p>We will start doing it the <em>Right Way</em>, that is, how it is expected to be done by any normal system application. And that is using the POSIX interface that is composed of three functions:</p>
<pre><code>opendir  Opens a directory for reading
readdir  Read one directory entry each time it is called
closedir Closes the directory
</code></pre>
<p>This API is intended to mimic the normal file interface (the stream like interface offered by <code>fopen/fread/fclose</code>), but just using slightly different data structures. Using this function our <code>select_target</code> function will look like this:</p>
<pre><code class="lang-auto">int select_target (PAYLOAD_FUNC pf) {
  struct dirent *de;
  DIR           *d;
  
  if (!(d = opendir (_the_folder))) {perror ("opendir:"); exit (EXIT_FAILURE);}

  while (1) {
      errno = 0;
      if (!(de = readdir (d))) {
	    if (errno) perror ("readdir:");
	    break;
      }
      pf (de-&gt;d_name);
    }
  closedir (d);
  return 0;
}
</code></pre>
<p>The first thing to note is that, <code>DIR*</code> is the type used by all the function, it is similar to the classical <code>FILE*</code> that we use with files (when using the stream interface). Conceptually it is the same, a stream abstraction of a directory. The <code>opendir</code> and <code>closedir</code> are intended to intialise the structure and to finish the processing respectively (and release resources). Not much more to say about them, you need to call <code>opendir</code> before start reading the directory, and you have to call <code>closedir</code> whenever you are done processing your folder. Yes, the parameter to <code>opendir</code> is just a string containing the folder to process. We will see later what those functions really do under the hood.</p>
<p>The interesting function is <code>readdir</code> that is the one that actually reads directory entries one by one.</p>
<h1><a name="p-65426-structs-5" class="anchor" href="https://d.clarkee.co.uk#p-65426-structs-5"></a><code>structs</code></h1>
<p>Before looking into <code>readdir</code> in detail, we need to introduce a new C keyword: <code>struct</code>. A <code>struct</code> is a so-called compound type. It is a compound type because it is composed of other types. Each one of those types together with the new we give to them is known as a field. You can think about a <code>struct</code> like a variable that groups more variables together in a convenient way.</p>
<p>The way to declare them is like this:</p>
<pre data-code-wrap="C"><code class="lang-C">struct name_of_the_struct {
  type1  field1;
  type2  field2;
  ....
};
</code></pre>
<p>A more specific example could be:</p>
<pre data-code-wrap="C"><code class="lang-C">struct linux_dirent {
  long           d_ino;
  long           d_off;
  unsigned short d_reclen;
  char           d_name[];
};

struct linux_dirent de,*pde;
</code></pre>
<p>The code above defines a new type named <code>struct linux_dirent</code> (note that you need to use <code>struct</code> to refer to the new type) composed of two longs (64bits integer), one short (16 bit integer) and a string of unknown size. You can add as many fields as you want, but in this case we are using only 4.</p>
<p>After the <code>struct</code> definition we have defined two variables. One is a <code>struct</code> and the other one is a pointer to a <code>struct</code>. Once the variables are declared, we can access the fields using the <code>.</code> for the struct one and the <code>-&gt;</code> operator for the pointer. Just like this:</p>
<pre data-code-wrap="C"><code class="lang-C">de.d_ino = 12345;
de.d_off = 0;
pde = &amp;de;
pde-&gt;d_ino = 54321;
pde-&gt;d_off = 1;
</code></pre>
<p>Whenever you need to pass structs as parameters to function, it is usual to redefine them using <code>typedef</code>s in order to minimise the writing. Imagine a function that returns one of those <code>struct linux_dirent</code> structs and receives as parameter two of them. The prototype will look like:</p>
<pre data-code-wrap="C"><code class="lang-C">struct linux_dirent my_func (struct linux_dirent p1, struct linux_dirent p2);
</code></pre>
<p>This is a lot of writing and also it is harder to figure out the function prototype at one glance. Now imagine, you have 20 more function in your API to deal with this data type‚Ä¶So we could just create an <em>alias</em> for this type:</p>
<pre data-code-wrap="C"><code class="lang-C">typedef struct linux_dirent LDIRENT;
LDIRENT my_func (LDIRENT p1, LDIRENT p2);
</code></pre>
<p>Which is way more easy to read. However this is a matter of personal use. Both approaches will produce the same code. Some people prefers to write everything so it is always clear what is that type (a struct in this case), and other prefer to redefine them. In the standard C library you will find both.</p>
<p><em>Note: It is not common (but indeed possible) to pass and return structs in C functions, usually you will use pointers instead. The reason is that C passes parameter by value. This means that all parameters we pass have to be copied. It is easier to copy 4/8 bytes for a pointer than the roughly 24 bytes required by the struct in our example.</em></p>
<p>All this may look  complicated at first glance, but you will get used to this very quickly. This data structures are all over the place when writing non trivial programs</p>
<p>However, in this course we are not just learning the syntax of C, we are going deeper.</p>
<h1><a name="p-65426-structs-are-just-memory-blocks-6" class="anchor" href="https://d.clarkee.co.uk#p-65426-structs-are-just-memory-blocks-6"></a><code>structs</code> are just memory blocks</h1>
<p>So, what is really a <code>struct</code> ?. Short answer: It is just a memory block. When we declare a variable of type struct, we are just allocating enough space to contain all the struct elements either in the stack, in case our variable is local to a function, in the data segment, in case it is a global variable, or in the <em>Heap</em> in case we allocate the memory block dynamically. This last case we will cover later in this course.</p>
<p>For our previous example we have:</p>
<pre data-code-wrap="C"><code class="lang-C">struct linux_dirent {
  long           d_ino;      // 8 bytes
  long           d_off;      // 8 bytes
  unsigned short d_reclen;   // 2 bytes
  char           d_name[];   // This is a placeholder we will talk about in a sec
};
</code></pre>
<p>So, this structure requires 18 bytes, which will likely be rounded up to 24 bytes to keep the memory alignment (check previous instalments when we introduce the native word size). You can just add a <code>printf</code> using the <code>sizeof</code> operator to find out the actual size of the struct. In memory it will look like:</p>
<pre><code>ADDR+18 -&gt; | d_name
ADDR+16 -&gt; | d_reclen (2 bytes) 
ADDR+8  -&gt; | d_off    (8 bytes) 
ADDR   --&gt; | d_ino    (8 bytes)
            +--------------
</code></pre>
<p>When declaring a variable, such a variable just names that memory block‚Ä¶ Think about it as a label, and therefore it is inmutable (you cannot change its value). It is the same with arrays‚Ä¶ they are like pointers but not completely (we will talk about this again when arrays pop up in our way later in the course).</p>
<p>When you declare a pointer to a struct, you are just allocating memory to store an address that will point to memory block. Note that when declaring a pointer to an structure, the structure is not magically created. It is just a pointer. You need to allocate the memory block for the structure by other means.</p>
<p>You can now add the <code>struct</code> we defined above to your program (we will do that in a sec) and declare a local variable in the <code>select_file</code> function. Then take a look to the generated code. The beginning of the function will allocate extra space (the <code>sub $0xVAL,%rsp</code> at the beginning) to accommodate the new variable.</p>
<h1><a name="p-65426-what-about-the-d_name-field-7" class="anchor" href="https://d.clarkee.co.uk#p-65426-what-about-the-d_name-field-7"></a>What about the <code>d_name</code> field?</h1>
<p>Many of you may be wondering this‚Ä¶ what does that <code>char d_name[]</code> means. Well, it is actually a placeholder. A field added to the <code>struct</code> to point to whatever comes after the rest of the fields. Or to get access to a specific point inside the struct if you prefer. This technique is used when the programmer needs to deal with variable length items.</p>
<p>In this example we do not known how long the name of the directory entry will be. When this happens we usually have two options. We either provide enough space so the longest possible name will fit in our memory block (and/or we limit the longest possible name with additional checks in the code), or we dynamically allocate space for the directory entry whenever we find out its size. Allocations just don‚Äôt happen magically‚Ä¶ even on interpreted languages all these processes are happening under the hood‚Ä¶ whenever you add two strings in python a lot of allocation and memory movement happens.</p>
<p>Let‚Äôs see how would this work. Imagine we are allocating our structure in the stack. Note that the actual memory block is created/managed by the <code>readdir</code> function not for us. The function gives us a pointer to the memory it manages/allocates. As, for the time being, we only know how to allocate memory in the stack, let‚Äôs assume <code>readdir</code> allocates memory in the stack, however it is likely to use some global storage or the heap. You should have an idea of the why at this point.</p>
<p>Also, let‚Äôs assume, that the syscalls used by <code>readdir</code> (remember <code>readdir</code> is a libc function not a system call), will let us known the size of file name it is reporting. Let‚Äôs imagine the length of the filename is <code>len</code>.</p>
<p>Then <code>readdir</code> will allocate in the stack 24 bytes + len, so there is enough space to store the <code>struct linux_dirent</code> fields plus the string. In this case the stack will look like this:</p>
<pre><code>ADDRS+18+len -&gt; | \0
ADDRS+18     -&gt; | d_name (the string goes here)
ADDRS+16     -&gt; | d_reclen (2 bytes) 
ADDRS+8      -&gt; | d_off    (8 bytes) 
ADDRS       --&gt; | d_ino    (8 bytes)
                +--------------
</code></pre>
<p>Whenever we access the <code>d_name</code> field that is located at <code>ADDR+18</code>, we will find a variable length string containing the name of the file being read by <code>readdir</code>.</p>
<p>From a syntactic point of view <code>char d_name[]</code> represents a character string of unknown size. In practise it is just indicating the offset in the memory block holding the structure where the string will be.</p>
<p>This technique is also sometimes used in network programming when the length of the packet is unknown until the packet header is read and the field containing the packet size can be read.</p>
<h1><a name="p-65426-reading-the-directory-8" class="anchor" href="https://d.clarkee.co.uk#p-65426-reading-the-directory-8"></a>Reading the directory</h1>
<p>Now that we know what a <code>struct</code> is, we can start using <code>readdir</code>. This function returns a pointer to a <code>struct dirent</code>. This type is defined in <code>#include &lt;dirent.h&gt;</code> and as you had already figure out the name comes from <em>DIRectory ENTry</em>.</p>
<p>So, each time we run <code>readdir</code> we will get the information of one of the files in the directory. We have to call it again and again until the whole directory is read. So, the question is: when should we stop?. Well, the answer, is in the <code>man</code> pages. Never underestimate the amount of information provided by the man pages. So this is what it says:</p>
<pre><code>RETURN VALUE
       On  success, readdir() returns a pointer to a dirent structure.  (This structure
       may be statically allocated; do not attempt to free(3) it.)

       If the end of the directory stream is reached, NULL is returned and errno is not
       changed.   If  an error occurs, NULL is returned and errno is set appropriately.
       To distinguish end of stream and from an error, set errno to zero before calling
       readdir() and then check the value of errno if NULL is returned.
</code></pre>
<p>Crystal clear. Now we can recall the main loop in our <code>select_target</code> function and look at it again:</p>
<pre data-code-wrap="C"><code class="lang-C">  while (1) {
      errno = 0;
      if (!(de = readdir (d))) {
	    if (errno) perror ("readdir:");
	    break;
      }
      pf (de-&gt;d_name);
    }
</code></pre>
<p>We had already introduced the <code>while</code> loop in the past. It just loops <em>while</em> the condition we set in the <code>while</code> is true. In this case, <code>while(1)</code> means that the loop will run forever, because the condition is always true (!= 0).</p>
<p><em>NOTE:C doesn‚Äôt has a boolean type. Conditional operators traditionally returns FALSE as 0 and TRUE as not zero. Setting the while condition to 1  means that it is always true. You could set it to 31173 and it will work the same, but why would you type 5 numbers when you can just type 1?.</em></p>
<p>Then we are prepared to call <code>readdir</code>. We set <code>errno</code> to zero as proposed in the man page, and call the function, if we get a <code>NULL</code> we fall into the <code>if</code>. Then we check again the <code>errno</code> variable and if it has changed we show and error. In either case, we had an error or we have reached the end of the list, we leave the while loop using <code>break</code>.</p>
<blockquote>
<p>NOTE: The expression we use above <code>if (!p)</code> is equivalent to <code>if (p == 0)</code> or if you prefer <code>if (p == NULL)</code>, the compiler will see that <code>p</code> is a pointer and will change 0 to a compatible representation of <code>NULL</code>. The way to write this is a matter of personal taste and some people says <code>if (!p)</code> is bad style, and some other say it is good‚Ä¶ Just do whatever better suits you, but be aware of what is going under the hood. The key point here is that NULL is a special value and doesn‚Äôt need to be the integer 0. This may be confusing for the beginner. You can take a look to <a href="http://c-faq.com/null/" rel="noopener nofollow ugc">the c faq NULL section</a> for details.</p>
</blockquote>
<p>Otherwise, we access the field <code>d_name</code> in the struct <code>struct dirent</code> that contains the name of the directory entry returned by <code>readdir</code> and pass it to the <code>payload</code> function.</p>
<h1><a name="p-65426-reading-directories-with-system-calls-9" class="anchor" href="https://d.clarkee.co.uk#p-65426-reading-directories-with-system-calls-9"></a>Reading directories with system calls</h1>
<p>We have a working function able to read the content of a directory in the disk using the POSIX interface. Overall, when writing malware we would like to minimise application dependencies and in the extreme case that implies just using the OS and avoid all libraries‚Ä¶ However this is not always possible.</p>
<p>In this case, instead of using the POSIX function we can use the associated Linux system call. This is perfectly fine, however the drawback is that the POSIX version will work with all POSIX compatible operating systems and the non-POSIX version will be Linux specific. In other words, all POSIX compatible system have the <code>opendir/readdir/closedir</code> functions but each one will have different system calls to access the directories. That is what standards are for.</p>
<blockquote>
<p>NOTE: That our program will work in any POSIX complaint system (Linux, NetBSD, OpenBSD, Solaris, MacOs‚Ä¶) means that we can recompile for those systems and the program will still work, it doesn‚Äôt mean that any compiled version of our program will run magically in all POSIX compliant OSes‚Ä¶ <a href="https://0x00sec.org/t/multi-platform-execution/25663/" rel="noopener nofollow ugc">However</a></p>
</blockquote>
<blockquote>
<p>NOTE2: Linux is not officially POSIX complaint. Despite of possible minor divergences the main issue is that POSIX certification, as most certifications out there, are really achieved by paying a fee‚Ä¶</p>
</blockquote>
<p>Anyhow, malware is usually target specific (platform-wise) and getting rid of the standard libc will make our program very small and give us much more control on what is in it and what is not.</p>
<p>So, the system call that we have to use is known as <code>getdents</code>. Sure, you got it, it stands for <em>GET Directory ENTries</em>. There is a man page for it and it says that there is no wrapper provided by libc, so we have to write our own if we want to use it (the man page already says how to do that):</p>
<pre data-code-wrap="C"><code class="lang-C">#include &lt;sys/syscall.h&gt;

int getdents (int fd, char *buf, int len)
{ return syscall (SYS_getdents, fd, buf, len); }
</code></pre>
<p>We will not go all the way down to the kernel right now. We implement it using the <code>syscall</code> standard function instead of invoking the <code>syscall</code> processor instruction directly so we can still use C code and we do not need to start adding assembler at this point. We will get to that a bit later.</p>
<p>In order to use this function, we need a file descriptor for the directory. We can get this using the standard <code>open</code> system call. This will do the trick:</p>
<pre data-code-wrap="C"><code class="lang-C">int select_target (PAYLOAD_FUNC pf) {
  char                buf[BUF_SIZE];
  struct linux_dirent *de;
  int                 fd, n, i;
  
  // Open directory using open
  if ((fd = open (folder, O_RDONLY | O_DIRECTORY)) &lt; 0) exit (1);

  while (1) {
    // Read directory entries
    }
  }
  close (fd);
  return 0;
</code></pre>
<p>At this level, we manage the directory exactly the same than a file. We <code>open</code> it‚Ä¶ and we <code>close</code> it whenever we are done. Now is time to see how to use <code>getdents</code>.</p>
<h2><a name="p-65426-using-getdents-10" class="anchor" href="https://d.clarkee.co.uk#p-65426-using-getdents-10"></a>Using <code>getdents</code></h2>
<p>The <code>getdents</code> prototype is as follows:</p>
<pre><code>int getdents(unsigned int fd, struct linux_dirent *dirp, unsigned int count);
</code></pre>
<p>It receives as parameters a file descriptor (the one we got from the call to <code>open</code> with flag <code>O_DIRECTORY</code>), then a pointer to the <code>struct linux_dirent</code> (actually an pseudo-array of items of this type) and finally the size of the buffer we pass as parameter in the second parameter. You will understand this in a second.</p>
<p>As you can see the second parameter is of type <code>struct linux_dirent</code> instead of the <code>struct_dirent</code> that we used with the POSIX version. These structures are slightly different, but we can get them from the man pages of the <code>readdir</code> function and <code>getdents</code> system call respectively. Anyway we had already introduced it previously when we talked about `structs .</p>
<p>So, how does <code>getdents</code> works?. It doesn‚Äôt return just one directory entry‚Ä¶ it returns as many as will fit in the buffer we pass as second parameter, and that number will vary depending on‚Ä¶ Yes sure, on the length of the name of each entry. So the return value (the number of bytes read) is important in order to extract the information.</p>
<p>The man page also include example code on how to use the system call. I will include here a simplified version to explain how does this syscall work:</p>
<pre data-code-wrap="C"><code class="lang-C">  char                buf[BUF_SIZE];
  struct linux_dirent *de;
  int                 fd, n, i;
(...)
  while (1) {
    n = getdents (fd, buf, BUF_SIZE);
    if (n &lt; 0) exit (1);
    if (n == 0) break;

    // Build file name
    for (i = 0; i &lt; n;) {
      de = (struct linux_dirent *)(buf + i);
      
	pf (de-&gt;d_name);
    i += de-&gt;d_reclen;
  }
</code></pre>
<p>First we call the syscall and process errors and end condition. And after that we have to process all the entries reported by the syscall‚Ä¶and we do not know how many are there. That number will depend on the size of the buffer we pass to the syscall. So we run our loop over bytes and not over <code>struct linux_dirent</code> items because we do not know the size of each entry in the array (actually this is why it is not really an array).</p>
<p>The variable <code>n</code> contains the number of bytes read by <code>getdents</code>.</p>
<p>The first entry will be at offset zero of our buffer. We access it casting our general buffer to the structure, do what we want to do and then we increase the offset by the size of the directory entry that is stored in the field <code>reclen</code>. This will update the offset in the buffer to point to the next entry and we repeat the process.</p>
<blockquote>
<p>NOTE: Casting a pointer is just forcing it into some type. This only make sense for the compiler. In reality, the memory is the same, regardless the cast operation we apply. Casting will allow us to tweak our view of a given memory block. Imaging our memory block is 16 bytes. We can see it as 16 <code>unsigned chars</code>, 8 <code>shorts</code>, 4 <code>ints</code>, 2 <code>longs</code> or 1 <code>longlong</code>. The memory block will have the same content but in our program the values that will get after casting will be different.</p>
<p>Example:<br>
A 8 bytes memory block at address ADDR contains.</p>
<pre><code>addr =  | 0x00 | 0x01 | 0x02 | 0x03 | 0x04 | 0x05 | 0x06 | 0x07 | 
</code></pre>
<pre data-code-wrap="C"><code class="lang-C">long *l = (long *) addr; // l[0] or *l will be 0x0001020304050607
int  *i = (int  *) addr; // i[0] or *i will be 0x00010203 and i[1] or *(i+1) = 0x04050607
char *c = (char *) addr; // c[0] = 0x00, c[1]= 0x01, .... c[7] = 0x07
</code></pre>
</blockquote>
<p>Let‚Äôs see this with an example. Imagine a folder containing just a file named <code>a.txt</code>. This is what <code>getdents</code> will return in the buffer:</p>
<pre><code>buf+64     -&gt; | inode
              +-------------- 
buf+59     -&gt; | a.txt\0
buf+57     -&gt; | 24
buf+49     -&gt; | offset
buf+41     -&gt; | inode
              +--------------
buf+38     -&gt; | ..\0
buf+36     -&gt; | 21 
buf+28     -&gt; | offset
buf+20     -&gt; | inode  &lt;----------+-- addr + 20
              +--------------     |           ^
buf+18     -&gt; | .\0               |           |
buf+16     -&gt; | 20     -----------+-----------+
buf+8      -&gt; | offset            |
buf       --&gt; | inode  &lt;----------+--- addr
              +--------------
</code></pre>
<p><em>NOTE: According to the man page, the offset is the distance from the start of the directory to the next dirent struct, however after printing the values I get on my test program those number look strange. I may need to double check, but may be related to the actual EXT3 filesystem that stores the directories as linked lists. For the time being we can use <code>reclen</code> to deal with the buffer returned by <code>getdents</code>, and ignore <code>d_off</code></em></p>
<p>As you can see we always get the current (<code>.</code>) and the parent ( <code>..</code>) directories and then the rest of files. In this case we only have an extra file and our 1024 bytes buffer will be mostly empty after reading the whole folder. A directory containing many files may fill the buffer completely and we may need to call <code>getdents</code> again to keep reading the directory.</p>
<h1><a name="p-65426-opaque-data-types-the-dir-struct-11" class="anchor" href="https://d.clarkee.co.uk#p-65426-opaque-data-types-the-dir-struct-11"></a>Opaque data types. The <code>DIR</code> struct</h1>
<p>Now we could figure out what is in the <code>DIR</code> type we used with the POSIX interface. It is not that we need that, but figuring out this kind of things will boost your learning‚Ä¶ so it is up to you to skip this section or not.</p>
<p>The <code>DIR</code> type is a so-called opaque data type in the sense that the programmer (that is us) cannot see what is in it. Compare this to the <code>struct dirent</code> we have been used in our examples, where we can see the different fields and we actually need to use them.</p>
<p>Opaque data types are used together with an API that does what we need so we do not need to access the structure directly. This has the advantage that new versions of the SW may change the internal structure of the data type and, as far as the API doesn‚Äôt change our program will still work. This concept is known generically as <em>Encapsulation</em>.</p>
<p>Making a structure opaque is just a matter of not exposing the internal structure. That‚Äôs means, the structure is not defined in the .h files available to the programmer. We will see how to do this later. For the time being this is not relevant.</p>
<p>So, with all the information we have, and after learning how to use the POSIX API we can figure out what is in this <code>DIR</code> data type and also how to implement the different functions. The structure would be more or less like:</p>
<pre data-code-wrap="C"><code class="lang-C">typedef struct __my_dirstream {
	int      fd;             // File descriptor returned by open. Required by getdent
	char     buf[BUF_SIZE];  // Buffer to read directory entries (to call getdent)
	int      n;              // Number of bytes to process
	int      off;            // Number of bytes already processed
} MY_DIR;
</code></pre>
<p>I will leave as exercise to the reader the implementation of the POSIX interface using <code>open/getdents/close</code>. It is a nice exercise to get more fluent with the C programming language. Just do it, it is pretty straightforward with all the information we have learnt so far and will help you to get comfortable with C‚Ä¶ you may need to add more fields to the structure above depending on how do you implement the API.</p>
<h1><a name="p-65426-the-final-version-12" class="anchor" href="https://d.clarkee.co.uk#p-65426-the-final-version-12"></a>The final version</h1>
<p>Just for your convenience this is the final complete version of our directory listing program:</p>
<pre data-code-wrap="C"><code class="lang-C">#define _GNU_SOURCE  // Needed by syscall
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;

#include &lt;unistd.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;sys/types.h&gt;  
#include &lt;sys/stat.h&gt;   // Stat systemcall

#include &lt;sys/syscall.h&gt;

#define BUF_SIZE 1024

#define MFW_EXIT(s) do {perror (s); exit (EXIT_FAILURE);} while (0)

// Dirent Data struct
struct linux_dirent {
  long           d_ino;
  off_t          d_off;
  unsigned short d_reclen;
  char           d_name[];
};


char folder[1024];

// getdent wrapper. Not provided by glibc
int getdents (int fd, char *buf, int len)
{ return syscall (SYS_getdents, fd, buf, len); }

typedef int (*PAYLOAD_FUNC)(char *);

int payload (char *target) {
  printf ("Doing malware things to %s\n", target);
}

int select_target (PAYLOAD_FUNC pf) {
  char                buf[BUF_SIZE];
  struct linux_dirent *de;
  struct stat         st;
  int                 fd, n, i;
  
  // Open directory using open
  if ((fd = open (folder, O_RDONLY | O_DIRECTORY)) &lt; 0) MFW_EXIT("open:");

  while (1) {
    n = getdents (fd, buf, BUF_SIZE);
    if (n &lt; 0) MFW_EXIT ("getdents:");
    if (n == 0) break;

    for (i = 0; i &lt; n;) {
      de = (struct linux_dirent *)(buf + i);
	  pf (de-&gt;d_name);
      i += de-&gt;d_reclen;
    }
  }
  close (fd);
  return 0;
}

int main (int argc, char *argv[]) {
  strcpy (folder, argv[1]);
  while (select_target(payload));
}

</code></pre>
<p>It has some minor changes and all the required includes and defines. I would recommend to go through it and try to understand the stuff that is not described in this text. Do not hesitate to ask in the comments if you do not understand something.</p>
<h1><a name="p-65426-conclusions-13" class="anchor" href="https://d.clarkee.co.uk#p-65426-conclusions-13"></a>Conclusions</h1>
<p>We have learnt how to read a directory using the standard POSIX interface and also using system calls. We have also learnt about function pointers and <code>structs</code>. A lot of stuff to digest. I know.</p>
<p>This is the first step to implement the <code>select_target</code> function. The second one is to be able to determine the details of each file in the directory and thus select the target needed by each specific malware. This is what we will deal with in the next instalment.</p>
<p>Note that these articles are intended for newbies, so be free to ask in the comments about any doubt. There is no stupid question when you are starting so do not be shy, I‚Äôll try to answer all of your doubts and I‚Äôm also interested on knowing if the level of the text is too easy or too hard, so your feedback will be pretty much appreciated.</p>
<p>However I would recommend to first try to answer your question by yourself, using Google, and rechecking the previous instalments. It is not just bad <a href="https://en.wikipedia.org/wiki/Etiquette_in_technology" rel="noopener nofollow ugc">nettiquette </a> to ask questions that you can solve yourself it is also way better for your learning process. The things you learn by yourself remind steady in your memory and broads your view of the topic.</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/programming-for-wanabes-vii-finding-files-i/25662#post_1</link>
        <pubDate>Wed, 14 Apr 2021 21:43:19 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65426</guid>
      </item>
      <item>
        <title>Kali vs BlackArch vs Parrot Sec</title>
        <dc:creator><![CDATA[@Ph03n1x_Crus4d3r]]></dc:creator>
        <description><![CDATA[ <p>This. I never actually used a hacking distro for a very long time. I started with Ubuntu in order to get myself familiar with Linux, then, by the time I was ready to move on, I made one from scratch using Artix. Recently made the move to Kali for compatibility purposes, but your best bet is starting with something simple like Ubuntu, getting some tools, learning how to install them, how they actually function, and go from there.</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/kali-vs-blackarch-vs-parrot-sec/25548#post_11</link>
        <pubDate>Wed, 14 Apr 2021 18:07:03 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65425</guid>
      </item>
      <item>
        <title>Kali vs BlackArch vs Parrot Sec</title>
        <dc:creator><![CDATA[@MrQbits Mereum]]></dc:creator>
        <description><![CDATA[ <p>Yeah, it is more beginner friendly.</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/kali-vs-blackarch-vs-parrot-sec/25548#post_10</link>
        <pubDate>Wed, 14 Apr 2021 14:35:33 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65421</guid>
      </item>
      <item>
        <title>Need advise on dynamic reversing encrypted php file</title>
        <dc:creator><![CDATA[@romzhke Roman]]></dc:creator>
        <description><![CDATA[ <p>Hi folks.<br>
I have some software which is delivered as enctypted php scripts. The encryption which is used is ioncube. So my strategy is to let the software run (it runs as a network service), while i will use R2 debugger to get right into memory\code and do my investigations.<br>
So as i understand the process, php interpreter generates some binary whith is then loaded in memory region with X permissions and passes controll to it. Is it correct?<br>
If yes, i cannot figure out how to locate the memory space i need.<br>
If i attach to the runing process i see the following memory mappings:</p>
<blockquote>
<p>[0x7f18e6909dd7]&gt; dm= ~!so<br>
map 4.1M - 0x000056257a70c000 |#-----------------------------| 0x000056257ab25000 r-x /usr/bin/php7.2<br>
map 484K - 0x000056257ad24000 |#-----------------------------| 0x000056257ad9d000 r-- /usr/bin/php7.2<br>
map 108K - 0x000056257ad9d000 |#-----------------------------| 0x000056257adb8000 rw- /usr/bin/php7.2<br>
map 116K - 0x000056257adb8000 |#-----------------------------| 0x000056257add5000 rw- unk0<br>
map 2.7M - 0x000056257c811000 |#-----------------------------| 0x000056257cac2000 rw- [heap]<br>
map  24K - 0x00007f18da538000 |------------------------------| 0x00007f18da53e000 rw- unk1<br>
map   4K - 0x00007f18dae98000 |------------------------------| 0x00007f18dae99000 rw- unk2<br>
map  16K - 0x00007f18dcfb3000 |------------------------------| 0x00007f18dcfb7000 rw- unk3<br>
map   4K - 0x00007f18ddb1f000 |------------------------------| 0x00007f18ddb20000 rw- unk4<br>
map   4K - 0x00007f18de56f000 |------------------------------| 0x00007f18de570000 rw- unk5<br>
map   4K - 0x00007f18df0f4000 |------------------------------| 0x00007f18df0f5000 rw- unk6<br>
map   4K - 0x00007f18e06a9000 |------------------------------| 0x00007f18e06aa000 rw- unk7<br>
map 124K - 0x00007f18e10b3000 |------------------------------| 0x00007f18e10d2000 rw- unk8<br>
map   8K - 0x00007f18e31f6000 |------------------------------| 0x00007f18e31f8000 rw- unk9<br>
map  36K - 0x00007f18e3465000 |------------------------------| 0x00007f18e346e000 rw- unk10<br>
map  16K - 0x00007f18e38d3000 |------------------------------| 0x00007f18e38d7000 rw- unk11<br>
map 3.2M - 0x00007f18e38d7000 |------------------------------| 0x00007f18e3c00000 r-- /usr/lib/locale/locale-archive<br>
map   2M - 0x00007f18e3c00000 |------------------------------| 0x00007f18e3e00000 rw- unk12<br>
map  16K - 0x00007f18e4449000 |------------------------------| 0x00007f18e444d000 rw- unk13<br>
map   4K - 0x00007f18e65d3000 |------------------------------| 0x00007f18e65d4000 rw- unk14<br>
map  16K - 0x00007f18e67ef000 |------------------------------| 0x00007f18e67f3000 rw- unk15<br>
map  16K - 0x00007f18e6be0000 |------------------------------| 0x00007f18e6be4000 rw- unk16<br>
map  12K - 0x00007f18e72fd000 |------------------------------| 0x00007f18e7300000 rw- unk17<br>
map   4K - 0x00007f18e794d000 |------------------------------| 0x00007f18e794e000 rw- unk18<br>
map   8K - 0x00007f18e8597000 |------------------------------| 0x00007f18e8599000 rw- unk19<br>
map 292K - 0x00007f18e88f5000 |------------------------------| 0x00007f18e893e000 rw- unk20<br>
map 428K - 0x00007f18e8953000 |------------------------------| 0x00007f18e89be000 rw- unk21<br>
map   4K - 0x00007f18e89cd000 |------------------------------| 0x00007f18e89ce000 rw- unk22<br>
map   4K - 0xffffffffff600000 |------------------------------| 0xffffffffff601000 r-x [vsyscall]<br>
map 132K - 0x00007ffe55e0e000 |#####-------------------------| 0x00007ffe55e2f000 rw- [stack]<br>
map  12K - 0x00007ffe55ed4000 |-----------------------------#| 0x00007ffe55ed7000 r-- [vvar]</p>
</blockquote>
<p>So. As i have guessed we nee da memory region with X rights. So we only left with the following:</p>
<blockquote>
<p>[0x7f18e6909dd7]&gt; dm= ~!so | grep ‚Äú-x‚Äù<br>
map 4.1M - 0x000056257a70c000 |#-----------------------------| 0x000056257ab25000 r-x /usr/bin/php7.2<br>
map   4K - 0xffffffffff600000 |------------------------------| 0xffffffffff601000 r-x [vsyscall]</p>
</blockquote>
<p>I‚Äôd say that vsyscall is something related to syscalls, so we are only left wth a single memory map.<br>
So next, i check the mapping inside the selected mem region:</p>
<blockquote>
<p>[0x56257aa6c260]&gt; dmS php<br>
[Sections]</p>
<h2>nth paddr           size vaddr              vsize perm name</h2>
<p>0   0x00000000       0x0 0x00000000           0x0 ---- php7.2.<br>
1   0x00000238      0x1c 0x56257a70c238      0x1c -r-- php7.2..interp<br>
2   0x00000254      0x20 0x56257a70c254      0x20 -r-- php7.2..note.ABI_tag<br>
3   0x00000274      0x24 0x56257a70c274      0x24 -r-- php7.2..note.gnu.build_id<br>
4   0x00000298    0x3328 0x56257a70c298    0x3328 -r-- php7.2..gnu.hash<br>
5   0x000035c0    0xed18 0x56257a70f5c0    0xed18 -r-- php7.2..dynsym<br>
6   0x000122d8    0xbf10 0x56257a71e2d8    0xbf10 -r-- php7.2..dynstr<br>
7   0x0001e1e8    0x13c2 0x56257a72a1e8    0x13c2 -r-- php7.2..gnu.version<br>
8   0x0001f5b0     0x1b0 0x56257a72b5b0     0x1b0 -r-- php7.2..gnu.version_r<br>
9   0x0001f760   0xbf688 0x56257a72b760   0xbf688 -r-- php7.2..rela.dyn<br>
10  0x000dede8    0x4908 0x56257a7eade8    0x4908 -r-- php7.2..rela.plt<br>
11  0x000e36f0      0x17 0x56257a7ef6f0      0x17 -r-x php7.2..init<br>
12  0x000e3710    0x30c0 0x56257a7ef710    0x30c0 -r-x php7.2..plt<br>
13  0x000e67d0      0x30 0x56257a7f27d0      0x30 -r-x php7.2..plt.got<br>
14  0x000e6800  0x279a52 0x56257a7f2800  0x279a52 -r-x php7.2..text<br>
15  0x00360254       0x9 0x56257aa6c254       0x9 -r-x php7.2..fini<br>
16  0x00360260   0x64288 0x56257aa6c260   0x64288 -r-- php7.2..rodata<br>
17  0x003c44e8       0x1 0x56257aad04e8       0x1 -r-- php7.2..stapsdt.base<br>
18  0x003c44ec    0xc33c 0x56257aad04ec    0xc33c -r-- php7.2..eh_frame_hdr<br>
19  0x003d0828   0x48620 0x56257aadc828   0x48620 -r-- php7.2..eh_frame<br>
20  0x00418fd0       0x8 0x56257ad24fd0       0x8 -rw- php7.2..init_array<br>
21  0x00418fd8       0x8 0x56257ad24fd8       0x8 -rw- php7.2..fini_array<br>
22  0x00418fe0   0x76410 0x56257ad24fe0   0x76410 -rw- php7.2..data.rel.ro<br>
23  0x0048f3f0     0x290 0x56257ad9b3f0     0x290 -rw- php7.2..dynamic<br>
24  0x0048f680    0x1978 0x56257ad9b680    0x1978 -rw- php7.2..got<br>
25  0x00491000   0x1a638 0x56257ad9d000   0x1a638 -rw- php7.2..data<br>
26  0x004ab638      0x16 0x56257adb7638      0x16 -rw- php7.2..probes<br>
27  0x004ab64e       0x0 0x56257adb7660   0x1cff0 -rw- php7.2..bss<br>
28  0x004ab650     0x4a8 0x00000000         0x4a8 ---- php7.2..note.stapsdt<br>
29  0x004abaf8      0x34 0x00000000          0x34 ---- php7.2..gnu_debuglink<br>
30  0x004abb2c     0x125 0x00000000         0x125 ---- php7.2..shstrtab</p>
</blockquote>
<p>But here i am not sure.</p>
<ol>
<li>I am right in general? Is this the area i need to focus on?</li>
<li>If 1. is true, then how do i dump the .text section to the disc, for example, And then load it into Ghidra to decompile or build some graphs?</li>
<li>In general what‚Äôs next? I am a bit confused.</li>
</ol> ]]></description>
        <link>https://d.clarkee.co.uk/t/need-advise-on-dynamic-reversing-encrypted-php-file/25659#post_1</link>
        <pubDate>Wed, 14 Apr 2021 13:39:19 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65420</guid>
      </item>
      <item>
        <title>Kali vs BlackArch vs Parrot Sec</title>
        <dc:creator><![CDATA[@faith Faith]]></dc:creator>
        <description><![CDATA[ <p>I personally swear to ParrotSec before Kali &lt;3</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/kali-vs-blackarch-vs-parrot-sec/25548#post_9</link>
        <pubDate>Wed, 14 Apr 2021 11:20:40 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65418</guid>
      </item>
      <item>
        <title>Obfuscated PHP Backdoor</title>
        <dc:creator><![CDATA[@webshell webshell]]></dc:creator>
        <description><![CDATA[ <p>Do you have the latest webshell?</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/obfuscated-php-backdoor/25477#post_3</link>
        <pubDate>Wed, 14 Apr 2021 10:54:44 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65416</guid>
      </item>
      <item>
        <title>Can someone explain a function that return an array in c</title>
        <dc:creator><![CDATA[@n33ds0n n33ds0n]]></dc:creator>
        <description><![CDATA[ <p>Thanks jeff, I really appreciate. now I get itüëç</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/can-someone-explain-a-function-that-return-an-array-in-c/25640#post_3</link>
        <pubDate>Tue, 13 Apr 2021 15:33:48 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65378</guid>
      </item>
      <item>
        <title>Can someone explain a function that return an array in c</title>
        <dc:creator><![CDATA[@jeff jeff]]></dc:creator>
        <description><![CDATA[ <p>Whatever comes before the the function name is the return type, in this case it‚Äôs a <code>int *</code> ( a pointer to an int), so this function returns a pointer to an integer, or as you said an array of integers</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/can-someone-explain-a-function-that-return-an-array-in-c/25640#post_2</link>
        <pubDate>Tue, 13 Apr 2021 14:00:35 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65359</guid>
      </item>
      <item>
        <title>Can someone explain a function that return an array in c</title>
        <dc:creator><![CDATA[@n33ds0n n33ds0n]]></dc:creator>
        <description><![CDATA[ <p>what‚Äôs the * in between a return type and a function name doing when declaring a function that return an array or pointer</p>
<p>int * func(){</p>
<p>}</p>
<p>What‚Äôs is the * doing in there or is it just conventional, I don‚Äôt think so because there must be a reason it is there, I just don‚Äôt want to know how to do it, I want to know why it‚Äôs there.</p>
<p>Does it mean a function pointer, I don‚Äôt think so, because a function pointer is not  declare that way.</p>
<p>I need an explanation, anyone.</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/can-someone-explain-a-function-that-return-an-array-in-c/25640#post_1</link>
        <pubDate>Tue, 13 Apr 2021 12:59:12 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65357</guid>
      </item>
      <item>
        <title>Best language for write malware</title>
        <dc:creator><![CDATA[@crimsonRain crimsonRain]]></dc:creator>
        <description><![CDATA[ <p>Golang is great, quite a few libraries are available to write malware such as <a href="https://github.com/redcode-labs/Coldfire" class="inline-onebox" rel="noopener nofollow ugc">GitHub - redcode-labs/Coldfire: Golang malware development library</a> and <a href="https://github.com/redcode-labs/Neurax" class="inline-onebox" rel="noopener nofollow ugc">GitHub - redcode-labs/Neurax: A framework for constructing self-spreading binaries</a>.</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/best-language-for-write-malware/25514#post_13</link>
        <pubDate>Mon, 12 Apr 2021 20:55:45 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65345</guid>
      </item>
      <item>
        <title>Programming for Wannabes Part VI. Malware Introduction</title>
        <dc:creator><![CDATA[@crimsonRain crimsonRain]]></dc:creator>
        <description><![CDATA[ <p>Was waiting a long time for part VI. Thank you <a class="mention" href="https://d.clarkee.co.uk/u/0x00pf">@0x00pf</a> for taking the time to write such great posts.</p> ]]></description>
        <link>https://d.clarkee.co.uk/t/programming-for-wannabes-part-vi-malware-introduction/25595#post_3</link>
        <pubDate>Mon, 12 Apr 2021 20:53:55 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-65344</guid>
      </item>
  </channel>
</rss>
