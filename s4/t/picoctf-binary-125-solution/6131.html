<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>PicoCTF Binary 125: Solution - CTF - 0x00sec - The Home of the Hacker</title>
    <meta name="description" content="Hello 0x00sec! 
As some of you may have seen in IRC, I have promised to deliver an article. But I couldn‚Äôt unfortunately, because my work has been intense lately. Then I thought that I could translate a few of my blog po&amp;hellip;">
    <meta name="generator" content="Discourse 3.6.0.beta2-latest - https://github.com/discourse/discourse version 3b1964f3ed8bdc2f181e2abccb1b116e4b814db5">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.html">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.html">
<meta name="theme-color" media="all" content="#171616">

<meta name="color-scheme" content="dark">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="6131.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">

    
    <link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4.css_%3b%20filename_%3dUTF-8%27%27color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" class="light-scheme" data-scheme-id="15"/>

<link href="../../stylesheets/common_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27common_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common"  />

  <link href="../../stylesheets/mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile"  />
  <link href="../../stylesheets/desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop"  />



    <link href="../../stylesheets/chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="chat"  />
    <link href="../../stylesheets/checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="checklist"  />
    <link href="../../stylesheets/discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-cakeday"  />
    <link href="../../stylesheets/discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="../../stylesheets/discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="../../stylesheets/discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="../../stylesheets/discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="../../stylesheets/discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="../../stylesheets/discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-solved"  />
    <link href="../../stylesheets/discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-templates"  />
    <link href="../../stylesheets/discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-topic-voting"  />
    <link href="../../stylesheets/docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="../../stylesheets/footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="../../stylesheets/poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="poll"  />
    <link href="../../stylesheets/spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="../../stylesheets/chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="chat_mobile"  />
    <link href="../../stylesheets/discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-solved_mobile"  />
    <link href="../../stylesheets/discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-topic-voting_mobile"  />
    <link href="../../stylesheets/chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="chat_desktop"  />
    <link href="../../stylesheets/discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="discourse-topic-voting_desktop"  />
    <link href="../../stylesheets/poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="poll_desktop"  />

  <link href="../../stylesheets/common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960db.css_%3b%20filename_%3dUTF-8%27%27common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960dba97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="57" data-theme-name="0x00sec-v2"/>
    <link href="../../stylesheets/mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38.css_%3b%20filename_%3dUTF-8%27%27mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile_theme" data-theme-id="4" data-theme-name="mobile chrome"/>
    <link href="../../stylesheets/desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2"/>

    <link rel="stylesheet" href="../../../external.html?link=https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="../../../external.html?link=https://s3.amazonaws.com/0x00sec/highlight.pack.js" nonce="N6jvViTGLZP1JrEbuiBoTxPHd"></script>
<script defer="" src="../../theme-javascripts/05954ff525aceb8daa8b585f92d758d311ae7077.js_%3b%20filename_%3dUTF-8%27%2705954ff525aceb8daa8b585f92d758d311ae7077a97f.js?__ws=d.clarkee.co.uk" data-theme-id="40" nonce="N6jvViTGLZP1JrEbuiBoTxPHd"></script>
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;PicoCTF Binary 125: Solution&#39;" href="6131.rss" />
    <meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://0x00sec.s3.amazonaws.com/original/2X/b/bd2a194a481866379b6bd34267ddb9968b1a4e39.png" />
<meta property="og:image" content="https://0x00sec.s3.amazonaws.com/original/2X/b/bd2a194a481866379b6bd34267ddb9968b1a4e39.png" />
<meta property="og:url" content="https://d.clarkee.co.uk/t/picoctf-binary-125-solution/6131" />
<meta name="twitter:url" content="https://d.clarkee.co.uk/t/picoctf-binary-125-solution/6131" />
<meta property="og:title" content="PicoCTF Binary 125: Solution" />
<meta name="twitter:title" content="PicoCTF Binary 125: Solution" />
<meta property="og:description" content="Hello 0x00sec!  As some of you may have seen in IRC, I have promised to deliver an article. But I couldn‚Äôt unfortunately, because my work has been intense lately. Then I thought that I could translate a few of my blog posts which I‚Äôm writing on my website (http://www.robindimyanoglu.com) as a less time consuming solution üôÇ  Feel free to visit, but beware! Posts are in Turkish üòÉ  At this challenge we were asked to connect a service on ‚Äúshell2017.picoctf.com:49182‚Äù and exploit ..." />
<meta name="twitter:description" content="Hello 0x00sec!  As some of you may have seen in IRC, I have promised to deliver an article. But I couldn‚Äôt unfortunately, because my work has been intense lately. Then I thought that I could translate a few of my blog posts which I‚Äôm writing on my website (http://www.robindimyanoglu.com) as a less time consuming solution üôÇ  Feel free to visit, but beware! Posts are in Turkish üòÉ  At this challenge we were asked to connect a service on ‚Äúshell2017.picoctf.com:49182‚Äù and exploit ..." />
<meta property="og:article:section" content="CTF" />
<meta property="og:article:section:color" content="F1592A" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="3 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="12 ‚ù§" />
<meta property="article:published_time" content="2018-04-01T20:36:01+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    <div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">
  <!--<a href="https://git.0x00sec.org" class="dow-menu">GitLab</a>  
  <a href="https://blog.0x00sec.org/irc" class="dow-menu">IRC</a>!-->
  <a href="../../../external.html?link=https://init.0x00sec.org/" class="dow-menu">Init</a>
  <a href="../../../external.html?link=https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
  <a href="../../../external.html?link=https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
    <header>
  <a href="../../index.html">0x00sec - The Home of the Hacker</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="6131.html">PicoCTF Binary 125: Solution</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/ctf/55.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #F1592A'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>CTF</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='../../../external.html?link=http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='PicoCTF Binary 125: Solution'>
      <link itemprop='url' href='6131.html'>
      <meta itemprop='datePublished' content='2018-04-01T20:36:01Z'>
        <meta itemprop='articleSection' content='CTF'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
        <meta itemprop='name' content='0x00sec - The Home of the Hacker'>
          <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
            <meta itemprop='url' content='../../uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.html'>
          </div>
      </div>


          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/hunter.html'><span itemprop='name'>hunter</span></a>
                
              </span>

                <link itemprop="mainEntityOfPage" href="6131.html">

                <link itemprop="image" href="../../../0x00sec.s3.amazonaws.com/original/2X/b/bd2a194a481866379b6bd34267ddb9968b1a4e39.png">

              <span class="crawler-post-infos">
                  <time  datetime='2018-04-01T20:36:01Z' class='post-time'>
                    April 1, 2018,  8:36pm
                  </time>
                  <meta itemprop='dateModified' content='2018-04-01T20:53:33Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Hello 0x00sec!</p>
<p>As some of you may have seen in IRC, I have promised to deliver an article. But I couldn‚Äôt unfortunately, because my work has been intense lately. Then I thought that I could translate a few of my blog posts which I‚Äôm writing on my website (<a href="../../../external.html?link=http://www.robindimyanoglu.com/">http://www.robindimyanoglu.com</a>) as a less time consuming solution <img src="../../../0x00sec.org/images/emoji/twitter/slight_smilec164.html?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"><br>
Feel free to visit, but beware! Posts are in Turkish <img src="../../../0x00sec.org/images/emoji/twitter/smileyc164.html?v=9" title=":smiley:" class="emoji" alt=":smiley:"></p>
<p>At this challenge we were asked to connect a service on ‚Äú<a href="../../../external.html?link=http://shell2017.picoctf.com:49182/">shell2017.picoctf.com:49182</a>‚Äù and exploit it. When I connected, I have encountered with this;<br>
<img src="../../../0x00sec.s3.amazonaws.com/original/2X/b/bd2a194a481866379b6bd34267ddb9968b1a4e39.png" alt="resim" data-base62-sha1="qZqragNzXccJtHcVLvM6ylQbCbL" width="690" height="333"></p>
<p>We were also provided with source code of the working service.</p>
<pre><code class="lang-auto">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;time.h&gt;
#include &lt;string.h&gt;
 
#define NAMEBUFFLEN 32
#define BETBUFFLEN 8
 
typedef struct _card{
    char suit;
    char value;
} card;
 
typedef struct _deck{
    size_t deckSize;
    size_t top;
    card cards[52];
} deck;
 
typedef struct _player{
    int money;
    deck playerCards;
} player;
 
typedef struct _gameState{
  int playerMoney;
  player ctfer;
  char name[NAMEBUFFLEN];
  size_t deckSize;
  player opponent;
} gameState;
 
gameState gameData;
 
//Shuffles the deck
//Make sure to call srand() before!
void shuffle(deck * inputDeck){
    card temp;
    size_t indexA, indexB;
    size_t deckSize = inputDeck-&gt;deckSize;
    for(unsigned int i=0; i &lt; 1000; i++){
        indexA = rand() % deckSize;
        indexB = rand() % deckSize;
        temp = inputDeck-&gt;cards[indexA];
        inputDeck-&gt;cards[indexA] = inputDeck-&gt;cards[indexB];
        inputDeck-&gt;cards[indexB] = temp;
    }
}
 
//Checks if a card is in invalid range
int checkInvalidCard(card * inputCard){
    if(inputCard-&gt;suit &gt; 4 || inputCard-&gt;value &gt; 14){
        return 1;
    }
    return 0;
}
 
//Reads input from user, and properly terminates the string
unsigned int readInput(char * buff, unsigned int len){
    size_t count = 0;
    char c;
    while((c = getchar()) != '\n' &amp;&amp; c != EOF){
        if(count &lt; (len-1)){
            buff[count] = c;
            count++;
        }
    }
    buff[count+1] = '\x00';
    return count;
}
 
//Builds the deck for each player.
//Good luck trying to win ;)
void buildDecks(player * ctfer, player * opponent){
    for(size_t j = 0; j &lt; 6; j++){
        for(size_t i = 0; i &lt; 4; i++){
            ctfer-&gt;playerCards.cards[j*4 + i].suit = i;
            ctfer-&gt;playerCards.cards[j*4 + i].value = j+2;
        }
    }
    for(size_t j = 0; j &lt; 6; j++){
        for(size_t i = 0; i &lt; 4; i++){
            opponent-&gt;playerCards.cards[j*4 + i].suit = i;
            opponent-&gt;playerCards.cards[j*4 + i].value = j+9;
        }
    }
    ctfer-&gt;playerCards.cards[24].suit = 0;
    ctfer-&gt;playerCards.cards[24].value = 8;
    ctfer-&gt;playerCards.cards[25].suit = 1;
    ctfer-&gt;playerCards.cards[25].value = 8;
    opponent-&gt;playerCards.cards[24].suit = 2;
    opponent-&gt;playerCards.cards[24].value = 8;
    opponent-&gt;playerCards.cards[25].suit = 3;
    opponent-&gt;playerCards.cards[25].value = 8;
 
    ctfer-&gt;playerCards.deckSize = 26;
    ctfer-&gt;playerCards.top = 0;
    opponent-&gt;playerCards.deckSize = 26;
    opponent-&gt;playerCards.top = 0;
}
 
int main(int argc, char**argv){
    char betStr[BETBUFFLEN];
    card * oppCard;
    card * playCard;
    memset(&amp;gameData, 0, sizeof(gameData));
    gameData.playerMoney = 100;
    int bet;
 
    buildDecks(&amp;gameData.ctfer, &amp;gameData.opponent);
    srand(time(NULL));//Not intended to be cryptographically strong
 
    shuffle(&amp;gameData.ctfer.playerCards);
    shuffle(&amp;gameData.opponent.playerCards);
 
    setbuf(stdout, NULL);
 
    //Set to be the smaller of the two decks.
    gameData.deckSize = gameData.ctfer.playerCards.deckSize &gt; gameData.opponent.playerCards.deckSize
   ? gameData.opponent.playerCards.deckSize : gameData.ctfer.playerCards.deckSize;
 
    printf("Welcome to the WAR card game simulator. Work in progress...\n");
    printf("Cards don't exchange hands after each round, but you should be able to win without that,right?\n");
    printf("Please enter your name: \n");
    memset(gameData.name,0,NAMEBUFFLEN);
    if(!readInput(gameData.name,NAMEBUFFLEN)){
        printf("Read error. Exiting.\n");
        exit(-1);
    }
    printf("Welcome %s\n", gameData.name);
    while(1){
        size_t playerIndex = gameData.ctfer.playerCards.top;
        size_t oppIndex = gameData.opponent.playerCards.top;
        oppCard = &amp;gameData.opponent.playerCards.cards[oppIndex];
        playCard = &amp;gameData.ctfer.playerCards.cards[playerIndex];
        printf("You have %d coins.\n", gameData.playerMoney);
        printf("How much would you like to bet?\n");
        memset(betStr,0,BETBUFFLEN);
        if(!readInput(betStr,BETBUFFLEN)){
            printf("Read error. Exiting.\n");
            exit(-1);
        };
        bet = atoi(betStr);
        printf("you bet %d.\n",bet);
        if(!bet){
            printf("Invalid bet\n");
            continue;
        }
        if(bet &lt; 0){
            printf("No negative betting for you! What do you think this is, a ctf problem?\n");
           continue;
        }
        if(bet &gt; gameData.playerMoney){
            printf("You don't have that much.\n");
            continue;
        }
        printf("The opponent has a %d of suit %d.\n", oppCard-&gt;value, oppCard-&gt;suit);
        printf("You have a %d of suit %d.\n", playCard-&gt;value, playCard-&gt;suit);
        if((playCard-&gt;value * 4 + playCard-&gt;suit) &gt; (oppCard-&gt;value * 4 + playCard-&gt;suit)){
            printf("You won? Hmmm something must be wrong...\n");
            if(checkInvalidCard(playCard)){
                printf("Cheater. That's not actually a valid card.\n");
            }else{
                printf("You actually won! Nice job\n");           
                gameData.playerMoney += bet;
            }
        }else{
            printf("You lost! :(\n");
            gameData.playerMoney -= bet;
        }
        gameData.ctfer.playerCards.top++;
        gameData.opponent.playerCards.top++;
        if(gameData.playerMoney &lt;= 0){
            printf("You are out of coins. Game over.\n");
            exit(0);
        }else if(gameData.playerMoney &gt; 500){
            printf("You won the game! That's real impressive, seeing as the deck was rigged...\n");
         system("/bin/sh -i");
            exit(0);
        }
 
        //TODO: Implement card switching hands. Cheap hack here for playability
        gameData.deckSize--;
        if(gameData.deckSize == 0){
            printf("All card used. Card switching will be implemented in v1.0, someday.\n");
            exit(0);
        }
        printf("\n");
     fflush(stdout);
    };
 
    return 0;
}
</code></pre>
<p>The game is called WAR, it‚Äôs a card game where two players given a deck of 26 cards and 100 coins. Then players place bets and reveals the card on top of their deck. Player with bigger card gets the money. This game continues till either someone is out of his money or deck has no more cards to play with.</p>
<p>This game also has a special ‚Äúreward‚Äù. If you happen to gather more then 500 coins, it gives you a shell. Huge reward, right? <img src="../../../0x00sec.org/images/emoji/twitter/slight_smilec164.html?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<pre><code class="lang-auto">if(gameData.playerMoney &lt;= 0){
    printf("You are out of coins. Game over.\n");
    exit(0);
}else if(gameData.playerMoney &gt; 500){
    printf("You won the game! That's real impressive, seeing as the deck was rigged...\n");
 system("/bin/sh -i");
    exit(0);
}
</code></pre>
<p>But soon after we see that the decks are rigged and that $ is too good to be true I guess <img src="../../../0x00sec.org/images/emoji/twitter/smileyc164.html?v=9" title=":smiley:" class="emoji" alt=":smiley:"></p>
<pre><code class="lang-auto">//Builds the deck for each player.
//Good luck trying to win ;)
void buildDecks(player * ctfer, player * opponent){
    for(size_t j = 0; j &lt; 6; j++){
        for(size_t i = 0; i &lt; 4; i++){
            ctfer-&gt;playerCards.cards[j*4 + i].suit = i;
            ctfer-&gt;playerCards.cards[j*4 + i].value = j+2;
        }
    }
    for(size_t j = 0; j &lt; 6; j++){
        for(size_t i = 0; i &lt; 4; i++){
            opponent-&gt;playerCards.cards[j*4 + i].suit = i;
            opponent-&gt;playerCards.cards[j*4 + i].value = j+9;
        }
    }
    ctfer-&gt;playerCards.cards[24].suit = 0;
    ctfer-&gt;playerCards.cards[24].value = 8;
    ctfer-&gt;playerCards.cards[25].suit = 1;
    ctfer-&gt;playerCards.cards[25].value = 8;
    opponent-&gt;playerCards.cards[24].suit = 2;
    opponent-&gt;playerCards.cards[24].value = 8;
    opponent-&gt;playerCards.cards[25].suit = 3;
    opponent-&gt;playerCards.cards[25].value = 8;
 
    ctfer-&gt;playerCards.deckSize = 26;
    ctfer-&gt;playerCards.top = 0;
    opponent-&gt;playerCards.deckSize = 26;
    opponent-&gt;playerCards.top = 0;
}
</code></pre>
<p>Or is it?</p>
<h2>Off-by-one bug</h2>
<p>This vulnerability is caused when you write into <em>n</em>‚Äôth indice of an <em>n</em> sized array. A common occurence of this is when a developer miscalculates the bounds of an array and iterates it <em>from 0 through n</em> (remember, array indices start from zero so it should be n-1 and not n). The bug in this code is in <strong>readInput</strong> function.</p>
<pre><code class="lang-auto">//Reads input from user, and properly terminates the string
unsigned int readInput(char * buff, unsigned int len){
    size_t count = 0;
    char c;
    while((c = getchar()) != '\n' &amp;&amp; c != EOF){
        if(count &lt; (len-1)){
            buff[count] = c;
            count++;
        }
    }
    buff[count+1] = '\x00';
    return count;
}
</code></pre>
<p>Now lets see where that function is used:</p>
<pre><code class="lang-auto">printf("Please enter your name: \n");
memset(gameData.name,0,NAMEBUFFLEN);
if(!readInput(gameData.name,NAMEBUFFLEN)){
    printf("Read error. Exiting.\n");
    exit(-1);
}
printf("Welcome %s\n", gameData.name);
</code></pre>
<p>In this call we have two arguments; one is being element of a structure called <em>gameData</em> and another is a macro named <em>NAMEBUFFLEN</em> defining upper limit of the loop. Lets take a look at both.</p>
<pre><code class="lang-auto">#define NAMEBUFFLEN 32
...
typedef struct _gameState{
  int playerMoney;
  player ctfer;
  char name[NAMEBUFFLEN];
  size_t deckSize;
  player opponent;
} gameState;
 
gameState gameData;
</code></pre>
<p>So that upper limit seems to be 32, and allocated size of the <em>gameData.name</em> array is also 32 bytes.<br>
When our ‚Äúname‚Äù happens to be exactly 32 bytes long, <em>readInput</em> function will iterate all the array and overwrite <em>gameData.name[32]</em> with a nullbyte (zero). We see that variable <em>deckSize</em> comes right after <em>name</em> inside <em>gameData</em> structure. That means;</p>
<pre><code>gameData.name[32] = 0;
</code></pre>
<p>is equal to</p>
<pre><code>deckSize = 0;
</code></pre>
<p>Lets try it out by giving a 32 bytes long input.</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/b/b9344fedd4f0e78f3f7d58544f8115785432fecf.png" alt="resim" data-base62-sha1="qqoprMyovHnAqSLfh8g9P0JWilN" width="690" height="109"></p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/e/e138b0748b534a592636624435e7e9b0c8f3977f.png" alt="resim" data-base62-sha1="w8oSZTxSIbZFBUhMliy1grFUPIr" width="690" height="109"></p>
<h2>What happens next?</h2>
<p>We have set deck size to zero so now what?</p>
<pre><code class="lang-auto">gameData.deckSize--;
if(gameData.deckSize == 0){
    printf("All card used. Card switching will be implemented in v1.0, someday.\n");
    exit(0);
}
</code></pre>
<p>Another day, another bug <img src="../../../0x00sec.org/images/emoji/twitter/slight_smilec164.html?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"> Deck size is first decremented and then checked its equality to zero. If we zero out the deck size value in the beginning of the game then it‚Äôll right off decrement it to -1 so we‚Äôll keep playing even after we‚Äôre out of cards, yay! <img src="../../../0x00sec.org/images/emoji/twitter/slight_smilec164.html?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/0/079258dd3b7f282c8ac85f242ff8f7de5bf7c94a.png" alt="resim" data-base62-sha1="14YT9u0aI1ycpnKHFE6htrOlaye" width="296" height="407"></p>
<p>Below is the <strong>approximiate</strong> layout of variables in the process memory.<br>
<img src="../../../0x00sec.s3.amazonaws.com/original/2X/d/dd23207086dcbbef2ad2bfa4dbb70ac628680feb.png" alt="resim" data-base62-sha1="vygMkPH99smnveee7BJMIRvEQcz" width="690" height="345"></p>
<p>After decks are finished, it continues to iterate through what‚Äôs next in the memory, which is some zeroes and then <em>gameData.name</em> for us (which is under our control) and all zeroes for the opponent <img src="../../../0x00sec.org/images/emoji/twitter/slight_smilec164.html?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:">  For the last we have a small condition to pass through.</p>
<pre><code class="lang-auto">//Checks if a card is in invalid range
int checkInvalidCard(card * inputCard){
    if(inputCard-&gt;suit &gt; 4 || inputCard-&gt;value &gt; 14){
        return 1;
    }
    return 0;
}
</code></pre>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/a/a4d63856c978bd9663dbd7ae83efb3513cf37eff.png" alt="resim" data-base62-sha1="nwdgI8mMGjWiFEUMQZ99tNu7dmL" width="400" height="445"></p>
<p>We pass this one by giving 32 <em>\x01</em>‚Äôs as our ‚Äúname‚Äù input. Now it‚Äôs time to place the right bets <img src="../../../0x00sec.org/images/emoji/twitter/slight_smilec164.html?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p>Our input should consist of:</p>
<ol>
<li>‚Äú\x01‚Äù*32 + ‚Äú\n‚Äù (value we should enter in ‚Äúname‚Äù input)</li>
<li>‚Äú1\n‚Äù*52 (we‚Äôll lose first 52 bets, remaining money is 48 coins)</li>
<li>‚Äú48\n‚Äù*10 (we‚Äôll win these bets)</li>
</ol>
<p>Here‚Äôs a little python code that does this:<br>
python2 -c ‚Äòprint chr(1)*32 + ‚Äú\n‚Äù + ‚Äú1\n‚Äù*52 + ‚Äú48\n‚Äù*10‚Äô</p>
<p>Now lets connect to the server and send our input.<br>
<img src="../../../0x00sec.s3.amazonaws.com/original/2X/2/2837bb219d36feec174c5c67a07b9721ecb5252c.png" alt="resim" data-base62-sha1="5JMv7hKnVc9B5jN2ulT7dCea8qM" width="690" height="331"></p>
<p>We won yay! <img src="../../../0x00sec.org/images/emoji/twitter/smileyc164.html?v=9" title=":smiley:" class="emoji" alt=":smiley:"></p>
<p>I hope you liked this article. See you in the next one <img src="../../../0x00sec.org/images/emoji/twitter/slight_smilec164.html?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="9" />
              <span class='post-likes'>9 Likes</span>
            </div>


            
          </div>
          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/nugget.html'><span itemprop='name'>nugget</span></a>
                (nugget)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-04-01T20:42:17Z' class='post-time'>
                    April 1, 2018,  8:42pm
                  </time>
                  <meta itemprop='dateModified' content='2018-04-01T20:42:17Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Good work nice and clear article</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="3" />
              <span class='post-likes'>3 Likes</span>
            </div>


            
          </div>
          <div id='post_3' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/system.html'><span itemprop='name'>system</span></a>
                (system)
                  Closed 
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-05-01T20:36:02Z' class='post-time'>
                    May 1, 2018,  8:36pm
                  </time>
                  <meta itemprop='dateModified' content='2018-05-01T20:36:02Z'>
              <span itemprop='position'>3</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>This topic was automatically closed after 30 days. New replies are no longer allowed.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
    </div>


    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../index.html' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../categories.html' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../guidelines.html' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../tos.html' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../privacy.html' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    <script src="../../../external.html?link=http://instant.page/3.0.0" type="module" defer="" integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1" nonce="N6jvViTGLZP1JrEbuiBoTxPHd"></script>
  </body>
  
</html>
