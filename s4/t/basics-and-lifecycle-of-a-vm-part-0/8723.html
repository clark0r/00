<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Basics and lifecycle of a VM - Part #0 - Hardware - 0x00sec - The Home of the Hacker</title>
    <meta name="description" content="Basics and lifecycle of a VM - Part #0
â–¶ 
Edit

Disclaimer 
This article is based on extensive research and I am not an expert in this field. The only intention Iâ€™ve got was â€œto understand how virtualization is working and&amp;hellip;">
    <meta name="generator" content="Discourse 3.6.0.beta2-latest - https://github.com/discourse/discourse version 3b1964f3ed8bdc2f181e2abccb1b116e4b814db5">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.html">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.html">
<meta name="theme-color" media="all" content="#171616">

<meta name="color-scheme" content="dark">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="8723.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">

    
    <link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4.css_%3b%20filename_%3dUTF-8%27%27color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" class="light-scheme" data-scheme-id="15"/>

<link href="../../stylesheets/common_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27common_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common"  />

  <link href="../../stylesheets/mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile"  />
  <link href="../../stylesheets/desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop"  />



    <link href="../../stylesheets/chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="chat"  />
    <link href="../../stylesheets/checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="checklist"  />
    <link href="../../stylesheets/discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-cakeday"  />
    <link href="../../stylesheets/discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="../../stylesheets/discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="../../stylesheets/discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="../../stylesheets/discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="../../stylesheets/discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="../../stylesheets/discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-solved"  />
    <link href="../../stylesheets/discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-templates"  />
    <link href="../../stylesheets/discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-topic-voting"  />
    <link href="../../stylesheets/docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="../../stylesheets/footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="../../stylesheets/poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="poll"  />
    <link href="../../stylesheets/spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="../../stylesheets/chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="chat_mobile"  />
    <link href="../../stylesheets/discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-solved_mobile"  />
    <link href="../../stylesheets/discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-topic-voting_mobile"  />
    <link href="../../stylesheets/chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="chat_desktop"  />
    <link href="../../stylesheets/discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="discourse-topic-voting_desktop"  />
    <link href="../../stylesheets/poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="poll_desktop"  />

  <link href="../../stylesheets/common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960db.css_%3b%20filename_%3dUTF-8%27%27common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960dba97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="57" data-theme-name="0x00sec-v2"/>
    <link href="../../stylesheets/mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38.css_%3b%20filename_%3dUTF-8%27%27mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile_theme" data-theme-id="4" data-theme-name="mobile chrome"/>
    <link href="../../stylesheets/desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2"/>

    <link rel="stylesheet" href="../../../external.html?link=https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="../../../external.html?link=https://s3.amazonaws.com/0x00sec/highlight.pack.js" nonce="A178kJ0HRAzlTXkLovuncG349"></script>
<script defer="" src="../../theme-javascripts/05954ff525aceb8daa8b585f92d758d311ae7077.js_%3b%20filename_%3dUTF-8%27%2705954ff525aceb8daa8b585f92d758d311ae7077a97f.js?__ws=d.clarkee.co.uk" data-theme-id="40" nonce="A178kJ0HRAzlTXkLovuncG349"></script>
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Basics and lifecycle of a VM - Part #0&#39;" href="8723.rss" />
    <meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://d.clarkee.co.uk/uploads/default/original/2X/2/27a5373af868edade07624e8205c46e79c247445.jpeg" />
<meta property="og:image" content="https://d.clarkee.co.uk/uploads/default/original/2X/2/27a5373af868edade07624e8205c46e79c247445.jpeg" />
<meta property="og:url" content="https://d.clarkee.co.uk/t/basics-and-lifecycle-of-a-vm-part-0/8723" />
<meta name="twitter:url" content="https://d.clarkee.co.uk/t/basics-and-lifecycle-of-a-vm-part-0/8723" />
<meta property="og:title" content="Basics and lifecycle of a VM - Part #0" />
<meta name="twitter:title" content="Basics and lifecycle of a VM - Part #0" />
<meta property="og:description" content="Basics and lifecycle of a VM - Part #0 â–¶  Edit  Disclaimer  This article is based on extensive research and I am not an expert in this field. The only intention Iâ€™ve got was â€œto understand how virtualization is working and share itâ€ (a pretty naive target). Please tell me any mistake you discover. I will correct it as quick as possible.   How does a Virtual Machine works? Well, an OS is running in a separate program (e.g. Virtual-Box, Hyper-V) which makes this OS â€œthinkâ€ it runs on a real PC, but ..." />
<meta name="twitter:description" content="Basics and lifecycle of a VM - Part #0 â–¶  Edit  Disclaimer  This article is based on extensive research and I am not an expert in this field. The only intention Iâ€™ve got was â€œto understand how virtualization is working and share itâ€ (a pretty naive target). Please tell me any mistake you discover. I will correct it as quick as possible.   How does a Virtual Machine works? Well, an OS is running in a separate program (e.g. Virtual-Box, Hyper-V) which makes this OS â€œthinkâ€ it runs on a real PC, but ..." />
<meta property="og:article:section" content="Hardware" />
<meta property="og:article:section:color" content="CCFF31" />
<meta property="og:article:tag" content="vm" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="2 mins ğŸ•‘" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="13 â¤" />
<meta property="article:published_time" content="2018-09-26T18:20:33+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    <div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">
  <!--<a href="https://git.0x00sec.org" class="dow-menu">GitLab</a>  
  <a href="https://blog.0x00sec.org/irc" class="dow-menu">IRC</a>!-->
  <a href="../../../external.html?link=https://init.0x00sec.org/" class="dow-menu">Init</a>
  <a href="../../../external.html?link=https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
  <a href="../../../external.html?link=https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
    <header>
  <a href="../../index.html">0x00sec - The Home of the Hacker</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="8723.html">Basics and lifecycle of a VM - Part #0</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/hardware/68.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #CCFF31'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Hardware</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../tag/vm.html' class='discourse-tag' rel="tag">vm</a>
        </div>
      </div>
  </div>

  

    <div itemscope itemtype='../../../external.html?link=http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Basics and lifecycle of a VM - Part #0'>
      <link itemprop='url' href='8723.html'>
      <meta itemprop='datePublished' content='2018-09-26T18:20:33Z'>
        <meta itemprop='articleSection' content='Hardware'>
      <meta itemprop='keywords' content='vm'>
      <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
        <meta itemprop='name' content='0x00sec - The Home of the Hacker'>
          <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
            <meta itemprop='url' content='../../uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.html'>
          </div>
      </div>


          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/Rot127.html'><span itemprop='name'>Rot127</span></a>
                (Guess, there&#39;s a solution I&#39;m not seeing.)
              </span>

                <link itemprop="mainEntityOfPage" href="8723.html">


              <span class="crawler-post-infos">
                  <time  datetime='2018-09-26T18:20:33Z' class='post-time'>
                    September 26, 2018,  6:20pm
                  </time>
                  <meta itemprop='dateModified' content='2018-10-04T19:23:31Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <h2>Basics and lifecycle of a VM - Part #0</h2>
<details>
<summary>
Edit</summary>
<ul>
<li>Added navigation links</li>
<li>some restructuring in the link section</li>
</ul>
</details>
<blockquote>
<p><strong>Disclaimer</strong></p>
<p>This article is based on extensive research and I am not an expert in this field. The only intention Iâ€™ve got was â€œ<em>to understand how virtualization is working and share it</em>â€ (a pretty naive target). Please tell me any mistake you discover. I will correct it as quick as possible.</p>
</blockquote>
<p>How does a Virtual Machine works? Well, an OS is running in a separate program (e.g. Virtual-Box, Hyper-V) which makes this OS â€œthinkâ€ it runs on a real PC, but in reality it has no power over my PC at all. This all can be done because magicians working at Intel, AMD and this company which develops VirtualBox.</p>
<p>This is the standard explanation which is kinda right, butâ€¦ nah, how does this stuff works in reality? So, lets get the basic high level view:</p>
<p>When you booting up a guest OS as VM on your machine, a part of your kernel starts executing special virtualization instructions on your CPU. This kernel module is called a Hypervisor or a Virtual Machine Monitor (VMM) which, you guessed it, monitors what your VM does.</p>
<p>There are two ways to design a VMM.</p>
<ol>
<li>The host virtualization type. Here your install a software on an already existing OS (the host). This software installs itâ€™s hypervisor driver and runs the VMs with it.<br>
<em>Software examples:</em> <a href="../../../external.html?link=https://en.wikipedia.org/wiki/VirtualBox" rel="noopener nofollow ugc">VirtualBox</a>, <a href="../../../external.html?link=https://en.wikipedia.org/wiki/VMware" rel="noopener nofollow ugc">Vmware</a>.</li>
</ol>
<blockquote>
<pre> â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“     â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“
|                       |   |                       |
|       GUEST OS        |   |      GUEST OS         |
|                       |   |                       |
 â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“     â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“
|                       |   |                       |
|     KERNEL GUEST OS   |   |   KERNEL GUEST OS     |           ...
 â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“     â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“   â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“
            |___________________________|________________________|
                                 |
 â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“|â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“  
|                                |                          |
|         HOST OS                |        HOST OS           |
 â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“
|                       |        |         |                |
|   KERNEL HOST         |   VMM MODULE     |  KERNEL HOST   |
|                       |        |         |                |
 â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“
|                                |                          |
|                          HARDWARE                         |
|                                                           |

</pre>
</blockquote>
<ol start="2">
<li>The bare metal hypervisor. This one is a hypervisor running directly on the hardware (started by the BIOS). On top of this all the guests are running with their own kernels. To manage the guests there is a more privileged VM running with which you can also control the hypervisor.<br>
<em>Software examples:</em> <a href="../../../external.html?link=https://en.wikipedia.org/wiki/Xen" rel="noopener nofollow ugc">Xen</a>, <a href="../../../external.html?link=https://en.wikipedia.org/wiki/Kernel-based_Virtual_Machine" rel="noopener nofollow ugc">KVM</a>.</li>
</ol>
<blockquote>
<pre> â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“     â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“
|                       |   |                       |
|       GUEST OS        |   |      GUEST OS         |
|                       |   |                       |
 â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“     â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“
|                       |   |                       |
|     KERNEL GUEST OS   |   |   KERNEL GUEST OS     |           ...
 â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“     â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“   â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“
            |__________________ ________|________________________|
                               |               |
                               |               |
                               |               | &lt; MANAGES GUESTS
                               |  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“
                               | |                           |
                               | |    MANAGEMENT OS          |
                               | |                           |
                               |  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“
                               |                    |
                               |                    |
                               |                    |
 â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“
|                              |                            |
|                         HYPERVISOR (e.g. XEN)             |
|                              |                            |
 â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“
|                              |                            |
|                          HARDWARE                         |
|                                                           |

</pre>
</blockquote>
<p>This is still a pretty high level view on the whole topic. So letâ€™s go deeper.</p>
<p>Your CPU got a hell lot of instructions which can be used by software like your kernel. Basic ones which read values from a register or more complex ones like AES encryption routines. And beside those, also a set of virtualization instructions (VMX operations).</p>
<p>To start your VM with your guest OS the VMM will set up a rule set, executes a VMXON instruction on the CPU and enters the VM.<br>
<em>â€œEnter the VMâ€</em> basically means that the processor starts executing the code of the guest OS (usually the BIOS). The processor is aware that a VM is executing code and not the actual host kernel (this processor state is called: <em>VMX non-root operation mode</em>).<br>
If the guest tries to run specific CPU instructions which are not allowed, the processor will â€œ<em>exit</em>â€ the VMX non-root mode and give back control to the VMM. The VMM can look at the instruction the guest has tried to execute, executes the instruction on behalf of the guest OS (or doesnâ€™t) and uses a VMRESUME to enter the VM again (a.k.a sets the processor state into VMX non-root mode).<br>
This game will go on and on until you decide to shut down the VM.</p>
<blockquote>
<pre>set up â€“â€“â€“â€“&gt; VMXON â€“â€“â€“â€“â€“â€“&gt; VMLAUNCH/â€“â€“â€“â€“â€“â€“â€“&gt; VM has â€“â€“â€“â€“â€“â€“ â€“â€“â€“â€“â€“â€“â€“â€“&gt; VMOFF
rule set                   VMRESUME         control       |
                          ^                               |
                          |                               |
                          |                         Tries to exec.
                          |                         root operation
                          |                               |
                      VMM exec.  &lt;â€“â€“â€“â€“ VMâ€“exit &lt;â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“
                     instructions
</pre>
</blockquote>
<p>As you see the guest OS is running most the time natively on your CPU. Occasionally interrupted by VM-exits and VM-entries.<br>
Those transitions between the VM and the VMM are relatively costly in terms of CPU-cycles. When it comes to a VM-exit the processor has to</p>
<p><strong>1.</strong> save the CPU state of the guest system (copy registers etc.),<br>
<strong>2.</strong> store information about the reason for the VM-Exit,<br>
<strong>3.</strong> restore the CPU state of the VMM,<br>
<strong>4.</strong> the VMM will handle the instructions the guest OS wasnâ€™t allowed to execute<br>
<strong>5.</strong> save the result for the guest,<br>
<strong>6.</strong> save its own CPU state and return to the VM (VMRESUME).</p>
<p>At this point we already can see why using a VM is safer than just running a normal OS. In case youâ€™ve got some malware on your guest OS running, it will only be able to execute harmless CPU instructions. All the important ones, which could affect our host systems memory and execution flow, get executed by the VMM.</p>
<p>Because a VMM just have to handle specific instructions of the VM, the code is way less complex than of an OS kernel. Which means:<br>
<em>less code</em> â†’ <em>smaller attack surface</em> â†’ <em>harder to find vulnerabilities.</em></p>
<p>This process is similar to User-Mode &lt;&gt; Kernel-Mode traps on not virtualized operation systems. Although in this case we create another layer under the guest OS kernel and therefore another possibility to control processes on the upper layers.</p>
<p>This was it for now. In the next part we talk about the rule sets of the VM. It should get much clearer than why the VMM has actually that much control.</p>
<p>In case you want to program a basic hypervisor yourself, you can follow the first of those links down there.</p>
<hr>
<div align="center"> <a href="../../../external.html?link=https://0x00sec.org/t/introduction-hardware-virtualization-part-4294967295/8722" rel="noopener nofollow ugc"><br> &lt;-- Introduction</a></div>
<div align="center"> <a href="../../../external.html?link=https://0x00sec.org/t/the-vmcs-part-1/8739" rel="noopener nofollow ugc">The VMCS - Part #1 --&gt;</a> </div>
<hr>
<p><em>Do it yourself</em></p>
<ul>
<li><a href="../../../external.html?link=https://rayanfam.com/topics/hypervisor-from-scratch-part-1/" class="inline-onebox" rel="noopener nofollow ugc">Hypervisor From Scratch - Part 1: Basic Concepts &amp; Configure Testing Environment | Rayanfam Blog</a> (building a kernel module)</li>
<li><a href="../../../external.html?link=https://software.intel.com/sites/default/files/managed/7c/f1/326019-sdm-vol-3c.pdf" rel="noopener nofollow ugc">https://software.intel.com/sites/default/files/managed/7c/f1/326019-sdm-vol-3c.pdf</a> (raw information)</li>
<li><a href="../../../external.html?link=https://www.codeproject.com/Articles/215458/Virtualization-for-System-Programmers" class="inline-onebox" rel="noopener nofollow ugc">Virtualization for System Programmers - CodeProject</a> (same content like this, but different words and with PoC)</li>
</ul>
<p><em>But I want to read about hacky stuff!</em></p>
<ul>
<li><a href="../../../external.html?link=https://en.wikipedia.org/wiki/Blue_Pill_(software)" class="inline-onebox" rel="noopener nofollow ugc">Blue Pill (software) - Wikipedia</a></li>
<li><a href="../../../external.html?link=https://web.archive.org/web/20110913070538/http://www.invisiblethingslab.com/resources/bh08/" class="inline-onebox" rel="noopener nofollow ugc">Index of /resources/bh08</a></li>
<li><a href="../../../external.html?link=https://web.archive.org/web/20080418123748/http://www.bluepillproject.org/" class="inline-onebox" rel="noopener nofollow ugc">bluepillproject.org</a></li>
</ul>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="11" />
              <span class='post-likes'>11 Likes</span>
            </div>


            
          </div>
          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/Derfloink.html'><span itemprop='name'>Derfloink</span></a>
                (Burning away in an Explosion)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-09-30T10:50:28Z' class='post-time'>
                    September 30, 2018, 10:50am
                  </time>
                  <meta itemprop='dateModified' content='2018-09-30T10:50:28Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Great Article! I never thought that much about VMâ€™s and  how secure theyâ€™re. Also I never knew that the code of a VM is directly executed on the CPU (which in my case sounds pretty vurnable despite itâ€™s controlled by the VMM). Looking forward to read more about that <img src="../../../0x00sec.org/images/emoji/twitter/winkc164.html?v=9" title=":wink:" class="emoji" alt=":wink:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_3' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/Rot127.html'><span itemprop='name'>Rot127</span></a>
                (Guess, there&#39;s a solution I&#39;m not seeing.)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-09-30T22:09:33Z' class='post-time'>
                    September 30, 2018, 10:09pm
                  </time>
                  <meta itemprop='dateModified' content='2018-09-30T22:09:33Z'>
              <span itemprop='position'>3</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Well, obviously, every code has to run at some point on a CPU. But before hardware virtualization was there hypervisors did changed some instructions before executing them on the CPU (which can be seen as â€œguest code never runs directly on the CPUâ€).<br>
This is called Binary Translation and because every instruction needs to be checked by the hypervisor before execution it was pretty ineffective.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_4' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/system.html'><span itemprop='name'>system</span></a>
                (system)
                  Closed 
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-10-26T18:20:38Z' class='post-time'>
                    October 26, 2018,  6:20pm
                  </time>
                  <meta itemprop='dateModified' content='2018-10-26T18:20:38Z'>
              <span itemprop='position'>4</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>This topic was automatically closed after 30 days. New replies are no longer allowed.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
    </div>


    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../index.html' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../categories.html' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../guidelines.html' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../tos.html' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../privacy.html' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    <script src="../../../external.html?link=http://instant.page/3.0.0" type="module" defer="" integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1" nonce="A178kJ0HRAzlTXkLovuncG349"></script>
  </body>
  
</html>
