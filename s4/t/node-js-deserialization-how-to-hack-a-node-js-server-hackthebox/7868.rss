<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>[Node.js Deserialization] How to hack a node.js server [Hackthebox]</title>
    <link>https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868</link>
    <description>Hello everyone! As i promised ill slowly be bringing you unique and hopefully 0day hacking content.  

This is a video guide showcasing a hackthebox machine and since the rules state no solutions can be given this is just a teaser to get you started.  

If you have any requests for assistance or certain methods youd like showcased just shoot me a pm or leave a comment.

https://www.youtube.com/watch?v=jIQWAz8UsLc</description>
    
    <lastBuildDate>Sun, 19 Aug 2018 17:49:16 +0000</lastBuildDate>
    <category>Web Hacking</category>
    <atom:link href="https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>[Node.js Deserialization] How to hack a node.js server [Hackthebox]</title>
        <dc:creator><![CDATA[system]]></dc:creator>
        <description><![CDATA[
            <p>This topic was automatically closed after 30 days. New replies are no longer allowed.</p>
          <p><a href="https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868/10">Read full topic</a></p>
        ]]></description>
        <link>https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868/10</link>
        <pubDate>Sat, 01 Sep 2018 00:30:54 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-7868-10</guid>
        <source url="https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868.rss">[Node.js Deserialization] How to hack a node.js server [Hackthebox]</source>
      </item>
      <item>
        <title>[Node.js Deserialization] How to hack a node.js server [Hackthebox]</title>
        <dc:creator><![CDATA[Baud]]></dc:creator>
        <description><![CDATA[
            <p>Can you be more specific about what steps you are following exactly and what issues you are encountering?</p>
          <p><a href="https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868/9">Read full topic</a></p>
        ]]></description>
        <link>https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868/9</link>
        <pubDate>Sun, 19 Aug 2018 17:49:16 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-7868-9</guid>
        <source url="https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868.rss">[Node.js Deserialization] How to hack a node.js server [Hackthebox]</source>
      </item>
      <item>
        <title>[Node.js Deserialization] How to hack a node.js server [Hackthebox]</title>
        <dc:creator><![CDATA[m0nly666]]></dc:creator>
        <description><![CDATA[
            <p>Watching this vdo and still having issues with the Deserialization, basically done the full walk though, keeps giving me an error at the step before the rce code. tried it twice now and get stuck at the same place the same time</p>
          <p><a href="https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868/8">Read full topic</a></p>
        ]]></description>
        <link>https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868/8</link>
        <pubDate>Sun, 19 Aug 2018 11:39:39 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-7868-8</guid>
        <source url="https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868.rss">[Node.js Deserialization] How to hack a node.js server [Hackthebox]</source>
      </item>
      <item>
        <title>[Node.js Deserialization] How to hack a node.js server [Hackthebox]</title>
        <dc:creator><![CDATA[Baud]]></dc:creator>
        <description><![CDATA[
            <p>I’m not on Ricochet yet but I’ll consider joining once my Internet issues are solved.</p>
          <p><a href="https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868/7">Read full topic</a></p>
        ]]></description>
        <link>https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868/7</link>
        <pubDate>Thu, 09 Aug 2018 21:33:48 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-7868-7</guid>
        <source url="https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868.rss">[Node.js Deserialization] How to hack a node.js server [Hackthebox]</source>
      </item>
      <item>
        <title>[Node.js Deserialization] How to hack a node.js server [Hackthebox]</title>
        <dc:creator><![CDATA[narcan]]></dc:creator>
        <description><![CDATA[
            <p>Are you on ricochet? We should link up.</p>
          <p><a href="https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868/6">Read full topic</a></p>
        ]]></description>
        <link>https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868/6</link>
        <pubDate>Thu, 09 Aug 2018 04:08:13 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-7868-6</guid>
        <source url="https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868.rss">[Node.js Deserialization] How to hack a node.js server [Hackthebox]</source>
      </item>
      <item>
        <title>[Node.js Deserialization] How to hack a node.js server [Hackthebox]</title>
        <dc:creator><![CDATA[Baud]]></dc:creator>
        <description><![CDATA[
            <p>Its own thread you say? Hmm… I’m going to run a few tests to study this vulnerability a little more and if I can gather enough information and useful notes I will make a bigger thread where I will explain everything more in depth than I did here!</p>
          <p><a href="https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868/5">Read full topic</a></p>
        ]]></description>
        <link>https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868/5</link>
        <pubDate>Wed, 08 Aug 2018 16:50:20 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-7868-5</guid>
        <source url="https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868.rss">[Node.js Deserialization] How to hack a node.js server [Hackthebox]</source>
      </item>
      <item>
        <title>[Node.js Deserialization] How to hack a node.js server [Hackthebox]</title>
        <dc:creator><![CDATA[pry0cc]]></dc:creator>
        <description><![CDATA[
            <p>Excellent share <a class="mention" href="https://d.clarkee.co.uk/u/baud">@Baud</a>!</p>
<p>This almost deserves it’s own thread <img src="https://0x00sec.org/images/emoji/twitter/stuck_out_tongue.png?v=9" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
          <p><a href="https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868/4">Read full topic</a></p>
        ]]></description>
        <link>https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868/4</link>
        <pubDate>Tue, 07 Aug 2018 17:17:33 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-7868-4</guid>
        <source url="https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868.rss">[Node.js Deserialization] How to hack a node.js server [Hackthebox]</source>
      </item>
      <item>
        <title>[Node.js Deserialization] How to hack a node.js server [Hackthebox]</title>
        <dc:creator><![CDATA[Baud]]></dc:creator>
        <description><![CDATA[
            <p>Ah! I solved this challenge just yesterday so it’s nice to see this, it was a fun new technique to learn, and I can talk a little bit about it as requested by <a class="mention" href="https://d.clarkee.co.uk/u/pry0cc">@pry0cc</a>, even if… well… that wasn’t directed to me, but still, I want to contribute.</p>
<p>This is a <strong>deserialization flaw</strong>, what this means is that we can provide a stream of arbitrary data to abuse the logic of the application receiving our stream, as this stream isn’t handled safely and it can be dangerous enough to cause remote code execution or denial of service attacks.</p>
<p>In this specific case, the flaw can be found in the <strong>serialize.js</strong> module for <strong>node.js</strong>. In the application above, the one used in a Hack The Box CTF challenge, our web browser sends the node.js server a cookie encoded in Base64 containing JSON data, something like this:</p>
<pre><code>{"username":"Dummy","number":"2","location":"random_place"}
</code></pre>
<p>The cookie is taken as input by a vulnerable web application and sent to the unserialize() function in order to convert it into an object that can be used in the code, the lines that do this operation are as follows:</p>
<pre><code>var str = new Buffer(req.cookies.profile, 'base64').toString(); // obtains and decodes the cookie
var obj = serialize.unserialize(str); // converts our cookie from a buffer to an object, the vulnerability takes place here
</code></pre>
<p>You might be wondering why this flaw happens exactly, and we can take a look at the source code for serialize.js to get our answer, let’s analyze these few lines of code:</p>
<pre><code>if(obj[key].indexOf(FUNCFLAG) === 0) {
        obj[key] = eval('(' + obj[key].substring(FUNCFLAG.length) + ')');
      }
</code></pre>
<p>Keep in mind that <em>obj</em> is an array containing all the different fields of our cookie (in the case of our targeted web application of course), and <em>key</em> is used as index of said array inside of a for() loop to refer to the single fields. The snippet of code is taken from line 75 of the source code, I will link the GitHub repository at the end of the post. Basically, what this code does is checking whether the item number <em>key</em> of our cookie begins with FUNCFLAG, and if it does, it removes FUNCFLAG from our item and passes the remaining text to the <strong>eval()</strong> function, and basically, this function executes code. So, if we wanted to make it short, FUNCFLAG is nothing but a constant used to mark text that has to be passed to <strong>eval()</strong> and thus interpreted as code.</p>
<p>So what happens if we manage to include FUNCFLAG in our cookie followed by an instruction we wish to execute? Simple, the code will be executed! On line 2 of the source code we find this:</p>
<pre><code>var FUNCFLAG = '_$$ND_FUNC$$_';
</code></pre>
<p>So, if we wish to make our web application execute some code we have to craft our cookie so that it includes that string above to tell the <strong>unserialize()</strong> function we have something special for <strong>eval()</strong>. Here’s a very simple example to close the instance of node.js at our own will:</p>
<pre><code>{"username":"Dummy","number":"2","location":"random_place","custom_code":"_$$ND_FUNC$$_process.exit(0)"}
</code></pre>
<p>All we have to do is encode the cookie back to Base64 and forward it to the web application, which will give it right to the unserialize() function, passing <strong>process.exit(0)</strong> to eval(). And there’s that, that’s how this exploit works. In the video OP shows how to obtain a reverse shell thanks to nodejsshell.py, the concept is the same, but instead of a lame process.exit(0) our cookie will include an encoded shell that will connect back to us.</p>
<p>I hope this was helpful, if anyone has any questions or corrections feel free to go ahead!</p>
<p>Source for serialize.js ----&gt; <a href="https://github.com/luin/serialize/blob/master/lib/serialize.js" rel="nofollow noopener">https://github.com/luin/serialize/blob/master/lib/serialize.js</a></p>
          <p><a href="https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868/3">Read full topic</a></p>
        ]]></description>
        <link>https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868/3</link>
        <pubDate>Mon, 06 Aug 2018 22:59:33 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-7868-3</guid>
        <source url="https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868.rss">[Node.js Deserialization] How to hack a node.js server [Hackthebox]</source>
      </item>
      <item>
        <title>[Node.js Deserialization] How to hack a node.js server [Hackthebox]</title>
        <dc:creator><![CDATA[pry0cc]]></dc:creator>
        <description><![CDATA[
            <p>Hi <a class="mention" href="https://d.clarkee.co.uk/u/narcan">@narcan</a>,</p>
<p>Would you be able to detail the methods used in writing? We are a mainly writing based forum, and so many prefer to read their articles rather than watch it. It is cool that you have posted a video, and the video can definitely remain, however we ask that you write a little bit about how it works.</p>
<p>Thanks!</p>
          <p><a href="https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868/2">Read full topic</a></p>
        ]]></description>
        <link>https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868/2</link>
        <pubDate>Thu, 02 Aug 2018 10:24:03 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-7868-2</guid>
        <source url="https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868.rss">[Node.js Deserialization] How to hack a node.js server [Hackthebox]</source>
      </item>
      <item>
        <title>[Node.js Deserialization] How to hack a node.js server [Hackthebox]</title>
        <dc:creator><![CDATA[narcan]]></dc:creator>
        <description><![CDATA[
            <p>Hello everyone! As i promised ill slowly be bringing you unique and hopefully 0day hacking content.</p>
<p>This is a video guide showcasing a hackthebox machine and since the rules state no solutions can be given this is just a teaser to get you started.</p>
<p>If you have any requests for assistance or certain methods youd like showcased just shoot me a pm or leave a comment.</p>
<p>            <iframe src="https://www.youtube.com/embed/jIQWAz8UsLc?feature=oembed&amp;wmode=opaque" width="480" height="360" frameborder="0" allowfullscreen="" class="youtube-onebox" seamless="seamless" sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox allow-presentation"></iframe>
</p>
          <p><a href="https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868/1">Read full topic</a></p>
        ]]></description>
        <link>https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868/1</link>
        <pubDate>Thu, 02 Aug 2018 00:21:36 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-7868-1</guid>
        <source url="https://d.clarkee.co.uk/t/node-js-deserialization-how-to-hack-a-node-js-server-hackthebox/7868.rss">[Node.js Deserialization] How to hack a node.js server [Hackthebox]</source>
      </item>
  </channel>
</rss>
