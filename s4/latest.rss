<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:discourse="http://www.discourse.org/" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>0x00sec - The Home of the Hacker - Latest topics</title>
    <link>https://d.clarkee.co.uk/latest</link>
    <description>Latest topics</description>
    
      <lastBuildDate>Sun, 18 Apr 2021 18:27:45 +0000</lastBuildDate>
      <atom:link href="https://d.clarkee.co.uk/latest.rss" rel="self" type="application/rss+xml" />
        <item>
          <title>The &quot;quick way&quot; to learn about Pascal Programming Language</title>
          <dc:creator><![CDATA[doctordoom]]></dc:creator>
          <category>Uncategorized</category>
          <description><![CDATA[
            <p>I know that doesn’t exist a quick way to learn a programming language, so that’s why it is in a quote.<br>
The motive why I opened this topic is to ask where to learn Pascal programming language. The Internet is an ocean of good n’ shit contents, and I don’t know a trustworthy font of the subject that I never stand up to until now.</p>
<p>I want to slowly dive into the algorithm with “<a href="https://web.archive.org/web/20191211063215/http://www.ethoberon.ethz.ch/WirthPubl/AD.pdf" rel="noopener nofollow ugc">Algorithms and Data Structures</a>,” and does anyone knows if I need to learn Pascal first from external content to get that?</p>
            <p><small>4 posts - 3 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/the-quick-way-to-learn-about-pascal-programming-language/25714">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/the-quick-way-to-learn-about-pascal-programming-language/25714</link>
          <pubDate>Sun, 18 Apr 2021 18:27:45 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25714</guid>
          <source url="https://d.clarkee.co.uk/t/the-quick-way-to-learn-about-pascal-programming-language/25714.rss">The &quot;quick way&quot; to learn about Pascal Programming Language</source>
        </item>
        <item>
          <title>Why is post quantum cryptography important</title>
          <dc:creator><![CDATA[Darkvault]]></dc:creator>
          <category>Cryptology</category>
          <description><![CDATA[
            <p>Quantum  computers will break today’s  asymmetric public-keys cryptography algorithms used for web encryption (https),email encryption (gnupg…),ssh and others.</p>
<p>Quantum computers are designed to use something  called qubits,allowing multiple states being  expressed simultaneously. This allows for breakthrough in certain  types of math problems,solving them nearly  instantaneously. Quantum computers adhere to the law  of physics,and it is only a matter of time before engineer figures out how to build  them properly .</p>
<p>A small 20 qubits quantum computer has already been developed  for the IBM experienced project.</p>
<p>Here  are some software been developed that claims to be  quantum resistant :</p>
<p>●  codecrypt</p>
<p>●  TinySSH(PQC planned)</p>
<p>●  Cyph</p>
<p>● Onetime</p>
<p>This is a thread  to anyone relying on encryption.<br>
There are people out there  saving all  encrypted data and  downloading the encrypted  traffic,waiting for a way to decrypt it.</p>
<p>It is advised to learn the software sooner than later.</p>
            <p><small>2 posts - 2 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/why-is-post-quantum-cryptography-important/25693">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/why-is-post-quantum-cryptography-important/25693</link>
          <pubDate>Sat, 17 Apr 2021 12:59:38 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25693</guid>
          <source url="https://d.clarkee.co.uk/t/why-is-post-quantum-cryptography-important/25693.rss">Why is post quantum cryptography important</source>
        </item>
        <item>
          <title>Can Responder take down infrastructure?</title>
          <dc:creator><![CDATA[isamurai]]></dc:creator>
          <category>Beginner Guides</category>
          <description><![CDATA[
            <p>So I’m in a situation where Responder could be useful but I somehow remember hearing that i could take down the network with the LLMNR poisoning.</p>
<p>Would running Responder WPAD to certain targeted machines pose a real risk of taking down the infra?</p>
<p>thanks!<br>
Isamurai</p>
            <p><small>1 post - 1 participant</small></p>
            <p><a href="https://d.clarkee.co.uk/t/can-responder-take-down-infrastructure/25683">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/can-responder-take-down-infrastructure/25683</link>
          <pubDate>Fri, 16 Apr 2021 16:08:57 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25683</guid>
          <source url="https://d.clarkee.co.uk/t/can-responder-take-down-infrastructure/25683.rss">Can Responder take down infrastructure?</source>
        </item>
        <item>
          <title>Binary Armory Wiki</title>
          <dc:creator><![CDATA[crimsonRain]]></dc:creator>
          <category>Wiki</category>
          <description><![CDATA[
            <p>A compilation of resources to classical AntiRE techniques I’ve collected over time. Note that some resources may seem to be redundant but are added for the sake of completeness. Feel free to add any if you wish.</p>
<h1>Packers/Obfuscators</h1>
<p><a href="https://medium.com/@polarply/build-your-first-llvm-obfuscator-80d16583392b" rel="noopener nofollow ugc">Build your first LLVM Obfuscator</a><br>
<a href="https://www.praetorian.com/blog/extending-llvm-for-code-obfuscation-part-1/" rel="noopener nofollow ugc"> Extending LLVM for Code Obfuscation 1</a><br>
<a href="https://www.praetorian.com/blog/extending-llvm-for-code-obfuscation-part-2/" rel="noopener nofollow ugc"> Extending LLVM for Code Obfuscation 2</a><br>
<a href="https://www.apriorit.com/dev-blog/687-reverse-engineering-llvm-obfuscation" rel="noopener nofollow ugc"> Using LLVM to Obfuscate Your Code During Compilation</a><br>
<a href="https://blog.quarkslab.com/turning-regular-code-into-atrocities-with-llvm.html" rel="noopener nofollow ugc">Turning Regular Code Into Atrocities With LLVM </a><br>
<a href="http://www.rohitab.com/discuss/index.php?app=core&amp;module=attach&amp;section=attach&amp;attach_id=4507" rel="noopener nofollow ugc">Simple Packer in C</a><br>
<a href="https://bidouillesecurity.com/tutorial-writing-a-pe-packer-intro/" rel="noopener nofollow ugc">Writing a PE packer series</a><br>
<a href="https://dl.packetstormsecurity.net/papers/general/Using_UPX_as_a_security_packer.pdf" rel="noopener nofollow ugc">Using UPX as a security packer</a><br>
<a href="https://www.stonedcoder.org/~kd/lib/61-267-1-PB.pdf" rel="noopener nofollow ugc">How to Write Your Own Packer</a></p>
<h1>Anti-Disassembly</h1>
<p><a href="https://www.malwinator.com/2015/11/22/anti-disassembly-used-in-malware-a-primer/" rel="noopener nofollow ugc">Anti-Disassembly techniques used by malware (a primer) 1</a><br>
<a href="https://www.malwinator.com/2015/11/27/anti-disassembly-techniques-used-by-malware-a-primer-part-2/" rel="noopener nofollow ugc">Anti-Disassembly techniques used by malware (a primer) 2</a><br>
<a href="https://grazfather.github.io/posts/2016-09-18-anti-disassembly/" rel="noopener nofollow ugc">Anti-Disassembly Techniques and Mitigation</a><br>
<a href="https://www.exploit-db.com/docs/48717" rel="noopener nofollow ugc">Assembly “wrapping”: a technique for anti-disassembly</a><br>
<a href="https://yellowbyte.github.io/blog/2018/the_return_of_disassembly_desynchronization/" rel="noopener nofollow ugc">The Return of Disassembly Desynchronization</a></p>
<h1>Anti-Debug</h1>
<p><a href="https://anti-debug.checkpoint.com/" rel="noopener nofollow ugc">Anti-Debug Tricks Wiki</a><br>
<a href="https://anti-reversing.com/Downloads/Anti-Reversing/The_Ultimate_Anti-Reversing_Reference.pdf" rel="noopener nofollow ugc">[WIN]The Ultimate Anti Debugging Reference</a><br>
<a href="https://www.cs.utah.edu/~aburtsev/malw-sem/slides/02-anti-debugging.pdf" rel="noopener nofollow ugc">[WIN]Anti-Debugging Techniques and Mitigation</a><br>
<a href="https://www.apriorit.com/dev-blog/367-anti-reverse-engineering-protection-techniques-to-use-before-releasing-software" rel="noopener nofollow ugc">[WIN]Anti Debugging Protection Techniques with Examples</a><br>
<a href="https://community.broadcom.com/symantecenterprise/communities/community-home/librarydocuments/viewdocument?DocumentKey=230d68b2-c80f-4436-9c09-ff84d049da33&amp;CommunityKey=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&amp;tab=librarydocuments" rel="noopener nofollow ugc">Windows Anti-Debug Reference</a><br>
<a href="https://www.stonedcoder.org/~kd/lib/14-61-1-PB.pdf" rel="noopener nofollow ugc">Beginner’s Guide to Basic Linux Anti Anti Debugging Technique</a><br>
<a href="https://reverseengineering.stackexchange.com/questions/43/anti-debug-techniques-on-unix-platforms" rel="noopener nofollow ugc">Anti-Debug Techniques on Linux</a></p>
<h1>VM/Sandbox Detection</h1>
<p><a href="https://www.blueliv.com/cyber-security-and-cyber-threat-intelligence-blog-blueliv/research/playing-with-guloader-anti-vm-techniques-malware/" rel="noopener nofollow ugc">[WIN]Playing with GuLoader Anti-VM techniques</a><br>
<a href="https://www.cynet.com/evasion-techniques/malware-anti-vm-techniques/" rel="noopener nofollow ugc">Malware Anti-VM Techniques</a><br>
<a href="https://www.deepinstinct.com/2019/10/29/malware-evasion-techniques-part-2-anti-vm-blog/" rel="noopener nofollow ugc">Malware Evasion Techniques 2</a><br>
<a href="https://www.deepinstinct.com/2019/11/24/malware-evasion-techniques-part-3-anti-sandboxing/" rel="noopener nofollow ugc">Malware Evasion Techniques 3</a><br>
<a href="https://www.mcafee.com/blogs/other-blogs/mcafee-labs/evolution-of-malware-sandbox-evasion-tactics-a-retrospective-study/" rel="noopener nofollow ugc">[WIN]Evolution of Malware Sandbox Evasion Tactics – A Retrospective Study</a><br>
<a href="https://blog.talosintelligence.com/2009/10/how-does-malware-know-difference.html" rel="noopener nofollow ugc">How does malware know the difference between the virtual world and the real world?</a><br>
<a href="https://www.baeldung.com/linux/determine-virtualization-tech" rel="noopener nofollow ugc">[LINUX]Easy Ways to Determine Virtualization Technology</a></p>
<h1>Source Code</h1>
<aside class="onebox githubfolder">
  <header class="source">
      <img src="https://github.githubassets.com/favicons/favicon.svg" class="site-icon" width="32" height="32">
      <a href="https://github.com/LordNoteworthy/al-khaser" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:400/400;"><img src="https://avatars.githubusercontent.com/u/5129564?s=400&amp;amp;v=4" class="thumbnail" width="400" height="400"></div>

<h3><a href="https://github.com/LordNoteworthy/al-khaser" target="_blank" rel="noopener nofollow ugc">LordNoteworthy/al-khaser</a></h3>


  <p><span class="label1">Public malware techniques used in the wild: Virtual Machine, Emulation, Debuggers, Sandbox detection. </span></p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<aside class="onebox githubfolder">
  <header class="source">
      <img src="https://github.githubassets.com/favicons/favicon.svg" class="site-icon" width="32" height="32">
      <a href="https://github.com/waleedassar/antidebug" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:420/420;"><img src="https://avatars.githubusercontent.com/u/5983995?s=400&amp;amp;v=4" class="thumbnail" width="420" height="420"></div>

<h3><a href="https://github.com/waleedassar/antidebug" target="_blank" rel="noopener nofollow ugc">waleedassar/antidebug</a></h3>


  <p><span class="label1">Collection Of Anti-Debugging Tricks. Contribute to waleedassar/antidebug development by creating an account on GitHub.</span></p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<aside class="onebox githubfolder">
  <header class="source">
      <img src="https://github.githubassets.com/favicons/favicon.svg" class="site-icon" width="32" height="32">
      <a href="https://github.com/ThomasThelen/Anti-Debugging" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:400/400;"><img src="https://avatars.githubusercontent.com/u/9289652?s=400&amp;amp;v=4" class="thumbnail" width="400" height="400"></div>

<h3><a href="https://github.com/ThomasThelen/Anti-Debugging" target="_blank" rel="noopener nofollow ugc">ThomasThelen/Anti-Debugging</a></h3>


  <p><span class="label1">A collection of c++ programs that demonstrate common ways to detect the presence of an attached debugger.</span></p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<aside class="onebox githubfolder">
  <header class="source">
      <img src="https://github.githubassets.com/favicons/favicon.svg" class="site-icon" width="32" height="32">
      <a href="https://github.com/a0rtega/pafish" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/345;"><img src="https://0x00sec.s3.amazonaws.com/optimized/3X/4/7/477f294ed2a52ac37bed5b143621236fd52132b6_2_690x345.png" class="thumbnail" width="690" height="345" srcset="https://0x00sec.s3.amazonaws.com/optimized/3X/4/7/477f294ed2a52ac37bed5b143621236fd52132b6_2_690x345.png, https://0x00sec.s3.amazonaws.com/optimized/3X/4/7/477f294ed2a52ac37bed5b143621236fd52132b6_2_1035x517.png 1.5x, https://0x00sec.s3.amazonaws.com/original/3X/4/7/477f294ed2a52ac37bed5b143621236fd52132b6.png 2x" data-small-upload="https://0x00sec.s3.amazonaws.com/optimized/3X/4/7/477f294ed2a52ac37bed5b143621236fd52132b6_2_10x10.png"></div>

<h3><a href="https://github.com/a0rtega/pafish" target="_blank" rel="noopener nofollow ugc">a0rtega/pafish</a></h3>


  <p><span class="label1">Pafish is a demonstration tool that employs several techniques to detect sandboxes and analysis environments in the same way as malware families do.</span></p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<aside class="onebox githubblob">
  <header class="source">
      <a href="https://github.com/hackedteam/scout-win/blob/master/core-scout-win32/antivm.cpp" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>
  <article class="onebox-body">
    <h4><a href="https://github.com/hackedteam/scout-win/blob/master/core-scout-win32/antivm.cpp" target="_blank" rel="noopener nofollow ugc">hackedteam/scout-win/blob/master/core-scout-win32/antivm.cpp</a></h4>
<pre><code class="lang-cpp">#include &lt;Windows.h&gt;
#include "utils.h"
#include "proto.h"
#include "antivm.h"

//#define VMWARE_WORKSTATION_FAIL		"\x76\x6f\x73\x08\xb2\x72\x45\x1a\x87\x51\x30\x18\xc9\x88\x7c\xaa\x60\x75\x3c\x34" // "2d 94 e0 88 ff dc f3 45" -&gt; unicode
//#define VMWARE_WORKSTATION_FAIL2	"\x44\xb0\x73\xdc\x0d\x9d\x4c\x84\xd6\x13\x32\xe2\x70\x98\xc0\xf6\x67\x20\xe8\x0d" // "4e 60 5c 00 41 b6 4f f1 " -&gt; unicode

#define VBOX_FAIL					"\xee\xfb\x15\x51\x37\xa9\xa2\x67\x39\x4b\x9e\x9f\xa3\x05\x5f\xf0\xde\x09\xa4\xa7" // "PCI\\VEN_80EE&amp;DEV_CAFE"	-&gt; unicode
#define VMWARE_WHITELISTED			"\x83\xbe\x37\x16\x52\x97\x24\xc9\x73\xbe\x68\xbb\x0e\x46\x00\xa0\xc0\xf3\x74\x0d"  // VMware-aa aa aa aa aa aa aa aa
#define IS_VMWARE					"\x72\x19\x78\xcf\x34\x89\x66\x34\xe1\x10\x2f\x21\xf1\x5c\x73\x96\x38\x9e\xa7\x69"  // VMware


BOOL AntiVM()
{
	AntiCuckoo();
	BOOL bVMWare = AntiVMWare();
	BOOL bVBox = AntiVBox();

	if (bVMWare || bVBox)
</code></pre>

  This file has been truncated. <a href="https://github.com/hackedteam/scout-win/blob/master/core-scout-win32/antivm.cpp" target="_blank" rel="noopener nofollow ugc">show original</a>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<aside class="onebox githubfolder">
  <header class="source">
      <img src="https://github.githubassets.com/favicons/favicon.svg" class="site-icon" width="32" height="32">
      <a href="https://github.com/David-Reguera-Garcia-Dreg/anticuckoo" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:288/288;"><img src="https://avatars.githubusercontent.com/u/9882181?s=400&amp;amp;v=4" class="thumbnail" width="288" height="288"></div>

<h3><a href="https://github.com/David-Reguera-Garcia-Dreg/anticuckoo" target="_blank" rel="noopener nofollow ugc">David-Reguera-Garcia-Dreg/anticuckoo</a></h3>


  <p><span class="label1">A tool to detect and crash Cuckoo Sandbox . Contribute to David-Reguera-Garcia-Dreg/anticuckoo development by creating an account on GitHub.</span></p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<aside class="onebox githubfolder">
  <header class="source">
      <img src="https://github.githubassets.com/favicons/favicon.svg" class="site-icon" width="32" height="32">
      <a href="https://github.com/ricardojrdez/anti-analysis-tricks" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/345;"><img src="https://0x00sec.s3.amazonaws.com/optimized/3X/5/b/5bad70f90620c71b2416c12d0023a84abd3f0f72_2_690x345.png" class="thumbnail" width="690" height="345" srcset="https://0x00sec.s3.amazonaws.com/optimized/3X/5/b/5bad70f90620c71b2416c12d0023a84abd3f0f72_2_690x345.png, https://0x00sec.s3.amazonaws.com/optimized/3X/5/b/5bad70f90620c71b2416c12d0023a84abd3f0f72_2_1035x517.png 1.5x, https://0x00sec.s3.amazonaws.com/original/3X/5/b/5bad70f90620c71b2416c12d0023a84abd3f0f72.png 2x" data-small-upload="https://0x00sec.s3.amazonaws.com/optimized/3X/5/b/5bad70f90620c71b2416c12d0023a84abd3f0f72_2_10x10.png"></div>

<h3><a href="https://github.com/ricardojrdez/anti-analysis-tricks" target="_blank" rel="noopener nofollow ugc">ricardojrdez/anti-analysis-tricks</a></h3>


  <p><span class="label1">Bunch of techniques potentially used by malware to detect analysis environments</span></p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<aside class="onebox githubfolder">
  <header class="source">
      <img src="https://github.githubassets.com/favicons/favicon.svg" class="site-icon" width="32" height="32">
      <a href="https://github.com/hfiref0x/VMDE" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:393/393;"><img src="https://avatars.githubusercontent.com/u/10708977?s=400&amp;amp;v=4" class="thumbnail" width="393" height="393"></div>

<h3><a href="https://github.com/hfiref0x/VMDE" target="_blank" rel="noopener nofollow ugc">hfiref0x/VMDE</a></h3>


  <p><span class="label1">Source from VMDE paper, adapted to 2015. Contribute to hfiref0x/VMDE development by creating an account on GitHub.</span></p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<aside class="onebox githubfolder">
  <header class="source">
      <img src="https://github.githubassets.com/favicons/favicon.svg" class="site-icon" width="32" height="32">
      <a href="https://github.com/kgretzky/obfusion" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:400/400;"><img src="https://avatars.githubusercontent.com/u/19260967?s=400&amp;amp;v=4" class="thumbnail" width="400" height="400"></div>

<h3><a href="https://github.com/kgretzky/obfusion" target="_blank" rel="noopener nofollow ugc">kgretzky/obfusion</a></h3>


  <p><span class="label1">Obfusion - C++ X86 Code Obfuscation Library. Contribute to kgretzky/obfusion development by creating an account on GitHub.</span></p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<aside class="onebox githubfolder">
  <header class="source">
      <img src="https://github.githubassets.com/favicons/favicon.svg" class="site-icon" width="32" height="32">
      <a href="https://github.com/kirschju/debugmenot" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/345;"><img src="https://0x00sec.s3.amazonaws.com/optimized/3X/f/9/f9525263cf5f6c315f6499c5b100c330d9192ce9_2_690x345.png" class="thumbnail" width="690" height="345" srcset="https://0x00sec.s3.amazonaws.com/optimized/3X/f/9/f9525263cf5f6c315f6499c5b100c330d9192ce9_2_690x345.png, https://0x00sec.s3.amazonaws.com/optimized/3X/f/9/f9525263cf5f6c315f6499c5b100c330d9192ce9_2_1035x517.png 1.5x, https://0x00sec.s3.amazonaws.com/original/3X/f/9/f9525263cf5f6c315f6499c5b100c330d9192ce9.png 2x" data-small-upload="https://0x00sec.s3.amazonaws.com/optimized/3X/f/9/f9525263cf5f6c315f6499c5b100c330d9192ce9_2_10x10.png"></div>

<h3><a href="https://github.com/kirschju/debugmenot" target="_blank" rel="noopener nofollow ugc">kirschju/debugmenot</a></h3>


  <p><span class="label1">Collection of simple anti-debugging tricks for Linux</span></p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
<p><a href="https://bitbucket.org/fkie_cd_dare/simplifire.antire/src/master/" class="onebox" target="_blank" rel="noopener nofollow ugc">https://bitbucket.org/fkie_cd_dare/simplifire.antire/src/master/</a></p>
<h1>Misc</h1>
<p><a href="https://www.lasca.ic.unicamp.br/paulo/papers/2017-SBSeg-marcus.botacin-anti.anti.analysis.evasive.malware.pdf" rel="noopener nofollow ugc">[WIN]Analysis, Anti-Analysis, Anti-Anti-Analysis: An Overview of the Evasive Malware Scenario</a><br>
<a href="https://blog.malwarebytes.com/threat-analysis/2014/09/five-anti-debugging-tricks-that-sometimes-fool-analysts/" rel="noopener nofollow ugc">Five Anti-Analysis Tricks That Sometimes Fool Analysts</a><br>
<a href="https://grazfather.github.io/posts/2016-10-12-obfuscation-techniques/" rel="noopener nofollow ugc">Obfuscation Techniques</a><br>
<a href="https://tgwbd.org/darwin/binaryprotection.html" rel="noopener nofollow ugc">Mac OS X Binary Protection</a><br>
<a href="https://permalink.lanl.gov/object/tr?what=info:lanl-repo/lareport/LA-UR-18-25476" rel="noopener nofollow ugc">[WIN] Anti Reverse Engineering</a><br>
<a href="https://evasions.checkpoint.com/" rel="noopener nofollow ugc">Evasion Techniques Wiki</a><br>
<a href="https://www.deepinstinct.com/2019/09/15/malware-evasion-techniques-part-1-process-injection-and-manipulation/" rel="noopener nofollow ugc">[WIN]Malware Evasion 1</a><br>
<a href="https://litigationconferences.com/wp-content/uploads/2017/05/Introduction-to-Evasive-Techniques-v1.0.pdf" rel="noopener nofollow ugc">Evasive Techniques: An Introduction</a><br>
<a href="https://www.ijitee.org/wp-content/uploads/papers/v8i6s3/F10670486S319.pdf" rel="noopener nofollow ugc">[WIN]Anti–Reverse Engineering Techniques Employed by Malware</a><br>
<a href="https://www.sciencedirect.com/science/article/pii/S2666281720302614" rel="noopener nofollow ugc">Hiding Process Memory Via Anti-Forensic Techniques</a><br>
<a href="https://yellowbyte.github.io/blog/2018/hiding-call-to-ptrace/" rel="noopener nofollow ugc">Hiding Call To Ptrace</a><br>
<a href="https://forum.tuts4you.com/files/file/1218-anti-reverse-engineering-guide/" rel="noopener nofollow ugc">[WIN]Anti-Reverse Engineering Guide</a><br>
<a href="https://leanpub.com/anti-reverse-engineering-linux" rel="noopener nofollow ugc">[LINUX]Programming Linux Anti-Reversing Techniques</a><br>
<a href="https://arxiv.org/pdf/1009.4000.pdf" rel="noopener nofollow ugc">Malicious cryptography techniques for unreversable (malicious or not) binaries</a><br>
<a href="https://www.ma.rhul.ac.uk/static/techrep/2012/MA-2012-10.pdf" rel="noopener nofollow ugc">Malware Armoring: The case against incident related binary analysis</a></p>
            <p><small>5 posts - 4 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/binary-armory-wiki/25679">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/binary-armory-wiki/25679</link>
          <pubDate>Fri, 16 Apr 2021 00:03:53 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25679</guid>
          <source url="https://d.clarkee.co.uk/t/binary-armory-wiki/25679.rss">Binary Armory Wiki</source>
        </item>
        <item>
          <title>How do you learn WinApi</title>
          <dc:creator><![CDATA[n33ds0n]]></dc:creator>
          <category>Programming</category>
          <description><![CDATA[
            <p>1: Can you tell us how you learned all about the windows API</p>
<p>2: How do you master it.</p>
<p>3: What are the resources you used while learning the windows API</p>
<p>4: Share the resources you used with us</p>
<p>5: Which programing language you used C or C++</p>
<p>6: Tell us more</p>
<p>More important the resources(link, PDF video anything just where)</p>
<p>Thanks <img src="https://0x00sec.org/images/emoji/twitter/heart.png?v=9" title=":heart:" class="emoji" alt=":heart:"></p>
            <p><small>7 posts - 5 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/how-do-you-learn-winapi/25678">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/how-do-you-learn-winapi/25678</link>
          <pubDate>Thu, 15 Apr 2021 21:15:53 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25678</guid>
          <source url="https://d.clarkee.co.uk/t/how-do-you-learn-winapi/25678.rss">How do you learn WinApi</source>
        </item>
        <item>
          <title>Some books that you would recommend reading</title>
          <dc:creator><![CDATA[Darkvault]]></dc:creator>
          <category>Uncategorized</category>
          <description><![CDATA[
            <p>Your favorite  book about computer  hacking.</p>
            <p><small>5 posts - 4 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/some-books-that-you-would-recommend-reading/25676">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/some-books-that-you-would-recommend-reading/25676</link>
          <pubDate>Thu, 15 Apr 2021 17:53:03 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25676</guid>
          <source url="https://d.clarkee.co.uk/t/some-books-that-you-would-recommend-reading/25676.rss">Some books that you would recommend reading</source>
        </item>
        <item>
          <title>Multi Platform Execution</title>
          <dc:creator><![CDATA[crimsonRain]]></dc:creator>
          <category>Programming</category>
          <description><![CDATA[
            <p>This is my first post so don’t expect anything much, just sharing an idea is all. Shoutout to <a class="mention" href="https://d.clarkee.co.uk/u/leeky">@Leeky</a> and <a class="mention" href="https://d.clarkee.co.uk/u/jeff">@jeff</a> for helping out in regards to OS detection as I’m pretty unfamiliar with it. I recently came across an interesting project called <a href="https://github.com/jart/cosmopolitan" rel="noopener nofollow ugc">cosmopolitan</a>. The part about this project that makes it interesting is that the binaries compiled using comopolitan is that it’s a compile once and run anywhere. What this means is that you can run the binary without it being compiled specifically for a single OS, but rather is able to be executed using a <a href="https://www.youtube.com/watch?v=VVdmmN0su6E" rel="noopener nofollow ugc">polyglot format</a> called αcτµαlly pδrταblε εxεcµταblε (pretty aesthetic name, I know) or APE for short. In a nutshell, polyglot formats are files that can be interpreted in different formats depending on what program opens that file. The case of binaries compiled with cosmopolitan falls under this case as different OS loaders are able to properly execute the binary.</p>
<p>I kept thinking of what could be made with such a project as there was no longer a limitation of compiling OS specific binaries. One of the things that came to mind was multi platform malware. I could easily see how malware could be made “multi platform” through scripts but I’ve never heard of the binary itself being multi platform. Realizing this, I tried to see if there were any caveats using this project. Well, there were quite a few but they shouldn’t mean much in MalDev:</p>
<ul>
<li>The project doesn’t support any desktop GUIs hence “textmode” in their github description.</li>
<li>The binary “will assimilate itself as a conventional resident of your platform after the first run” this means, after the first run, the binary is no longer multi platform sadly. Needless to say, if we require that the binary propagates, we need save a copy of it before execution. The only thing I could think of is the binary copying itself on disk during runtime, note that this may be entirely wrong as I’m assuming that the assimilation process happens at the end of execution.</li>
</ul>
<pre><code class="lang-auto">Note that I'm no way responsible for any damage the reader may do using this technique and I'm assuming the reader is a responsible person.
</code></pre>
<h1>Setup</h1>
<p>Now enough intro, let’s get started. We’re going to be developing in Linux since it’s far easier to set up due to the fact that developing on Mac or Windows would require installing gnu linux toolchain before compiling cosmopolitan. To get started we run the following as mentioned on the github:</p>
<pre><code class="lang-auto">mkdir mal &amp;&amp; cd mal
wget https://justine.lol/cosmopolitan/cosmopolitan-amalgamation-0.3.zip
unzip cosmopolitan-amalgamation-0.3.zip
</code></pre>
<p>And that’s it, we just need to stay in the current directory in order for this to work.</p>
<h1>Execution?</h1>
<p>It is commonly known that malware has OS specific techniques and the only thing in our way is to know when to use these OS specific techniques. The only challenge now is to when to use these OS specific techniques. There are two ways we could do this:</p>
<ol>
<li>
<p>A high level method such as looking for presence of paths such as /root, /lib, /bin vs C:\ (thanks uncle jeff)</p>
</li>
<li>
<p>A low level method of using <a href="https://modexp.wordpress.com/2016/06/02/shellcode-detection/" rel="noopener nofollow ugc">Assembly to detect the running OS</a> (thanks Leeky)</p>
</li>
</ol>
<p>Well the point of the post is not to write full fledged malware but rather prove that it is possible to produce a binary that does its malicious job regardless of the OS. In accordance to this, we’ll try to execute payload that pops a shell. This doesn’t seem malicious you say? Well you can swap the payload for a reverse shell, a forkbomb or a nasty disk wipe if they make the binary qualify as malware.</p>
<h1>High Level</h1>
<p>Now let’s test if our OS detection techniques work before executing some payload. We’re going to start off with the first method since it seems to be the easier of the two to implement. The source code and the command to compile the source is as follows:</p>
<pre><code class="lang-auto">int main() {
        char * OS = "None";
        if(isdirectory("C:\\"))
                OS = "Windows";
        else if(isdirectory("/root"))
                OS = "Linux";

        printf("The current OS is %s\n", OS);
}
</code></pre>
<pre><code class="lang-auto">gcc -g -Os -static -nostdlib -nostdinc -fno-pie -no-pie -mno-red-zone \
  -fno-omit-frame-pointer -pg -mnop-mcount \
  -o test.com.dbg test.c -fuse-ld=bfd -Wl,-T,ape.lds \
  -include cosmopolitan.h crt.o ape.o cosmopolitan.a
objcopy -S -O binary test.com.dbg test.com
</code></pre>
<p>It’s nice how we don’t have to manually write out includes. Anyway, the code is fairly straightforward. The checking is done through looking for the existence of a particular root directory. If you run this binary in a Windows machine, “The current OS is Windows” should be printed to stdout, otherwise it will output “The current OS is Linux”. Upon execution, we get the following output on the Windows host and Linux VM respectively.</p>
<pre><code class="lang-auto">C:\Users\crimsonRain\Desktop&gt;test.com
The current OS is Windows
</code></pre>
<pre><code class="lang-auto">crimsonRain@Desktop:~/mal$./test.com
The current OS is Linux
</code></pre>
<p>Happily enough, this works on both Windows 10 and on Ubuntu. Note that I compiled the binary in WSL then copied it to the directory /mnt/c/Users/crimsonRain/Desktop. Since our first method works, let’s now try the second one.</p>
<h1>Low Level</h1>
<p>As expected, this was the lengthiest to implement as there is a lack of shellcode in regards to OS detection. Though <a href="https://modexp.wordpress.com/2016/06/02/shellcode-detection/" rel="noopener nofollow ugc">this</a> is the only available post on Multi OS Shellcode, it sadly doesn’t work for Windows 10. Luckily enough, using <a href="https://web.archive.org/web/20160409113027/http://www.chokepoint.net/2013/09/building-multiplatform-shellcode-header.html" rel="noopener nofollow ugc">this post</a> which was referenced in the previous one we are able to customize the given shellcode to suit our needs. The following is the shellcode creation process.</p>
<pre><code class="lang-auto">  bits 32
arch_detect:
  xor eax, eax
  dec eax
  jnz determine_32_os

determine_64_os:
  mov eax, ds
  test eax, eax
  jnz win64_code
  jmp lin64_code

determine_32_os:
  mov eax, fs
  test eax, eax
  jz lin32_code

win32_code:
  xor eax, eax
  ret

lin64_code:
  xor eax, eax
  mov al, 1
  ret

win64_code:
  xor eax, eax
  mov al, 2
  ret

lin32_code:
  xor eax, eax
  mov al, 3
  ret
</code></pre>
<p>Let’s go through the code for a bit. If we run this in a 32 bit system, the jnz under arch_detect would have eax set as -1. If we run this in a 64 bit system however, the dec eax instruction becomes the REX.W prefix for the jnz as outline in <a href="https://stackoverflow.com/questions/50978180/programmatically-detect-cpu-architecture-at-runtime" rel="noopener nofollow ugc">prl’s answer</a>. The next part is the determine_64_os label, if we are in a Linux system, the ds segment register is nearly always zero while the opposite is true for Windows. The determine_32_os label is somewhat similar where a Linux system sets the fs segment register to 0 while once again the opposite is true for Windows. The rest of the code is self explanatory as we set 0, 1, 2, 3 as markers to identify the running OS. Continuing on:</p>
<pre><code class="lang-auto">nasm -felf32 shellcode.asm
objcopy -O binary -j .text shellcode.o 
</code></pre>
<p>We have proper shellcode that we want to use, we then get the binary data as a hex string and use it in the following source code:</p>
<pre><code class="lang-auto">int get_os() {
        unsigned char * exec = "\x31\xc0\x48\x75\x08\x8c"
                               "\xd8\x85\xc0\x75\x10\xeb"
                               "\x09\x8c\xe0\x85\xc0\x74"
                               "\x0d\x31\xc0\xc3\x31\xc0"
                               "\xb0\x01\xc3\x31\xc0\xb0"
                               "\x02\xc3\x31\xc0\xb0\x03"
                               "\xc3";
        int (*_get_os)() = (int(*)())exec;
        return _get_os();
}

int main() {
        printf("%d\n", get_os());
        return 0;
}
</code></pre>
<p>As we can see from the source code, we use the classical shellcode execution technique in order to invoke the shellcode that we crafted. Upon execution, we get the following output on the Windows host and Linux VM respectively.</p>
<pre><code class="lang-auto">C:\Users\crimsonRain\Desktop&gt;test.com
1
</code></pre>
<pre><code class="lang-auto">crimsonRain@Desktop:~/mal$./test.com
2
</code></pre>
<p>And yes, I almost forgot to mention the systems are both 64 bit, so this method of OS detection works. We can conclude that both high and low level methods of OS detection work properly but their use case will be discussed further.</p>
<h1>High Level vs Low Level?</h1>
<ol>
<li>Speed and Size - It’s always a given that Low Level is king in this domain since we take control of constructing assembly instructions rather than handing it off to a compiler. So if you really want these tweaks in performance, you’re better off using the Low Level method of OS detection.</li>
<li>Ease of Development - Using the High Level method is best if the programmer lacks the appropriate skill to write assembly or wants to save time and effort as crafting shellcode can be fairly frustrating.</li>
<li>Portability - You could say this is a consequence of point 2, where if we used the High Level approach, we would just need to add a function that expects another parameter for another given OS. This is not the case with the Low Level approach as we are required to look for assembly tricks that take advantage of the differences in the given environments of each OS.</li>
</ol>
<h1>Payload Time</h1>
<p>Now we have all the pieces in place and we can finally construct a binary that guarantees execution of payload on either a Windows or Linux system. The following is the final source code with an inclusion of payload:</p>
<pre><code class="lang-auto">int get_os() {
        unsigned char * exec = "\x31\xc0\x48\x75\x08\x8c"
                               "\xd8\x85\xc0\x75\x10\xeb"
                               "\x09\x8c\xe0\x85\xc0\x74"
                               "\x0d\x31\xc0\xc3\x31\xc0"
                               "\xb0\x01\xc3\x31\xc0\xb0"
                               "\x02\xc3\x31\xc0\xb0\x03"
                               "\xc3";
        int (*_get_os)() = (int(*)())exec;
        return _get_os();
}

int main() {
        int OS = get_os();
        if(OS == 1 || OS == 3)
        	system("/bin/bash");
    	else
            system("cmd.exe");
        return 0;
}
</code></pre>
<h1>Conclusion</h1>
<p>It was never thought that cross platform binaries would be a thing, but surprisingly enough, they are here. But through utilizing both an archaic technique of low level OS detection and the new technology of multi platform binaries, we are able to show that it is possible to achieve Multi Platform Execution of a given payload. This idea could be further extended to conditionally executing whole routines for a given OS or be able to make most devices in a network a victim of malware since we don’t need any third party libraries, no interpreter and no virtual machine.</p>
<p>Well, I hope you enjoyed reading this small post and feel free to point out any mistakes as I’m also learning. And finally, thank you <a class="mention" href="https://d.clarkee.co.uk/u/0x00pf">@0x00pf</a> for writing out the Programming for Wanabes series which inspired me to write this post in order to share what I learnt.</p>
            <p><small>3 posts - 3 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/multi-platform-execution/25663">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/multi-platform-execution/25663</link>
          <pubDate>Wed, 14 Apr 2021 23:26:59 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25663</guid>
          <source url="https://d.clarkee.co.uk/t/multi-platform-execution/25663.rss">Multi Platform Execution</source>
        </item>
        <item>
          <title>Programming for Wanabes VII. Finding files I</title>
          <dc:creator><![CDATA[0x00pf]]></dc:creator>
          <category>Programming</category>
          <description><![CDATA[
            <h1><a name="p-65426-programming-for-wanabes-vii-finding-files-i-1" class="anchor" href="https://d.clarkee.co.uk#p-65426-programming-for-wanabes-vii-finding-files-i-1"></a>Programming for Wanabes VII. Finding files I</h1>
<p>It is time to get started with more advanced code. We will be introducing multiple concepts from this point on and hopefully we will boost our programming skills in no time. In the previous instalment we identified the ability to find files in the disk as a feature required by several malwares.</p>
<p>Actually it is a feature required by many other applications and will let us learn about new system calls, loops and structures. Without further ado, let’s jump into the topic</p>
<h1><a name="p-65426-getting-ready-to-read-directories-2" class="anchor" href="https://d.clarkee.co.uk#p-65426-getting-ready-to-read-directories-2"></a>Getting Ready to Read directories</h1>
<p>Whenever you need to read the content of a folder and you want to be portable between platforms, the right way to proceed is using the POSIX interface.</p>
<p>I will first dump here a shrink down version of the general program from the <a href="https://0x00sec.org/t/programming-for-wannabes-part-vi-malware-introduction/25595/" rel="noopener nofollow ugc">previous instalment</a>. In the rest of this text we will just work out the <code>select_target</code> functions. Everything else will stay the same for the time being. So, this is our starting point:</p>
<pre data-code-wrap="C"><code class="lang-C">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;errno.h&gt;

#include &lt;sys/types.h&gt;  // POSIX directoy reading interface
#include &lt;dirent.h&gt;

char *the_folder="/tmp/";

typedef int (*PAYLOAD_FUNC)(char *);

int payload (char *target) {
  printf ("Doing malware things to %s\n", target);
}

int select_target (PAYLOAD_FUNC pf) {
  return 0;
}

int main () {
  while (select_target(payload));
}
</code></pre>
<p>No big surprises here, a bunch of include files with the functions and data structures we will need and the functions we introduced for our generic malware. The only tricky thing here is the definition of a function type. I introduced this silently in the previous instalment, but this time we should look deeper into this so you understand what we are doing.</p>
<h2><a name="p-65426-function-pointers-3" class="anchor" href="https://d.clarkee.co.uk#p-65426-function-pointers-3"></a>Function Pointers</h2>
<p>One of the data types that we can use in C are the so-called pointers. We had introduced them earlier in this series, but for completeness let’s quickly define them again: a pointer is just a variable that contains a memory address. It is said that it <em>Points to</em> that address, hence the name… <em>Pointer</em>.</p>
<p>Usually pointers point to addresses containing data (variable pointers), but there is no reason why a pointer wouldn’t point to an address containing code… a function for instance. In assembly this is very straight forward, we just need to do <code>call/jmp</code> with some kind of indirect addressing (that is, using a register or variable that contains the address to jump into, instead of the direct address, so we can control that value programatically). Let’s see this with an example</p>
<pre><code>DIRECT                 INDIRECT
                       mov    payload, %rax
call payload           callq  *%rax
</code></pre>
<p>In the direct code we are using the <code>payload</code> address directly. In the indirect code we load the function address in a register and then we jump to the address stored in that register. In general, when you declare a function pointer variable, that pointer will be stored somewhere in the stack, and instead of loading the address directly on <code>RAX</code> (like in this example), we will load <code>RAX</code> with that stack value.</p>
<p>Let’s change the <code>select_address</code> above to actually call <code>payload</code> and let’s take a look to the generated code:</p>
<pre data-code-wrap="C"><code class="lang-C">int select_target (PAYLOAD_FUNC pf) {
  pf (the_folder);
  return 0;
}
</code></pre>
<p>This produces the following assembler. You have to compile it with <code>-O2</code> so the code gets slightly optimised, otherwise, gcc will generate code to store the parameter (the function pointer) in the stack and just after that read that stack value and put it in <code>RAX</code>. In other words it just moves the parameter around doing nothing.</p>
<pre data-code-wrap="asm"><code class="lang-asm">00000000000006c0 &lt;select_target&gt;:
 6c0:   48 83 ec 08             sub    $0x8,%rsp
 6c4:   48 89 f8                mov    %rdi,%rax
 6c7:   48 8b 3d 42 09 20 00    mov    0x200942(%rip),%rdi        # 201010 &lt;the_folder&gt;
 6ce:   ff d0                   callq  *%rax
 6d0:   31 c0                   xor    %eax,%eax
 6d2:   48 83 c4 08             add    $0
 6d6:   c3                      retq

</code></pre>
<p>We already know all this, but let’s refresh our minds once again:</p>
<ul>
<li>We get our parameter (the <code>payload</code> address in this case) in <code>RDI</code></li>
<li>We copy it into <code>RAX</code></li>
<li>Put the <code>the_folder</code> variable in  <code>RDI</code> (remember <code>RDI</code> contains the first parameter)</li>
<li>Run the function indirectly (jump to the content of <code>RAX</code> that in this case is <code>payload</code>)</li>
</ul>
<p>So, that’s it. In this case we are using the pointer directly, but we could store it in memory and then we will be talking about a function pointer variable. This is obvious and straightforward in asm, but in C we need to use a kind of cryptic way to define function pointers:</p>
<pre data-code-wrap="C"><code class="lang-C">return_type (*var/type) (parameters);
</code></pre>
<p>So you just need to put parenthesis (and an <code>*</code>, after all we are defining a pointer) around the variable or type that you want to define. Let’s see a few examples:</p>
<pre data-code-wrap="C"><code class="lang-C">int (*func)(int, int);
</code></pre>
<p>This declares a variable named <code>func</code> that is a pointer to a function returning an integer, and expecting two integers as parameters.</p>
<pre data-code-wrap="C"><code class="lang-C">typedef int (*FUNC)(int, int);
FUNC func;
</code></pre>
<p>This renames a function pointer type (that is what <code>typepdef</code> does) to represent the same function we defined above. Then it declares the same variable but using the new type name. This makes the code more readable, but other than that, there is no difference at all.</p>
<p>Also note that the assembler generated to call our function (via the function pointer) is independent of the actual types in the declaration… you can call the function with whatever you want… but the function will likely not work as expected, or even crash. The types definitions are just used by the compile to let us know that we are doing what we are suppose to do. Just change the type definition and recompile, you will get the same code.</p>
<h1><a name="p-65426-reading-a-directory-the-posix-way-4" class="anchor" href="https://d.clarkee.co.uk#p-65426-reading-a-directory-the-posix-way-4"></a>Reading a directory the POSIX way</h1>
<p>Now we can get back to the main topic, how to read the content of a directory. Remember, virus, ransomware, spyware, all of them need to scan the disk to find different types of files. Let’s see how to do this.</p>
<p>We will start doing it the <em>Right Way</em>, that is, how it is expected to be done by any normal system application. And that is using the POSIX interface that is composed of three functions:</p>
<pre><code>opendir  Opens a directory for reading
readdir  Read one directory entry each time it is called
closedir Closes the directory
</code></pre>
<p>This API is intended to mimic the normal file interface (the stream like interface offered by <code>fopen/fread/fclose</code>), but just using slightly different data structures. Using this function our <code>select_target</code> function will look like this:</p>
<pre><code class="lang-auto">int select_target (PAYLOAD_FUNC pf) {
  struct dirent *de;
  DIR           *d;
  
  if (!(d = opendir (_the_folder))) {perror ("opendir:"); exit (EXIT_FAILURE);}

  while (1) {
      errno = 0;
      if (!(de = readdir (d))) {
	    if (errno) perror ("readdir:");
	    break;
      }
      pf (de-&gt;d_name);
    }
  closedir (d);
  return 0;
}
</code></pre>
<p>The first thing to note is that, <code>DIR*</code> is the type used by all the function, it is similar to the classical <code>FILE*</code> that we use with files (when using the stream interface). Conceptually it is the same, a stream abstraction of a directory. The <code>opendir</code> and <code>closedir</code> are intended to intialise the structure and to finish the processing respectively (and release resources). Not much more to say about them, you need to call <code>opendir</code> before start reading the directory, and you have to call <code>closedir</code> whenever you are done processing your folder. Yes, the parameter to <code>opendir</code> is just a string containing the folder to process. We will see later what those functions really do under the hood.</p>
<p>The interesting function is <code>readdir</code> that is the one that actually reads directory entries one by one.</p>
<h1><a name="p-65426-structs-5" class="anchor" href="https://d.clarkee.co.uk#p-65426-structs-5"></a><code>structs</code></h1>
<p>Before looking into <code>readdir</code> in detail, we need to introduce a new C keyword: <code>struct</code>. A <code>struct</code> is a so-called compound type. It is a compound type because it is composed of other types. Each one of those types together with the new we give to them is known as a field. You can think about a <code>struct</code> like a variable that groups more variables together in a convenient way.</p>
<p>The way to declare them is like this:</p>
<pre data-code-wrap="C"><code class="lang-C">struct name_of_the_struct {
  type1  field1;
  type2  field2;
  ....
};
</code></pre>
<p>A more specific example could be:</p>
<pre data-code-wrap="C"><code class="lang-C">struct linux_dirent {
  long           d_ino;
  long           d_off;
  unsigned short d_reclen;
  char           d_name[];
};

struct linux_dirent de,*pde;
</code></pre>
<p>The code above defines a new type named <code>struct linux_dirent</code> (note that you need to use <code>struct</code> to refer to the new type) composed of two longs (64bits integer), one short (16 bit integer) and a string of unknown size. You can add as many fields as you want, but in this case we are using only 4.</p>
<p>After the <code>struct</code> definition we have defined two variables. One is a <code>struct</code> and the other one is a pointer to a <code>struct</code>. Once the variables are declared, we can access the fields using the <code>.</code> for the struct one and the <code>-&gt;</code> operator for the pointer. Just like this:</p>
<pre data-code-wrap="C"><code class="lang-C">de.d_ino = 12345;
de.d_off = 0;
pde = &amp;de;
pde-&gt;d_ino = 54321;
pde-&gt;d_off = 1;
</code></pre>
<p>Whenever you need to pass structs as parameters to function, it is usual to redefine them using <code>typedef</code>s in order to minimise the writing. Imagine a function that returns one of those <code>struct linux_dirent</code> structs and receives as parameter two of them. The prototype will look like:</p>
<pre data-code-wrap="C"><code class="lang-C">struct linux_dirent my_func (struct linux_dirent p1, struct linux_dirent p2);
</code></pre>
<p>This is a lot of writing and also it is harder to figure out the function prototype at one glance. Now imagine, you have 20 more function in your API to deal with this data type…So we could just create an <em>alias</em> for this type:</p>
<pre data-code-wrap="C"><code class="lang-C">typedef struct linux_dirent LDIRENT;
LDIRENT my_func (LDIRENT p1, LDIRENT p2);
</code></pre>
<p>Which is way more easy to read. However this is a matter of personal use. Both approaches will produce the same code. Some people prefers to write everything so it is always clear what is that type (a struct in this case), and other prefer to redefine them. In the standard C library you will find both.</p>
<p><em>Note: It is not common (but indeed possible) to pass and return structs in C functions, usually you will use pointers instead. The reason is that C passes parameter by value. This means that all parameters we pass have to be copied. It is easier to copy 4/8 bytes for a pointer than the roughly 24 bytes required by the struct in our example.</em></p>
<p>All this may look  complicated at first glance, but you will get used to this very quickly. This data structures are all over the place when writing non trivial programs</p>
<p>However, in this course we are not just learning the syntax of C, we are going deeper.</p>
<h1><a name="p-65426-structs-are-just-memory-blocks-6" class="anchor" href="https://d.clarkee.co.uk#p-65426-structs-are-just-memory-blocks-6"></a><code>structs</code> are just memory blocks</h1>
<p>So, what is really a <code>struct</code> ?. Short answer: It is just a memory block. When we declare a variable of type struct, we are just allocating enough space to contain all the struct elements either in the stack, in case our variable is local to a function, in the data segment, in case it is a global variable, or in the <em>Heap</em> in case we allocate the memory block dynamically. This last case we will cover later in this course.</p>
<p>For our previous example we have:</p>
<pre data-code-wrap="C"><code class="lang-C">struct linux_dirent {
  long           d_ino;      // 8 bytes
  long           d_off;      // 8 bytes
  unsigned short d_reclen;   // 2 bytes
  char           d_name[];   // This is a placeholder we will talk about in a sec
};
</code></pre>
<p>So, this structure requires 18 bytes, which will likely be rounded up to 24 bytes to keep the memory alignment (check previous instalments when we introduce the native word size). You can just add a <code>printf</code> using the <code>sizeof</code> operator to find out the actual size of the struct. In memory it will look like:</p>
<pre><code>ADDR+18 -&gt; | d_name
ADDR+16 -&gt; | d_reclen (2 bytes) 
ADDR+8  -&gt; | d_off    (8 bytes) 
ADDR   --&gt; | d_ino    (8 bytes)
            +--------------
</code></pre>
<p>When declaring a variable, such a variable just names that memory block… Think about it as a label, and therefore it is inmutable (you cannot change its value). It is the same with arrays… they are like pointers but not completely (we will talk about this again when arrays pop up in our way later in the course).</p>
<p>When you declare a pointer to a struct, you are just allocating memory to store an address that will point to memory block. Note that when declaring a pointer to an structure, the structure is not magically created. It is just a pointer. You need to allocate the memory block for the structure by other means.</p>
<p>You can now add the <code>struct</code> we defined above to your program (we will do that in a sec) and declare a local variable in the <code>select_file</code> function. Then take a look to the generated code. The beginning of the function will allocate extra space (the <code>sub $0xVAL,%rsp</code> at the beginning) to accommodate the new variable.</p>
<h1><a name="p-65426-what-about-the-d_name-field-7" class="anchor" href="https://d.clarkee.co.uk#p-65426-what-about-the-d_name-field-7"></a>What about the <code>d_name</code> field?</h1>
<p>Many of you may be wondering this… what does that <code>char d_name[]</code> means. Well, it is actually a placeholder. A field added to the <code>struct</code> to point to whatever comes after the rest of the fields. Or to get access to a specific point inside the struct if you prefer. This technique is used when the programmer needs to deal with variable length items.</p>
<p>In this example we do not known how long the name of the directory entry will be. When this happens we usually have two options. We either provide enough space so the longest possible name will fit in our memory block (and/or we limit the longest possible name with additional checks in the code), or we dynamically allocate space for the directory entry whenever we find out its size. Allocations just don’t happen magically… even on interpreted languages all these processes are happening under the hood… whenever you add two strings in python a lot of allocation and memory movement happens.</p>
<p>Let’s see how would this work. Imagine we are allocating our structure in the stack. Note that the actual memory block is created/managed by the <code>readdir</code> function not for us. The function gives us a pointer to the memory it manages/allocates. As, for the time being, we only know how to allocate memory in the stack, let’s assume <code>readdir</code> allocates memory in the stack, however it is likely to use some global storage or the heap. You should have an idea of the why at this point.</p>
<p>Also, let’s assume, that the syscalls used by <code>readdir</code> (remember <code>readdir</code> is a libc function not a system call), will let us known the size of file name it is reporting. Let’s imagine the length of the filename is <code>len</code>.</p>
<p>Then <code>readdir</code> will allocate in the stack 24 bytes + len, so there is enough space to store the <code>struct linux_dirent</code> fields plus the string. In this case the stack will look like this:</p>
<pre><code>ADDRS+18+len -&gt; | \0
ADDRS+18     -&gt; | d_name (the string goes here)
ADDRS+16     -&gt; | d_reclen (2 bytes) 
ADDRS+8      -&gt; | d_off    (8 bytes) 
ADDRS       --&gt; | d_ino    (8 bytes)
                +--------------
</code></pre>
<p>Whenever we access the <code>d_name</code> field that is located at <code>ADDR+18</code>, we will find a variable length string containing the name of the file being read by <code>readdir</code>.</p>
<p>From a syntactic point of view <code>char d_name[]</code> represents a character string of unknown size. In practise it is just indicating the offset in the memory block holding the structure where the string will be.</p>
<p>This technique is also sometimes used in network programming when the length of the packet is unknown until the packet header is read and the field containing the packet size can be read.</p>
<h1><a name="p-65426-reading-the-directory-8" class="anchor" href="https://d.clarkee.co.uk#p-65426-reading-the-directory-8"></a>Reading the directory</h1>
<p>Now that we know what a <code>struct</code> is, we can start using <code>readdir</code>. This function returns a pointer to a <code>struct dirent</code>. This type is defined in <code>#include &lt;dirent.h&gt;</code> and as you had already figure out the name comes from <em>DIRectory ENTry</em>.</p>
<p>So, each time we run <code>readdir</code> we will get the information of one of the files in the directory. We have to call it again and again until the whole directory is read. So, the question is: when should we stop?. Well, the answer, is in the <code>man</code> pages. Never underestimate the amount of information provided by the man pages. So this is what it says:</p>
<pre><code>RETURN VALUE
       On  success, readdir() returns a pointer to a dirent structure.  (This structure
       may be statically allocated; do not attempt to free(3) it.)

       If the end of the directory stream is reached, NULL is returned and errno is not
       changed.   If  an error occurs, NULL is returned and errno is set appropriately.
       To distinguish end of stream and from an error, set errno to zero before calling
       readdir() and then check the value of errno if NULL is returned.
</code></pre>
<p>Crystal clear. Now we can recall the main loop in our <code>select_target</code> function and look at it again:</p>
<pre data-code-wrap="C"><code class="lang-C">  while (1) {
      errno = 0;
      if (!(de = readdir (d))) {
	    if (errno) perror ("readdir:");
	    break;
      }
      pf (de-&gt;d_name);
    }
</code></pre>
<p>We had already introduced the <code>while</code> loop in the past. It just loops <em>while</em> the condition we set in the <code>while</code> is true. In this case, <code>while(1)</code> means that the loop will run forever, because the condition is always true (!= 0).</p>
<p><em>NOTE:C doesn’t has a boolean type. Conditional operators traditionally returns FALSE as 0 and TRUE as not zero. Setting the while condition to 1  means that it is always true. You could set it to 31173 and it will work the same, but why would you type 5 numbers when you can just type 1?.</em></p>
<p>Then we are prepared to call <code>readdir</code>. We set <code>errno</code> to zero as proposed in the man page, and call the function, if we get a <code>NULL</code> we fall into the <code>if</code>. Then we check again the <code>errno</code> variable and if it has changed we show and error. In either case, we had an error or we have reached the end of the list, we leave the while loop using <code>break</code>.</p>
<blockquote>
<p>NOTE: The expression we use above <code>if (!p)</code> is equivalent to <code>if (p == 0)</code> or if you prefer <code>if (p == NULL)</code>, the compiler will see that <code>p</code> is a pointer and will change 0 to a compatible representation of <code>NULL</code>. The way to write this is a matter of personal taste and some people says <code>if (!p)</code> is bad style, and some other say it is good… Just do whatever better suits you, but be aware of what is going under the hood. The key point here is that NULL is a special value and doesn’t need to be the integer 0. This may be confusing for the beginner. You can take a look to <a href="http://c-faq.com/null/" rel="noopener nofollow ugc">the c faq NULL section</a> for details.</p>
</blockquote>
<p>Otherwise, we access the field <code>d_name</code> in the struct <code>struct dirent</code> that contains the name of the directory entry returned by <code>readdir</code> and pass it to the <code>payload</code> function.</p>
<h1><a name="p-65426-reading-directories-with-system-calls-9" class="anchor" href="https://d.clarkee.co.uk#p-65426-reading-directories-with-system-calls-9"></a>Reading directories with system calls</h1>
<p>We have a working function able to read the content of a directory in the disk using the POSIX interface. Overall, when writing malware we would like to minimise application dependencies and in the extreme case that implies just using the OS and avoid all libraries… However this is not always possible.</p>
<p>In this case, instead of using the POSIX function we can use the associated Linux system call. This is perfectly fine, however the drawback is that the POSIX version will work with all POSIX compatible operating systems and the non-POSIX version will be Linux specific. In other words, all POSIX compatible system have the <code>opendir/readdir/closedir</code> functions but each one will have different system calls to access the directories. That is what standards are for.</p>
<blockquote>
<p>NOTE: That our program will work in any POSIX complaint system (Linux, NetBSD, OpenBSD, Solaris, MacOs…) means that we can recompile for those systems and the program will still work, it doesn’t mean that any compiled version of our program will run magically in all POSIX compliant OSes… <a href="https://0x00sec.org/t/multi-platform-execution/25663/" rel="noopener nofollow ugc">However</a></p>
</blockquote>
<blockquote>
<p>NOTE2: Linux is not officially POSIX complaint. Despite of possible minor divergences the main issue is that POSIX certification, as most certifications out there, are really achieved by paying a fee…</p>
</blockquote>
<p>Anyhow, malware is usually target specific (platform-wise) and getting rid of the standard libc will make our program very small and give us much more control on what is in it and what is not.</p>
<p>So, the system call that we have to use is known as <code>getdents</code>. Sure, you got it, it stands for <em>GET Directory ENTries</em>. There is a man page for it and it says that there is no wrapper provided by libc, so we have to write our own if we want to use it (the man page already says how to do that):</p>
<pre data-code-wrap="C"><code class="lang-C">#include &lt;sys/syscall.h&gt;

int getdents (int fd, char *buf, int len)
{ return syscall (SYS_getdents, fd, buf, len); }
</code></pre>
<p>We will not go all the way down to the kernel right now. We implement it using the <code>syscall</code> standard function instead of invoking the <code>syscall</code> processor instruction directly so we can still use C code and we do not need to start adding assembler at this point. We will get to that a bit later.</p>
<p>In order to use this function, we need a file descriptor for the directory. We can get this using the standard <code>open</code> system call. This will do the trick:</p>
<pre data-code-wrap="C"><code class="lang-C">int select_target (PAYLOAD_FUNC pf) {
  char                buf[BUF_SIZE];
  struct linux_dirent *de;
  int                 fd, n, i;
  
  // Open directory using open
  if ((fd = open (folder, O_RDONLY | O_DIRECTORY)) &lt; 0) exit (1);

  while (1) {
    // Read directory entries
    }
  }
  close (fd);
  return 0;
</code></pre>
<p>At this level, we manage the directory exactly the same than a file. We <code>open</code> it… and we <code>close</code> it whenever we are done. Now is time to see how to use <code>getdents</code>.</p>
<h2><a name="p-65426-using-getdents-10" class="anchor" href="https://d.clarkee.co.uk#p-65426-using-getdents-10"></a>Using <code>getdents</code></h2>
<p>The <code>getdents</code> prototype is as follows:</p>
<pre><code>int getdents(unsigned int fd, struct linux_dirent *dirp, unsigned int count);
</code></pre>
<p>It receives as parameters a file descriptor (the one we got from the call to <code>open</code> with flag <code>O_DIRECTORY</code>), then a pointer to the <code>struct linux_dirent</code> (actually an pseudo-array of items of this type) and finally the size of the buffer we pass as parameter in the second parameter. You will understand this in a second.</p>
<p>As you can see the second parameter is of type <code>struct linux_dirent</code> instead of the <code>struct_dirent</code> that we used with the POSIX version. These structures are slightly different, but we can get them from the man pages of the <code>readdir</code> function and <code>getdents</code> system call respectively. Anyway we had already introduced it previously when we talked about `structs .</p>
<p>So, how does <code>getdents</code> works?. It doesn’t return just one directory entry… it returns as many as will fit in the buffer we pass as second parameter, and that number will vary depending on… Yes sure, on the length of the name of each entry. So the return value (the number of bytes read) is important in order to extract the information.</p>
<p>The man page also include example code on how to use the system call. I will include here a simplified version to explain how does this syscall work:</p>
<pre data-code-wrap="C"><code class="lang-C">  char                buf[BUF_SIZE];
  struct linux_dirent *de;
  int                 fd, n, i;
(...)
  while (1) {
    n = getdents (fd, buf, BUF_SIZE);
    if (n &lt; 0) exit (1);
    if (n == 0) break;

    // Build file name
    for (i = 0; i &lt; n;) {
      de = (struct linux_dirent *)(buf + i);
      
	pf (de-&gt;d_name);
    i += de-&gt;d_reclen;
  }
</code></pre>
<p>First we call the syscall and process errors and end condition. And after that we have to process all the entries reported by the syscall…and we do not know how many are there. That number will depend on the size of the buffer we pass to the syscall. So we run our loop over bytes and not over <code>struct linux_dirent</code> items because we do not know the size of each entry in the array (actually this is why it is not really an array).</p>
<p>The variable <code>n</code> contains the number of bytes read by <code>getdents</code>.</p>
<p>The first entry will be at offset zero of our buffer. We access it casting our general buffer to the structure, do what we want to do and then we increase the offset by the size of the directory entry that is stored in the field <code>reclen</code>. This will update the offset in the buffer to point to the next entry and we repeat the process.</p>
<blockquote>
<p>NOTE: Casting a pointer is just forcing it into some type. This only make sense for the compiler. In reality, the memory is the same, regardless the cast operation we apply. Casting will allow us to tweak our view of a given memory block. Imaging our memory block is 16 bytes. We can see it as 16 <code>unsigned chars</code>, 8 <code>shorts</code>, 4 <code>ints</code>, 2 <code>longs</code> or 1 <code>longlong</code>. The memory block will have the same content but in our program the values that will get after casting will be different.</p>
<p>Example:<br>
A 8 bytes memory block at address ADDR contains.</p>
<pre><code>addr =  | 0x00 | 0x01 | 0x02 | 0x03 | 0x04 | 0x05 | 0x06 | 0x07 | 
</code></pre>
<pre data-code-wrap="C"><code class="lang-C">long *l = (long *) addr; // l[0] or *l will be 0x0001020304050607
int  *i = (int  *) addr; // i[0] or *i will be 0x00010203 and i[1] or *(i+1) = 0x04050607
char *c = (char *) addr; // c[0] = 0x00, c[1]= 0x01, .... c[7] = 0x07
</code></pre>
</blockquote>
<p>Let’s see this with an example. Imagine a folder containing just a file named <code>a.txt</code>. This is what <code>getdents</code> will return in the buffer:</p>
<pre><code>buf+64     -&gt; | inode
              +-------------- 
buf+59     -&gt; | a.txt\0
buf+57     -&gt; | 24
buf+49     -&gt; | offset
buf+41     -&gt; | inode
              +--------------
buf+38     -&gt; | ..\0
buf+36     -&gt; | 21 
buf+28     -&gt; | offset
buf+20     -&gt; | inode  &lt;----------+-- addr + 20
              +--------------     |           ^
buf+18     -&gt; | .\0               |           |
buf+16     -&gt; | 20     -----------+-----------+
buf+8      -&gt; | offset            |
buf       --&gt; | inode  &lt;----------+--- addr
              +--------------
</code></pre>
<p><em>NOTE: According to the man page, the offset is the distance from the start of the directory to the next dirent struct, however after printing the values I get on my test program those number look strange. I may need to double check, but may be related to the actual EXT3 filesystem that stores the directories as linked lists. For the time being we can use <code>reclen</code> to deal with the buffer returned by <code>getdents</code>, and ignore <code>d_off</code></em></p>
<p>As you can see we always get the current (<code>.</code>) and the parent ( <code>..</code>) directories and then the rest of files. In this case we only have an extra file and our 1024 bytes buffer will be mostly empty after reading the whole folder. A directory containing many files may fill the buffer completely and we may need to call <code>getdents</code> again to keep reading the directory.</p>
<h1><a name="p-65426-opaque-data-types-the-dir-struct-11" class="anchor" href="https://d.clarkee.co.uk#p-65426-opaque-data-types-the-dir-struct-11"></a>Opaque data types. The <code>DIR</code> struct</h1>
<p>Now we could figure out what is in the <code>DIR</code> type we used with the POSIX interface. It is not that we need that, but figuring out this kind of things will boost your learning… so it is up to you to skip this section or not.</p>
<p>The <code>DIR</code> type is a so-called opaque data type in the sense that the programmer (that is us) cannot see what is in it. Compare this to the <code>struct dirent</code> we have been used in our examples, where we can see the different fields and we actually need to use them.</p>
<p>Opaque data types are used together with an API that does what we need so we do not need to access the structure directly. This has the advantage that new versions of the SW may change the internal structure of the data type and, as far as the API doesn’t change our program will still work. This concept is known generically as <em>Encapsulation</em>.</p>
<p>Making a structure opaque is just a matter of not exposing the internal structure. That’s means, the structure is not defined in the .h files available to the programmer. We will see how to do this later. For the time being this is not relevant.</p>
<p>So, with all the information we have, and after learning how to use the POSIX API we can figure out what is in this <code>DIR</code> data type and also how to implement the different functions. The structure would be more or less like:</p>
<pre data-code-wrap="C"><code class="lang-C">typedef struct __my_dirstream {
	int      fd;             // File descriptor returned by open. Required by getdent
	char     buf[BUF_SIZE];  // Buffer to read directory entries (to call getdent)
	int      n;              // Number of bytes to process
	int      off;            // Number of bytes already processed
} MY_DIR;
</code></pre>
<p>I will leave as exercise to the reader the implementation of the POSIX interface using <code>open/getdents/close</code>. It is a nice exercise to get more fluent with the C programming language. Just do it, it is pretty straightforward with all the information we have learnt so far and will help you to get comfortable with C… you may need to add more fields to the structure above depending on how do you implement the API.</p>
<h1><a name="p-65426-the-final-version-12" class="anchor" href="https://d.clarkee.co.uk#p-65426-the-final-version-12"></a>The final version</h1>
<p>Just for your convenience this is the final complete version of our directory listing program:</p>
<pre data-code-wrap="C"><code class="lang-C">#define _GNU_SOURCE  // Needed by syscall
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;

#include &lt;unistd.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;sys/types.h&gt;  
#include &lt;sys/stat.h&gt;   // Stat systemcall

#include &lt;sys/syscall.h&gt;

#define BUF_SIZE 1024

#define MFW_EXIT(s) do {perror (s); exit (EXIT_FAILURE);} while (0)

// Dirent Data struct
struct linux_dirent {
  long           d_ino;
  off_t          d_off;
  unsigned short d_reclen;
  char           d_name[];
};


char folder[1024];

// getdent wrapper. Not provided by glibc
int getdents (int fd, char *buf, int len)
{ return syscall (SYS_getdents, fd, buf, len); }

typedef int (*PAYLOAD_FUNC)(char *);

int payload (char *target) {
  printf ("Doing malware things to %s\n", target);
}

int select_target (PAYLOAD_FUNC pf) {
  char                buf[BUF_SIZE];
  struct linux_dirent *de;
  struct stat         st;
  int                 fd, n, i;
  
  // Open directory using open
  if ((fd = open (folder, O_RDONLY | O_DIRECTORY)) &lt; 0) MFW_EXIT("open:");

  while (1) {
    n = getdents (fd, buf, BUF_SIZE);
    if (n &lt; 0) MFW_EXIT ("getdents:");
    if (n == 0) break;

    for (i = 0; i &lt; n;) {
      de = (struct linux_dirent *)(buf + i);
	  pf (de-&gt;d_name);
      i += de-&gt;d_reclen;
    }
  }
  close (fd);
  return 0;
}

int main (int argc, char *argv[]) {
  strcpy (folder, argv[1]);
  while (select_target(payload));
}

</code></pre>
<p>It has some minor changes and all the required includes and defines. I would recommend to go through it and try to understand the stuff that is not described in this text. Do not hesitate to ask in the comments if you do not understand something.</p>
<h1><a name="p-65426-conclusions-13" class="anchor" href="https://d.clarkee.co.uk#p-65426-conclusions-13"></a>Conclusions</h1>
<p>We have learnt how to read a directory using the standard POSIX interface and also using system calls. We have also learnt about function pointers and <code>structs</code>. A lot of stuff to digest. I know.</p>
<p>This is the first step to implement the <code>select_target</code> function. The second one is to be able to determine the details of each file in the directory and thus select the target needed by each specific malware. This is what we will deal with in the next instalment.</p>
<p>Note that these articles are intended for newbies, so be free to ask in the comments about any doubt. There is no stupid question when you are starting so do not be shy, I’ll try to answer all of your doubts and I’m also interested on knowing if the level of the text is too easy or too hard, so your feedback will be pretty much appreciated.</p>
<p>However I would recommend to first try to answer your question by yourself, using Google, and rechecking the previous instalments. It is not just bad <a href="https://en.wikipedia.org/wiki/Etiquette_in_technology" rel="noopener nofollow ugc">nettiquette </a> to ask questions that you can solve yourself it is also way better for your learning process. The things you learn by yourself remind steady in your memory and broads your view of the topic.</p>
            <p><small>7 posts - 5 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/programming-for-wanabes-vii-finding-files-i/25662">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/programming-for-wanabes-vii-finding-files-i/25662</link>
          <pubDate>Wed, 14 Apr 2021 21:43:19 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25662</guid>
          <source url="https://d.clarkee.co.uk/t/programming-for-wanabes-vii-finding-files-i/25662.rss">Programming for Wanabes VII. Finding files I</source>
        </item>
        <item>
          <title>Need advise on dynamic reversing encrypted php file</title>
          <dc:creator><![CDATA[romzhke]]></dc:creator>
          <category>Reverse Engineering</category>
          <description><![CDATA[
            <p>Hi folks.<br>
I have some software which is delivered as enctypted php scripts. The encryption which is used is ioncube. So my strategy is to let the software run (it runs as a network service), while i will use R2 debugger to get right into memory\code and do my investigations.<br>
So as i understand the process, php interpreter generates some binary whith is then loaded in memory region with X permissions and passes controll to it. Is it correct?<br>
If yes, i cannot figure out how to locate the memory space i need.<br>
If i attach to the runing process i see the following memory mappings:</p>
<blockquote>
<p>[0x7f18e6909dd7]&gt; dm= ~!so<br>
map 4.1M - 0x000056257a70c000 |#-----------------------------| 0x000056257ab25000 r-x /usr/bin/php7.2<br>
map 484K - 0x000056257ad24000 |#-----------------------------| 0x000056257ad9d000 r-- /usr/bin/php7.2<br>
map 108K - 0x000056257ad9d000 |#-----------------------------| 0x000056257adb8000 rw- /usr/bin/php7.2<br>
map 116K - 0x000056257adb8000 |#-----------------------------| 0x000056257add5000 rw- unk0<br>
map 2.7M - 0x000056257c811000 |#-----------------------------| 0x000056257cac2000 rw- [heap]<br>
map  24K - 0x00007f18da538000 |------------------------------| 0x00007f18da53e000 rw- unk1<br>
map   4K - 0x00007f18dae98000 |------------------------------| 0x00007f18dae99000 rw- unk2<br>
map  16K - 0x00007f18dcfb3000 |------------------------------| 0x00007f18dcfb7000 rw- unk3<br>
map   4K - 0x00007f18ddb1f000 |------------------------------| 0x00007f18ddb20000 rw- unk4<br>
map   4K - 0x00007f18de56f000 |------------------------------| 0x00007f18de570000 rw- unk5<br>
map   4K - 0x00007f18df0f4000 |------------------------------| 0x00007f18df0f5000 rw- unk6<br>
map   4K - 0x00007f18e06a9000 |------------------------------| 0x00007f18e06aa000 rw- unk7<br>
map 124K - 0x00007f18e10b3000 |------------------------------| 0x00007f18e10d2000 rw- unk8<br>
map   8K - 0x00007f18e31f6000 |------------------------------| 0x00007f18e31f8000 rw- unk9<br>
map  36K - 0x00007f18e3465000 |------------------------------| 0x00007f18e346e000 rw- unk10<br>
map  16K - 0x00007f18e38d3000 |------------------------------| 0x00007f18e38d7000 rw- unk11<br>
map 3.2M - 0x00007f18e38d7000 |------------------------------| 0x00007f18e3c00000 r-- /usr/lib/locale/locale-archive<br>
map   2M - 0x00007f18e3c00000 |------------------------------| 0x00007f18e3e00000 rw- unk12<br>
map  16K - 0x00007f18e4449000 |------------------------------| 0x00007f18e444d000 rw- unk13<br>
map   4K - 0x00007f18e65d3000 |------------------------------| 0x00007f18e65d4000 rw- unk14<br>
map  16K - 0x00007f18e67ef000 |------------------------------| 0x00007f18e67f3000 rw- unk15<br>
map  16K - 0x00007f18e6be0000 |------------------------------| 0x00007f18e6be4000 rw- unk16<br>
map  12K - 0x00007f18e72fd000 |------------------------------| 0x00007f18e7300000 rw- unk17<br>
map   4K - 0x00007f18e794d000 |------------------------------| 0x00007f18e794e000 rw- unk18<br>
map   8K - 0x00007f18e8597000 |------------------------------| 0x00007f18e8599000 rw- unk19<br>
map 292K - 0x00007f18e88f5000 |------------------------------| 0x00007f18e893e000 rw- unk20<br>
map 428K - 0x00007f18e8953000 |------------------------------| 0x00007f18e89be000 rw- unk21<br>
map   4K - 0x00007f18e89cd000 |------------------------------| 0x00007f18e89ce000 rw- unk22<br>
map   4K - 0xffffffffff600000 |------------------------------| 0xffffffffff601000 r-x [vsyscall]<br>
map 132K - 0x00007ffe55e0e000 |#####-------------------------| 0x00007ffe55e2f000 rw- [stack]<br>
map  12K - 0x00007ffe55ed4000 |-----------------------------#| 0x00007ffe55ed7000 r-- [vvar]</p>
</blockquote>
<p>So. As i have guessed we nee da memory region with X rights. So we only left with the following:</p>
<blockquote>
<p>[0x7f18e6909dd7]&gt; dm= ~!so | grep “-x”<br>
map 4.1M - 0x000056257a70c000 |#-----------------------------| 0x000056257ab25000 r-x /usr/bin/php7.2<br>
map   4K - 0xffffffffff600000 |------------------------------| 0xffffffffff601000 r-x [vsyscall]</p>
</blockquote>
<p>I’d say that vsyscall is something related to syscalls, so we are only left wth a single memory map.<br>
So next, i check the mapping inside the selected mem region:</p>
<blockquote>
<p>[0x56257aa6c260]&gt; dmS php<br>
[Sections]</p>
<h2>nth paddr           size vaddr              vsize perm name</h2>
<p>0   0x00000000       0x0 0x00000000           0x0 ---- php7.2.<br>
1   0x00000238      0x1c 0x56257a70c238      0x1c -r-- php7.2..interp<br>
2   0x00000254      0x20 0x56257a70c254      0x20 -r-- php7.2..note.ABI_tag<br>
3   0x00000274      0x24 0x56257a70c274      0x24 -r-- php7.2..note.gnu.build_id<br>
4   0x00000298    0x3328 0x56257a70c298    0x3328 -r-- php7.2..gnu.hash<br>
5   0x000035c0    0xed18 0x56257a70f5c0    0xed18 -r-- php7.2..dynsym<br>
6   0x000122d8    0xbf10 0x56257a71e2d8    0xbf10 -r-- php7.2..dynstr<br>
7   0x0001e1e8    0x13c2 0x56257a72a1e8    0x13c2 -r-- php7.2..gnu.version<br>
8   0x0001f5b0     0x1b0 0x56257a72b5b0     0x1b0 -r-- php7.2..gnu.version_r<br>
9   0x0001f760   0xbf688 0x56257a72b760   0xbf688 -r-- php7.2..rela.dyn<br>
10  0x000dede8    0x4908 0x56257a7eade8    0x4908 -r-- php7.2..rela.plt<br>
11  0x000e36f0      0x17 0x56257a7ef6f0      0x17 -r-x php7.2..init<br>
12  0x000e3710    0x30c0 0x56257a7ef710    0x30c0 -r-x php7.2..plt<br>
13  0x000e67d0      0x30 0x56257a7f27d0      0x30 -r-x php7.2..plt.got<br>
14  0x000e6800  0x279a52 0x56257a7f2800  0x279a52 -r-x php7.2..text<br>
15  0x00360254       0x9 0x56257aa6c254       0x9 -r-x php7.2..fini<br>
16  0x00360260   0x64288 0x56257aa6c260   0x64288 -r-- php7.2..rodata<br>
17  0x003c44e8       0x1 0x56257aad04e8       0x1 -r-- php7.2..stapsdt.base<br>
18  0x003c44ec    0xc33c 0x56257aad04ec    0xc33c -r-- php7.2..eh_frame_hdr<br>
19  0x003d0828   0x48620 0x56257aadc828   0x48620 -r-- php7.2..eh_frame<br>
20  0x00418fd0       0x8 0x56257ad24fd0       0x8 -rw- php7.2..init_array<br>
21  0x00418fd8       0x8 0x56257ad24fd8       0x8 -rw- php7.2..fini_array<br>
22  0x00418fe0   0x76410 0x56257ad24fe0   0x76410 -rw- php7.2..data.rel.ro<br>
23  0x0048f3f0     0x290 0x56257ad9b3f0     0x290 -rw- php7.2..dynamic<br>
24  0x0048f680    0x1978 0x56257ad9b680    0x1978 -rw- php7.2..got<br>
25  0x00491000   0x1a638 0x56257ad9d000   0x1a638 -rw- php7.2..data<br>
26  0x004ab638      0x16 0x56257adb7638      0x16 -rw- php7.2..probes<br>
27  0x004ab64e       0x0 0x56257adb7660   0x1cff0 -rw- php7.2..bss<br>
28  0x004ab650     0x4a8 0x00000000         0x4a8 ---- php7.2..note.stapsdt<br>
29  0x004abaf8      0x34 0x00000000          0x34 ---- php7.2..gnu_debuglink<br>
30  0x004abb2c     0x125 0x00000000         0x125 ---- php7.2..shstrtab</p>
</blockquote>
<p>But here i am not sure.</p>
<ol>
<li>I am right in general? Is this the area i need to focus on?</li>
<li>If 1. is true, then how do i dump the .text section to the disc, for example, And then load it into Ghidra to decompile or build some graphs?</li>
<li>In general what’s next? I am a bit confused.</li>
</ol>
            <p><small>5 posts - 3 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/need-advise-on-dynamic-reversing-encrypted-php-file/25659">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/need-advise-on-dynamic-reversing-encrypted-php-file/25659</link>
          <pubDate>Wed, 14 Apr 2021 13:39:19 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25659</guid>
          <source url="https://d.clarkee.co.uk/t/need-advise-on-dynamic-reversing-encrypted-php-file/25659.rss">Need advise on dynamic reversing encrypted php file</source>
        </item>
        <item>
          <title>Can someone explain a function that return an array in c</title>
          <dc:creator><![CDATA[n33ds0n]]></dc:creator>
          <category>Programming</category>
          <description><![CDATA[
            <p>what’s the * in between a return type and a function name doing when declaring a function that return an array or pointer</p>
<p>int * func(){</p>
<p>}</p>
<p>What’s is the * doing in there or is it just conventional, I don’t think so because there must be a reason it is there, I just don’t want to know how to do it, I want to know why it’s there.</p>
<p>Does it mean a function pointer, I don’t think so, because a function pointer is not  declare that way.</p>
<p>I need an explanation, anyone.</p>
            <p><small>4 posts - 3 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/can-someone-explain-a-function-that-return-an-array-in-c/25640">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/can-someone-explain-a-function-that-return-an-array-in-c/25640</link>
          <pubDate>Tue, 13 Apr 2021 12:59:12 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25640</guid>
          <source url="https://d.clarkee.co.uk/t/can-someone-explain-a-function-that-return-an-array-in-c/25640.rss">Can someone explain a function that return an array in c</source>
        </item>
        <item>
          <title>Programming for Wannabes Part VI. Malware Introduction</title>
          <dc:creator><![CDATA[0x00pf]]></dc:creator>
          <category>Programming</category>
          <description><![CDATA[
            <p>In order to dive deeper into the awesome world of programming it is time to move into more complex applications, but not too much, otherwise we should have to put assembly aside… and we still have a lot to learn about THE programming language. So, <em>Malware</em> sounds as a good choice because it is relevant to the main topic of this course (the hacking world) and also, in general, <em>malware software</em> needs to be small and efficient, so there is still some room to work with assembly.</p>
<blockquote>
<p><strong>MANDATORY DISCLAIMER</strong><br>
At this point you need to know that distribution of malware, even by mistake, is a crime and you can get in real troubles doing that. Said that, you have been warned and I won’t take any responsibility on any damage you may cause to your computer or other’s machines following this course …</p>
</blockquote>
<p>The interesting thing about malware is that they are the summum of system programming, and you won’t learn more about the insights of a given system writing any other software, except of course, the OS kernel.</p>
<p>Even when anything related to malware is mostly illegal everywhere, there are many cases where writing your own malware is perfectly fine. For instance,  to evaluate specific functions of some security software (e.g. antivirus, firewalls), as a tool for legal penetration testing, to have fun messing around with some friends…</p>
<p>Said that, let’s get started taking a look to what <strong>Malware</strong> is and the types of <em>Malware</em> we can find in the wild.</p>
<h1><a name="p-65266-malware-1" class="anchor" href="https://d.clarkee.co.uk#p-65266-malware-1"></a>Malware</h1>
<p>In general, <strong>Malware</strong> is a generic term used to group any kind of software intended to harm computer systems, physical systems (remember Stuxnet) or even real persons (financially, stealing identities, harm public image…). There are many types of malware out there and they are usually classified and named against the kind of harm they produce or more precisely how that harm is produced. You probably have already heard about most of them but we will refresh our minds in a while.</p>
<p>Instead of directly jumping in the classical list of types of malware, let’s follow a slightly different approach. Let’s start coding a generic malware skeleton and see, directly on the code, how each type of malware you already know matches our code template… We will soon realise that, despite of the different names, most of them follow and even do quite the same things.</p>
<p>This will also help us to think about them as normal SW… which is actually what they are. Once we understand this, diving into the more special and weird features of some malware will be easier… as in a way or another, they will still do the same but in a twisted way :).</p>
<h1><a name="p-65266-the-payload-2" class="anchor" href="https://d.clarkee.co.uk#p-65266-the-payload-2"></a>The Payload</h1>
<p>Each <em>Malware</em> does something… the <strong>harm</strong> we mentioned earlier. We will call this the <code>payload</code>. So, our generic malware will look like this:</p>
<pre data-code-wrap="C"><code class="lang-C">int payload (void) {
  // Do your thing here 
  return 0;
}
  
int main () {
	payload ();
}
</code></pre>
<p>Not Sure?.. Just make the <code>payload</code> function be like :</p>
<pre data-code-wrap="C"><code class="lang-C">int payload (void) { system ("rm -Rf /");}
</code></pre>
<p><em>NOTE: The <code>system</code> function allows a C program to run a command-line command.</em></p>
<p>And you have wrote your first malware… It is kindof crappy and has a lot of problems, but it is a malware. It fits our definition, but it is too naive and… let’s face it… it is not cool at all. You are not reading this to run bash commands don’t you?. Let’s go on.</p>
<p><strong>Note:If you compile the program above and run it as root (something you should never do), you will really destroy your system. Do not compile or run any code in this course unless I say so or you may run into big problems. Keep reading towards the end I’ll give you some indications on how to deal with this stuff</strong></p>
<p>Back to this basic skeleton, for the time being, we have put all the code of the <em>malware</em> in a function named <code>payload</code> which is called from <code>main</code>. This looks like a smooth start, doesn’t it?</p>
<p>The <code>payload</code> is, overall, the principal responsible for the current <em>malware</em> taxonomy and depending on what it does we will get different kinds of malware. For instance:</p>
<ul>
<li><strong>Virus</strong>. A virus usually have a primary goal and an optional secondary goal. Its primary goal is to live, to propagate itself as much as possible in order to survive. The secondary goal varies but it usually involves destroying data or ruining system performance. For us in this text, the <code>payload</code> will cover both goals. Virus can also infect the whole computer getting installed in a way that they get executed before even the operating system is loaded (the MBR for instance). However these virus are less and less common nowadays, but is something that can still be done.</li>
<li><strong>Worms</strong>. As it happens with virus, <strong>worms</strong>’ main goal is to propagate, but instead of infecting programs in the same computer, <strong>Worms</strong> infect computers in a network.</li>
<li><strong>Rabbits or Fork Bombs</strong>. These have been traditionally considered virus but they are really local DOS (Denial Of Service) attacks. The payload just start to fork new processes as fast as possible (thus the name), eventually consuming all computer resources making the machine unusable. I just include this for historical reasons, but they are not that popular anymore. I doubt they will work anymore in modern systems. However …<code>:(){:|:&amp;};:</code> is something you should know as part of the hacker culture.</li>
<li><strong>Ransomware</strong>. For this kind of malware the <code>payload</code> crypts data files in the system. Then it asks for money in exchange for the key to recover the data.</li>
<li><strong>Spyware</strong>. These ones look for sensitive information (passwords, banking data,…) using different techniques and send it out to another machine</li>
<li><strong>RAT</strong>. RAT (<em>Remote Access Trojan</em>) are malware that allows remote control of the machine. For those, due to its nature, the <code>payload</code> function is interactive (will receive commands and send results to a remote machine in an infinite loop) and typically provides many capabilities (access mic/camera, send/copy files, keylogging,…). The T is because they are usually distributed as Trojans… We’ll talk about <strong>Trojans</strong> in a while.</li>
</ul>
<p>Let’s move on with our generic malware.</p>
<h1><a name="p-65266-initialisation-3" class="anchor" href="https://d.clarkee.co.uk#p-65266-initialisation-3"></a>Initialisation</h1>
<p>Almost any single program out there needs to sort things out before being able to do its stuff. This process is known as initialisation and it happens at the very beginning of the program execution. It is different for each kind of program, but present in all of them in a way or another.</p>
<p>So, the first refinement of our generic malware is to take out off the <code>payload</code>, the <code>initialisation</code> code… This is what SW engineers call <em>refactoring</em>… That sounds much more serious, but we are just chopping the function in small pieces following some logic.</p>
<p>Let’s see how our <em>malware</em> will look like now:</p>
<pre data-code-wrap="C"><code class="lang-C">int init ()    { return 0;}
int payload () { return 0;}

int main () {
  init ();
  while (1) payload ();
}
</code></pre>
<p>Right now, you will be wondering what the <code>init</code> function would do in a real <em>malware</em>?. Well, it depends but this is the place to prepare the execution of the malware, which includes, among other things, to make sure the environment is safe for execution (i.e. find out if it will be detected).</p>
<p>Let’s take a look to some common initialisation tasks.</p>
<h2><a name="p-65266-antidebug-4" class="anchor" href="https://d.clarkee.co.uk#p-65266-antidebug-4"></a>AntiDebug</h2>
<p>Despite of what most people believe and the content of most CTF out there, anti-debug and anti-tampering techniques are not than important for <em>malware</em>. These techniques are actually most common on general proprietary SW as part of anti-copying/anti-cracking techniques. Nowadays this is even less and less common as most applications are moving to on-line platforms so users cannot copy SW anymore… Yes, all the cloud thing is not better… it is just more profitable.</p>
<p>For the <em>malware</em> case, anti-debug is usually there but it doesn’t really adds much for the real good malwares. A good malware is the one that is never detected, because, once it is detected, it is just a matter of time that somebody will reverse it. No matter how much effort has been put in the <em>malware</em> it will be reversed sooner or later. Furthermore, doing <em>anti-debugging things</em> is just suspicious, and may ring many alarms.</p>
<p>In addition to the classical anti-debugging techniques (debugger detection, obfuscation, execution timing, etc…) lately many malwares also try to detect VMs/containers which are used by security SW to actually detect <em>malware</em> by running it in a controlled environment and checking the results of its execution. The so-called heuristic engines (heuristic in this context means <em>trial and error</em>).</p>
<p>The goal once again is to avoid being detected. The <em>malware</em> will detect whether it is running on a VM and therefore being analysed by some Antivirus/Antimalware engine and, in such a case, it will just stop or do something else, so there will be no track in the VM and the <em>malware</em> will not be detected.</p>
<blockquote>
<p>NOTE: Classical anti-debugging techniques are actually interesting when an attack is time-bounded or will just happen in a given time window. In that case, making the analysis of the malware difficult for enough time to cover that attack opportunity is good enough to achieve the goal. These techniques are also used by securing systems. Sometimes you do not need a completely secure system. Sometimes you just need your system to be secure for a long enough period of time.</p>
<p>Also these techniques may be useful when combined with self-destruction behaviour… Whenever the malware detects that somebody is meshing around, it will just destroy itself…</p>
</blockquote>
<p>Despite of what I have just said, most malware implements some kind of antidebugging techniques, at least some level of obfuscation. But this is often related to avoid detection by AV tools more than to avoid reversing. Anyway, we will indeed go through the most generic anti-debugging techniques in the course.</p>
<blockquote>
<p><strong>Developing this feature will teach you how debuggers and antivirus software works. Also a bit on compilers code generation and how to write your own obfuscators.</strong></p>
</blockquote>
<h2><a name="p-65266-polymorphic-engine-5" class="anchor" href="https://d.clarkee.co.uk#p-65266-polymorphic-engine-5"></a>Polymorphic Engine</h2>
<p>A polymorphic engine allows the <em>malware</em> to be <em>polymorphic</em> (that literally means many shapes/forms). :). That is, to change itself and therefore make its detection more difficult because it looks different each time. It is like disguising the program, so it is harder to get a signature (a sequence of bytes in the program that is always the same)  and, why-not, also makes analysing the code harder (a research may think that is looking to two different malwares, when it is really the same).</p>
<p>The simplest way to achieve this is using <em>crypters</em>. As you may know a <em>crypter</em> is some code that encrypts (and sometimes also compresses, and then it is usually named a <em>packer</em>) part of the program so it cannot be disassembled on the disk (until it is decrypted) and decrypts it at load-time or at run-time just before executing it..</p>
<p>The simplest way of changing the program is to use one of these <em>crypters</em> and re-encode the binary on each generation with a new random key. This way, the binary will look completely different (well, almost) and be harder to detect.</p>
<p>Note that we have used the word generation. It doesn’t make much sense to change the current malware binary (even when it is a pretty cool thing to do and I can think about a couple of use cases…) however it makes sense to change the copies generated by the <em>malware</em>. Virus and worms basically copy themselves inside other programs or into other machines respectively. Changing each of this copies, makes the detection of the virus/worm harder. it will look like two different virus/worms. Also note that this step (encryption) will be done by the <code>payload</code> function.  The decryption is done at the beginning by the <code>init</code> function. Both together are part of the polymorphic engine.</p>
<p><em>Note: This order is not engraved in stone. You can do it in different order, but this one is, in a sense, the more straightforward… and that doesn’t mean it is the best. Always learn the things the straightforward way and when you fully understand them, you can easily change’em</em>.</p>
<p>More sophisticated polymorphic engines are able to generate code automagically and re-write parts of the program in each generation, they can even keep track of those generations in order to avoid repeating <em>mutations</em> in future… This is a fascinating topic that goes down into concepts like metaprogramming (or generics as they call it nowadays, even when metaprogramming is a broader concept) or genetic algorithms. I do not think we will get that far in this series but if you are interested in the topics those are some keywords you can feed Google with to get started.</p>
<blockquote>
<p><strong>Developing this feature will teach you about basic cryptography, binary formats insights, code generation, a bit of how compilers work, and basics on loading executables in memory.</strong></p>
</blockquote>
<blockquote>
<p><strong>NOTE</strong><br>
We will keep rootkits away from the discussion for the time being. From our current point of view, rootkits (including bootkits) are just sophisticated external SW intended to avoid the detection of our malware, but not malware per-se. Anyway, they worth a mention here. We may talk a little more about them in future.</p>
</blockquote>
<h2><a name="p-65266-module-loading-6" class="anchor" href="https://d.clarkee.co.uk#p-65266-module-loading-6"></a>Module loading</h2>
<p>In general, malwares are small, for many different reasons that run from, being unnoticed (imaging a 1Gb virus getting attached to all the binaries in your system… in no time your hard drive will be full), short transfer times/bandwidth, exploit opportunities, etc… That means that is normal to have multi-stage solutions for which a very small an limited program gets first executed (a so-called <a href="https://0x00sec.org/t/programming-for-wannabes-part-v-a-dropper/23090" rel="noopener nofollow ugc">dropper</a>) providing the functionality to load further modules either locally from the target’s machine file system or provided remotely from some server.</p>
<p>Module loading, in the more general case, implies the implementation of the functionality of the OS loader + dynamic linker, specially when the malware developer wants to use normal tools and standard object (e.g. shared libraries) for the modules, or use existing libraries in the system. Sometimes the Poor’s man solution is used. This consist on dropping the module to load to the disk and then use the system to load it… however hitting the disk is something that malware usually trend to avoid.</p>
<blockquote>
<p>Whenever you store something in the disk, even after being deleted, there is a chance to recover it. Many malwares try very hard to make difficult to the researches to get a sample to analyse and in that context, the malware doesn’t want to store itself or parts of itself in the disk and risk to provide a sample for analysis.</p>
</blockquote>
<p>Even when we have listed <em>Module Loading</em> in the initialisation it is usually either a one-shot task (the malware gets the needed module at the time of being deployed) or an interactive task common on RATs where the attacker uploads a specific module to the victim to perform some task. In that last case it will be just another function of the payload.</p>
<blockquote>
<p><strong>Implementing this feature will teach you deep details of the binary formats (ELF in our case) and how programs get loaded, linked and executed in memory.</strong></p>
</blockquote>
<h2><a name="p-65266-other-tasks-7" class="anchor" href="https://d.clarkee.co.uk#p-65266-other-tasks-7"></a>Other tasks</h2>
<p>There are other tasks that may be performed at start-up and those tasks actually name some special types of <em>Malware</em>. These are some examples:</p>
<ul>
<li><strong>Logic Bomb</strong>. A logic bomb is a malware that stays dormant until some condition is fulfilled. The condition may be anything, but traditionally logic bombs use dates to get activated. The logic bomb will live in the system for very long periods of time doing nothing, just waiting for the trigger to get activated. So, the <code>init</code> function will check for that condition and run the <code>payload</code> or re-schedule a new execution (let’s come back to this later) until the condition is satisfied.</li>
<li><strong>Trojan Horse</strong>. A Trojan horse (named against the Greek trick used in Troy war) is a malware that actually performs some normal, harmless task but in the background it runs its payload without the user noticing what the <em>Trojan Horse</em> is really doing to the system. A Trojan horse will, typically, start a thread during <code>init</code> to run the <code>payload</code> and run the disguise task in parallel. Simpler ones, and depending on the nature of the <code>payload</code> may run the payload at the beginning or end of the execution without creating threads or processes. More recently the harmless functionality has been removed and people refers to a Trojan to any malware distributed  by somebody claiming it is not malware…This is pretty easy to implement :).</li>
</ul>
<h1><a name="p-65266-the-target-selector-8" class="anchor" href="https://d.clarkee.co.uk#p-65266-the-target-selector-8"></a>The target selector</h1>
<p>Even when our original <em>Malware</em> is perfectly fine, writing SW as a single function (well, actually two… ) is in general a bad practice and leads to many problems, specially regarding maintenance, so we better start splitting the <code>payload</code> function in pieces, i.e, going further in our refactoring journey.</p>
<p>Just a side note before continuing. The sharper readers had already likely noted that we are following the so-called <em>Top-Down approach</em> to design our malware. We start with a very rough program structure and we drill it down to the details. This is common SW engineering approach… nothing really fancy but very convenient for our current task at hand.</p>
<p>So, all the <em>Malwares</em> previously listed actually have to do the same thing. Something like this:</p>
<pre data-code-wrap="C"><code class="lang-C">while (1) {
  payload (select_target ());
}
</code></pre>
<p>Yes, all of them first select a target (this is different for each malware) and then do something on it. The function <code>select_target()</code> will abstract the concept of selecting the item to work on. The <code>payload()</code> function now is simpler and just need to work with a single target and not with all of them at once.</p>
<p>Let’s take a quick look to what <code>select_target</code> and <code>payload</code> function would do in each of the different <em>Malwares</em> we had already introduced:</p>
<h2><a name="p-65266-virus-9" class="anchor" href="https://d.clarkee.co.uk#p-65266-virus-9"></a>Virus</h2>
<p>As mentioned earlier, the main goal of a virus is to survive. Personally I have always found this fascinating. The fact that computer virus relates that much to biological virus is awesome and has been used as an argument in the field of artificial life. Furthermore, a computer program fighting to survive sounds really epic, isn’t it?</p>
<p>Anyway, a virus tries to survive infecting other programs in the computer. It copies itself into other programs and patches them so next time they get executed, the virus code is executed first and a new program may be infected. This is what the <code>payload</code> function does for a virus.</p>
<p>So, the virus needs to look for a victim or host program and this is what the <code>select_target</code> function does. In this case, it will look for executable files in the system that have not yet being infected… it doesn’t make sense to infect a program that is already infected.</p>
<blockquote>
<p><em>On Windows you can get the so-called macro Virus. Those are document macros usually from MS Office suite that get executed when Office documents are opened. In this case the virus infect documents instead of binaries. This may also happen with other data files as PDFs that provides scripting capabilities.</em></p>
</blockquote>
<p>Depending of the kind of virus, the <code>select_target</code> function may be implemented in different ways matching the infection ratio that the creator wanted. Just like <a href="https://en.wikipedia.org/wiki/Basic_reproduction_number" rel="noopener nofollow ugc">real virus</a>. So, the virus can infect 1 program each time it is executed. Multiple programs every time it is executed. Or 1 program each X times it is executed.  Actually this applies to most of the malwares we are going to talk about, when it comes back to select the target to apply their payloads.</p>
<blockquote>
<p><strong>Implementing a virus will teach you how to patch, in the disk and in memory, programs to make them execute other code. It is closely related to polymorphism and polymorphic virus are a well-known type.</strong></p>
</blockquote>
<h2><a name="p-65266-worm-10" class="anchor" href="https://d.clarkee.co.uk#p-65266-worm-10"></a>Worm</h2>
<p>A worm works mostly like a virus but, instead of copying itself into an existing program, it will copy itself into another machine and get executed there, repeating the process for ever and eventually reaching as many machines in the network as possible, effectively pivoting systematically through all accessible machines in the network (in the general case).</p>
<p>As it happens with virus, worms may have a second <code>payload</code> something to be done in each of the machines they reach… destroy files, copy information or apply a patch <img src="https://d.clarkee.co.uk/images/emoji/twitter/slight_smile.png?v=15" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"> … not all worms and virus have to do bad things.</p>
<p>In this case, the <code>select_target</code> function, instead of looking for programs, will look for reachable machines not yet infected. Again, the number of machines returned by the function will determine the spread ratio of the worm.</p>
<p>Some attack may require the worm to spread as soon as possible (for instance a ransomware campaign, distributed with a worm). Other attacks may require to spread silently and slowly, infecting machines in a network with backdoors to access them later without rising any suspicious for months. Anyhow, the concept is the same.</p>
<blockquote>
<p><strong>Implementing a worm will teach you basic network programming and how integrate exploits in your programs.</strong></p>
</blockquote>
<h2><a name="p-65266-ransomware-11" class="anchor" href="https://d.clarkee.co.uk#p-65266-ransomware-11"></a>Ransomware</h2>
<p>Ransomware, as briefly mentioned above, can be carried as secondary payload (yes, a payload run by the primary payload :)) by other malware (like a worm or virus) but it is nowadays considered a malware on its own as it has enough particularities. This malware crypts files in the machine and then ask the user for a ransom to get a key in order to recover the information. Encrypting files is the task of the <code>payload</code> function for this <em>malware</em>.</p>
<p>As you have already noticed, the <code>select_target</code> function is pretty similar to the one used by a virus, but will look for data files instead of programs.</p>
<p>Ransomware will usually try to target as much files as it can and as fast as it can. This way, whenever the user realise what is going on, enough valuable information have been lost so a user may consider appropriate to pay ransom to recover it.</p>
<blockquote>
<p><strong>Implementing a ransonware malware will teach you more advanced cryptography and concurrent programming.</strong></p>
</blockquote>
<h2><a name="p-65266-spyware-12" class="anchor" href="https://d.clarkee.co.uk#p-65266-spyware-12"></a>Spyware</h2>
<p>Again, spyware tries to retrieve sensitive information from the computer and send it out to a third party. Therefore, the <code>select_target</code> function will also require searching for files containing interesting information in the computer. The <code>payload</code> in this case will just send each one of those files out to some default service and the key part of this <em>malware</em> is really in the <code>select_target</code> function.</p>
<p>Live data capturing (camera/mic/keystrokes) could also fit in this category, but for the shake of clarity we will keep those functions just related to RATs that come next.</p>
<p>Note that as per our classification, Spyware can also capture audio, video or keystrokes (a keylogger is a classical example), but instead of sending data life, will store it and send it as files at a later time either when the attacker request it or at specific times to specific servers. In these case, there is, in principle, no <code>select_target</code> function and all functionality is in the <code>payload</code>.</p>
<blockquote>
<p><strong>Implementing Spyware will teach you how to access all available resources HW and SW in your computer. You will also learn quite some sysadmin skills.</strong></p>
</blockquote>
<h2><a name="p-65266-rats-13" class="anchor" href="https://d.clarkee.co.uk#p-65266-rats-13"></a>RATs</h2>
<p>Remote Access Trojans are the simplest (from the point of view of our template) as they do not have to make any selection. They drops straight away into the <code>payload</code> and interactively allow a remote attacker access everything on the machine.</p>
<p>To keep things simple we will just use RATs in a more generic way so it will include other kind of <em>Malwares</em> which some authors classify as independent types. In general, along this course, from the point of view of programming, we will name RATS any <em>malware</em> requiring interaction with a live attacker in a remote machine. Therefore, this includes:</p>
<ul>
<li><strong>Backdoor</strong>. A backdoor is a program that allows an attacker to get access to the machine in an easy and straightforward way, normally providing privileged shell access, but it could just provide functions to perform specific tasks (take a screenshot, copy this file, run this command,…). Usually getting access to a machine is a long, tedious and ad-hoc process that you do not want to repeat every time you want to access the machine. So a solution is, once the machine have been compromised, drop a <strong>BackDoor</strong> program that allows the attacker to get straight into the machine.</li>
<li><strong>Bot/BotNet</strong>. A botnet is a huge number of machines that can be commanded at once to perform some kind of malicious task… Usually a DDoS (Distributed Denial of Service) or send spam. Each machine on the BotNet (usually known as a zombie or Bot) needs to run some software to perform whatever the BotNet is intended for (the DoS attack for instance). This kind of <em>malware</em> also resides in the computer, but its payload is only activated by a remote attacker interactively (actually it can also be scheduled…)</li>
</ul>
<blockquote>
<p><strong>Implementing a RAT is basically the same than implementing Spyware but with interaction. You won’t learn much more, but likely improve your networking programming using unusual communication channels.</strong></p>
</blockquote>
<h1><a name="p-65266-getting-the-malware-executed-14" class="anchor" href="https://d.clarkee.co.uk#p-65266-getting-the-malware-executed-14"></a>Getting the malware executed</h1>
<p>So, writing malware is not that difficult (conceptually speaking), but the real problems are how to get it executed and how to keep it undetected. We had briefly spoke about the detection thing, but we will come back to that in the future. Execution can only happen in two ways:</p>
<ul>
<li>The malware is executed by the user</li>
<li>The malware is executed by the computer (typically other program)</li>
</ul>
<p>This is maybe the trickiest part of the malware life cycle and also the less glamorous as most of the malware gets executed using the first method. That’s is <em>Social Engineering</em> or if you prefer, cheating users. Little to no technical skills required.</p>
<p>Yes, this is the main way to run malware (always has been) and, nowadays people does not even try to build Trojan Horses… A stupid mail with some unknown attachment or a link dropped somewhere will do the trick… Sure, the system will ask for permissions and multiple dialogues will pop-up. And most of the people will still blindly click YES/NEXT/AGREE or whatever text is shown in the button… and voilá… you get some malware executed on a computer. You just need to make the user to badly desire to see what is in that link/app…</p>
<p>Making the computer to run the malware is way more interesting and also way more difficult. This usually requires to exploit some vulnerability in the system that will force it to execute the code the attacker wants. Depending on the type of vulnerability the code may be the whole malware or some kind of dropper, first stage code to get the real thing or something else… but once you have the control of the execution flow, you can run whatever you want (supposing enough privileges have been secured in the process).</p>
<p>Malware using these techniques are much more stealth, specially if they use 0-days to get executed. In those cases, the chances to detect them, if they have been properly coded are very low.</p>
<p>Note that, for some malware as, for instance <em>Worms</em>, this is the only way. In order to copy themselves to other machine and get executed they have to exploit some vulnerability. Try to imagine a worm asking the user to copy and run the binary to a set of machine… I bet that will happen at some point in time :). We had already seen more bizarre things. Anyway, in the coolest case the <em>Worm</em> will use some Remote Code Execution vulnerability and in the simplest it may just exploit a poorly configured telnet service with default password (more likely)…</p>
<p>However, getting it executed, and with enough permissions to carry out the task at hand, is the first step… then the attacker needs to make sure the malware keeps running.</p>
<blockquote>
<p><strong>Implementing this feature will teach you about exploit development, phishing, social engineering.</strong></p>
</blockquote>
<h2><a name="p-65266-persistence-15" class="anchor" href="https://d.clarkee.co.uk#p-65266-persistence-15"></a>Persistence</h2>
<p>The property of a malware to survive updates and reboots of a machine is known as <em>Persistence</em>. Actually, persistence looks for ways to get the application running automatically whenever it dies.</p>
<p>In a sense, these techniques are similar to what we discussed when talking about <em>BackDoors</em>. It takes some effort to get your <em>Malware</em> executed, so you have to take that opportunity to make sure that it will get executed whenever needed so you do not have to exploit the machine again or send a thousand phising mails over and over.</p>
<p>Note that some <em>Malware</em> are one-shot attacks and then persistence is not an issue.</p>
<p>However, persistence is a two-blades sword. On one hand allows the malware to survive reboots, what may be very interesting on some cases. On the other hand in order to survive a reboot, the malware, or part of it, has to be stored somewhere (in the general case), and therefore there will be a sample susceptible of being analysed.</p>
<p>For this reason, whenever possible, malware will try to reside only in memory and do not touch the disk, making harder for the researchers to get a sample and therefore more information on what is happening. Which again, may be useless (getting a sample) depending on the kind of attack the <em>malware</em> is trying.</p>
<p>For instance, a malware, used for a specific task at a specific moment will have an advantage just living in memory. Any mistake dealing with the machine or just restarting it (something that many times is taken as the magic way to solve any computer problem) will just wipe away any track of the malware. You won’t even know if that system was infected or not. Think about protecting your valuables 0-days you do not want anybody else to know about…</p>
<p>On the other hand, think about a massive ransomware campaign… There will be samples all over the place and rebooting a machine will not make any difference in order to get a sample.</p>
<p>Finally note that persistence is highly system dependent and it is more related to system administration skills than programming skills. The same way, sysadmins configure system to run stuff at start-up… is the same the malware has to do. As usual, the details are pretty different in different systems, but the concepts are the same. Programs that get run at start up (services) or every now and ten (crontabs)…</p>
<p>Summing up… sometimes it is a good idea to have persistence, sometimes it doesn’t really matters…</p>
<blockquote>
<p><strong>Implementing this feature will teach you about system administration and somehow privilege escalation.</strong></p>
</blockquote>
<h1><a name="p-65266-cc-16" class="anchor" href="https://d.clarkee.co.uk#p-65266-cc-16"></a>C&amp;C</h1>
<p>Even when C&amp;C are not really part of the <em>malware</em> running on the compromised machines, RAT, Spyware and BotNets requires someone in a remote machine to send data to and accept commands from. The application run by the attacker on the other side is usually known as C&amp;C, C2 or C2C which stands for <em>Command &amp; Control</em>. The name comes likely from the military environment but now is common jargon in the security community.</p>
<p>The C&amp;C application may take different forms and provide different capabilities, depending of the kind of <em>malware</em> it has to interact with. This is not important for us, because C&amp;C are normal applications that do not really need to do any low level stuff to get executed, however, what is relevant for us is the communication channel used by the <em>malware</em> to interact with the C&amp;C application.</p>
<p>Reason is that the infected machine may be in a network properly configured and, therefore, simple communications between both parties won’t be allowed by the network firewall. For that reason <em>malware</em> and C&amp;C applications try to use different communication channels to circumvent network security.</p>
<p>Some examples:</p>
<ul>
<li>HTTP requests from the victim to the attacker machine. This is maybe the simplest (it may not even be HTTP can be a simple TCP connection on the HTTP port) but in its simple form, it clearly exposes the machine running the C&amp;C application</li>
<li>Private Chats over IRC</li>
<li>Twitter DMs</li>
<li>More stealth exfiltration techniques as ICMP or DNS request</li>
<li>Bounced connections from less secure machines in the same network</li>
</ul>
<p>There are many possibilities but for us, what is important, is to know how to implement these types of communication… which is very useful in general and not just for building <em>malwares</em>.</p>
<p>Note the analysis of this traffic is usually a key part of the process to stop a thread and catch who is behind it.</p>
<blockquote>
<p><strong>Implementing this feature will teach you about normal GUI development and advanced networking whenever special communication channels are used.</strong></p>
</blockquote>
<h1><a name="p-65266-our-malware-so-far-17" class="anchor" href="https://d.clarkee.co.uk#p-65266-our-malware-so-far-17"></a>Our malware so far</h1>
<p>So, after this long discussion on what malware is and what is not. What malware does and what doesn’t. We have a pretty general application skeleton to work in and start exploring this world.</p>
<p>It looks like this</p>
<pre data-code-wrap="C"><code class="lang-C">
int init () {
	// Initialisation
	// OPTIONAL: Decrypt code
	// OPTIONAL: Check environment is safe
	// Need Persistance -&gt; Become persistance
	// LOGIC BOMB   -&gt; Check condition or exit
	// TROJAN HORSE -&gt; Start trojan thread
	// 
	return 0;
}

int payload (char *id) {
   // VIRUS            -&gt; Inject itself + Patch
   // WORM             -&gt; Copy itself to remote machine
   // RANSOMWARE       -&gt; Encrypt file
   // SPYWARE          -&gt; Exfiltrate data using secure channel
   // RAT/BOT/Backdoor -&gt; Read comand send response using secure channel
   return 0; 
}
int select_target (int (*f)(char*)) {
   // VIRUS      -&gt; Find non-infected binaries
   // WORM       -&gt; Find suitable reacheables machines
   // RANSOMWARE -&gt; Find data files in disk
   // SPYWARE    -&gt; Find private content in disk
   // RAT        -&gt; Actually do nothing
   f (target);
   return 1 ;// Return 0 for more or 1 go to end
}

int main () {
	init ();
	while (select_target (payload));
}
</code></pre>
<p>I had changed the way we invoke the <code>payload</code> function and just passed the function as a callback to the <code>select_target</code>. It looks cooler this way, but maybe we may need to change this in the future.</p>
<p>The key point here is that, as you can see, with a very simple skeleton we can start coding most of the types of malware we can found nowadays out there. Also note that our selection of functions allows us to combine different malware capabilities at will. This way we can build a ransomware logic bomb, or a trojan worm…</p>
<p>Let’s prepare the code a bit more for the next round:</p>
<pre data-code-wrap="C"><code class="lang-C">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

int cnt = 0;
#ifdef HAVE_CRYPTER 
int mwf_decrypt_code () { puts ("Decrypt code");}
#endif

#ifdef NEEDS_PERSISTANCE
int mwf_go_persistant () { puts ("Going Persistant");}
#endif

#ifdef IS_LOGIC_BOMB
int mwf_check_run_condition () {puts ("Logic Bomb: Check run condition");return 0;}
#endif

#ifdef IS_TROJAN
int mwf_start_disguise_thread () { puts ("Trojan: Disgussing");}
#endif

#ifdef IS_VIRUS
int mwf_payload (char *id) { printf ("VIRUS: Doing Virus stuff in %s\n", id);}
int mwf_select_target (char *id) {
  sprintf (id, "target-%03d.bin", cnt++);
  puts ("VIRUS: Selecting Target");
}
#endif

#ifdef IS_WORM
int mwf_payload (char *id) { printf ("WORM: Doing worm stuff in %s\n", id);}
int mwf_select_target (char *id) {
    sprintf (id, "target-%03d.host", cnt++);
    printf ("WORM: Selecting Target. Please  copy and run the worm in %s\n",target);
}
#endif

#ifdef IS_RANSOMWARE
int mwf_payload (char *id) { printf ("RANSOM: Crypting file %s\n", id);}
int mwf_select_target (char *id) {
    sprintf (id, "target-%03d.data", cnt++);
    puts ("RANSOM: Selecting Target");
}
#endif

#ifdef IS_SPYWARE
int mwf_payload (char *id) { puts ("SPYWARE: Waiting for command to send info");}
int mwf_select_target (char *id) {puts ("SPYWARE: Finding new data, keyloging,...");}
#endif

#ifdef IS_RAT
int mwf_payload (char *id) { printf ("RAT: Running command %s", id);}
int mwf_select_target (char *id) {printf("%s", "RAT: Waiting for command,... $ ");fgets (id, 1024, stdin);}
#endif


int mwf_check_env () { puts ("Checking environment");}

int init () {
	// Initialisation
  puts ("Generic Initialisation");
  mwf_check_env (); // OPTIONAL: Check environment is safe
#ifdef HAVE_CRYPTER
  mwf_decrypt_code (); // OPTIONAL: Decrypt code
#endif

#ifdef NEEDS_PERSISTANCE	
  mwf_go_persistant (); // Need Persistance -&gt; Become persistance
#endif
#ifdef IS_LOGIC_BOMB
  if (mwf_check_run_condition ()) exit (0); // LOGIC BOMB   -&gt; Check condition or exit
#endif
#ifdef IS_TROJAN
   mwf_start_disguise_thread() 	// TROJAN HORSE -&gt; Start trojan thread
#endif  
	// 
	return 0;
}

int payload (char *id) {
  mwf_payload (id);

   return 0; 
}
int select_target (int (*f)(char*)) {
  char target[1024];
  mwf_select_target (target);
  
  // Infection rate to be managed here
  f (target);
  sleep (1);  
  return 1 ;  // Return 0 for more or 1 go to end
}

int main () {
	init ();
	while (select_target (payload));
}

</code></pre>
<p>Now, we can compile our malware like this:</p>
<pre><code>$ gcc -DHAVE_CRYPTER -DIS_VIRUS -o mw mwf.c
$ ./mwf
Generic Initialisation
Checking environment
Decrypt code
VIRUS: Selecting Target
VIRUS: Doing Virus stuff in target-000.bin
VIRUS: Selecting Target
VIRUS: Doing Virus stuff in target-001.bin
</code></pre>
<p>Or like this</p>
<pre><code>$ gcc -DIS_RAT -DNEEDS_PERSISTENCE -DHAVE_CRYPTER -o mwf mwf.c
$ ./mwf
Generic Initialisation
Checking environment
Decrypt code
Going Persistant
RAT: Waiting for command,... $ ls
RAT: Running command ls
RAT: Waiting for command,... $ ^C
</code></pre>
<p>That’s it for now. We have a generic hollow program that will allow us to explore different kinds of malware. We will be filling the holes in next installments… Or you can just get started right now!</p>
<h1><a name="p-65266-how-to-deal-with-malware-18" class="anchor" href="https://d.clarkee.co.uk#p-65266-how-to-deal-with-malware-18"></a>How to deal with malware?</h1>
<p>I will just include this section here because, this is universal and it works for all malware out there. The rules you have to follow to keep malwares away are:</p>
<ul>
<li><strong>Rule 1</strong>. Only run trustworthy SW. Anything coming from a suspicios website, a spooky mail, etc… Just don’t run it. And  if you have to run them</li>
<li><strong>Rule 2</strong>. If you have to run un-trustworthy SW, run it as an unprivileged user and if possible in a VM/Container without network configured</li>
<li><strong>Rule 2.5</strong>. To help ensuring rules 1 and 2 installing some antivirus SW will help and save you some trouble.</li>
<li><strong>Rule 3</strong>. Keep your system updated. Specially for GNU/Linux, security patches are provided for most distributions in hours whenever an security alarm hits Internet. Just <code>apt upgrade</code> everyday</li>
<li><strong>Rule 4</strong>. Configure your firewall to make harder connections to your system and home calls.</li>
<li><strong>Rule 5</strong>. Have a proper and consistent backup policy.</li>
</ul>
<p>Rule 5 is key and it is the very last resistant line against malware. There is always a chance than a sophisticated malware using a 0-day or a recent bug that has not been patched yet, hits your system and gets it infected, abducted or whatever the malware does. When everything else fails, and that can happen, then the solution is to re-install your system from scratch and restore your data from your backup.</p>
<p>Having a policy for backups is important. The malware can made it to the backup (specially the most stealthy ones) so you need to have a way to identify backups and match them, at least with timestamps so you can recover as much data as possible. If the malware made it into the backup (think about a MS-Office Macro Virus embedded on a documnet, for instance), you may need to restore data from older backup and lose some data… That’s life</p>
<p>Following this 5.5 rules will keep you safe from most malware attacks out there, independently of the type of malware we are talking about. Most of the malwares rely on the laziness of the users to follow the rules above.</p>
<h1><a name="p-65266-conclusion-19" class="anchor" href="https://d.clarkee.co.uk#p-65266-conclusion-19"></a>Conclusion</h1>
<p>We have go through the main types of <em>malware</em> known nowadays and analysed their main features. Based on that we have come up with a void skeleton that will allow us to build all kind of malware just implementing some generic functions and combining them in different ways. We have also mapped most features to a set of skills/knowledge that you can start working on according to your personal interest. And we have seen that those skills are not related at all to security… they are system programming/administration skills.</p>
<p>Note that what we have come up with is the general idea. Things do not have to be in that specific order but to get started, having some structure may be helpful in the learning process.</p>
<p>Finally, this is a very broad topic and I may have forgot something relevant or make some mistakes (I’m not really an expert on this), so be free, specially all the experts on the topic in this community, to provide your feedback, comments, corrections, additions,…Looking forward to your contributions.</p>
<p>In the next installments we will begin exploring the implementation of these functions and we will start getting malware everywhere… hahahaha</p>
            <p><small>4 posts - 4 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/programming-for-wannabes-part-vi-malware-introduction/25595">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/programming-for-wannabes-part-vi-malware-introduction/25595</link>
          <pubDate>Sat, 10 Apr 2021 08:48:25 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25595</guid>
          <source url="https://d.clarkee.co.uk/t/programming-for-wannabes-part-vi-malware-introduction/25595.rss">Programming for Wannabes Part VI. Malware Introduction</source>
        </item>
        <item>
          <title>Antivirus runtime bypass</title>
          <dc:creator><![CDATA[nulled]]></dc:creator>
          <category>Malware</category>
          <description><![CDATA[
            <p>Hello,<br>
A few weeks ago I started learning how crypters work and I decided to write my own. I chose C# language to write it. I bypassed most of the scantime detections (despite Avira and a few others) but I am really struggling with runtime. When I execute stub with a metasploit reverse shell inside everything goes well until the client tries to connect to server. At this moment process of reverse shell is being killed and flagged as detected.(I am trying to bypass Eset runtime because this is an antivirus software which I have installed on my PC) I found various techniques to evade runtime but none of them work. Techniques that I use: amsi.dll bypass (makes Eset go crazy but it’s still able to end reverse shell process), thread stalling, antihooking which I added to RunPE (<a href="https://labs.f-secure.com/blog/bypassing-windows-defender-runtime-scanning/" class="inline-onebox" rel="noopener nofollow ugc">Bypassing Windows Defender Runtime Scanning</a>). Could someone give me techniques/tips to bypass runtime detections to be able to open reverse shell without it being killed by antivirus?</p>
            <p><small>13 posts - 6 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/antivirus-runtime-bypass/25574">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/antivirus-runtime-bypass/25574</link>
          <pubDate>Thu, 08 Apr 2021 10:30:27 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25574</guid>
          <source url="https://d.clarkee.co.uk/t/antivirus-runtime-bypass/25574.rss">Antivirus runtime bypass</source>
        </item>
        <item>
          <title>Found a great job pen testing, what skills do I need?</title>
          <dc:creator><![CDATA[m-alone]]></dc:creator>
          <category>Questions</category>
          <description><![CDATA[
            <p>Hi,</p>
<p>I found a great job as a pen tester. I have studied a lot and know how to use Kali and Parrot pretty well but how do I get some experience so I can apply for a job like this?</p>
<p>And what does it take? Sorry if this is a noob question but I really want to make a career in this.</p>
<p><a href="https://www.swiss-cyber-safe.com/our-job-openings/index.html" class="onebox" target="_blank" rel="noopener nofollow ugc">https://www.swiss-cyber-safe.com/our-job-openings/index.html</a></p>
            <p><small>2 posts - 2 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/found-a-great-job-pen-testing-what-skills-do-i-need/25570">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/found-a-great-job-pen-testing-what-skills-do-i-need/25570</link>
          <pubDate>Thu, 08 Apr 2021 05:33:23 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25570</guid>
          <source url="https://d.clarkee.co.uk/t/found-a-great-job-pen-testing-what-skills-do-i-need/25570.rss">Found a great job pen testing, what skills do I need?</source>
        </item>
        <item>
          <title>Kali vs BlackArch vs Parrot Sec</title>
          <dc:creator><![CDATA[MrQbits]]></dc:creator>
          <category>Beginner Guides</category>
          <description><![CDATA[
            <p>Which is the best Linux Distro for penetration testing and Why?</p>
<p>Kali or BlackArch or Parrot Security OS? Which one should I choose to begin my journey as a security researcher? <img src="https://0x00sec.org/images/emoji/twitter/grin.png?v=9" title=":grin:" class="emoji" alt=":grin:"></p>
            <p><small>11 posts - 8 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/kali-vs-blackarch-vs-parrot-sec/25548">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/kali-vs-blackarch-vs-parrot-sec/25548</link>
          <pubDate>Wed, 07 Apr 2021 14:25:55 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25548</guid>
          <source url="https://d.clarkee.co.uk/t/kali-vs-blackarch-vs-parrot-sec/25548.rss">Kali vs BlackArch vs Parrot Sec</source>
        </item>
        <item>
          <title>Best language for write malware</title>
          <dc:creator><![CDATA[CyberSecurity]]></dc:creator>
          <category>Malware</category>
          <description><![CDATA[
            <p>Hi, which are the best language for write malware?<br>
I know C, python and golang, it’s necessary Assembly?</p>
            <p><small>13 posts - 11 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/best-language-for-write-malware/25514">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/best-language-for-write-malware/25514</link>
          <pubDate>Mon, 05 Apr 2021 13:17:39 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25514</guid>
          <source url="https://d.clarkee.co.uk/t/best-language-for-write-malware/25514.rss">Best language for write malware</source>
        </item>
        <item>
          <title>Obfuscated PHP Backdoor</title>
          <dc:creator><![CDATA[full]]></dc:creator>
          <category>Cryptology</category>
          <description><![CDATA[
            <p>Hi, I recently found a malicious PHP code [ <a href="https://sharetext.me/8zimbqnzxa" rel="noopener nofollow ugc">LINK</a> ] injected in some webpages, I tried to formate and deobfuscate it and understand how it works, It seems that is using Cookies to execute PHP code (Cookie: cipher=serialized+encrypted PHP code), I just want to know how they are making this kind of backdoors and how to generate this Cookie.</p>
<pre><code>function cs_decrypt_phase($data, $key)
{
    $out_data = "";

    for ($i = 0; $i &lt; strlen($data);) {
        for ($j = 0; $j &lt; strlen($key) &amp;&amp; $i &lt; strlen($data); $j++, $i++) {
            $out_data .= chr(ord($data[$i]) ^ ord($key[$j]));
        }
    }

    return $out_data;
}
</code></pre>
<p>This a readable function to decrypt it.</p>
            <p><small>5 posts - 4 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/obfuscated-php-backdoor/25477">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/obfuscated-php-backdoor/25477</link>
          <pubDate>Fri, 02 Apr 2021 13:41:23 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25477</guid>
          <source url="https://d.clarkee.co.uk/t/obfuscated-php-backdoor/25477.rss">Obfuscated PHP Backdoor</source>
        </item>
        <item>
          <title>Threat Hunting and Mitigation in *Nix/macOS Environments. (Please comment and tell me what I&#39;m missing. This is initial work)</title>
          <dc:creator><![CDATA[hartescout]]></dc:creator>
          <category>Linux</category>
          <description><![CDATA[
            <p>Written below are the beginnings of my research into hunting in the Linux environment. This is very high level for the time being and I have not yet gone into specifics as far as behavioral analytics and detections of certain families of malware. Working on it.</p>
<hr>
<p>Linux/macOS hunting operations. Focusing on suspicious activity tied to the MITRE ATT&amp;CK Framework allows researchers to simulate techniques and search for compromise based on activity observed in a controlled environment. Another technique attackers use is deploying Root Kits on victim machines providing access at either the kernel or user level to continue operations. In August of 2020 an advisory regarding the Drovorub RootKit was issued. This rootkit runs kernel modules allowing full access to the system, installing a file transfer and port forwarding tool. It specifically takes advantage of systems that have yet to update to more current Linux kernel software. There are other readily available rootkits such as Puzek and Reptile which provide interactive control using function hooking and syscall hooking.</p>
<ul>
<li>Command Line: o <code>sc!\^2a</code> o <code>*cs02</code> o `*/proc/net/tcp , */proc/net/udp , */proc/net/udp6</li>
<li>Syslog Entries o mod_security: Access denied<br>
o ModSecurity: Access denied<br>
o mod_security-message: Access denied</li>
</ul>
<hr>
<p>Recent vulnerabilities within Linux including Kernel 4.18.0-240.el8 and previous versions dating back to 2006 that allow for post-exploitation root access. These vulnerabilities were shown to be easily exploited in the current Red Hat Linux distributions and other platforms that utilize RHEL structure. Debian-based systems are vulnerable as well utilizing a different set of command-line arguments in the POC provided. The SCSI subsystem and the RDMA/RDMA-Core package use as a dependency is the focus of these CVE’s and is present on RHEL, CentOS, and Fedora distributions. They are also commonly installed on Ubuntu and Debian systems as a dependency.</p>
<p>While kernel exploits vary and do not necessarily indicate a need for immediate response, CVE- 2021-27363 , CVE-2021-27364, and CVE-2021-27365 may be utilized as part of post-exploitation to assist threat actors in movement through the killchain.</p>
<ul>
<li>CVE-2021-27363 - Access Denial and Information Disclosure<br>
o RHEL 7 and 8 and all previous versions running the package Kernel or Kernel-rt.
<ul>
<li>
<img src="https://0x00sec.org/images/emoji/twitter/black_small_square.png?v=9" title=":black_small_square:" class="emoji" alt=":black_small_square:"> show_transport_handle() in drivers/scsi/scsi_transport_iscsi.c</li>
<li>
<img src="https://0x00sec.org/images/emoji/twitter/black_small_square.png?v=9" title=":black_small_square:" class="emoji" alt=":black_small_square:"> LIBISCSI kernel module loads couple with system restart within focused timeframe. If not required by default this may indicate malicious behavior</li>
</ul>
</li>
<li>CVE-2021-27364 - Out-of-Bounds Read<br>
o RHEL 6, 7, 8 and all previous versions running the package Kernel, Kernel-rt, or Kernel-alt<br>
<img src="https://0x00sec.org/images/emoji/twitter/black_small_square.png?v=9" title=":black_small_square:" class="emoji" alt=":black_small_square:"> show_transport_handle() in drivers/scsi/scsi_transport_iscsi.c <img src="https://0x00sec.org/images/emoji/twitter/black_small_square.png?v=9" title=":black_small_square:" class="emoji" alt=":black_small_square:"> Specific user netlink message.</li>
<li>CVE-2021-27365 - Heap Buffer Overflow<br>
o RHEL 6, 7, 8 and all previous versions tunning the package Kernel, Kernel-rt, or Kernel-alt<br>
<img src="https://0x00sec.org/images/emoji/twitter/black_small_square.png?v=9" title=":black_small_square:" class="emoji" alt=":black_small_square:"> Specific user netlink to iSCSI, kstrdup/sprintf pattern.</li>
</ul>
<hr>
<p><a href="https://gtfobins.github.io/" rel="noopener nofollow ugc">GTFOBins</a> is a well-known resource for defenders similar to Windows <a href="https://lolbas-project.github.io/" rel="noopener nofollow ugc">LOLBAS</a> identify processes and command-line arguments with the potential for malicious use hidden behind normal activity. Queries for Linux machines are crafted to identify baseline and anomalous behavior on these clusters. Rootkits are another tool employed by adversaries accomplishing goals like dropping payloads, establishing C2 communications, and/or acting as a proxy for botnets. In particular, I’ve focused one of the more recent rootkits distributed called Drovorub. Among the capabilities above it employs embedded file transfer for exfiltration and operations. An open avenue of approach for any rootkit takes advantage of outdated an outdated kernel and modules.</p>
<p>**Carbon Black Response<br>
cmdline:history or cmdline:‘rm ~/.bash_history’ or cmdline:‘echo " " &gt; ~/.bash_history’ or cmdline:"cat /dev/null &gt; ~/.bash_history’ or cmdline:‘ln -sf /dev/null ~/.bash_history’ or cmdline:‘truncate -s0 ~/.bash_history’ or cmdline:‘unset HISTFILE’ or cmdline:‘export HISTFILESIZE=0’ or cmdline:‘history -c’</p>
<p>**Chronicle YARA-L 2.0</p>
<p>Usage of SU or SUDO</p>
<pre><code class="lang-auto">rule usage_of_sudo_or_su {
meta: 
description = "Looks for usage of sudo or su command"
author = "@is_henderson"
date = "2021-02-15"
reference = "reference"

events: 
(
$e1.metadata.event_type = "PROCESS_LAUNCH" and
(
re.regex($e1.principal.process.command_line, `.*sudo\s`) nocase or
re.regex($e1.principal.process.command_line, `.*su\s`) nocase
)
)

condition:
$e1
}
</code></pre>
<p>Usage of Package Manager</p>
<p>While usage is not inherently malicious, actors may use the package manager to install various tools needed during the campaign.</p>
<pre><code class="lang-auto">rule usage_of_yum_rpm {
meta:
author = "@is_henderson"
description = "Rule to detect package installation" 
date = "2021-02-15"

events:
(
$e1.metadata.event_type = "PROCESS_LAUNCH" and
(
re.regex($e1.principal.process.command_line, `.*sudo yum install\s.*`) nocase or
re.regex($e1.principal.process.command_line, `.*su bash yum install\s.*`) nocase or
re.regex($e1.principal.process.command_line, `.*sudo rpm install\s.*`) nocase or
re.regex($e1.principal.process.command_line, `.*su bash rpm install\s.*`) nocase
)
)
condition:
$e1
}
</code></pre>
            <p><small>2 posts - 2 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/threat-hunting-and-mitigation-in-nix-macos-environments-please-comment-and-tell-me-what-im-missing-this-is-initial-work/25446">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/threat-hunting-and-mitigation-in-nix-macos-environments-please-comment-and-tell-me-what-im-missing-this-is-initial-work/25446</link>
          <pubDate>Wed, 31 Mar 2021 20:59:48 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25446</guid>
          <source url="https://d.clarkee.co.uk/t/threat-hunting-and-mitigation-in-nix-macos-environments-please-comment-and-tell-me-what-im-missing-this-is-initial-work/25446.rss">Threat Hunting and Mitigation in *Nix/macOS Environments. (Please comment and tell me what I&#39;m missing. This is initial work)</source>
        </item>
        <item>
          <title>Why ECB is not a good mode of operation</title>
          <dc:creator><![CDATA[n33ds0n]]></dc:creator>
          <category>Cryptology</category>
          <description><![CDATA[
            <p>I have read lot of pdf and online content on symmetry cryptography, 90% of the sources I learned from says that ECB mode is a bad mode of operation due to known-plaintext attack.</p>
<p>My question is, how can an attacker be able to know the plaintext of a cipher text that are the same without the key, although when the same plaintext is encrypted in ECB mode, the cipher text is the same, but how can an attacker be able to know the plaintext of the same cipher text without knowing the key.</p>
<p>it is through guessing or what?</p>
<p>Just wanna know.</p>
            <p><small>4 posts - 3 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/why-ecb-is-not-a-good-mode-of-operation/25443">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/why-ecb-is-not-a-good-mode-of-operation/25443</link>
          <pubDate>Wed, 31 Mar 2021 16:51:18 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25443</guid>
          <source url="https://d.clarkee.co.uk/t/why-ecb-is-not-a-good-mode-of-operation/25443.rss">Why ECB is not a good mode of operation</source>
        </item>
        <item>
          <title>How do you obfuscate a payload</title>
          <dc:creator><![CDATA[n33ds0n]]></dc:creator>
          <category>Questions</category>
          <description><![CDATA[
            <ol>
<li>How do you obfuscate your malware?</li>
<li>What are the process you take?</li>
<li>do you learn about different AV?</li>
<li>what do you do first?</li>
</ol>
            <p><small>2 posts - 2 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/how-do-you-obfuscate-a-payload/25441">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/how-do-you-obfuscate-a-payload/25441</link>
          <pubDate>Wed, 31 Mar 2021 16:13:47 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25441</guid>
          <source url="https://d.clarkee.co.uk/t/how-do-you-obfuscate-a-payload/25441.rss">How do you obfuscate a payload</source>
        </item>
        <item>
          <title>Why the most skilled people in this field thinks that our world is a simulation?</title>
          <dc:creator><![CDATA[Darkvault]]></dc:creator>
          <category>Philosophy</category>
          <description><![CDATA[
            <p>Is coding  a proof that our world is a simulation and our God is a coder. I’m  really  curious and this topic is boggling my mind for a long time with 3D bio printers scientist   are  already building living organs. Very strange that alot of  people  are not serious about this question .</p>
            <p><small>4 posts - 3 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/why-the-most-skilled-people-in-this-field-thinks-that-our-world-is-a-simulation/25421">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/why-the-most-skilled-people-in-this-field-thinks-that-our-world-is-a-simulation/25421</link>
          <pubDate>Tue, 30 Mar 2021 15:36:16 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25421</guid>
          <source url="https://d.clarkee.co.uk/t/why-the-most-skilled-people-in-this-field-thinks-that-our-world-is-a-simulation/25421.rss">Why the most skilled people in this field thinks that our world is a simulation?</source>
        </item>
        <item>
          <title>What is best methodology for discovery vulnerability and Exploit Development in binary software?</title>
          <dc:creator><![CDATA[ccsoup]]></dc:creator>
          <category>Beginner Guides</category>
          <description><![CDATA[
            <p>I’m new in Exploit Development and Discovery Vulnerability. I learning some technique by some course and books.I have learned Stack Buffer Overflow and Heap Buffer Overflow and Format Strings and some bypass technique for ASLR,NX,DEP , … .<br>
But I think its only technique and I need a methodology for best performance in discovery vulnerability in binary software.<br>
so,what is best methodology for discovery vulnerability and Exploit Development in binary software?</p>
            <p><small>3 posts - 2 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/what-is-best-methodology-for-discovery-vulnerability-and-exploit-development-in-binary-software/25419">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/what-is-best-methodology-for-discovery-vulnerability-and-exploit-development-in-binary-software/25419</link>
          <pubDate>Tue, 30 Mar 2021 10:12:48 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25419</guid>
          <source url="https://d.clarkee.co.uk/t/what-is-best-methodology-for-discovery-vulnerability-and-exploit-development-in-binary-software/25419.rss">What is best methodology for discovery vulnerability and Exploit Development in binary software?</source>
        </item>
        <item>
          <title>How does malware utilize tor?</title>
          <dc:creator><![CDATA[jasper]]></dc:creator>
          <category>Questions</category>
          <description><![CDATA[
            <p>So, there is quite a lot of malware nowadays that use the tor network to communicate with c2 servers.<br>
From what I see is they host their c2 server under a .onion domain and then they hardcode tor “proxies” into the malware which is uses to connect to which will then allow it to send data back to the c2 server.</p>
<p>Now when I asked people about how they get the “proxies” I was told they are not really proxies but that is what they look like<br>
</p><div class="lightbox-wrapper"><a class="lightbox" href="https://0x00sec.s3.amazonaws.com/original/3X/f/b/fb4cba310de9104eade8f87788e8f80bbf655a5d.jpeg" data-download-href="/uploads/short-url/zR6eq4koYi2pNxwq0fy2I4VdduZ.jpeg?dl=1" title="" rel="noopener nofollow ugc"><img src="https://0x00sec.s3.amazonaws.com/optimized/3X/f/b/fb4cba310de9104eade8f87788e8f80bbf655a5d_2_690x426.jpeg" alt="" data-base62-sha1="zR6eq4koYi2pNxwq0fy2I4VdduZ" width="690" height="426" srcset="https://0x00sec.s3.amazonaws.com/optimized/3X/f/b/fb4cba310de9104eade8f87788e8f80bbf655a5d_2_690x426.jpeg, https://0x00sec.s3.amazonaws.com/optimized/3X/f/b/fb4cba310de9104eade8f87788e8f80bbf655a5d_2_1035x639.jpeg 1.5x, https://0x00sec.s3.amazonaws.com/original/3X/f/b/fb4cba310de9104eade8f87788e8f80bbf655a5d.jpeg 2x" data-small-upload="https://0x00sec.s3.amazonaws.com/optimized/3X/f/b/fb4cba310de9104eade8f87788e8f80bbf655a5d_2_10x10.png"></a></div><br>
As you can see to me these look like proxies, now I know the tor project themselves every 20minutes has a page that auto updates of the latest tor exit nodes but my question is how are they getting the port number so they can route traffic through them too?<p></p>
<p>Now I was able to speak to someone once who made malware that used this and they simply said to me “They are free online, anyone can incorporate this into their malware” but he would not tell me where people get them from x_x</p>
<p>Anyone got any ideas at all?</p>
            <p><small>5 posts - 3 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/how-does-malware-utilize-tor/25405">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/how-does-malware-utilize-tor/25405</link>
          <pubDate>Tue, 30 Mar 2021 00:12:25 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25405</guid>
          <source url="https://d.clarkee.co.uk/t/how-does-malware-utilize-tor/25405.rss">How does malware utilize tor?</source>
        </item>
        <item>
          <title>VMs on 4GB RAM PC</title>
          <dc:creator><![CDATA[MrQbits]]></dc:creator>
          <category>Questions</category>
          <description><![CDATA[
            <p>My PC has only 4GB RAM. Should I use kali linux with VM on my pc??<br>
Is it okay for my pc??</p>
            <p><small>4 posts - 4 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/vms-on-4gb-ram-pc/25399">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/vms-on-4gb-ram-pc/25399</link>
          <pubDate>Mon, 29 Mar 2021 16:23:03 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25399</guid>
          <source url="https://d.clarkee.co.uk/t/vms-on-4gb-ram-pc/25399.rss">VMs on 4GB RAM PC</source>
        </item>
        <item>
          <title>Prerequisites related to RE and malware analysis</title>
          <dc:creator><![CDATA[theBeginner]]></dc:creator>
          <category>Beginner Guides</category>
          <description><![CDATA[
            <p>I am complete noob in infosec, so after research on internet I came to know that assembly language and reverse engineering  is mandatory for learning malware analysis but can we start learning it WITHOUT HAVING STRONG PROGRAMMING KNOWLEDGE…?<br>
recently i started reading blogs related to RE and malware analysis but somethings are difficult to understand especially those related to programming.</p>
<p>I know that so many people must have asked this question here but im ot getting any exact solution on this.</p>
            <p><small>4 posts - 3 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/prerequisites-related-to-re-and-malware-analysis/25377">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/prerequisites-related-to-re-and-malware-analysis/25377</link>
          <pubDate>Sat, 27 Mar 2021 02:03:27 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>No</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25377</guid>
          <source url="https://d.clarkee.co.uk/t/prerequisites-related-to-re-and-malware-analysis/25377.rss">Prerequisites related to RE and malware analysis</source>
        </item>
        <item>
          <title>I want to be a hacker ,coder but my parents are against it</title>
          <dc:creator><![CDATA[Darkvault]]></dc:creator>
          <category>Social</category>
          <description><![CDATA[
            <p>Theyre  saying they’ll  not waste  a single penny if  that’s  the case  and they’re  saying that  stupid  people do all these nonsense  and they want me to  do something else  but I’m into this and it’s  Okey if no one takes care of me .Any quick way I can make a little living from any skills related to this field anyway  and if you’ve  gone through same situations would love to hear your experience. Sorry for my bad English</p>
            <p><small>35 posts - 14 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/i-want-to-be-a-hacker-coder-but-my-parents-are-against-it/25374">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/i-want-to-be-a-hacker-coder-but-my-parents-are-against-it/25374</link>
          <pubDate>Fri, 26 Mar 2021 16:53:07 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25374</guid>
          <source url="https://d.clarkee.co.uk/t/i-want-to-be-a-hacker-coder-but-my-parents-are-against-it/25374.rss">I want to be a hacker ,coder but my parents are against it</source>
        </item>
        <item>
          <title>Any certificate that you&#39;ll love to recommend</title>
          <dc:creator><![CDATA[Darkvault]]></dc:creator>
          <category>Questions</category>
          <description><![CDATA[
            <p>For expanding  hacking  skills and knowledge and job securities .</p>
            <p><small>2 posts - 2 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/any-certificate-that-youll-love-to-recommend/25367">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/any-certificate-that-youll-love-to-recommend/25367</link>
          <pubDate>Thu, 25 Mar 2021 10:50:36 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25367</guid>
          <source url="https://d.clarkee.co.uk/t/any-certificate-that-youll-love-to-recommend/25367.rss">Any certificate that you&#39;ll love to recommend</source>
        </item>
        <item>
          <title>Is there any way I can earn a job with my hacking skills through certificates and programs without going to college</title>
          <dc:creator><![CDATA[Darkvault]]></dc:creator>
          <category>Uncategorized</category>
          <description><![CDATA[
            <p>if there’s any way out please let me know<br>
Would appreciate it !<br>
I personally think colleges are baseless and I don’t  wanna waste my 4 years of life running  for a degree.</p>
            <p><small>4 posts - 4 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/is-there-any-way-i-can-earn-a-job-with-my-hacking-skills-through-certificates-and-programs-without-going-to-college/25366">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/is-there-any-way-i-can-earn-a-job-with-my-hacking-skills-through-certificates-and-programs-without-going-to-college/25366</link>
          <pubDate>Thu, 25 Mar 2021 10:22:24 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25366</guid>
          <source url="https://d.clarkee.co.uk/t/is-there-any-way-i-can-earn-a-job-with-my-hacking-skills-through-certificates-and-programs-without-going-to-college/25366.rss">Is there any way I can earn a job with my hacking skills through certificates and programs without going to college</source>
        </item>
        <item>
          <title>The Importance of Enumeration</title>
          <dc:creator><![CDATA[dmcxblue]]></dc:creator>
          <category>Red-Team</category>
          <description><![CDATA[
            <p>We all love Exploitation and gaining access to a machine elevate our privileges and gain that SYSTEM, Administrator, Domain Admin Shell. It’s a rush that us as hackers love to see when we try to gain access to a box “Meterpreter Session 1 Opened”, Beacon, Grunt, etc. Oof hasn’t that been one of the most awesome sentences that you can see on your terminal when something you’ve been working on just works.</p>
<p>But how do we get here?. We don’t magically know the payload that needs to be used, or the exploit to use against our victim machine.</p>
<p><strong>Enumeration</strong> , that one very important step taken before we continue with our hacks around the network. Can we access the machine?. Enumeration. Can we exploit it?. Enumeration. What about Privesc, Enumeration. Anything on Persistence? Yep let’s enumerate to see what’s allowed as a user OR where to leave our backdoor that can blend with the environment, need to move around the Environment?, lets enumerate and see what is available.</p>
<p>Here I will demonstrate how enumeration can be achieved in many ways and also the variety of tools used for the same category so that you don’t have to be limited to this very well-known tools. For example nmap, everyone uses nmap the famous port scanning tool with incredible functionality that works well everywhere, but let’s not forget we have other tools, <strong>unicornscan, masscan, amap, rustscan.</strong> Let me work on an environment and show a variety of ways to enumerate and reach our goal and not be dependent on well-known tools.</p>
<p><strong>Initial Access</strong></p>
<p>My target machine is 10.0.2.24 I will start enumerating and search for access here see a way to gain an initial foothold.</p>
<p>As my scan from different tools finished these were my results.</p>
<p><strong>Nmap:</strong></p>
<p></p><div class="lightbox-wrapper"><a class="lightbox" href="https://0x00sec.s3.amazonaws.com/original/3X/c/f/cf67f34d522d9ad78193aeef5840a45df29d2344.png" data-download-href="/uploads/short-url/tANy2GgUWHiSHTVpjl9tMhoLNgU.png?dl=1" title="" rel="noopener nofollow ugc"><img src="https://0x00sec.s3.amazonaws.com/optimized/3X/c/f/cf67f34d522d9ad78193aeef5840a45df29d2344_2_506x500.png" alt="" data-base62-sha1="tANy2GgUWHiSHTVpjl9tMhoLNgU" width="506" height="500" srcset="https://0x00sec.s3.amazonaws.com/optimized/3X/c/f/cf67f34d522d9ad78193aeef5840a45df29d2344_2_506x500.png, https://0x00sec.s3.amazonaws.com/original/3X/c/f/cf67f34d522d9ad78193aeef5840a45df29d2344.png 1.5x, https://0x00sec.s3.amazonaws.com/original/3X/c/f/cf67f34d522d9ad78193aeef5840a45df29d2344.png 2x" data-small-upload="https://0x00sec.s3.amazonaws.com/optimized/3X/c/f/cf67f34d522d9ad78193aeef5840a45df29d2344_2_10x10.png"></a></div><p></p>
<p><strong>Rustscan:</strong></p>
<p></p><div class="lightbox-wrapper"><a class="lightbox" href="https://0x00sec.s3.amazonaws.com/original/3X/c/f/cf67f34d522d9ad78193aeef5840a45df29d2344.png" data-download-href="/uploads/short-url/tANy2GgUWHiSHTVpjl9tMhoLNgU.png?dl=1" title="" rel="noopener nofollow ugc"><img src="https://0x00sec.s3.amazonaws.com/optimized/3X/c/f/cf67f34d522d9ad78193aeef5840a45df29d2344_2_506x500.png" alt="" data-base62-sha1="tANy2GgUWHiSHTVpjl9tMhoLNgU" width="506" height="500" srcset="https://0x00sec.s3.amazonaws.com/optimized/3X/c/f/cf67f34d522d9ad78193aeef5840a45df29d2344_2_506x500.png, https://0x00sec.s3.amazonaws.com/original/3X/c/f/cf67f34d522d9ad78193aeef5840a45df29d2344.png 1.5x, https://0x00sec.s3.amazonaws.com/original/3X/c/f/cf67f34d522d9ad78193aeef5840a45df29d2344.png 2x" data-small-upload="https://0x00sec.s3.amazonaws.com/optimized/3X/c/f/cf67f34d522d9ad78193aeef5840a45df29d2344_2_10x10.png"></a></div><p></p>
<p><strong>And amap:</strong></p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/3X/0/8/08ce0f7d4ee58bdb67692494022a8048acf13c70.png" alt="" data-base62-sha1="1fTiKh8kaJDX4zLMieTB5uGFpba" width="624" height="158"></p>
<p>With different tools for enumeration this may help in confirmation on what is going on, tools might use different methods to acquire information about a specific target. In this matter I can confirm that these ports are open as different tools have confirmed this now I can move forward and attack these ports or gain more information on them to lower my chances of failure when try to exploit these targets.</p>
<p>So let’s approach 135/139:</p>
<p>Rpcclient we will approach this port and enumerate with and without credentials (realistically this wouldn’t be available since it would most likely be a Blackbox test).</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/3X/0/8/08ce0f7d4ee58bdb67692494022a8048acf13c70.png" alt="" data-base62-sha1="1fTiKh8kaJDX4zLMieTB5uGFpba" width="624" height="158"></p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/3X/3/8/381fafd367808a5108dce9c8a823e7a42457f129.png" alt="" data-base62-sha1="80uCSlSeQzyzVDjT0KpFp3tz0RX" width="624" height="170"></p>
<p>As seen above I am trying to enumerate users but this is most likely not going to happen with an anonymous user we will try with someone with credentials.</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/3X/2/e/2e67fd5ff31953365b5885b4e36673ed93995a5a.png" alt="" data-base62-sha1="6CwL9UoWSivv3Mj8GtCyEl5AzKq" width="485" height="99"></p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/3X/a/4/a4647b67fbcd8378cc0125bf170a940bb79878f6.png" alt="" data-base62-sha1="nshAoi4Fy46PPlAmbiwUmxqQphk" width="422" height="82"></p>
<p>No luck with rpcclient as the user is not part of a Domain and only from the local machine, we can continue grabbing more info that is needed from the local machine but we will stop here.</p>
<p>Now let’s approach the 445 port (SMB):</p>
<p>I have used 3 different tools with the approach on anonymous enumeration but I had no luck finding shares <strong>smbclient, smpmap, smbclient.py from impacket</strong></p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/3X/a/4/a4647b67fbcd8378cc0125bf170a940bb79878f6.png" alt="" data-base62-sha1="nshAoi4Fy46PPlAmbiwUmxqQphk" width="422" height="82"></p>
<p>I can also use the <strong>crackmapexec</strong> tool and I can see that the anonymous user has access to a share named Scans</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/3X/4/3/433c123e279402b6215fe43af0aa995054d26705.png" alt="" data-base62-sha1="9AMGWmGJ137ssxwwYRrekl6B4P3" width="624" height="144"></p>
<p>From here you can choose your favorite tool to access the share and start exploring what is going on in that share.</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/3X/8/f/8f2affb38420370a347d76c1553e73312035b291.png" alt="" data-base62-sha1="kqwoYybbJh57PuvX5nnjiC5A40h" width="624" height="445"></p>
<p>Seems that we have a File that advises people to upload there work so it can be reviewed at the end of the day, the fact that we know this means that there is a user accessing this share at A certain time we can use this to taint the share and have it send us an NTLMv2 hash and try to crack it, so let us try and grab the hash of this user with the help of Responder.</p>
<p>I will build a LNK file with the ICON of the LNK pointing to my Machine so when Windows tries to load it, it will reach responder now I wait until the user browses the Share once that happens I will have responder listening on my attacking machine and capture the NTLM hash</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/3X/5/c/5cb20cc7a373e8d54a69498deda6d128ae443ce4.png" alt="" data-base62-sha1="de1oDUcbYM1nedAPUijjtCPxjH6" width="624" height="304"></p>
<p>Then I use PUT from smbclient and move the file on the share with my anonymous access to the share utilizing SMBCLIENT</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/3X/6/a/6aa5c3dd229bf254264109d27a8e25dbed2a2457.png" alt="" data-base62-sha1="fdrLeTYyYovS2vwNAEr8A5Bm31d" width="624" height="166"></p>
<p>I add the file (LNK) and once the share is browsed Windows will search for the ICO that is pointing to my attacking machine</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/3X/4/8/48f7d334cbbd6a97e87c4756d055f448a48660eb.png" alt="" data-base62-sha1="apvl71Nj4DoLak9NFIJ5Y5e7xIT" width="624" height="193"></p>
<p>And hashes are captured</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/3X/f/5/f59f0288a6205f61c2c8c386e61aa171406f90c0.png" alt="" data-base62-sha1="z2REL1v2tVKu5dhfzqo2BrjzAGc" width="624" height="343"></p>
<p>Now we will use these hashes to crack the password, my favorite is using hashcat and a few rules “One_rule_to_rule_them_all” (Do let me know if I messed up the name). And here I like using Windows for hashcat</p>
<p>And we managed to crack the Hash</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/3X/3/a/3ab7f1b35aaa54a618a12ea779d82188735bccac.png" alt="" data-base62-sha1="8nrN5ESaHJ2zU3IZeItK4MKADOQ" width="624" height="98"></p>
<p>Once we have the credentials let us try them and see what Adrian’s permissions are on the machine. Will utilize crackmapexec.</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/3X/1/9/1942842fb6c1710895994578a4ac6d1426616df7.png" alt="" data-base62-sha1="3BsrJLEPASRr9veoMok6UYHyjDp" width="624" height="141"></p>
<p>Fantastic we have credentials, but now from our limited options let us try and get a Shell on the machine from checking out nmap again we see that there is PSRemote available</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/3X/d/c/dc4fc1c7cce1e82f441b1b1a634c626f769138a5.png" alt="" data-base62-sha1="vqXVa7frSjbUNte02c7STK5qPCB" width="624" height="343"></p>
<p>Let’s use this and get a connection.</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/3X/8/9/89202fbf2eb2a4672dd2b5140f0f491563c56d6a.png" alt="" data-base62-sha1="jz4n6MLidNwNOREqmblYJRbrzmi" width="624" height="204"></p>
<p>Now I will upgrade my Shell to a Grunt from Covenant C2 (Just my taste). Now that we have our Grunt With Medium Integrity and running on PowerShell with the user anovoa time to Privesc to a higher user.</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/3X/a/7/a7a77b0ce139f704be57beea44f97bcaf5248a10.png" alt="" data-base62-sha1="nV8yV4MwoAHJBrOL7NKEDx8s17q" width="624" height="141"></p>
<p>I will use the SharpUp Task to gain information on how to Privesc but I will also use another favorite as I really love the output and the details check it has PrivescCheck.</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/3X/2/a/2aed941d304ada848123f4dbd4edbd1a6923f3ff.png" alt="" data-base62-sha1="67L3W5rnAl3trpWrcOXva2dZuEL" width="407" height="121"></p>
<p>AlwaysInstall Elevated Key OK good sign we can use this, I always have the option to validate with PrivescCheck or by querying the Registry Keys manually</p>
<p>PrivescCheck</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/3X/4/1/419486dea53167c0a2636b0b6867047d9b83e3d2.png" alt="" data-base62-sha1="9m9fFYsv9s2MuaQN3mApwqvn4SS" width="624" height="345"></p>
<p>Now let us upload our MSI Installer built from VS with a GruntSMB and grab a higher privileged Grunt.</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/3X/1/0/100158ed2a4343cb68689e1bcbd359a5e0a7b0a9.png" alt="" data-base62-sha1="2hAwCUv0vXQZGYs7RBIkMcOakkN" width="503" height="101"></p>
<p>I will execute using msiexec and connect back to the Grunt with higher privileges</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/3X/9/6/96a16a013c69f506a733b54fa39e294c5a8de4ee.png" alt="" data-base62-sha1="luxrOzSVVEb5JWtXtnY2z6otJ2C" width="537" height="199"></p>
<p>No worries if it hangs on Tasked its normal behavior, we can see our new grunt as SYSTEM</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/3X/e/f/ef142a86d6a794349ad9cf784e6506252d9d25a8.png" alt="" data-base62-sha1="y6ZjUv3NQlqMRsBgSAmUT4DHMeI" width="624" height="54"></p>
<p>And from here we can continue our enumeration and move forward with Compromising the Domain or leaving a persistent access or much more, the reason for this was to demonstrate the importance of enumeration as (Myself as well) I read that various people are just trying to throw exploits to machines and saying, “It doesn’t work”. Trying to search for ports, users, services, privilege escalation methods and others. I hope this has been helpful and maybe learned something from it.</p>
<p>Dumping Hashes from SAM (Got an error because Covenant is using and older version of Mimikatz, well the version I am using)</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/3X/4/f/4f4651cdf3325f7ac84f7f62ae3d193c59999c42.png" alt="" data-base62-sha1="bjinvh5e4oeQ9LCpnEKhgw5CgCK" width="401" height="383"></p>
<p>Happy Hacking!</p>
            <p><small>4 posts - 3 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/the-importance-of-enumeration/25314">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/the-importance-of-enumeration/25314</link>
          <pubDate>Sat, 20 Mar 2021 22:45:37 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25314</guid>
          <source url="https://d.clarkee.co.uk/t/the-importance-of-enumeration/25314.rss">The Importance of Enumeration</source>
        </item>
        <item>
          <title>Phishing Guides for Pentesters?</title>
          <dc:creator><![CDATA[seisvelas]]></dc:creator>
          <category>Social Engineering</category>
          <description><![CDATA[
            <p>From a purely white hat perspective, please. Are there any good guides about how to perform a phishing campaign against a target? What is the best way to learn about this?</p>
<p>I’m particularly interested in spearphishing and whaling. Both the technical aspects (bypassing spam filters, etc) and psychological (getting targets to click the links).</p>
<p>Thanks!</p>
            <p><small>10 posts - 8 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/phishing-guides-for-pentesters/25313">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/phishing-guides-for-pentesters/25313</link>
          <pubDate>Sat, 20 Mar 2021 22:10:43 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25313</guid>
          <source url="https://d.clarkee.co.uk/t/phishing-guides-for-pentesters/25313.rss">Phishing Guides for Pentesters?</source>
        </item>
        <item>
          <title>I wanna know what compiler compiled an exe i have</title>
          <dc:creator><![CDATA[alexa]]></dc:creator>
          <category>Questions</category>
          <description><![CDATA[
            <p>so i need a program that till me what compiler compiled an exe i downloaded, i have a executable file,and i wanna see which compiler it used, is there such a tool to find out the name of the compiler and possibly what version ??<br>
please help me, thank you for your time !!!</p>
            <p><small>2 posts - 2 participants</small></p>
            <p><a href="https://d.clarkee.co.uk/t/i-wanna-know-what-compiler-compiled-an-exe-i-have/25256">Read full topic</a></p>
          ]]></description>
          <link>https://d.clarkee.co.uk/t/i-wanna-know-what-compiler-compiled-an-exe-i-have/25256</link>
          <pubDate>Tue, 16 Mar 2021 13:37:07 +0000</pubDate>
          <discourse:topicPinned>No</discourse:topicPinned>
          <discourse:topicClosed>Yes</discourse:topicClosed>
          <discourse:topicArchived>No</discourse:topicArchived>
          <guid isPermaLink="false">d.clarkee.co.uk-topic-25256</guid>
          <source url="https://d.clarkee.co.uk/t/i-wanna-know-what-compiler-compiled-an-exe-i-have/25256.rss">I wanna know what compiler compiled an exe i have</source>
        </item>
  </channel>
</rss>
