<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Rewriting LibC functions in malwares - Malware - 0x00sec - The Home of the Hacker</title>
<meta name="description" content="Hello everyone; 
I wonder why some malware dev, rewrite some libc functions in their malware, like strcat, strcpy, malloc ‚Ä¶ 
Thanks !!">
<meta name="generator" content="Discourse 3.1.0.beta6 - https://github.com/discourse/discourse version 80a1709965fa59da824b2e3392976fc6fc898f80">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.png">
<meta name="theme-color" media="all" content="#171616">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="6004.html" />
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">
<link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_a5ef387651921c3e4c7aa1108536015ba8299efb.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" class="light-scheme" />
<link href="../../stylesheets/desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop" />
<link href="../../stylesheets/chat_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="chat" />
<link href="../../stylesheets/discourse-details_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-details" />
<link href="../../stylesheets/discourse-lazy-videos_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-lazy-videos" />
<link href="../../stylesheets/discourse-local-dates_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-local-dates" />
<link href="../../stylesheets/discourse-narrative-bot_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-narrative-bot" />
<link href="../../stylesheets/discourse-presence_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-presence" />
<link href="../../stylesheets/discourse-spoiler-alert_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-spoiler-alert" />
<link href="../../stylesheets/docker_manager_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="docker_manager" />
<link href="../../stylesheets/poll_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="poll" />
<link href="../../stylesheets/chat_desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="chat_desktop" />
<link href="../../stylesheets/poll_desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="poll_desktop" />
<link href="../../stylesheets/desktop_theme_46_f36ade55bf80933494fe3b5fab518f477de3bd4e.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2" />
<link href="../../stylesheets/desktop_theme_57_8c0e890a61cdb4c5833a9f9c96664ed164e7d645.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="57" data-theme-name="0x00sec-v2" />
<link rel="stylesheet" href="https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="https://s3.amazonaws.com/0x00sec/highlight.pack.js"></script>
<link rel="preload" href="../../theme-javascripts/440fd21108f5ba9e5dfe06cca9fc842569d5a874.js%3F__ws=0x00sec.org" as="script">
<script defer src="../../theme-javascripts/440fd21108f5ba9e5dfe06cca9fc842569d5a874.js%3F__ws=0x00sec.org" data-theme-id="40"></script>
<link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Rewriting LibC functions in malwares&#39;" href="6004.rss" />
<meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://0x00sec.org/uploads/default/original/2X/2/27a5373af868edade07624e8205c46e79c247445.jpeg" />
<meta property="og:image" content="https://0x00sec.org/uploads/default/original/2X/2/27a5373af868edade07624e8205c46e79c247445.jpeg" />
<meta property="og:url" content="https://0x00sec.org/t/rewriting-libc-functions-in-malwares/6004" />
<meta name="twitter:url" content="https://0x00sec.org/t/rewriting-libc-functions-in-malwares/6004" />
<meta property="og:title" content="Rewriting LibC functions in malwares" />
<meta name="twitter:title" content="Rewriting LibC functions in malwares" />
<meta property="og:description" content="Hello everyone;  I wonder why some malware dev, rewrite some libc functions in their malware, like strcat, strcpy, malloc ‚Ä¶  Thanks !!" />
<meta name="twitter:description" content="Hello everyone;  I wonder why some malware dev, rewrite some libc functions in their malware, like strcat, strcpy, malloc ‚Ä¶  Thanks !!" />
<meta property="og:article:section" content="Malware" />
<meta property="og:article:section:color" content="F7941D" />
<meta property="og:article:tag" content="programming" />
<meta property="og:article:tag" content="malware" />
<meta property="og:article:tag" content="hacking" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="2 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="17 ‚ù§" />
<meta property="article:published_time" content="2018-03-24T13:07:19+00:00" />
<meta property="og:ignore_canonical" content="true" />
</head>
<body class="crawler ">
<div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">

<a href="https://init.0x00sec.org" class="dow-menu">Init</a>
<a href="https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
<a href="https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
<header>
<a href="../../index.html">
0x00sec - The Home of the Hacker
</a>
</header>
<div id="main-outlet" class="wrap" role="main">
<div id="topic-title">
<h1>
<a href="6004.html">Rewriting LibC functions in malwares</a>
</h1>
<div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
<span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a href="../../c/malware.html" class="badge-wrapper bullet" itemprop="item">
<span class="badge-category-bg" style="background-color: #F7941D"></span>
<span class="badge-category clear-badge">
<span class="category-name" itemprop="name">Malware</span>
</span>
</a>
<meta itemprop="position" content="1" />
</span>
</div>
<div class="topic-category">
<div class="discourse-tags list-tags">
<a href="../../tag/programming.html" class="discourse-tag" rel="tag">programming</a>,
<a href="../../tag/malware.html" class="discourse-tag" rel="tag">malware</a>,
<a href="../../tag/hacking.html" class="discourse-tag" rel="tag">hacking</a>
</div>
</div>
</div>
<div itemscope itemtype="http://schema.org/DiscussionForumPosting">
<meta itemprop="headline" content="Rewriting LibC functions in malwares">
<meta itemprop="articleSection" content="Malware">
<meta itemprop="keywords" content="programming, malware, hacking">
<div itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="0x00sec - The Home of the Hacker">
<div itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
<meta itemprop="url" content="https://0x00sec.org/uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.png">
</div>
</div>
<div id="post_1" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/BlackYenii"><span itemprop="name">BlackYenii</span></a>
(Yenii)
</span>
<link itemprop="mainEntityOfPage" href="6004.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2018-03-24T13:07:19Z" class="post-time">
March 24, 2018, 1:07pm
</time>
<meta itemprop="dateModified" content="2018-03-24T13:07:19Z">
<span itemprop="position">1</span>
</span>
</div>
<div class="post" itemprop="articleBody">
<p>Hello everyone;</p>
<p>I wonder why some malware dev, rewrite some libc functions in their malware, like strcat, strcpy, malloc ‚Ä¶</p>
<p>Thanks !!</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_2" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/oaktree"><span itemprop="name">oaktree</span></a>
(oaktree)
</span>
<link itemprop="mainEntityOfPage" href="6004.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2018-03-24T13:20:33Z" class="post-time">
March 24, 2018, 1:20pm
</time>
<meta itemprop="dateModified" content="2018-03-24T13:20:33Z">
<span itemprop="position">2</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Where have you seen this? Mentioning some examples would be great.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_3" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/BlackYenii"><span itemprop="name">BlackYenii</span></a>
(Yenii)
</span>
<link itemprop="mainEntityOfPage" href="6004.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2018-03-24T14:00:09Z" class="post-time">
March 24, 2018, 2:00pm
</time>
<meta itemprop="dateModified" content="2018-03-24T14:19:08Z">
<span itemprop="position">3</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Carberp :<br>
<aside class="onebox githubblob">
<header class="source">
<a href="https://github.com/nyx0/Carberp/blob/master/Source/Strings.cpp" target="_blank" rel="nofollow noopener">github.com</a>
</header>
<article class="onebox-body">
<h4><a href="https://github.com/nyx0/Carberp/blob/master/Source/Strings.cpp" target="_blank" rel="nofollow noopener">nyx0/Carberp/blob/master/Source/Strings.cpp</a></h4>
<pre><code class="lang-cpp">#include &lt;windows.h&gt;

#include "Memory.h"
#include "GetApi.h"
#include "Strings.h"
#include "BotClasses.h"


#include "StrWildCmp.cpp"

DWORD WINAPI m_lstrncmp( const char *szstr1, const char *szstr2, int nlen )
{
	if ( !szstr1 || !szstr2 )
		return -1;

	DWORD dwReturn;

	__asm
	{
		pushad
</code></pre>
This file has been truncated. <a href="https://github.com/nyx0/Carberp/blob/master/Source/Strings.cpp" target="_blank" rel="nofollow noopener">show original</a>
</article>
<div class="onebox-metadata">
</div>
<div style="clear: both"></div>
</aside>
<br>
<aside class="onebox githubblob">
<header class="source">
<a href="https://github.com/nyx0/Carberp/blob/master/Source/Memory.cpp" target="_blank" rel="nofollow noopener">github.com</a>
</header>
<article class="onebox-body">
<h4><a href="https://github.com/nyx0/Carberp/blob/master/Source/Memory.cpp" target="_blank" rel="nofollow noopener">nyx0/Carberp/blob/master/Source/Memory.cpp</a></h4>
<pre><code class="lang-cpp">#include &lt;windows.h&gt;

#include "Memory.h"
#include "GetApi.h"
#include "Utils.h"
#include "ntdll.h"

//#include "BotDebug.h"

void *m_memset( void *szBuffer, DWORD dwSym, DWORD dwLen )
{
	if ( !szBuffer )
		return NULL;

	__asm
	{
		pushad
		mov		edi,[szBuffer]
		mov		ecx,[dwLen]
		mov		eax,[dwSym]
</code></pre>
This file has been truncated. <a href="https://github.com/nyx0/Carberp/blob/master/Source/Memory.cpp" target="_blank" rel="nofollow noopener">show original</a>
</article>
<div class="onebox-metadata">
</div>
<div style="clear: both"></div>
</aside>
</p>
<p>A virus from Github<br>
<aside class="onebox githubblob">
<header class="source">
<a href="https://github.com/elfmaster/skeksi_virus/blob/master/virus.c" target="_blank" rel="nofollow noopener">github.com</a>
</header>
<article class="onebox-body">
<h4><a href="https://github.com/elfmaster/skeksi_virus/blob/master/virus.c" target="_blank" rel="nofollow noopener">elfmaster/skeksi_virus/blob/master/virus.c</a></h4>
<pre><code class="lang-c">/*
 * Skeksi Virus v0.1 - infects files that are ELF_X86_64 Linux ET_EXEC's
 * Written by ElfMaster - <a href="../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="5d2f243c331d3f3429313c3e3638242e73322f3a">[email&#160;protected]</a>
 *
 * Compile:
 * gcc -g -O0 -DANTIDEBUG -DINFECT_PLTGOT  -fno-stack-protector -c virus.c -fpic -o virus.o
 * gcc -N -fno-stack-protector -nostdlib virus.o -o virus
 *
 * Using -DDEBUG will allow Virus to print debug output
 *
 * Usage:
 * ./virus
 *
 */

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;
</code></pre>
This file has been truncated. <a href="https://github.com/elfmaster/skeksi_virus/blob/master/virus.c" target="_blank" rel="nofollow noopener">show original</a>
</article>
<div class="onebox-metadata">
</div>
<div style="clear: both"></div>
</aside>
</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_4" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/Malware_Info"><span itemprop="name">Malware_Info</span></a>
</span>
<link itemprop="mainEntityOfPage" href="6004.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2018-03-24T14:30:41Z" class="post-time">
March 24, 2018, 2:30pm
</time>
<meta itemprop="dateModified" content="2018-03-24T14:30:41Z">
<span itemprop="position">4</span>
</span>
</div>
<div class="post" itemprop="text">
<p>May be b‚Äôcoz malware analysts heavily rely on FLIRT signatures,a feature provided by IDA,which actually finds libc functions in the assembly code and renames it with the library name.<br>
<a href="https://www.hex-rays.com/products/ida/tech/flirt/in_depth.shtml" class="onebox" target="_blank" rel="nofollow noopener">https://www.hex-rays.com/products/ida/tech/flirt/in_depth.shtml</a><br>
IDA relies on some tactics to find this libc functions,so defeat this techniques they should have written libc functions by hand.<br>
If i‚Äôm wrong plz correct me!</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_5" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/BlackYenii"><span itemprop="name">BlackYenii</span></a>
(Yenii)
</span>
<link itemprop="mainEntityOfPage" href="6004.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2018-03-24T21:09:53Z" class="post-time">
March 24, 2018, 9:09pm
</time>
<meta itemprop="dateModified" content="2018-03-24T21:09:53Z">
<span itemprop="position">5</span>
</span>
</div>
<div class="post" itemprop="text">
<p>First thanks for replying, but whats is the problem if IDA detect LibC functions ? They are not malicious ‚Ä¶</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_6" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/BlackYenii"><span itemprop="name">BlackYenii</span></a>
(Yenii)
</span>
<link itemprop="mainEntityOfPage" href="6004.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2018-03-24T21:10:33Z" class="post-time">
March 24, 2018, 9:10pm
</time>
<meta itemprop="dateModified" content="2018-03-24T21:10:33Z">
<span itemprop="position">6</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Hope to have some clarifications from <a class="mention" href="https://0x00sec.org/u/dtm">@dtm</a> <img src="../../images/emoji/twitter/slight_smile.png%3Fv=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_7" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/dtm"><span itemprop="name">dtm</span></a>
</span>
<link itemprop="mainEntityOfPage" href="6004.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2018-03-25T01:30:08Z" class="post-time">
March 25, 2018, 1:30am
</time>
<meta itemprop="dateModified" content="2018-03-25T01:30:08Z">
<span itemprop="position">7</span>
</span>
</div>
<div class="post" itemprop="text">
<p>The only reasons I can think of for implementing your own functions would be the following:</p>
<ol>
<li>Evading signature-based or heuristic detection.</li>
</ol>
<p>Let‚Äôs say I have a keylogger and I want it to upload logs to my FTP server. If I directly link the executable such that functions like <code>FtpOpenFile</code> and <code>FtpPutFile</code> exist in the imports in plain text and can be seen to be used in the code section, it would be very suspicious. If I can replace them by implementing my own self-coded networking library that has an FTP protocol, it <em>could</em> reduce the chance of it being suspicious. This is probably not the reason for why the above samples implement their own libc functions because they wouldn‚Äôt be classified as potentially unwanted.</p>
<ol start="2">
<li>Reducing dependencies in the binary.</li>
</ol>
<p>Sometimes, dependencies are troublesome for malware that infects other objects. In the case of viruses, having as little dependencies is ideal because the environment of the host is considered to be volatile. What I mean by this is that if you select a host at random, there is no guarantee that the execution environment will contain what the virus may need to properly do its task, therefore, to eliminate dependency is to become entirely self-sufficient.</p>
<p>A very classical example of this is dynamically obtaining WinAPI functions by walking the process‚Äô PEB‚Äôs executable modules under the assumption that <em>all</em> processes must have the <code>ntdll.dll</code> and <code>kernel32.dll</code> libraries present. Because of this, any malcode that lives in the process space of a host has access to whatever it needs to interact with the OS without having to rely on what already exists in the host‚Äôs environment.</p>
<p>Other than that, your guess is as good as mine. ¬Ø\_(„ÉÑ)_/¬Ø</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="3" />
<span class="post-likes">3 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_8" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/0x00pf"><span itemprop="name">0x00pf</span></a>
(pico)
</span>
<link itemprop="mainEntityOfPage" href="6004.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2018-03-25T07:43:27Z" class="post-time">
March 25, 2018, 7:43am
</time>
<meta itemprop="dateModified" content="2018-03-25T07:43:27Z">
<span itemprop="position">8</span>
</span>
</div>
<div class="post" itemprop="text">
<p>On top of <a class="mention" href="https://0x00sec.org/u/dtm">@dtm</a> points I‚Äôd add:</p>
<ol start="3">
<li>Your binary will be way smaller which is, in general, a desirable feature for a malware</li>
</ol>
<p><em>I think point 2 is a very good reason</em></p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="4" />
<span class="post-likes">4 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_9" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/BlackYenii"><span itemprop="name">BlackYenii</span></a>
(Yenii)
</span>
<link itemprop="mainEntityOfPage" href="6004.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2018-03-25T22:06:48Z" class="post-time">
March 25, 2018, 10:06pm
</time>
<meta itemprop="dateModified" content="2018-03-25T22:06:48Z">
<span itemprop="position">9</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Thanks <a class="mention" href="https://0x00sec.org/u/dtm">@dtm</a> and <a class="mention" href="https://0x00sec.org/u/0x00pf">@0x00pf</a> ‚Ä¶ does it have any relation with having a position independent in memory?</p>
<aside class="onebox allowlistedgeneric">
<header class="source">
<img src="https://github.githubassets.com/favicons/favicon.svg" class="site-icon" width="32" height="32">
<a href="https://github.com/elfmaster/skeksi_virus" target="_blank" rel="noopener nofollow ugc">GitHub</a>
</header>
<article class="onebox-body">
<img src="https://0x00sec.s3.amazonaws.com/original/2X/5/576c87448774e3e9c463e2ebfb47709cea74f01a.jpeg" class="thumbnail onebox-avatar" width="400" height="400">
<h3><a href="https://github.com/elfmaster/skeksi_virus" target="_blank" rel="noopener nofollow ugc">elfmaster/skeksi_virus</a></h3>
<p>Devestating and awesome Linux X86_64 ELF Virus. Contribute to elfmaster/skeksi_virus development by creating an account on GitHub.</p>
</article>
<div class="onebox-metadata">
</div>
<div style="clear: both"></div>
</aside>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="2" />
</div>
</div>
<div id="post_10" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/dtm"><span itemprop="name">dtm</span></a>
</span>
<link itemprop="mainEntityOfPage" href="6004.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2018-03-25T23:46:53Z" class="post-time">
March 25, 2018, 11:46pm
</time>
<meta itemprop="dateModified" content="2018-03-25T23:46:53Z">
<span itemprop="position">10</span>
</span>
</div>
<div class="post" itemprop="text">
<p>In the Windows environment, using functions from libc (e.g. <code>memcpy</code>, <code>strcpy</code>) requires the <code>msvcrt.dll</code> library to be present in the process space which means that the binary must be linked with it in its import table assuming the source contains its direct usage (as opposed to dynamically retrieving it as aforementioned or by using the <code>GetProcAddress</code>/<code>LoadLibrary</code> pair but using these two functions also requires linking). The import table by itself is <em>not</em> position-independent but can be pseudo-independent with the reliance on another table structure known as the <em>relocation table</em>.</p>
<p>Depending on these two structures needs <em>more</em> information to be able to locate them. In a standard PE binary, the PE headers are responsible for describing the structure of the program which includes the import and relocation tables. To programmatically calculate these offsets requires the use of such data structure which only introduces more size and as <a class="mention" href="https://0x00sec.org/u/0x00pf">@0x00pf</a> mentioned, smaller sizes are ideal for viruses. To programmatically fix the offsets of the import table such that it is ‚Äúposition-independent‚Äù requires more code which in turn expands the size.</p>
<p>So as you can see, it‚Äôs just much simpler and effective to implement these functions yourself. The trade-off clearly isn‚Äôt worth it with libc. Shellcode is the way to go.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="3" />
<span class="post-likes">3 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_11" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/0x00pf"><span itemprop="name">0x00pf</span></a>
(pico)
</span>
<link itemprop="mainEntityOfPage" href="6004.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2018-03-26T05:50:26Z" class="post-time">
March 26, 2018, 5:50am
</time>
<meta itemprop="dateModified" content="2018-03-26T05:50:26Z">
<span itemprop="position">11</span>
</span>
</div>
<div class="post" itemprop="text">
<aside class="quote no-group" data-username="BlackYenii" data-post="9" data-topic="6004">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/0x00sec.org/blackyenii/40/2505_2.png" class="avatar"> BlackYenii:</div>
<blockquote>
<p>does it have any relation with having a position independent in memory?</p>
</blockquote>
</aside>
<p>It indeed makes things easier, if your program will be moving around in its own addressing space (or in another processes addressing space) and not just standing at the entry point specified in its ELF header (for GNU/Linux systems), then it is very handy to do not depend on anything external.</p>
<p>To better understand why, we need to roughly known a libc C function is invoked:</p>
<ul>
<li>Call an entry on a memory table (<code>PLT</code> <em>Procedure Linkage table</em>)</li>
<li>At the first invocation, the dynamic linker is fired to resolve the address of the function you want to call in the library (and even load the library if needed)</li>
<li>Then, the entry in that memory table is patched with the resolved address so, next time, it does not need to call the dynamic linker (you already know where the function is located).</li>
</ul>
<p>So, even in the stationary case (whenever all the symbols your program uses have been resolved), all your calls to a libc function goes through an indirection. For the gory details check theses two great post at 0x00sec</p>
<aside class="quote quote-modified" data-post="1" data-topic="1488">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/0x00sec.org/_py/40/4275_2.png" class="avatar">
<a href="../linux-internals-the-art-of-symbol-resolution/1488.html">Linux Internals - The Art Of Symbol Resolution</a> <a class="badge-wrapper  bullet" href="../../c/linux/64.html"><span class="badge-category-bg" style="background-color: #283890;"></span><span style data-drop-close="true" class="badge-category clear-badge">Linux</span></a>
</div>
<blockquote>
Hello peeps! Been a while. I hope you‚Äôre all doing great. This write-up was supposed to be up way sooner to be honest. Recently, <a class="mention" href="https://0x00sec.org/u/oaktree">@oaktree</a> coded an IRC bot with dynamic linking features which motivated me to finally take the initiative and finish this god damn paper. So without further ado, <a class="mention" href="https://0x00sec.org/u/oaktree">@oaktree</a> and the rest, let‚Äôs get right into it.
Today we are continuing our journey towards the in-depth understanding of our binaries. If this is the first write-up you are reading regarding my series on Lin‚Ä¶
</blockquote>
</aside>
<aside class="quote quote-modified" data-post="1" data-topic="1082">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/0x00sec.org/_py/40/4275_2.png" class="avatar">
<a href="../elf-binaries-dynamic-linking-wizardry/1082.html">Linux Internals ~ Dynamic Linking Wizardry</a> <a class="badge-wrapper  bullet" href="../../c/linux/64.html"><span class="badge-category-bg" style="background-color: #283890;"></span><span style data-drop-close="true" class="badge-category clear-badge">Linux</span></a>
</div>
<blockquote>
UPDATE: Please refer to <a href="../linux-internals-the-art-of-symbol-resolution/1488.html">Linux Internals - The Art Of Symbol Resolution</a> for a more detailed and updated analysis of the concept.
Hey peeps! I hope you‚Äôre all doing great. It‚Äôs been a long time since my last post. Anyway, today I present to you something completely different from what you‚Äôve been used to seeing from me. This is more a self-research/study material. I‚Äôm nowhere close to being an expert on this subject but I busted my ass off trying to understand the inner workings of Linux executab‚Ä¶
</blockquote>
</aside>
<p>So, coming back to your question. Once the PLT table is resolved/updated, you can just call any libc function from any memory position, through that table. In order to make your program Position Independent you need to let the compiler know, independently of the libraries you use. So, I do not see a big advantage on that side.</p>
<p>However, if you want your code to be loaded using non standard techniques (as it may happen with a virus or other malwares), having all your program self-contained makes things easier as you do not have to care about linking or resolving symbols‚Ä¶ on the other hand, whatever functionality you need, you will have to implement your self/add to your program manually‚Ä¶ Which, depending on what the program has to do may be quite some work‚Ä¶</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="4" />
<span class="post-likes">4 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_12" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/BlackYenii"><span itemprop="name">BlackYenii</span></a>
(Yenii)
</span>
<link itemprop="mainEntityOfPage" href="6004.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2018-03-26T10:21:32Z" class="post-time">
March 26, 2018, 10:21am
</time>
<meta itemprop="dateModified" content="2018-03-26T10:21:32Z">
<span itemprop="position">12</span>
</span>
</div>
<div class="post" itemprop="text">
<p><a class="mention" href="https://0x00sec.org/u/dtm">@dtm</a> <a class="mention" href="https://0x00sec.org/u/0x00pf">@0x00pf</a> Thank youu very much <img src="../../images/emoji/twitter/smiley.png%3Fv=9" title=":smiley:" class="emoji" alt=":smiley:"><img src="../../images/emoji/twitter/smiley.png%3Fv=9" title=":smiley:" class="emoji" alt=":smiley:"><img src="../../images/emoji/twitter/smiley.png%3Fv=9" title=":smiley:" class="emoji" alt=":smiley:"><img src="../../images/emoji/twitter/smiley.png%3Fv=9" title=":smiley:" class="emoji" alt=":smiley:"><br>
I understand ^^</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_13" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/system"><span itemprop="name">system</span></a>
(system)
Closed
</span>
<link itemprop="mainEntityOfPage" href="6004.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2018-04-23T13:07:33Z" class="post-time">
April 23, 2018, 1:07pm
</time>
<meta itemprop="dateModified" content="2018-04-23T13:07:33Z">
<span itemprop="position">13</span>
</span>
</div>
<div class="post" itemprop="text">
<p>This topic was automatically closed after 30 days. New replies are no longer allowed.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
</div>
</div>
<footer class="container wrap">
<nav class="crawler-nav">
<ul>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../index.html" itemprop="url">Home </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../categories.html" itemprop="url">Categories </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="https://0x00sec.org/guidelines" itemprop="url">FAQ/Guidelines </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../tos.html" itemprop="url">Terms of Service </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../privacy.html" itemprop="url">Privacy Policy </a>
</span>
</li>
</ul>
</nav>
<p class="powered-by-link">Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>
<script data-cfasync="false" src="../../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="https://instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
</body>
</html>
