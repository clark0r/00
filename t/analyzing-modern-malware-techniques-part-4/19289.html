<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Analyzing Modern Malware Techniques - Part 4 - Malware - 0x00sec - The Home of the Hacker</title>
    <meta name="description" content="Analyzing Modern Malware Techniques - Part 4
Iâ€™m afraid of no packer(Part 1 of 2)
  

Preface:
If youâ€™re going to analyze malware you are going to run into packers, code injections, obfuscated code and what not. If one d&amp;hellip;">
    <meta name="generator" content="Discourse 3.6.0.beta2-latest - https://github.com/discourse/discourse version 3b1964f3ed8bdc2f181e2abccb1b116e4b814db5">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.html">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.html">
<meta name="theme-color" media="all" content="#171616">

<meta name="color-scheme" content="dark">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="19289.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">

    
    <link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4.css_%3b%20filename_%3dUTF-8%27%27color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" class="light-scheme" data-scheme-id="15"/>

<link href="../../stylesheets/common_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27common_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common"  />

  <link href="../../stylesheets/mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile"  />
  <link href="../../stylesheets/desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop"  />



    <link href="../../stylesheets/chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="chat"  />
    <link href="../../stylesheets/checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="checklist"  />
    <link href="../../stylesheets/discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-cakeday"  />
    <link href="../../stylesheets/discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="../../stylesheets/discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="../../stylesheets/discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="../../stylesheets/discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="../../stylesheets/discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="../../stylesheets/discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-solved"  />
    <link href="../../stylesheets/discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-templates"  />
    <link href="../../stylesheets/discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-topic-voting"  />
    <link href="../../stylesheets/docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="../../stylesheets/footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="../../stylesheets/poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="poll"  />
    <link href="../../stylesheets/spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="../../stylesheets/chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="chat_mobile"  />
    <link href="../../stylesheets/discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-solved_mobile"  />
    <link href="../../stylesheets/discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-topic-voting_mobile"  />
    <link href="../../stylesheets/chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="chat_desktop"  />
    <link href="../../stylesheets/discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="discourse-topic-voting_desktop"  />
    <link href="../../stylesheets/poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="poll_desktop"  />

  <link href="../../stylesheets/common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960db.css_%3b%20filename_%3dUTF-8%27%27common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960dba97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="57" data-theme-name="0x00sec-v2"/>
    <link href="../../stylesheets/mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38.css_%3b%20filename_%3dUTF-8%27%27mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile_theme" data-theme-id="4" data-theme-name="mobile chrome"/>
    <link href="../../stylesheets/desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2"/>

    <link rel="stylesheet" href="../../../external.html?link=https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="../../../external.html?link=https://s3.amazonaws.com/0x00sec/highlight.pack.js" nonce="OintPUh5OOa9arsEXanZexfOT"></script>
<script defer="" src="../../theme-javascripts/05954ff525aceb8daa8b585f92d758d311ae7077.js_%3b%20filename_%3dUTF-8%27%2705954ff525aceb8daa8b585f92d758d311ae7077a97f.js?__ws=d.clarkee.co.uk" data-theme-id="40" nonce="OintPUh5OOa9arsEXanZexfOT"></script>
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Analyzing Modern Malware Techniques - Part 4&#39;" href="19289.rss" />
    <meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://d.clarkee.co.uk/uploads/default/original/2X/f/f7feab28b8c58f0f563080d9420eba6a8b6d5be5.png" />
<meta property="og:image" content="https://d.clarkee.co.uk/uploads/default/original/2X/f/f7feab28b8c58f0f563080d9420eba6a8b6d5be5.png" />
<meta property="og:url" content="https://d.clarkee.co.uk/t/analyzing-modern-malware-techniques-part-4/19289" />
<meta name="twitter:url" content="https://d.clarkee.co.uk/t/analyzing-modern-malware-techniques-part-4/19289" />
<meta property="og:title" content="Analyzing Modern Malware Techniques - Part 4" />
<meta name="twitter:title" content="Analyzing Modern Malware Techniques - Part 4" />
<meta property="og:description" content="Analyzing Modern Malware Techniques - Part 4 Iâ€™m afraid of no packer(Part 1 of 2)     Preface: If youâ€™re going to analyze malware you are going to run into packers, code injections, obfuscated code and what not. If one doesnâ€™t possess the correct knowledge or the correct tools to deal with such problems he will not get far with his analysis. In fact, when I first started practicing malware analysis somewhere back in 2015 I stopped because I couldnâ€™t understand how to unpack packed code and I qui..." />
<meta name="twitter:description" content="Analyzing Modern Malware Techniques - Part 4 Iâ€™m afraid of no packer(Part 1 of 2)     Preface: If youâ€™re going to analyze malware you are going to run into packers, code injections, obfuscated code and what not. If one doesnâ€™t possess the correct knowledge or the correct tools to deal with such problems he will not get far with his analysis. In fact, when I first started practicing malware analysis somewhere back in 2015 I stopped because I couldnâ€™t understand how to unpack packed code and I qui..." />
<meta property="og:article:section" content="Malware" />
<meta property="og:article:section:color" content="F7941D" />
<meta property="og:article:tag" content="malware" />
<meta property="og:article:tag" content="antidebug" />
<meta property="og:article:tag" content="reverseengineering" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="6 mins ðŸ•‘" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="8 â¤" />
<meta property="article:published_time" content="2020-02-17T22:31:03+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    <div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">
  <!--<a href="https://git.0x00sec.org" class="dow-menu">GitLab</a>  
  <a href="https://blog.0x00sec.org/irc" class="dow-menu">IRC</a>!-->
  <a href="../../../external.html?link=https://init.0x00sec.org/" class="dow-menu">Init</a>
  <a href="../../../external.html?link=https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
  <a href="../../../external.html?link=https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
    <header>
  <a href="../../index.html">0x00sec - The Home of the Hacker</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="19289.html">Analyzing Modern Malware Techniques - Part 4</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/malware/56.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #F7941D'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Malware</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../tag/malware.html' class='discourse-tag' rel="tag">malware</a>, 
            <a href='../../tag/antidebug.html' class='discourse-tag' rel="tag">antidebug</a>, 
            <a href='../../tag/reverseengineering.html' class='discourse-tag' rel="tag">reverseengineering</a>
        </div>
      </div>
  </div>

  

    <div itemscope itemtype='../../../external.html?link=http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Analyzing Modern Malware Techniques - Part 4'>
      <link itemprop='url' href='19289.html'>
      <meta itemprop='datePublished' content='2020-02-17T22:31:03Z'>
        <meta itemprop='articleSection' content='Malware'>
      <meta itemprop='keywords' content='malware, antidebug, reverseengineering'>
      <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
        <meta itemprop='name' content='0x00sec - The Home of the Hacker'>
          <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
            <meta itemprop='url' content='../../uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.html'>
          </div>
      </div>


          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/Danus.html'><span itemprop='name'>Danus</span></a>
                
              </span>

                <link itemprop="mainEntityOfPage" href="19289.html">

                <link itemprop="image" href="../../uploads/default/original/2X/f/f7feab28b8c58f0f563080d9420eba6a8b6d5be5.html">

              <span class="crawler-post-infos">
                  <time  datetime='2020-02-17T22:31:03Z' class='post-time'>
                    February 17, 2020, 10:31pm
                  </time>
                  <meta itemprop='dateModified' content='2020-07-06T18:21:29Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <h2><a name="p-53180-analyzing-modern-malware-techniques-part-4-1" class="anchor" href="#p-53180-analyzing-modern-malware-techniques-part-4-1"></a>Analyzing Modern Malware Techniques - Part 4</h2>
<h3><a name="p-53180-im-afraid-of-no-packerpart-1-of-2-2" class="anchor" href="#p-53180-im-afraid-of-no-packerpart-1-of-2-2"></a>Iâ€™m afraid of no packer(Part 1 of 2)</h3>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/f/f7feab28b8c58f0f563080d9420eba6a8b6d5be5.html" data-download-href="/uploads/short-url/znRyJaLJucGf973ikjJ0ifkMhtX.png?dl=1" title=""><img src="../../uploads/default/original/2X/f/f7feab28b8c58f0f563080d9420eba6a8b6d5be5.html" alt="" data-base62-sha1="znRyJaLJucGf973ikjJ0ifkMhtX" width="168" height="144" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">300Ã—256 11.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<hr>
<h3><a name="p-53180-preface-3" class="anchor" href="#p-53180-preface-3"></a>Preface:</h3>
<p>If youâ€™re going to analyze malware you are going to run into packers, code injections, obfuscated code and what not. If one doesnâ€™t possess the correct knowledge or the correct tools to deal with such problems he will not get far with his analysis. In fact, when I first started practicing malware analysis somewhere back in 2015 I stopped because I couldnâ€™t understand how to unpack packed code and I quit trying, So I tried again around 2017.. and I quit again. This in time(in 2019) I didnâ€™t quit but only because I had the proper tools to deal with the problem. Packed code is usually a dynamic problem and by that I mean that most of the time when youâ€™ll encounter a packed malware itâ€™s not going to be the same packed code but if youâ€™ll have the tools to deal with the problem I guess you could defeat any packer. Still Iâ€™m to remain humble and admit that I still donâ€™t have enough experience to deal with all types of packed code but Iâ€™m hoping that today, my dear reader, together we can bring more experience into our reverse engineering arsenal to learn together how to defeat packed code. I would like to put my efforts in this post to find anti analysis techniques that bypass my Scylla-Hide plugin and to learn how to de obfuscate binaries to ease analysis. Letâ€™s begin!</p>
<hr>
<p><strong>Required knowledge:</strong></p>
<ul>
<li>Basic understanding in code injections</li>
<li>Basic understanding in dealing with anti analysis</li>
<li>A solid grasp of C and WINAPI</li>
<li>A solid grasp of x86 Assembly</li>
<li>Experience with IDAPRO</li>
<li>Experience with x64dbg</li>
</ul>
<p><strong>Required Tools:</strong></p>
<ul>
<li>IDA Pro</li>
<li>x64dbg</li>
<li>Resource Hacker</li>
<li>PEBear</li>
<li>Process Explorer</li>
<li>Process Monitor</li>
<li>VMWare</li>
</ul>
<p><strong>Sample used:</strong></p>
<p><a href="../../../external.html?link=https://www.hybrid-analysis.com/sample/3d2777b748e805c0463c0c6d0fef8280ad197bea1dd0a25e30ed71199989a6b9?environmentId=100" rel="noopener nofollow ugc">3d2777b748e805c0463c0c6d0fef8280ad197bea1dd0a25e30ed71199989a6b9</a></p>
<p><strong>Goal setting:</strong></p>
<ol>
<li>Find and bypass anti analysis techniques.</li>
<li>Unpack main payload so we could analyze and run it.</li>
<li>Extract basic host based IOC and network based IOC.</li>
</ol>
<blockquote>
<p><strong>Some side notes</strong>:<br>
I highly encourage you to download the sample and follow my execution paths. As I begin to dive into shellcode analysis here it will be highly difficult to follow me in the post itself as I would begin to traverse offsets and I would not be making a picture of every location I access.</p>
</blockquote>
<hr>
<h2><a name="p-53180-basic-analysis-4" class="anchor" href="#p-53180-basic-analysis-4"></a>Basic Analysis:</h2>
<p>I was encouraged by a few users in <a href="../../../external.html?link=http://0x00sec.org/" rel="noopener nofollow ugc">0x00sec.org</a> to check out this sample, It was stated that this sample was packed by <a href="../../../external.html?link=https://malpedia.caad.fkie.fraunhofer.de/details/win.smokeloader" rel="noopener nofollow ugc">SmokeLoader</a> and it performs some pretty cool anti-analysis tricks, so off I went.</p>
<h2><a name="p-53180-basic-static-analysis-5" class="anchor" href="#p-53180-basic-static-analysis-5"></a>Basic Static Analysis:</h2>
<p><strong>Anti Analysis APIs:</strong></p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/7/76d9e8ad1cb9d81739f923097e0e11fd1b22abc8.html" data-download-href="/uploads/short-url/gXpcY0DLK12rzxbMQWUJIcoWdg4.png?dl=1" title=""><img src="../../../0x00sec.s3.amazonaws.com/optimized/2X/7/76d9e8ad1cb9d81739f923097e0e11fd1b22abc8_2_602x196.png" alt="" data-base62-sha1="gXpcY0DLK12rzxbMQWUJIcoWdg4" width="602" height="196" role="presentation" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/7/76d9e8ad1cb9d81739f923097e0e11fd1b22abc8_2_602x196.png, https://0x00sec.s3.amazonaws.com/optimized/2X/7/76d9e8ad1cb9d81739f923097e0e11fd1b22abc8_2_903x294.png 1.5x, https://0x00sec.s3.amazonaws.com/optimized/2X/7/76d9e8ad1cb9d81739f923097e0e11fd1b22abc8_2_1204x392.png 2x"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">1544Ã—504 25.4 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/a/a7141244273f370cfbc3d22e011cc10bf6f707ef.html" data-download-href="/uploads/short-url/nQ2JTtK3gLNnekyPCzrgggX9BsH.png?dl=1" title=""><img src="../../../0x00sec.s3.amazonaws.com/optimized/2X/a/a7141244273f370cfbc3d22e011cc10bf6f707ef_2_602x123.png" alt="" data-base62-sha1="nQ2JTtK3gLNnekyPCzrgggX9BsH" width="602" height="123" role="presentation" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/a/a7141244273f370cfbc3d22e011cc10bf6f707ef_2_602x123.png, https://0x00sec.s3.amazonaws.com/optimized/2X/a/a7141244273f370cfbc3d22e011cc10bf6f707ef_2_903x184.png 1.5x, https://0x00sec.s3.amazonaws.com/optimized/2X/a/a7141244273f370cfbc3d22e011cc10bf6f707ef_2_1204x246.png 2x"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">1544Ã—315 40.5 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/c/c0405ce3e351b7790ff0104f7947eeae8a5e6ecc.html" data-download-href="/uploads/short-url/rqJzpjqujsQkalq68cHvXAPrY3a.png?dl=1" title=""><img src="../../../0x00sec.s3.amazonaws.com/optimized/2X/c/c0405ce3e351b7790ff0104f7947eeae8a5e6ecc_2_602x63.png" alt="" data-base62-sha1="rqJzpjqujsQkalq68cHvXAPrY3a" width="602" height="63" role="presentation" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/c/c0405ce3e351b7790ff0104f7947eeae8a5e6ecc_2_602x63.png, https://0x00sec.s3.amazonaws.com/optimized/2X/c/c0405ce3e351b7790ff0104f7947eeae8a5e6ecc_2_903x94.png 1.5x, https://0x00sec.s3.amazonaws.com/optimized/2X/c/c0405ce3e351b7790ff0104f7947eeae8a5e6ecc_2_1204x126.png 2x"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">1552Ã—163 13.6 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p><strong>Dynamic API Resolving:</strong></p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/0/040ebed14c9059aa45fef0efc390d6a0555ac5d2.html" data-download-href="/uploads/short-url/zTv6AMxewzVLYxhJFC5ewvO4Xo.png?dl=1" title=""><img src="../../../0x00sec.s3.amazonaws.com/optimized/2X/0/040ebed14c9059aa45fef0efc390d6a0555ac5d2_2_602x193.png" alt="" data-base62-sha1="zTv6AMxewzVLYxhJFC5ewvO4Xo" width="602" height="193" role="presentation" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/0/040ebed14c9059aa45fef0efc390d6a0555ac5d2_2_602x193.png, https://0x00sec.s3.amazonaws.com/optimized/2X/0/040ebed14c9059aa45fef0efc390d6a0555ac5d2_2_903x289.png 1.5x, /uploads/default/original/2X/0/040ebed14c9059aa45fef0efc390d6a0555ac5d2.png 2x"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">909Ã—291 35.1 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p><strong>Uncommon section in PE file:</strong></p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/6/66f53764551bce8a7f17d2a7f7849d0f926c97d3.html" data-download-href="/uploads/short-url/eGO4GMsRZQrCvjK1pMRHdFMF0TF.png?dl=1" title=""><img src="../../../0x00sec.s3.amazonaws.com/optimized/2X/6/66f53764551bce8a7f17d2a7f7849d0f926c97d3_2_602x64.png" alt="" data-base62-sha1="eGO4GMsRZQrCvjK1pMRHdFMF0TF" width="602" height="64" role="presentation" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/6/66f53764551bce8a7f17d2a7f7849d0f926c97d3_2_602x64.png, https://0x00sec.s3.amazonaws.com/optimized/2X/6/66f53764551bce8a7f17d2a7f7849d0f926c97d3_2_903x96.png 1.5x, https://0x00sec.s3.amazonaws.com/optimized/2X/6/66f53764551bce8a7f17d2a7f7849d0f926c97d3_2_1204x128.png 2x"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">1543Ã—164 8.57 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>And thatâ€™s it. That is very undetailed for hybrid-analysis. No connections being made, No files dropped, no code injection detectionâ€™s no nothing.</p>
<p>Letâ€™s look at the sample on disk.</p>
<p>So I start off by viewing the Imports and the list seems pretty full and we have some strings which are well..:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/6/69655c0af5d33b260a7f86ac53343c1bd9ac9f73.html" data-download-href="/uploads/short-url/f2nimEija5AnkbtqBS7u7xWieav.png?dl=1" title=""><img src="../../uploads/default/original/2X/6/69655c0af5d33b260a7f86ac53343c1bd9ac9f73.html" alt="" data-base62-sha1="f2nimEija5AnkbtqBS7u7xWieav" width="602" height="271" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">932Ã—420 37.6 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Not very informative, the rest of the strings look like auto-generated by the compiler so itâ€™s not much use to us.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/f/fbc5d67fdf587eaddefbdb459ae19c5135b725bf.html" data-download-href="/uploads/short-url/zVhI4kA1ZGB2CIrIugC2tdhDigv.png?dl=1" title=""><img src="../../uploads/default/original/2X/f/fbc5d67fdf587eaddefbdb459ae19c5135b725bf.html" alt="" data-base62-sha1="zVhI4kA1ZGB2CIrIugC2tdhDigv" width="602" height="496" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">642Ã—529 50.2 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>TLS calls are never a good thing, TLS is <a href="../../../external.html?link=https://en.wikipedia.org/wiki/Thread-local_storage" rel="noopener nofollow ugc">Thread Local Storage</a>, itâ€™s code that is usually stored in a different section and runs before the entry point or it might be allocated and created using TLS API calls, but there is no TLS section in this binary. Just a strangely named section called <strong>.mysec</strong> which doesnâ€™t contain any code:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/f/f29057e65c4d456b837a782d8ca3c9f79f1cee58.html" data-download-href="/uploads/short-url/yBONJ9oMUDpOTgE8I4jb2x2wfxu.png?dl=1" title=""><img src="../../uploads/default/original/2X/f/f29057e65c4d456b837a782d8ca3c9f79f1cee58.html" alt="" data-base62-sha1="yBONJ9oMUDpOTgE8I4jb2x2wfxu" width="602" height="97" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">853Ã—138 4.87 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>but it contains a lot of storage, infact I viewed its full size and its 4095 bytes long. weâ€™ll keep that in mind.</p>
<p>In addition, there is a strange artifact in the samples resource section:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/e/ef3ff96efeaa69dd79bfca40931ec56b0607b04d.html" data-download-href="/uploads/short-url/y8vb9lfGL3ZfN12yHHclhvbHxiR.png?dl=1" title=""><img src="../../uploads/default/original/2X/e/ef3ff96efeaa69dd79bfca40931ec56b0607b04d.html" alt="" data-base62-sha1="y8vb9lfGL3ZfN12yHHclhvbHxiR" width="602" height="255" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">1129Ã—478 51 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>It looks to long(35769 bytes long) to be a valid resource unless its a video format, weâ€™ll keep this in mind as well.</p>
<p><strong>Basic Dynamic Analysis:</strong></p>
<p>So letâ€™s run this on our Dynamic Analysis machine, Iâ€™ll set process monitor to watch the application and weâ€™ll take a look at it in process explorer.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/9/9e54500c1706fbbe1410e978d0a94b9b74777619.html" data-download-href="/uploads/short-url/mAE4Vj2OWUlJyWDzPuDNUw53pRD.png?dl=1" title=""><img src="../../uploads/default/original/2X/9/9e54500c1706fbbe1410e978d0a94b9b74777619.html" alt="" data-base62-sha1="mAE4Vj2OWUlJyWDzPuDNUw53pRD" width="602" height="237" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">608Ã—240 18.2 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p><img src="../../uploads/default/original/2X/1/18bb0eaaddf8f1c1ad510bf5527fc60c288afa29.html" alt="" data-base62-sha1="3wMe7gqwDz1wrrHv2MOKYX6Dgtr" width="602" height="277" role="presentation" class="animated"></p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/f/f8d815054732f1bcabd9bffde8b3a5e5958a6e46.html" data-download-href="/uploads/short-url/zvnmIFRb3oTAta72GtxttqHlG8C.png?dl=1" title=""><img src="../../../0x00sec.s3.amazonaws.com/optimized/2X/f/f8d815054732f1bcabd9bffde8b3a5e5958a6e46_2_602x331.png" alt="" data-base62-sha1="zvnmIFRb3oTAta72GtxttqHlG8C" width="602" height="331" role="presentation" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/f/f8d815054732f1bcabd9bffde8b3a5e5958a6e46_2_602x331.png, /uploads/default/original/2X/f/f8d815054732f1bcabd9bffde8b3a5e5958a6e46.png 1.5x, /uploads/default/original/2X/f/f8d815054732f1bcabd9bffde8b3a5e5958a6e46.png 2x"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">807Ã—443 400 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Thatâ€™s not true actually, Iâ€™m not surprised at all. but we do have something interesting here - it appears that the sample spawned a new sub process:</p>
<p><img src="../../uploads/default/original/2X/4/4ca2e6c28e3f496d4ba485f313c323c02894b2e3.html" alt="" data-base62-sha1="aVXiKs6XzNpvr7HjjK7Xsngby4r" width="602" height="27" role="presentation"></p>
<p>which is a legitimate Windows Application, that might come in handy! so letâ€™s move on to the advanced analysis!</p>
<hr>
<h2><a name="p-53180-advanced-analysis-finding-obfuscation-and-anti-analysis-tricks-6" class="anchor" href="#p-53180-advanced-analysis-finding-obfuscation-and-anti-analysis-tricks-6"></a>Advanced Analysis - Finding Obfuscation and Anti Analysis Tricks:</h2>
<p>Our goal here is to find obfuscation techniques and anti analysis techniques, Iâ€™m going to find ways to circumvent them, instead of skipping these like I usually do weâ€™ll park at each technique we find and see how we can deal with it.</p>
<p>Before we continue, I want to mention that <a href="../../../external.html?link=https://malpedia.caad.fkie.fraunhofer.de/details/win.smokeloader" rel="noopener nofollow ugc">SmokeLoader </a>is simply a loader aiding the main payload in covert launching. According to Hybrid Analysis that was linked before and <a href="../../../external.html?link=https://maltiverse.com/sample/3d2777b748e805c0463c0c6d0fef8280ad197bea1dd0a25e30ed71199989a6b9" rel="noopener nofollow ugc">Maltiverse</a>, the final payload is ransomware(GandCrab according to Maltiverse).</p>
<p>Letâ€™s start by looking at <strong>WinMain</strong> in IDA:</p>
<p>looking at <strong>loc_4011C5</strong> we can see a lot of local variables being initialized:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/1/1815326a7341e4c207ca849f62e2ab7f12c33ad4.html" data-download-href="/uploads/short-url/3r2S9NTLJxRHn5B5e2pGCMibCJe.png?dl=1" title=""><img src="../../../0x00sec.s3.amazonaws.com/optimized/2X/1/1815326a7341e4c207ca849f62e2ab7f12c33ad4_2_235x499.png" alt="" data-base62-sha1="3r2S9NTLJxRHn5B5e2pGCMibCJe" width="235" height="499" role="presentation" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/1/1815326a7341e4c207ca849f62e2ab7f12c33ad4_2_235x499.png, /uploads/default/original/2X/1/1815326a7341e4c207ca849f62e2ab7f12c33ad4.png 1.5x, /uploads/default/original/2X/1/1815326a7341e4c207ca849f62e2ab7f12c33ad4.png 2x"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">261Ã—554 65.6 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>and since Iâ€™ve already analyzed this malware a bit - Iâ€™m going to assume these are <a href="../../../external.html?link=https://www.fireeye.com/blog/threat-research/2016/06/automatically-extracting-obfuscated-strings.html" rel="noopener nofollow ugc">encrypted stack strings</a> but weâ€™ll see if this is true later on. Next up we got mambo jumbo code that is built to look confusing but legitimate. But wait! oh boy whatâ€™s this at location <strong>loc_4017F9</strong>:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/d/d2cbd82660f60643c1fc5739c08691fe17c72420.html" data-download-href="/uploads/short-url/u4N0cz8854XfHyh3Tu2V4GCtWes.png?dl=1" title=""><img src="../../uploads/default/original/2X/d/d2cbd82660f60643c1fc5739c08691fe17c72420.html" alt="" data-base62-sha1="u4N0cz8854XfHyh3Tu2V4GCtWes" width="309" height="342" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">309Ã—342 11.1 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>A call to a dynamically calculated value and what appears to be an attempt to set a value in the Process Environment Block? What is at <strong>0x2c</strong> being accessed from the <strong>FS</strong> register?</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/optimized/2X/4/400b6ae9d4fb7abc035a92e1c8bb400ade093f71_2_602x24.png" alt="" data-base62-sha1="98z1fUJgLbc1HAJH5Bs7ZeueAuJ" width="602" height="24" role="presentation" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/4/400b6ae9d4fb7abc035a92e1c8bb400ade093f71_2_602x24.png, /uploads/default/original/2X/4/400b6ae9d4fb7abc035a92e1c8bb400ade093f71.png 1.5x, /uploads/default/original/2X/4/400b6ae9d4fb7abc035a92e1c8bb400ade093f71.png 2x"></p>
<p>Huh.. Itâ€™s attempting to access a value in the Thread Local Storage array(TLS), weâ€™ll check that out too since we donâ€™t know exactly what value itâ€™s attempting to access since <strong>EDX</strong> is dynamically calculated.</p>
<p>After this the code block calls <strong>printf</strong> and terminates, Iâ€™m not sure this invocation actually does something.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/1/12f89afdd2268b01bdb6888cf08682c877c4bdc5.html" data-download-href="/uploads/short-url/2HPecSz8hA5LhQ8z2DtrjGdqEpn.png?dl=1" title=""><img src="../../uploads/default/original/2X/1/12f89afdd2268b01bdb6888cf08682c877c4bdc5.html" alt="" data-base62-sha1="2HPecSz8hA5LhQ8z2DtrjGdqEpn" width="346" height="286" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">346Ã—286 3.82 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p><strong>So letâ€™s summarize what we gathered so far:</strong></p>
<ol>
<li>A shady looking resource</li>
<li>A lot of local variables being set up that look like encrypted stack strings</li>
<li>A call to a dynamically calculated pointer</li>
<li>Dynamic access to the TLS array</li>
</ol>
<p>Letâ€™s start x64dbg and put a breakpoint on the assumed stack strings, and <strong>loc_4017F9</strong>. In addition just for safety letâ€™s place a breakpoint on <strong>VirtualAlloc</strong> and <strong>CreateProcessW</strong>.</p>
<p>We break on the assumed stack strings at location <strong>0x4011DE</strong>, now Iâ€™m going to access the dump pointed by these variables after I run the entire variable assignment block at <strong>loc_4011C5</strong>:</p>
<p><img src="../../uploads/default/original/2X/a/a65cb423a92ec2188cf59347167012fb4a44f5bc.html" alt="" data-base62-sha1="nJHSmnwK32nkjlbk43x5WwrpWwI" width="592" height="59" role="presentation"></p>
<p><img src="../../uploads/default/original/2X/9/9e3eabb3711a4396bf9a25bdd8fcb41eef146385.html" alt="" data-base62-sha1="mzTI7MhOxOYV8c7GcVOgjd4X3wN" width="357" height="22" role="presentation"></p>
<p><img src="../../uploads/default/original/2X/9/9af9e8c73de7396f4257b455c5a2c940d89482af.html" alt="" data-base62-sha1="m6YXqZkje8B4WBrKJf1X3dIjS0f" width="405" height="23" role="presentation"></p>
<p>This is data, but Iâ€™m not sure all of it is data, weâ€™ll see how this plays out later.</p>
<p>Next we hit on <strong>CreateProcessW</strong> which attempts to create <strong>splwow64.exe</strong> which is the printer driver we saw the malware launching before with command like parameters:</p>
<p>C:\Windows\splwow64.exe 8192</p>
<p>But it seems to be created because of a call to the API <strong>DeviceCapabilitiesA</strong> which is not much of interest to us.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/6/6f6bd156ee054ee4497918431c716284eb60c3e0.html" data-download-href="/uploads/short-url/fTFZQXa7G0rn04l3Flkl3OEuWe4.png?dl=1" title=""><img src="../../uploads/default/original/2X/6/6f6bd156ee054ee4497918431c716284eb60c3e0.html" alt="" data-base62-sha1="fTFZQXa7G0rn04l3Flkl3OEuWe4" width="602" height="149" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">635Ã—158 10.1 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<hr>
<h2><a name="p-53180-trick-number-0-embedding-shellcode-in-the-resource-section-7" class="anchor" href="#p-53180-trick-number-0-embedding-shellcode-in-the-resource-section-7"></a>Trick number 0 - Embedding shellcode in the resource section</h2>
<p>Next we hit <strong>VirtualAlloc</strong> and upon exit it seems to be moving the allocated returned memory to 0x4260AC! thatâ€™s the address of the value that is going to be called later:</p>
<p><img src="../../uploads/default/original/2X/1/1cf10891f6090ffe31c2dba154f5af8c110102a0.html" alt="" data-base62-sha1="481MqdVFwbwZtrGa5zL7LLeAjWE" width="253" height="25" role="presentation"></p>
<p>Letâ€™s set a hardware on access breakpoint on the returned from <strong>VirtualAlloc</strong> value:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/0/02dbb55e299052975f4a1582e9bc08df43f83f8a.html" data-download-href="/uploads/short-url/phG2RaFkdVQ6Kkld71g57zZB5o.png?dl=1" title=""><img src="../../../0x00sec.s3.amazonaws.com/optimized/2X/0/02dbb55e299052975f4a1582e9bc08df43f83f8a_2_602x323.png" alt="" data-base62-sha1="phG2RaFkdVQ6Kkld71g57zZB5o" width="602" height="323" role="presentation" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/0/02dbb55e299052975f4a1582e9bc08df43f83f8a_2_602x323.png, /uploads/default/original/2X/0/02dbb55e299052975f4a1582e9bc08df43f83f8a.png 1.5x, /uploads/default/original/2X/0/02dbb55e299052975f4a1582e9bc08df43f83f8a.png 2x"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">777Ã—417 119 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>It gets accessed a few times and after 2 times of hitting run I land at <strong>loc_4017F9</strong>:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/4/4e9bbdbe3f5cdbb3e89429531903b36601fdf8fe.html" data-download-href="/uploads/short-url/bdoUPzL5KeKxDDbA3mgAiDEx8bs.png?dl=1" title=""><img src="../../uploads/default/original/2X/4/4e9bbdbe3f5cdbb3e89429531903b36601fdf8fe.html" alt="" data-base62-sha1="bdoUPzL5KeKxDDbA3mgAiDEx8bs" width="602" height="215" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">610Ã—218 13.6 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>I decided to look on the dump of the allocated area returned from <strong>VirtualAlloc</strong> and it reminded me of something Iâ€™ve seen before:<br>
<img src="../../uploads/default/original/2X/b/bce6158a02a605b95b7887c5b8343331b7881c49.html" alt="" data-base62-sha1="qX4ItOMBt7YBReA3ulY11IoCz0J" width="594" height="16" role="presentation"></p>
<p>Wait, letâ€™s check the resource section of this sample that we looked at before:<br>
<img src="../../uploads/default/original/2X/7/7d0ffdd5ebb0ce0e26658beb6dc7ff9777dc2e1b.html" alt="" data-base62-sha1="hQlWCDgLezS6fy0DqjRwGjx6LTd" width="522" height="18" role="presentation"></p>
<p>They match! hmm:<br>
<img src="../../uploads/default/original/2X/8/8ae3c774c50bb714fb1bd93237bc7cc44b37c788.html" alt="" data-base62-sha1="jOFU8xxdT6ZbHMxQjlU1rDYOzH2" width="244" height="93" role="presentation"></p>
<p>Before the call to that dynamic variable at <strong>dword_4260B4</strong> we see that another DWORD is being used located at <strong>dword_4260B4</strong>(passed to <strong>EAX</strong>). if we look at <strong>dword_4260AC</strong> in disassembler view it doesnâ€™t look like valid code:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/7/7ab856fa75bc79732f06a7f9d131dba1607f2c0e.html" data-download-href="/uploads/short-url/hvDcfdy9A2wDEm0siZCRw2SQnMi.png?dl=1" title=""><img src="../../uploads/default/original/2X/7/7ab856fa75bc79732f06a7f9d131dba1607f2c0e.html" alt="" data-base62-sha1="hvDcfdy9A2wDEm0siZCRw2SQnMi" width="602" height="264" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">690Ã—302 20.4 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>So this little invocation at <strong>0x40180E</strong> to <strong>sub_401110</strong> gives me a hutch that it might lead to a decryption of that entire resource.</p>
<p><strong>dword_4260B4</strong> holds value of <strong>0x8BB9</strong> and if we view the resource length that was mapped into <strong>dword_4260AC</strong> we can clearly see they have the same size!</p>
<p><img src="../../uploads/default/original/2X/d/dc4b570247d71f3db5812197fe7d445d3591646e.html" alt="" data-base62-sha1="vqOsqg4K9tRKFVO10Ft9wZexePA" width="242" height="25" role="presentation"></p>
<p>I decided to rename the variables and jump pass the call <strong>sub_401110</strong>(func_ResourceDecryptionRoutine) :</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/0/077bf4c7f651c9524d66d67ac2d4f828276a124a.html" data-download-href="/uploads/short-url/14cURCFGg5tlH360qVLMUVBgh5w.png?dl=1" title=""><img src="../../uploads/default/original/2X/0/077bf4c7f651c9524d66d67ac2d4f828276a124a.html" alt="" data-base62-sha1="14cURCFGg5tlH360qVLMUVBgh5w" width="354" height="265" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">354Ã—265 9.31 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>To see what will happen to the resource section that was mapped into memory I decided to place hardware breakpoints on <strong>dword_4260AC</strong> to check for memory access, after my hardware breakpoints got triggered the allocated resource view in disassembly turned into this:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/d/d1eb60dbb181cc4926b224be482676c9c5cf37f6.html" data-download-href="/uploads/short-url/tX25oSBsujGXF2mongvlbT2nuzY.png?dl=1" title=""><img src="../../../0x00sec.s3.amazonaws.com/optimized/2X/d/d1eb60dbb181cc4926b224be482676c9c5cf37f6_2_602x196.png" alt="" data-base62-sha1="tX25oSBsujGXF2mongvlbT2nuzY" width="602" height="196" role="presentation" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/d/d1eb60dbb181cc4926b224be482676c9c5cf37f6_2_602x196.png, https://0x00sec.s3.amazonaws.com/optimized/2X/d/d1eb60dbb181cc4926b224be482676c9c5cf37f6_2_903x294.png 1.5x, https://0x00sec.s3.amazonaws.com/optimized/2X/d/d1eb60dbb181cc4926b224be482676c9c5cf37f6_2_1204x392.png 2x"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">1281Ã—418 41.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Awesome!</p>
<p>So letâ€™s enter the rabbit hole and see where it leads us, but before we do that - letâ€™s dump this into memory to see whatâ€™s going exactly:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/0/0bb5bcfcd5ad4ee2238b848a7f8f665cb195bc0d.html" data-download-href="/uploads/short-url/1FACIK9dxLTGSR1DT76mgZrKAMZ.png?dl=1" title=""><img src="../../uploads/default/original/2X/0/0bb5bcfcd5ad4ee2238b848a7f8f665cb195bc0d.html" alt="" data-base62-sha1="1FACIK9dxLTGSR1DT76mgZrKAMZ" width="602" height="241" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">846Ã—340 23.3 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>IDA view of dumped shellcode:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/3/30dd2972e188d24f0cadb0ef0efc74fc56bea8c9.html" data-download-href="/uploads/short-url/6YgKRf85phjkqHHW3XaK2o46i81.png?dl=1" title=""><img src="../../uploads/default/original/2X/3/30dd2972e188d24f0cadb0ef0efc74fc56bea8c9.html" alt="" data-base62-sha1="6YgKRf85phjkqHHW3XaK2o46i81" width="602" height="316" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">720Ã—378 20.3 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Iâ€™ve analyzed the dump a bit, and found that the function called at offset <strong>0x33</strong> is where the main execution happens but unfortunately it looks like this:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/1/1f26a928ae9905671e7ffab64165f3dcba1a47d1.html" data-download-href="/uploads/short-url/4rzDb5qLKaoX7GD5NfTWG6POcGl.png?dl=1" title=""><img src="../../uploads/default/original/2X/1/1f26a928ae9905671e7ffab64165f3dcba1a47d1.html" alt="" data-base62-sha1="4rzDb5qLKaoX7GD5NfTWG6POcGl" width="125" height="422" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">125Ã—422 2.02 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Letâ€™s scroll around the IDB to see if we can find some interesting anomalies:</p>
<p>Our first encounter is at code block <strong>loc_4C:</strong></p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/e/e655b02175933a629245e759246839bea078f528.html" data-download-href="/uploads/short-url/wRDp2FfIjw9Lwv6cbmvpxkHADUI.png?dl=1" title=""><img src="../../uploads/default/original/2X/e/e655b02175933a629245e759246839bea078f528.html" alt="" data-base62-sha1="wRDp2FfIjw9Lwv6cbmvpxkHADUI" width="285" height="425" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">285Ã—425 45.3 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<hr>
<h2><a name="p-53180-trick-number-1-stack-strings-8" class="anchor" href="#p-53180-trick-number-1-stack-strings-8"></a>Trick number 1 - Stack Strings</h2>
<p>This again looks like stack strings, and they all contain a call right after the push. If weâ€™ll attempt to parse these strings manually and turn them into ASCII strings we can find something really interesting:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/e/e58cdd55f0115b52b686b7731e94cc980ca3e97e.html" data-download-href="/uploads/short-url/wKH8MOlorpBLmjqb6ctXR04qsbQ.png?dl=1" title=""><img src="../../uploads/default/original/2X/e/e58cdd55f0115b52b686b7731e94cc980ca3e97e.html" alt="" data-base62-sha1="wKH8MOlorpBLmjqb6ctXR04qsbQ" width="210" height="340" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">210Ã—340 35.1 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>First it appears to load <strong>kernel32.dll</strong> and <strong>call [ebp-28h]</strong>, Then we see a push to <strong>VirtualAlloc</strong> and a call to <strong>[ebp-60h]</strong>. Each time a new function string is pushed, <strong>[ebp-60h]</strong> is called. I have reason to suspect that <strong>[ebp-28h]</strong> is  the address of <strong>LoadLibraryA</strong> and <strong>[ebp-60h]</strong> is the address of <strong>GetProcAddress</strong>, weâ€™ll map this assumption into IDA:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/1/1805c93ce462b29fffa458172a92292a6fd4e0fe.html" data-download-href="/uploads/short-url/3qvR4a4soMAaMfCFy3uwm2qy7NQ.unknown?dl=1" title=""><img src="../../uploads/default/original/2X/1/1805c93ce462b29fffa458172a92292a6fd4e0fe.html" alt="" data-base62-sha1="3qvR4a4soMAaMfCFy3uwm2qy7NQ" width="164" height="500" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">169Ã—514 45.8 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>This mapping actually aids us to recover more artifacts from just looking at the the dumped memory statically:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/1/1c470decbca9ddc0e24c18b511f5974c14d9875b.html" data-download-href="/uploads/short-url/429Bm2H2KqbYP8lKwWoze0KPI9R.png?dl=1" title=""><img src="../../uploads/default/original/2X/1/1c470decbca9ddc0e24c18b511f5974c14d9875b.html" alt="" data-base62-sha1="429Bm2H2KqbYP8lKwWoze0KPI9R" width="174" height="323" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">174Ã—323 25.8 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Letâ€™s debug this memory dump and see if weâ€™re correct:</p>
<p><img src="../../uploads/default/original/2X/3/3d9d0b876de231710c8d57eb81a8bc0d925def94.html" alt="" data-base62-sha1="8N3AM0lzUnlDgCYg13bjaOdJA3y" width="602" height="31" role="presentation"></p>
<p><img src="../../uploads/default/original/2X/e/e72c864d3ec527f79299315e8dc6fc0a2f4082f5.html" alt="" data-base62-sha1="wZ3GJnmeKQXAjplJkaCoQnwvM0d" width="560" height="25" role="presentation"><br>
<img src="../../uploads/default/original/2X/0/0a1029876fe146b9c37fd52334826744f3c78026.html" alt="" data-base62-sha1="1r1oVHpWKVnzGp9XPQceko7Vbq6" width="602" height="31" role="presentation"><br>
<img src="../../uploads/default/original/2X/9/908af432e44ac4c5b553396f49ab1cdaed2e1d10.html" alt="" data-base62-sha1="kCGsIb3EYmSsGOEZnuYTw7EgO2I" width="598" height="13" role="presentation"><br>
Our assumptions are indeed correct!</p>
<hr>
<h2><a name="p-53180-trick-number-2-handling-dynamic-api-calls-in-ida-9" class="anchor" href="#p-53180-trick-number-2-handling-dynamic-api-calls-in-ida-9"></a>Trick Number 2 - Handling Dynamic API calls in IDA:</h2>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/5/5fccff5ec78dc79cb2fdfefc598f47a4232a59dd.html" data-download-href="/uploads/short-url/dFuz1sDOltv7qOJcSOCoeZc0vEh.png?dl=1" title=""><img src="../../uploads/default/original/2X/5/5fccff5ec78dc79cb2fdfefc598f47a4232a59dd.html" alt="" data-base62-sha1="dFuz1sDOltv7qOJcSOCoeZc0vEh" width="267" height="158" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">267Ã—158 17.5 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>So we have this issue, The base address of <strong>TerminateProcess</strong> is going to placed in <strong>[ebp-0ACH]</strong> as we can see on the last line(Iâ€™m assuming you guys know that in the <strong>stdcall</strong> convention, the return value is returned in <strong>EAX</strong> and that you know what <strong>GetProcAddress</strong> does). We canâ€™t go and manually map each and one of these by clicking K on each local variable like some potato, we must edit the function so that IDA will know that any time the <strong>EBP</strong> register is being access using offsets its actually accessing local variables so letâ€™s tell IDA itâ€™s an <strong>EBP</strong> based function:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/c/c609528e77e4bc4500839cd8c5e2d303ca828276.html" data-download-href="/uploads/short-url/sfUvLZgf74hWakvDPfCv5wT7ftY.png?dl=1" title=""><img src="../../../0x00sec.s3.amazonaws.com/optimized/2X/c/c609528e77e4bc4500839cd8c5e2d303ca828276_2_217x303.png" alt="" data-base62-sha1="sfUvLZgf74hWakvDPfCv5wT7ftY" width="217" height="303" role="presentation" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/c/c609528e77e4bc4500839cd8c5e2d303ca828276_2_217x303.png, https://0x00sec.s3.amazonaws.com/optimized/2X/c/c609528e77e4bc4500839cd8c5e2d303ca828276_2_325x454.png 1.5x, /uploads/default/original/2X/c/c609528e77e4bc4500839cd8c5e2d303ca828276.png 2x"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">384Ã—535 19.5 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Letâ€™s click edit function and mark the function as <strong>EBP</strong> based:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/0/062473b384e8ca402e17b87d71c63739928b801f.html" data-download-href="/uploads/short-url/SkXGW1Wh5KzZSLQ6jvEwsXOTj9.png?dl=1" title=""><img src="../../uploads/default/original/2X/0/062473b384e8ca402e17b87d71c63739928b801f.html" alt="" data-base62-sha1="SkXGW1Wh5KzZSLQ6jvEwsXOTj9" width="338" height="242" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">532Ã—380 20.1 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Now we can rename all the local variables and see the changes get applied all across the IDB! So letâ€™s fix the dynamic API resolving local variables and keep searching for anomalies. I didnâ€™t find anything worthwhile so I decided to place a breakpoint on <strong>VirtualAlloc</strong> and see what happens and indeed we broke on offset <strong>0x1B8</strong>:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/7/720552a43b53a7f5eb4f42a5f63b1581ae497c80.html" data-download-href="/uploads/short-url/ggFPOuNVy46KvFtSCUnoSqERIbe.png?dl=1" title=""><img src="../../uploads/default/original/2X/7/720552a43b53a7f5eb4f42a5f63b1581ae497c80.html" alt="" data-base62-sha1="ggFPOuNVy46KvFtSCUnoSqERIbe" width="379" height="221" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">379Ã—221 4.5 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Iâ€™ve access the dump of the newly allocated memory which is passed into <strong>var_10</strong>.</p>
<p>Letâ€™s set up a hardware breakpoint on the first DWORD of the allocated memory and see if it gets accessed:</p>
<p><img src="../../uploads/default/original/2X/f/f41a58c2c4f2bf1179ab06d7ec4c11def40d46d7.html" alt="" data-base62-sha1="yPqWVgoZBtdJSh5GdE4Rgk6IPt5" width="589" height="14" role="presentation"></p>
<hr>
<h2><a name="p-53180-trick-number-3-dumping-pe-files-from-memory-10" class="anchor" href="#p-53180-trick-number-3-dumping-pe-files-from-memory-10"></a>Trick number 3 - Dumping PE files from memory:</h2>
<p>It does, and with a promising <strong>MZ</strong> signature that might indicate that a new file is being mapped, now we have to be careful here because I only set a breakpoint on the first <strong>DWORD</strong> of <strong>0x1EB0000</strong> - if we execute another time we will lose control over the malware, When I did that by accident the malware began to start an infinite amount of threads to circumvent our analysis and crash the vm!</p>
<p>We are currently executing at offset <strong>0x9B2</strong> inside <strong>sub_978</strong> and if we look in IDA at how complicated this function is weâ€™ll have to collect our jaw from the floor:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/c/c3c16559bde805e0354a6e61e7280808a4b01f31.html" data-download-href="/uploads/short-url/rVJsf6O0f5tto07XaqguRrkFtVn.png?dl=1" title=""><img src="../../uploads/default/original/2X/c/c3c16559bde805e0354a6e61e7280808a4b01f31.html" alt="" data-base62-sha1="rVJsf6O0f5tto07XaqguRrkFtVn" width="349" height="448" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">349Ã—448 3.41 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Letâ€™s assume the <strong>MZ</strong> signature is no coincidence and a PE file is being mapped into memory, maybe if we find where this loop end and break there, we might successfully map the file entirely and then we can dump it!</p>
<p><strong>sub_978</strong> ends at <strong>loc_BBA</strong>:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/d/d3c8f1583914a8e9ef620fde02bcb92892169baa.html" data-download-href="/uploads/short-url/udxgniGSNLNsR0GFbLbhOhTJqT8.png?dl=1" title=""><img src="../../uploads/default/original/2X/d/d3c8f1583914a8e9ef620fde02bcb92892169baa.html" alt="" data-base62-sha1="udxgniGSNLNsR0GFbLbhOhTJqT8" width="181" height="354" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">181Ã—354 13.3 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>so letâ€™s set up a breakpoint there and see what happens:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/c/c26a13cbef0b6c4f699ec008e853bf5dbe393dd5.html" data-download-href="/uploads/short-url/rJRTJmWTBJqqJHIVZIYEmJc0A2F.png?dl=1" title=""><img src="../../uploads/default/original/2X/c/c26a13cbef0b6c4f699ec008e853bf5dbe393dd5.html" alt="" data-base62-sha1="rJRTJmWTBJqqJHIVZIYEmJc0A2F" width="592" height="169" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">592Ã—169 7.35 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>We were correct!</p>
<p>Before we continue execution letâ€™s dump this PE using Scylla and see how IDA will parse it:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/e/e40826c10505487b95d60847d3fce2be0c56ab06.html" data-download-href="/uploads/short-url/wxgkiZ2hSUkJOdQdKlbbmswwVj8.png?dl=1" title=""><img src="../../uploads/default/original/2X/e/e40826c10505487b95d60847d3fce2be0c56ab06.html" alt="" data-base62-sha1="wxgkiZ2hSUkJOdQdKlbbmswwVj8" width="602" height="317" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">837Ã—441 30.8 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>I have seen this before, but only in books. This anti disassembly at its finest. It attempts to trick IDAâ€™s disassembler by creating these faulty jump instructions that will just into the middle of other parsed instructions - IDA doesnâ€™t know how to deal with this so it will begin parsing instructions incorrectly. We will deal with this later as we are not done with the first binary.</p>
<hr>
<h2><a name="p-53180-trick-number-4-self-loading-heavy-waves-of-nostalgia-intensifieshttpsdanusminimusgithubioanalyzing-modern-malware-techniques-part-1-11" class="anchor" href="#p-53180-trick-number-4-self-loading-heavy-waves-of-nostalgia-intensifieshttpsdanusminimusgithubioanalyzing-modern-malware-techniques-part-1-11"></a>Trick number 4 - Self Loading, <a href="../../../external.html?link=https://danusminimus.github.io/Analyzing-Modern-Malware-Techniques-Part-1/" rel="noopener nofollow ugc">[heavy waves of nostalgia intensifies]</a></h2>
<p>Letâ€™s go back to x64dbg, after we leave the mapping function we are supposed to land at offset <strong>0x1E0</strong>. Our next anomaly will be met at location <strong>0x1F8</strong> where a <strong>VirtualProtect</strong> call is being made:</p>
<p><img src="../../uploads/default/original/2X/1/18c23c41872bf7c37faeb4fad119e6504831b597.html" alt="" data-base62-sha1="3x1BC0AxLoiCupEk7l5nQusF6dx" width="602" height="12" role="presentation"></p>
<p><img src="../../uploads/default/original/2X/3/3335ae4a14f2af1929e63d35333175822a6e51b3.html" alt="" data-base62-sha1="7j1mq2WbxcAApU29YtkqzQ4dku7" width="294" height="55" role="presentation"></p>
<p>On the base address of the main image? what?</p>
<p><img src="../../uploads/default/original/2X/e/ed55c02f4e43539ddfaae6bf1a7276ae7a5960d1.html" alt="" data-base62-sha1="xRySAUDyFByadw8JI68VxumaB8Z" width="602" height="11" role="presentation"></p>
<p>If we execute the call, the <strong>.text</strong> section which is responsible for storing the code of the PE file has its memory protection changed. It can now be Read from, Executed and WRITTEN TO, that is not supposed to happen! letâ€™s see what happens next:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/2/2426c34ca352804fbb045d9d98716ebca631a904.html" data-download-href="/uploads/short-url/59OeL1Q0ZVij3sjRI9V9tvnKUhC.png?dl=1" title=""><img src="../../uploads/default/original/2X/2/2426c34ca352804fbb045d9d98716ebca631a904.html" alt="" data-base62-sha1="59OeL1Q0ZVij3sjRI9V9tvnKUhC" width="269" height="483" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">269Ã—483 5.35 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>We enter a <strong>sub_BDD</strong> and if we view the functions behavior in the debugger, we can see that <a href="../../../external.html?link=http://faydoc.tripod.com/cpu/stosb.htm" rel="noopener nofollow ugc">rep stosb</a> instruction will begin to copy the zeroes stored in <strong>AL</strong> to replace the value of addresses pointed by <strong>EDI</strong>. <strong>EDI</strong> is pointing to the code section of the main sample! Itâ€™s rewriting its own code section wow!</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/0/07fb4132517bec065810456202168f04534f9b86.html" data-download-href="/uploads/short-url/18BEtWb3uDGYEMtOmLlBhdUCAv4.png?dl=1" title=""><img src="../../../0x00sec.s3.amazonaws.com/optimized/2X/0/07fb4132517bec065810456202168f04534f9b86_2_602x369.png" alt="" data-base62-sha1="18BEtWb3uDGYEMtOmLlBhdUCAv4" width="602" height="369" role="presentation" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/0/07fb4132517bec065810456202168f04534f9b86_2_602x369.png, https://0x00sec.s3.amazonaws.com/optimized/2X/0/07fb4132517bec065810456202168f04534f9b86_2_903x553.png 1.5x, /uploads/default/original/2X/0/07fb4132517bec065810456202168f04534f9b86.png 2x"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">1163Ã—714 104 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div>Itâ€™s gone!</p>
<p>Iâ€™m going to assume that the malware will copy the newly mapped PE into the code section of the current executing binary. letâ€™s see if our assumption is correct.</p>
<p>When we exit the function <strong>sub_BDD</strong> we land at offset <strong>0x220</strong>:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/1/19eeebf72a2df8a1f89d1e812b0520c0532fb324.html" data-download-href="/uploads/short-url/3HpP6kNi2f2Wt77sTx2ircyvpm4.png?dl=1" title=""><img src="../../../0x00sec.s3.amazonaws.com/optimized/2X/1/19eeebf72a2df8a1f89d1e812b0520c0532fb324_2_602x163.png" alt="" data-base62-sha1="3HpP6kNi2f2Wt77sTx2ircyvpm4" width="602" height="163" role="presentation" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/1/19eeebf72a2df8a1f89d1e812b0520c0532fb324_2_602x163.png, https://0x00sec.s3.amazonaws.com/optimized/2X/1/19eeebf72a2df8a1f89d1e812b0520c0532fb324_2_903x244.png 1.5x, /uploads/default/original/2X/1/19eeebf72a2df8a1f89d1e812b0520c0532fb324.png 2x"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">1056Ã—286 36.8 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>If we keep stepping over instructions we begin to see the string <strong>â€œ.textâ€</strong>, which gives me a hutch that weâ€™re are traversing through the PE Header format of the current executing binary and come to think of it, if we look at offset <strong>0x22c</strong> we see:</p>
<p><img src="../../uploads/default/original/2X/4/47e3135611c91e707fd701fca3e8a496efb49843.html" alt="" data-base62-sha1="afWpgndXgEnOGb3O0MfnIPJk9s7" width="214" height="23" role="presentation"></p>
<p>And I know that <strong>3Ch</strong> is the <strong>e_lfanew</strong> field in the PE File header format, hmm.. Lets trying to map this in IDA and see if this assumption makes any sense:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/e/e85f9b99e6e3a1498e2aea502a1d9aae050a8860.html" data-download-href="/uploads/short-url/x9FBWkfIRpgwNGOZRlS1A6akHZK.png?dl=1" title=""><img src="../../uploads/default/original/2X/e/e85f9b99e6e3a1498e2aea502a1d9aae050a8860.html" alt="" data-base62-sha1="x9FBWkfIRpgwNGOZRlS1A6akHZK" width="422" height="373" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">422Ã—373 80.4 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Itâ€™s actually traversing through the newly mapped PE file!</p>
<p>I mapped it and now will explain how this entire process is done:</p>
<pre><code>mov eax, [ebp+lpvoidVirtualMemory]
mov [ebp+lpVoidNewMappedPE], eax
mov eax, [ebp+lpVoidNewMappedPE]
mov eax, [eax+_IMAGE_DOS_HEADER.e_lfanew] ; Get the value of e_lfanew
mov ecx, [ebp+lpvoidVirtualMemory] ; Get Image base of the newly mapped PE
lea eax, [ecx+eax+4] ; Access IMAGE_NT_HEADERS by adding e_lfawnew to the image base of the newly mapped PE
mov [ebp+_IMAGE_NT_HEADERS], eax ; Save the address of _IMAGE_NT_HEADERS of the newly mapped PE
</code></pre>
<hr>
<pre><code>mov eax, [ebp+_IMAGE_NT_HEADERS]
movzx eax, [eax+IMAGE_FILE_HEADER.SizeOfOptionalHeader] ; Get the size of _IMAGE_OPTIONAL_HEADERS from the newly mapped PE
mov ecx, [ebp+lpVoidNewMappedPE]
mov ecx, [ecx+_IMAGE_DOS_HEADER.e_lfanew]
lea eax, [ecx+eax+18h] ; Skip to the first section of the newly mapped PE
</code></pre>
<hr>
<pre><code>push [eax+_IMAGE_SECTION_HEADER.PointerToRawData] ; Push the address of the first section of the new mapped PE
push [ebp+lpVoidNewMappedPE] ; Push the Image base address of the newly mapped PE
push [ebp+lpvoidBaseAddressOfCurrentPE] ; Push the base address of the current PE
call sub_BF6
</code></pre>
<p>Now letâ€™s make another assumption - after the call to <strong>sub_BF6</strong> at offset <strong>0x21B</strong> the code section of the current PE will be replaced with the code section of the new mapped PE.</p>
<p>And that is incorrect! Fortunately I put a hardware breakpoint on the the code section of the current PE before I continued execution and the copying actually occurred at offset <strong>0x326</strong> instead of <strong>0x21B</strong> BUT with a call to <strong>sub_BF6</strong> so I was kinda right :), so letâ€™s put a breakpoint at the return instruction out of this function and see what happened to the code section:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/2/229dfbc8a4c22fcf56f684504bfe1ccd5751bbee.html" data-download-href="/uploads/short-url/4WeI9uNpz2b9Wm1coOQpMVhQsvI.png?dl=1" title=""><img src="../../uploads/default/original/2X/2/229dfbc8a4c22fcf56f684504bfe1ccd5751bbee.html" alt="" data-base62-sha1="4WeI9uNpz2b9Wm1coOQpMVhQsvI" width="587" height="152" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">587Ã—152 11.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/2/20f5a8d6bb7656696aefac516e4dc5dfc11ad70f.html" data-download-href="/uploads/short-url/4HzBkIdrxoW3reJpXqEJJOtQAwf.png?dl=1" title=""><img src="../../uploads/default/original/2X/2/20f5a8d6bb7656696aefac516e4dc5dfc11ad70f.html" alt="" data-base62-sha1="4HzBkIdrxoW3reJpXqEJJOtQAwf" width="594" height="162" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">594Ã—162 13 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Very cool, but this code looks really strange because if we view it in disassembly it looks nothing like what we dumped to IDA before:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/f/ff9f9ae538a8f56ca472ab94882091bb04b0931c.html" data-download-href="/uploads/short-url/AtlHQAqfqKa3MCAGn1vTOxTzfje.png?dl=1" title=""><img src="../../uploads/default/original/2X/f/ff9f9ae538a8f56ca472ab94882091bb04b0931c.html" alt="" data-base62-sha1="AtlHQAqfqKa3MCAGn1vTOxTzfje" width="602" height="388" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">615Ã—396 22.3 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Letâ€™s keep going to see if it might change. Our next anomaly is at offset <strong>0x358</strong>:</p>
<p><img src="../../uploads/default/original/2X/1/14db48ff08b85b45923a5a61edea9a6230688f4c.html" alt="" data-base62-sha1="2YvmFAvYzVRcorh0nxqWud40MTq" width="548" height="14" role="presentation"></p>
<p><img src="../../uploads/default/original/2X/3/3f098a356b4173f5c13ebd591dc77d7181d1654f.html" alt="" data-base62-sha1="8ZEwdQDKz7inGumRb1kmVtlFdmv" width="213" height="69" role="presentation"></p>
<p>The newly mapped PE gets freeâ€™d from memory, alright this is promising letâ€™s see what happens afterwards.</p>
<p>The last anomaly that occurs is at the bottom of the function we encountered when we started analyzing this shellcode(<strong>sub_3C</strong>):</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/2/232ddf658b0beaa5703f07cfb6ebf2182871ddc6.html" data-download-href="/uploads/short-url/51cZzFyKtxhw2GS3zRIKik5W4Oq.png?dl=1" title=""><img src="../../uploads/default/original/2X/2/232ddf658b0beaa5703f07cfb6ebf2182871ddc6.html" alt="" data-base62-sha1="51cZzFyKtxhw2GS3zRIKik5W4Oq" width="355" height="293" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">355Ã—293 25.1 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>A call to <a href="../../../external.html?link=https://docs.microsoft.com/en-us/cpp/c-runtime-library/reference/atexit?view=vs-2019" rel="noopener nofollow ugc"><strong>atexit</strong></a>:</p>
<blockquote>
<p>â€œProcesses the specified function at exit.â€</p>
<p>int atexit(</p>
<p>void (__cdecl *func )( void )</p>
<p>);</p>
</blockquote>
<p>This function will execute a callback function that will trigger when the process will exit.<br>
So what was the last value pushed into the stack?<br>
<img src="../../uploads/default/original/2X/3/3cf084155b0ee8bb1a5b5e2b78fc3e7890899a8c.html" alt="" data-base62-sha1="8H5WYHuHh4y4Iy9xLFj1iqjBytS" width="150" height="16" role="presentation"><br>
Itâ€™s an address, lets follow it:</p>
<p><img src="../../uploads/default/original/2X/c/c4caf550a94577efd8229edd73a160efe7952b8c.html" alt="" data-base62-sha1="s4Uq3yfGCkKITs3udHQKymuayjq" width="597" height="52" role="presentation"></p>
<p>Itâ€™s going to terminate itself upon function exit, alright but is that it? well, not exactly.. at location <strong>loc_811</strong>:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/5/5ccc3e885e606f05442a6ab96e18ad5e8089d522.html" data-download-href="/uploads/short-url/deVw9wOEzNsuYam8YZXshNQeNea.png?dl=1" title=""><img src="../../uploads/default/original/2X/5/5ccc3e885e606f05442a6ab96e18ad5e8089d522.html" alt="" data-base62-sha1="deVw9wOEzNsuYam8YZXshNQeNea" width="342" height="190" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">342Ã—190 18 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>We jump to a different shellcode located inside the code section of our PE:<br>
<img src="../../uploads/default/original/2X/0/0200dc4260b788582a2a416157d1622b6d97ad9e.html" alt="" data-base62-sha1="hINuIqlYygXD1Gz3w22uH82qUm" width="298" height="23" role="presentation"></p>
<p>Letâ€™s look at the newly mapped PE that we dumped in IDA at this location:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/6/61a5fe5ae5d70195e85e77e45ab83bd0975456ca.html" data-download-href="/uploads/short-url/dVPXa2WvWPzflvdy03JSGhuo7Oi.png?dl=1" title=""><img src="../../uploads/default/original/2X/6/61a5fe5ae5d70195e85e77e45ab83bd0975456ca.html" alt="" data-base62-sha1="dVPXa2WvWPzflvdy03JSGhuo7Oi" width="602" height="147" role="presentation"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">803Ã—195 5.86 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div><br>
We compare it to the address stored in EAX:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/9/94a6b866c5bad0a2d276f352fbd6f28abe9038ff.html" data-download-href="/uploads/short-url/ld1RswTb55O5uVp3IYQkwPJ6ear.png?dl=1" title=""><img src="../../../0x00sec.s3.amazonaws.com/optimized/2X/9/94a6b866c5bad0a2d276f352fbd6f28abe9038ff_2_602x113.png" alt="" data-base62-sha1="ld1RswTb55O5uVp3IYQkwPJ6ear" width="602" height="113" role="presentation" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/9/94a6b866c5bad0a2d276f352fbd6f28abe9038ff_2_602x113.png, https://0x00sec.s3.amazonaws.com/optimized/2X/9/94a6b866c5bad0a2d276f352fbd6f28abe9038ff_2_903x169.png 1.5x, /uploads/default/original/2X/9/94a6b866c5bad0a2d276f352fbd6f28abe9038ff.png 2x"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename"></span><span class="informations">1074Ã—202 19.2 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
<p>Ah, this explains the reason we saw garbage code when we looked at it when it was first mapped to the code section, its because the address of entry point of this code section is actually at offset <strong>0x2B87</strong>!</p>
<hr>
<p>Alright, letâ€™s stop for a second and take a breather.</p>
<h2><a name="p-53180-summary-12" class="anchor" href="#p-53180-summary-12"></a>Summary:</h2>
<p>In this small blog we covered 5 neat techniques:</p>
<ul>
<li>Resource embedded code</li>
<li>Stack strings</li>
<li>Dynamic API Resolving</li>
<li>Loading PE files dynamically</li>
<li>Self loading code</li>
</ul>
<p>Again, sadly - Iâ€™ll have to break this post into two parts since it already become to long but I hope this helped and aided your analysis toolkit. On the next part weâ€™ll be analyzing the dumped PE file and circumventing itâ€™s anti reverse engineering tricks.</p>
<p>Till next time!</p>
<hr>
<h2><a name="p-53180-sources-13" class="anchor" href="#p-53180-sources-13"></a>Sources:</h2>
<p><a href="../../../external.html?link=https://www.hybrid-analysis.com/sample/3d2777b748e805c0463c0c6d0fef8280ad197bea1dd0a25e30ed71199989a6b9?environmentId=100" class="onebox" target="_blank" rel="noopener nofollow ugc">https://www.hybrid-analysis.com/sample/3d2777b748e805c0463c0c6d0fef8280ad197bea1dd0a25e30ed71199989a6b9?environmentId=100</a></p>
<aside class="onebox allowlistedgeneric" data-onebox-src="../../../external.html?link=https://maltiverse.com/dashboards/newioc">
  <header class="source">
      <img src="../../../external.html?link=https://maltiverse.com/dashboards/favicon.ico" class="site-icon" alt="" width="" height="">

      <a href="../../../external.html?link=https://maltiverse.com/dashboards/newioc" target="_blank" rel="noopener nofollow ugc">maltiverse.com</a>
  </header>

  <article class="onebox-body">
    

<h3><a href="../../../external.html?link=https://maltiverse.com/dashboards/newioc" target="_blank" rel="noopener nofollow ugc">Maltiverse</a></h3>



  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<aside class="onebox allowlistedgeneric" data-onebox-src="../../../external.html?link=https://learn.microsoft.com/en-us/">
  <header class="source">

      <a href="../../../external.html?link=https://learn.microsoft.com/en-us/" target="_blank" rel="noopener nofollow ugc">learn.microsoft.com</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/362;"><img src="../../../learn.microsoft.com/en-us/media/open-graph-image.png" class="thumbnail" alt="" width="690" height="362"></div>

<h3><a href="../../../external.html?link=https://learn.microsoft.com/en-us/" target="_blank" rel="noopener nofollow ugc">Microsoft Learn: Build skills that open doors in your career</a></h3>

  <p>Gain technical skills through documentation and training, earn certifications and connect with the community</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p><a href="../../../external.html?link=https://www.youtube.com/channel/UC--DwaiMV-jtO-6EvmKOnqg" class="onebox" target="_blank" rel="noopener nofollow ugc">https://www.youtube.com/channel/UC--DwaiMV-jtO-6EvmKOnqg</a></p>
<aside class="onebox allowlistedgeneric" data-onebox-src="../../../external.html?link=https://malpedia.caad.fkie.fraunhofer.de/details/win.smokeloader">
  <header class="source">
      <img src="../../../0x00sec.s3.amazonaws.com/original/3X/3/3/33e94c148a89c675fb8241f5cc23e04d91c8593b.png" class="site-icon" alt="" data-dominant-color="" width="36" height="36">

      <a href="../../../external.html?link=https://malpedia.caad.fkie.fraunhofer.de/details/win.smokeloader" target="_blank" rel="noopener nofollow ugc">malpedia.caad.fkie.fraunhofer.de</a>
  </header>

  <article class="onebox-body">
    

<h3><a href="../../../external.html?link=https://malpedia.caad.fkie.fraunhofer.de/details/win.smokeloader" target="_blank" rel="noopener nofollow ugc">SmokeLoader (Malware Family)</a></h3>

  <p>The SmokeLoader family is a generic backdoor with a range of capabilities which depend on the modules included in any given build of the malware. The malware is delivered in a variety of ways and is broadly associated with criminal activity. The...</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="8" />
              <span class='post-likes'>8 Likes</span>
            </div>


            
          </div>
          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/system.html'><span itemprop='name'>system</span></a>
                (system)
                  Closed 
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2020-06-18T14:31:03Z' class='post-time'>
                    June 18, 2020,  2:31pm
                  </time>
                  <meta itemprop='dateModified' content='2020-06-18T14:31:03Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>This topic was automatically closed after 121 days. New replies are no longer allowed.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
    </div>


    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../index.html' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../categories.html' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../guidelines.html' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../tos.html' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../privacy.html' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    <script src="../../../external.html?link=http://instant.page/3.0.0" type="module" defer="" integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1" nonce="OintPUh5OOa9arsEXanZexfOT"></script>
  </body>
  
</html>
