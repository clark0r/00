<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Zero2Auto - CruLoader - Malware - 0x00sec - The Home of the Hacker</title>
    <meta name="description" content="Zero2Auto - CruLoader
Preface
As part of the course we were instructed to analyze a custom malware sample developed for us, below is a full analysis of that sample plus a an automated script to extract the final payload &amp;hellip;">
    <meta name="generator" content="Discourse 3.6.0.beta2-latest - https://github.com/discourse/discourse version 3b1964f3ed8bdc2f181e2abccb1b116e4b814db5">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.html">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.html">
<meta name="theme-color" media="all" content="#171616">

<meta name="color-scheme" content="dark">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="22420.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">

    
    <link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4.css_%3b%20filename_%3dUTF-8%27%27color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" class="light-scheme" data-scheme-id="15"/>

<link href="../../stylesheets/common_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27common_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common"  />

  <link href="../../stylesheets/mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile"  />
  <link href="../../stylesheets/desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop"  />



    <link href="../../stylesheets/chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="chat"  />
    <link href="../../stylesheets/checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="checklist"  />
    <link href="../../stylesheets/discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-cakeday"  />
    <link href="../../stylesheets/discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="../../stylesheets/discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="../../stylesheets/discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="../../stylesheets/discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="../../stylesheets/discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="../../stylesheets/discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-solved"  />
    <link href="../../stylesheets/discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-templates"  />
    <link href="../../stylesheets/discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-topic-voting"  />
    <link href="../../stylesheets/docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="../../stylesheets/footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="../../stylesheets/poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="poll"  />
    <link href="../../stylesheets/spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="../../stylesheets/chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="chat_mobile"  />
    <link href="../../stylesheets/discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-solved_mobile"  />
    <link href="../../stylesheets/discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-topic-voting_mobile"  />
    <link href="../../stylesheets/chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="chat_desktop"  />
    <link href="../../stylesheets/discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="discourse-topic-voting_desktop"  />
    <link href="../../stylesheets/poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="poll_desktop"  />

  <link href="../../stylesheets/common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960db.css_%3b%20filename_%3dUTF-8%27%27common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960dba97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="57" data-theme-name="0x00sec-v2"/>
    <link href="../../stylesheets/mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38.css_%3b%20filename_%3dUTF-8%27%27mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile_theme" data-theme-id="4" data-theme-name="mobile chrome"/>
    <link href="../../stylesheets/desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2"/>

    <link rel="stylesheet" href="../../../external.html?link=https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="../../../external.html?link=https://s3.amazonaws.com/0x00sec/highlight.pack.js" nonce="uDXpzoDAVQATvRC9OcWRnDM7j"></script>
<script defer="" src="../../theme-javascripts/05954ff525aceb8daa8b585f92d758d311ae7077.js_%3b%20filename_%3dUTF-8%27%2705954ff525aceb8daa8b585f92d758d311ae7077a97f.js?__ws=d.clarkee.co.uk" data-theme-id="40" nonce="uDXpzoDAVQATvRC9OcWRnDM7j"></script>
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Zero2Auto - CruLoader&#39;" href="22420.rss" />
    <meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://0x00sec.s3.amazonaws.com/original/2X/b/b1a8cdf8d0fc23d4e49e45a57570128aa04761f5.png" />
<meta property="og:image" content="https://0x00sec.s3.amazonaws.com/original/2X/b/b1a8cdf8d0fc23d4e49e45a57570128aa04761f5.png" />
<meta property="og:url" content="https://d.clarkee.co.uk/t/zero2auto-cruloader/22420" />
<meta name="twitter:url" content="https://d.clarkee.co.uk/t/zero2auto-cruloader/22420" />
<meta property="og:title" content="Zero2Auto - CruLoader" />
<meta name="twitter:title" content="Zero2Auto - CruLoader" />
<meta property="og:description" content="Zero2Auto - CruLoader Preface As part of the course we were instructed to analyze a custom malware sample developed for us, below is a full analysis of that sample plus a an automated script to extract the final payload of that sample.   Hi there,  During an ongoing investigation, one of our IR team members managed to locate an unknown sample on an infected machine belonging to one of our clients. We cannot pass that sample onto you currently as we are still analyzing it to determine what data w..." />
<meta name="twitter:description" content="Zero2Auto - CruLoader Preface As part of the course we were instructed to analyze a custom malware sample developed for us, below is a full analysis of that sample plus a an automated script to extract the final payload of that sample.   Hi there,  During an ongoing investigation, one of our IR team members managed to locate an unknown sample on an infected machine belonging to one of our clients. We cannot pass that sample onto you currently as we are still analyzing it to determine what data w..." />
<meta property="og:article:section" content="Malware" />
<meta property="og:article:section:color" content="F7941D" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="5 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="3 ‚ù§" />
<meta property="article:published_time" content="2020-07-26T12:37:39+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    <div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">
  <!--<a href="https://git.0x00sec.org" class="dow-menu">GitLab</a>  
  <a href="https://blog.0x00sec.org/irc" class="dow-menu">IRC</a>!-->
  <a href="../../../external.html?link=https://init.0x00sec.org/" class="dow-menu">Init</a>
  <a href="../../../external.html?link=https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
  <a href="../../../external.html?link=https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
    <header>
  <a href="../../index.html">0x00sec - The Home of the Hacker</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="22420.html">Zero2Auto - CruLoader</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/malware/56.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #F7941D'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Malware</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='../../../external.html?link=http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Zero2Auto - CruLoader'>
      <link itemprop='url' href='22420.html'>
      <meta itemprop='datePublished' content='2020-07-26T12:37:38Z'>
        <meta itemprop='articleSection' content='Malware'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
        <meta itemprop='name' content='0x00sec - The Home of the Hacker'>
          <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
            <meta itemprop='url' content='../../uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.html'>
          </div>
      </div>


          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/Danus.html'><span itemprop='name'>Danus</span></a>
                
              </span>

                <link itemprop="mainEntityOfPage" href="22420.html">

                <link itemprop="image" href="../../../0x00sec.s3.amazonaws.com/original/2X/b/b1a8cdf8d0fc23d4e49e45a57570128aa04761f5.png">

              <span class="crawler-post-infos">
                  <time  datetime='2020-07-26T12:37:39Z' class='post-time'>
                    July 26, 2020, 12:37pm
                  </time>
                  <meta itemprop='dateModified' content='2020-07-27T01:45:17Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <h1>Zero2Auto - CruLoader</h1>
<h2>Preface</h2>
<p>As part of the course we were instructed to analyze a custom malware sample developed for us, below is a full analysis of that sample plus a an automated script to extract the final payload of that sample.</p>
<hr>
<p>Hi there,</p>
<p>During an ongoing investigation, one of our IR team members managed to locate an unknown sample on an infected machine belonging to one of our clients. We cannot pass that sample onto you currently as we are still analyzing it to determine what data was exfilatrated. However, one of our backend analysts developed a YARA rule based on the malware packer, and we were able to locate a similar binary that seemed to be an earlier version of the sample we‚Äôre dealing with. Would you be able to take a look at it? We‚Äôre all hands on deck here, dealing with this situation, and so we are unable to take a look at it ourselves.<br>
We‚Äôre not too sure how much the binary has changed, though developing some automation tools might be a good idea, in case the threat actors behind it start utilizing something like Cutwail to push their samples.<br>
I have uploaded the sample alongside this email.</p>
<p>Thanks, and Good Luck!</p>
<hr>
<h2>Basic Static &amp; Dynamic Anaylsis</h2>
<h3>Sample information:</h3>
<p>SHA-256: <strong>[Redacted]</strong></p>
<p>Intezer: <strong>[Redacted]</strong></p>
<p>Any.run:<br>
<strong>[Redacted]</strong></p>
<p>VirusTotal:<br>
<strong>[Redacted]</strong></p>
<p>We begin by running the sample in a sandboxed environment like any.run. We can immediately see that this process launches itself and <strong>svchost</strong> as a sub process. This can also be confirmed within Intezer, and in Intezer one can examine the strings contained within each sub process. We can assume there is process injection happening.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/b/b1a8cdf8d0fc23d4e49e45a57570128aa04761f5.png" data-download-href="/uploads/short-url/plEaOqHnm5EWokcvloDHXLfTEIl.png?dl=1" title="" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/optimized/2X/b/b1a8cdf8d0fc23d4e49e45a57570128aa04761f5_2_624x275.png" alt="" data-base62-sha1="plEaOqHnm5EWokcvloDHXLfTEIl" width="624" height="275" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/b/b1a8cdf8d0fc23d4e49e45a57570128aa04761f5_2_624x275.png, https://0x00sec.s3.amazonaws.com/original/2X/b/b1a8cdf8d0fc23d4e49e45a57570128aa04761f5.png 1.5x, https://0x00sec.s3.amazonaws.com/original/2X/b/b1a8cdf8d0fc23d4e49e45a57570128aa04761f5.png 2x" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/b/b1a8cdf8d0fc23d4e49e45a57570128aa04761f5_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">691√ó304 16.2 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/2/2ee00225c612a4379738873b451952704d24068f.png" alt="" data-base62-sha1="6GFTLiiqyQSaDRLcLeTlaxwOmsv" width="499" height="277"></p>
<p>Regarding any connection made to outer servers, we can see that <strong><a href="../../../external.html?link=http://pastebin.com/" rel="noopener nofollow ugc">pastebin.com</a></strong> is being contacted.</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/e/e884dc4d7798ff6f2d13222759e36be62784d9ea.png" alt="" data-base62-sha1="xaXqnUpfpmd5l2tXPaaxMsWwOqS" width="470" height="187"></p>
<p>There is a suspicious looking resource within the resource section:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/4/46b5e4467690252f63a0abba2f5b8706205d5f01.png" data-download-href="/uploads/short-url/a5x7H2VLDPXHM1u3Ey8JN58V7t7.png?dl=1" title="" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/4/46b5e4467690252f63a0abba2f5b8706205d5f01.png" alt="" data-base62-sha1="a5x7H2VLDPXHM1u3Ey8JN58V7t7" width="624" height="47" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/4/46b5e4467690252f63a0abba2f5b8706205d5f01_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">952√ó71 8.98 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p>Before the sandbox quit on <strong>Any.run</strong> ‚Äì one can see a strange looking <strong>MessageBox</strong> string.</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/9/9b82fd7fe8fbd681647d921b3daf78784480deda.png" alt="" data-base62-sha1="mbIEuTJ8RkO3Z6IVJ2jvuzPWS8i" width="500" height="187"></p>
<p>Finally, the strings found in all first 3 loaded process appear to encrypt, and this can be easily confirmed within Intezer:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/8/881cfec6655148e529ac1545df4967c9700f10cf.png" alt="" data-base62-sha1="jq73AJfTlBgOEZ7SkMLeWXIkr8P" width="239" height="158"><br>
<div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/1/1746ab522653854d36bb541912582bf170525ca1.png" data-download-href="/uploads/short-url/3jUoaTpnEaPY1OEOs59lFYeO3ct.png?dl=1" title="" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/optimized/2X/1/1746ab522653854d36bb541912582bf170525ca1_2_261x160.png" alt="" data-base62-sha1="3jUoaTpnEaPY1OEOs59lFYeO3ct" width="261" height="160" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/1/1746ab522653854d36bb541912582bf170525ca1_2_261x160.png, https://0x00sec.s3.amazonaws.com/optimized/2X/1/1746ab522653854d36bb541912582bf170525ca1_2_391x240.png 1.5x, https://0x00sec.s3.amazonaws.com/optimized/2X/1/1746ab522653854d36bb541912582bf170525ca1_2_522x320.png 2x" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/1/1746ab522653854d36bb541912582bf170525ca1_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">754√ó463 71 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p><strong>Summary</strong>:<br>
We‚Äôre going to be looking for process injection, I suspect that the resource located within the resource section would be mapped into memory, unpacked or decrypted and then injected into the second sub process. There are 4 sub process in total so our final payload would be located on the fourth sub process. It is assumed that the payload would connect to pastebin and display a message box. There is definitely string encryption going on, so we‚Äôll have to deal with that as well.</p>
<hr>
<h2>Static and Dynamic Anaylsis</h2>
<p>This binary is compiled with Visual Studio C++, the implications of that mean that the actual main function is located somewhere within the start function and I‚Äôve located it by recursively traversing xrefs from one of the imported functions. The main function is located at <strong>0x00401400</strong></p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/b/bf59ca1c6fd5521883a486db385e01c17d57178c.png" alt="" data-base62-sha1="riLzkWwG3Al8ZHUEbenk16JYyvi" width="233" height="350"></p>
<p>When viewing the code of the main function one can see gibberish strings being pushed before function calls:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/9/9c7079266ff70c5b09ae6ade353d1017b8a1867f.png" data-download-href="/uploads/short-url/mjVspkcrSzYl17u1LDQlSmoeXdt.png?dl=1" title="" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/9/9c7079266ff70c5b09ae6ade353d1017b8a1867f.png" alt="" data-base62-sha1="mjVspkcrSzYl17u1LDQlSmoeXdt" width="269" height="272" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/9/9c7079266ff70c5b09ae6ade353d1017b8a1867f_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">497√ó503 15.2 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p>The function that is called after each push is the same, I instantly assume there is some string encryption going on. The extensive use of <strong>LoadLibraryA</strong> and <strong>GetProcAddress</strong> also makes me assume these strings are API strings that are resolved using <strong>LoadLibraryA</strong> and <strong>GetProcAddress</strong>.</p>
<p>At <strong>loc_401550</strong> and <strong>loc_401570</strong> one can located something that resembles a <strong>RC4 KSA</strong> routine, it is easily recognized by the two loop procedures iterating <strong>256</strong> times.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/8/853075b5aa7a9b1e4d54b3972c690dfc07bc54d4.png" data-download-href="/uploads/short-url/j0fklFRvCBX94DqcR9dHWbojlRy.png?dl=1" title="" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/8/853075b5aa7a9b1e4d54b3972c690dfc07bc54d4.png" alt="" data-base62-sha1="j0fklFRvCBX94DqcR9dHWbojlRy" width="285" height="456" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/8/853075b5aa7a9b1e4d54b3972c690dfc07bc54d4_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">457√ó731 23.6 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p>These are just quick assumptions I‚Äôve made by looking at the binary, the rest of it is filled with obfuscated code and otherwise an extensive use of registers and dynamic resolving so we‚Äôll have to resort to dynamic analysis. I‚Äôve disabled <strong>ASLR</strong> for this binary with <strong>CFF explorer</strong> so it would be easier to debug it.<br>
I‚Äôve set relevant breakpoints within the debugger. So all the resource related functions to locate any resource loading, <strong>CreateProcessInternalW</strong> for process initialization and <strong>VirtualProtect</strong>, <strong>VirtualAllocEx</strong> and <strong>WriteProcessMemory</strong> for injection. In addition I‚Äôve set breakpoints on <strong>OutputDebugString</strong> and <strong>IsDebuggerPresent</strong> to catch easy implemented anti analysis.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/7/767537c7581d0edf4d0d8da70bb70235be510606.png" data-download-href="/uploads/short-url/gTVtJRQEJmxcowxQPY79BEP5058.png?dl=1" title="" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/7/767537c7581d0edf4d0d8da70bb70235be510606.png" alt="" data-base62-sha1="gTVtJRQEJmxcowxQPY79BEP5058" width="624" height="99" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/7/767537c7581d0edf4d0d8da70bb70235be510606_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">880√ó139 6.53 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p>First, as assumed the <strong>sub_401300</strong> seems to be resolving strings:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/6/693d6e043fc54eac36e0cd4580fde78ddce189fa.png" data-download-href="/uploads/short-url/f0ZKjBfmBDNrtic2hhnb8SOLyoW.png?dl=1" title="" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/6/693d6e043fc54eac36e0cd4580fde78ddce189fa.png" alt="" data-base62-sha1="f0ZKjBfmBDNrtic2hhnb8SOLyoW" width="624" height="280" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/6/693d6e043fc54eac36e0cd4580fde78ddce189fa_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">808√ó363 33 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p>The function <strong>func_StringDecrypt</strong> seems to be decrypting strings using some kind of custom base64 decoding, The reason I suspect is ‚Äì is because the use of the full alphanumeric string that is being passed within this function. This function would be studied extensively later on in this paper and we‚Äôll attempt to generate an automation script for it to decode all strings within this sample.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/7/7f6811edd2499307bbe52df9c7868338c9baa2d1.png" data-download-href="/uploads/short-url/ib5BGgm9JsZmpCO6zfMJ4WFwN0Z.png?dl=1" title="" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/7/7f6811edd2499307bbe52df9c7868338c9baa2d1.png" alt="" data-base62-sha1="ib5BGgm9JsZmpCO6zfMJ4WFwN0Z" width="624" height="123" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/7/7f6811edd2499307bbe52df9c7868338c9baa2d1_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">1076√ó212 31.4 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p>Then the sample does something interesting:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/c/c31e5e6d7dd1ca971f92054cbeb56e10d2113f59.png" data-download-href="/uploads/short-url/rQ6aE4Mf1A6mbISISQmm1WjEktj.png?dl=1" title="" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/c/c31e5e6d7dd1ca971f92054cbeb56e10d2113f59.png" alt="" data-base62-sha1="rQ6aE4Mf1A6mbISISQmm1WjEktj" width="443" height="500" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/c/c31e5e6d7dd1ca971f92054cbeb56e10d2113f59_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">490√ó552 18.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p>It allocates space for the resource but it skips the first <strong>0x1C</strong> bytes within the resource.</p>
<p>Hmm, perhaps this is the decryption key for the <strong>RC4</strong> algorithm we saw before?</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/2/2a35c452b6e91b4ffd03c5667d769aab4918a0b3.png" alt="" data-base62-sha1="61pfqk0R7Wx42QkUjrznK1JzTtV" width="590" height="29"></p>
<p>Then a call is performed to <strong>sub_402DB0</strong> which I renamed to <strong>func_CopyResourceWithoutKeyToAllocMem</strong> because that is exactly what it does, it just copies the resource without its key, so starting at offset <strong>0x1C</strong>.</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/9/92a3e39710f69028bd173ea52aff8ff104c974a9.png" alt="" data-base62-sha1="kVeQ9XhBDwUhV7F0KS4uUsDekAx" width="505" height="152"></p>
<p>because that is exactly what it does, it just copies the resource without its key, so starting at offset <strong>0x1C</strong>. This function would seem very confusing at first, but if we set a hardware <strong>breakpoint</strong> on the allocated memory we‚Äôll break within this function we can confirm this. Because at 00403002 it performs this copying procedure and then it just exists the function:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/7/781aac6a248a4a5ebaa6adb991b14a46ed6b1379.png" alt="" data-base62-sha1="h8urxjYWD0UlEiX3CNNDmAryIf7" width="589" height="170"></p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/f/f3a8514cfe205c9893d71129669104790c9ba4b9.png" alt="" data-base62-sha1="yLuDVOIUeLWxG1Il8QTPHhJ6meZ" width="565" height="222"></p>
<p>Then <strong>sub_4025B0</strong> is executed, it receives a stack address and we simply skip this function while looking at that address on dump we can see that it simply zeroes it out.</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/d/d13247593b0070b3c2f6302496bbf96d45a83195.png" alt="" data-base62-sha1="tQDvNN64tdKVjtOPJELwdw7cYq9" width="593" height="167"></p>
<p>So thankfully I‚Äôm saving a lot of time by skipping these rabbit holes.</p>
<p>Then the assumed <strong>RC4</strong> algorithm executes, what I want to do is locate the address to where the sample mapped the resource to memory as I suspect that it‚Äôs going to be decrypted.</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/a/a2dbd1b1b1fefd3726d402ac6b5ce5312d7de0ec.png" alt="" data-base62-sha1="neIjfyUJIuVmSiE7qZCATWil4Re" width="590" height="166"></p>
<p>So I‚Äôm going to skip the RC4 decryption routine and jump straight to address 0x40161D</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/7/7e0f3ab485829391fc919532ba18cf7fd6865065.png" alt="" data-base62-sha1="hZaMYwjbPilHKlcKxb6PEMUiBTf" width="594" height="165"></p>
<p>Yay! I decide to dump the new PE file out to disk but we‚Äôre not done yet. We have to see how it‚Äôs going to be injected to memory.</p>
<p>We jump into <strong>sub_401000</strong>:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/a/a6ffa02b9fb9576138028929398b06a84dcad9ca.png" alt="" data-base62-sha1="nPkW0hvDbKAGaqK6J3FtkA0OLHQ" width="445" height="131"></p>
<p>First the sample resolves the <strong>ImageBase</strong> of the current executing sample and then it attempts to confirm and locate the address of the <strong>NT_Headers</strong> of the decrypted payload.</p>
<p>Then the current process main.bin is created in suspended mode</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/f/f8e373510b66a17b8aafb48d4508c6817bad5823.png" data-download-href="/uploads/short-url/zvLIPj0hjNqywQfsXUU5NtkqvFF.png?dl=1" title="" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/f/f8e373510b66a17b8aafb48d4508c6817bad5823.png" alt="" data-base62-sha1="zvLIPj0hjNqywQfsXUU5NtkqvFF" width="624" height="49" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/f/f8e373510b66a17b8aafb48d4508c6817bad5823_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">1078√ó84 7.75 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p>Seems like there is going to be process injection involved.</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/6/6215474b6ec517ea2760953df980f0e4c5b52c41.png" alt="" data-base62-sha1="dZGnCPmkrgXnzmlyZoJCejsw9C9" width="566" height="160"></p>
<p>First memory is allocated within the new process. The sample attempts to execute <strong>VirtualAllocEx</strong> on the new process. Attempting to allocate memory at the payloads PE default <strong>ImageBase</strong> and with the virtual Size of the image. This won‚Äôt work though under our modified execution since we disabled <strong>ASLR</strong>. Why? Because both processes execute at the same <strong>ImageBase</strong>, the new process already has memory allocated within that region, so we must enable <strong>ASLR</strong> and start again. So, lets do that just that and we‚Äôll see that it would work.</p>
<p>Then the sample will copy the payloads section to their correct virtual addresses:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/6/64927f4f2cf4950112291325481456cb4d9958d0.png" alt="" data-base62-sha1="elHCc9VoPGnQdDVBXYBRWsGk1Gw" width="436" height="453"></p>
<p>Then something very interesting happens:<br>
The <strong>ImageBase</strong> of the payload is written to the <strong>PEB</strong> of the new process, specifically at offset 0x8.</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/7/7958c520fcb283055dcb3fc71a4d3d2d03e385d6.png" alt="" data-base62-sha1="hjtXHbeAcVsNLyDbLV2g9hTEhhA" width="179" height="72"></p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/6/649618079423af112dc93477514aeaa048333c38.png" alt="" data-base62-sha1="elPjWuIzdZZcczPOGeuy2rqWS5W" width="458" height="235"></p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/a/a803d4ad6b1b9b9dbc6c3aa538fff1d5cf7fba07.png" alt="" data-base62-sha1="nYkqbNEAYDJ4jY9W5Xa3TTMwj5B" width="514" height="101"></p>
<p>We can assume that the payload would use this to resolve its own APIs.</p>
<p>Finally, <strong>SetThreadContext</strong> and <strong>ResumeThread</strong> are called, and the injected payload executes.</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/e/e09c1cdc8e957f9f019cf16c53fc124c385c983c.png" alt="" data-base62-sha1="w2ZqfumdQsV7d7qsJDaaAvJaTEg" width="395" height="91"></p>
<hr>
<h2>Second Payload Analysis</h2>
<h3>Sample information:</h3>
<p>SHA-256: <strong>[Redacted]</strong></p>
<p>Intezer: <strong>[Redacted]</strong></p>
<p>Any.run: <strong>[Redacted]</strong></p>
<p>VirusTotal: <strong>[Redacted]</strong></p>
<h2>Advanced Static and Dynamic Analysis</h2>
<p>I‚Äôm going to assume process injection again and go straight into analysis, I‚Äôll disable <strong>ASLR</strong> for this execution as I would be executing the second stage payload independently and so the previous problem, we encountered due disabling <strong>ASLR</strong> shouldn‚Äôt bother us.</p>
<p>It is observed that this second stage contains API hashing as the extensive use of <strong>CRC32</strong> constants indicates that:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/3/3531de48d279186cdf225e9dc5fa0a4b35c268f3.png" alt="" data-base62-sha1="7AA9bX7BObB1glpaiNwmyiWIjOb" width="320" height="171"></p>
<p>In addition, the function that was seen in the first stage loader that simply copies the payload into memory from the resource section can be seen:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/0/07c7e94ca228965d34eff24c0b7d48bc9332be56.png" alt="" data-base62-sha1="16PEjSx0aViZNsO4E6zJ8beK7Yy" width="383" height="406"></p>
<p>I‚Äôve set relevant breakpoints within the debugger. So, all the resource related functions to locate any resource loading, <strong>CreateProcessInternalW</strong> for process initialization and <strong>VirtualProtect</strong>, <strong>VirtualAllocEx</strong> and <strong>WriteProcessMemory</strong> for injection. In addition, I‚Äôve set breakpoints on <strong>OutputDebugString</strong> and <strong>IsDebuggerPresent</strong> to catch easy implemented anti analysis.</p>
<p>The malware takes the name of the file that its currently executing from and hashes it using a <strong>CRC32</strong> hashing algorithm, it can be identified by the <strong>CRC32</strong> hashing constants found within this function. The sample then compares the result against a constant value. I‚Äôm assuming its using this method as an anti-analysis method to check if the samples name is ‚Äúsample‚Äù or ‚Äúmalware‚Äù its really hard to tell. If this check matches the sample quits execution.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/6/6f21414ae6a7e89fbce0527c6382be4d004e315c.png" data-download-href="/uploads/short-url/fR6fmFNcBzflnOo6P3hIw5klOri.png?dl=1" title="" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/6/6f21414ae6a7e89fbce0527c6382be4d004e315c.png" alt="" data-base62-sha1="fR6fmFNcBzflnOo6P3hIw5klOri" width="624" height="73" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/6/6f21414ae6a7e89fbce0527c6382be4d004e315c_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">827√ó97 8.86 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p>Then an API resolving routine called which utilizes the <strong>CRC32</strong> hashing algorithm we seen earlier:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/0/0f8bab987c36bb355f96b775d4c041bc8590be12.png" alt="" data-base62-sha1="2dwp44n2uJOMa72u1SdtELGXKca" width="298" height="79"></p>
<p>The <strong>HashID</strong>(EDX) and the <strong>ID</strong>(ECX) which identifies the library to which to resolve the API from</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/d/da9b8f4b551e58edcbc7c5e8c414fe55bffccba9.png" alt="" data-base62-sha1="vbTnaM14AOyExtqMSuBs962xvLP" width="459" height="58"><br>
<img src="../../../0x00sec.s3.amazonaws.com/original/2X/1/106c61c1907591581fef88c71509637e4de41cd9.png" alt="" data-base62-sha1="2lhQuijuBIVoIKuuVvFajWg401X" width="624" height="120"></p>
<p>I will not explain how the API Hashing and resolving in depth. Basically the export table of each loaded DLL is hashed to check which function name matches the hash passed into the function. If anyone wants to read about how that might be implemented they can read about it <a href="../../../external.html?link=https://github.com/DanusMinimus/API-Hash" rel="noopener nofollow ugc">on my github right here</a>.</p>
<p>The sample loads <strong>IsDebuggerPresent</strong> to check if the malware is executing under a debugger, this can be easily circumvented.<br>
The next anti analysis method located within <strong>sub_401000</strong> checks if any blacklisted process is running ‚Äì the malware hashes each running process and then checks if the hash matches to a pre-computed hash array. If they match the malware quits execution.<br>
<img src="../../../0x00sec.s3.amazonaws.com/original/2X/4/43c50f3d14c789a4df20ec66f50cd01e88e87030.png" alt="" data-base62-sha1="9FwbH0iXnks6wi1jdvGfwlbcV8I" width="378" height="109"></p>
<p>Then the sample executes <strong>sub_401D50</strong> which resolves a lot of APIs that might indicate process injection:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/4/4ebada267efc55fa472385e635de4252e5b19e2e.png" data-download-href="/uploads/short-url/betzr9uAXbtiGr58KWoVguUNOb4.png?dl=1" title="" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/optimized/2X/4/4ebada267efc55fa472385e635de4252e5b19e2e_2_130x291.png" alt="" data-base62-sha1="betzr9uAXbtiGr58KWoVguUNOb4" width="130" height="291" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/4/4ebada267efc55fa472385e635de4252e5b19e2e_2_130x291.png, https://0x00sec.s3.amazonaws.com/optimized/2X/4/4ebada267efc55fa472385e635de4252e5b19e2e_2_195x436.png 1.5x, https://0x00sec.s3.amazonaws.com/optimized/2X/4/4ebada267efc55fa472385e635de4252e5b19e2e_2_260x582.png 2x" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/4/4ebada267efc55fa472385e635de4252e5b19e2e_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">291√ó650 22 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<ol>
<li>Start <strong>svchost</strong> with suspended flags</li>
<li>Copy current PE into allocated memory</li>
<li>Allocate Memory in <strong>svchost</strong>
</li>
<li>Rebuild current PE payload relocation table</li>
<li>Write payload into <strong>svchost</strong>
</li>
<li>Use <strong>CreateRemoteThread</strong> to execute function <strong>sub_401DC0</strong>
</li>
</ol>
<p>To continue execution, we simply must attach to a second debugger instance and set a <strong>breakpoint</strong> on the functions location and after running <strong>CreateRemoteThread</strong> we should hit it.</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/9/9cde5cbf9d171b0a4591ec7d647e61db7dab023b.png" alt="" data-base62-sha1="mnITs8RtkjXflPZUH2ITXgrDYHF" width="611" height="395"></p>
<p>After setting up the <strong>breakpoint</strong> lets resume execution of the <strong>svchost</strong> instance and then skip <strong>CreateRemoteThread</strong> and see if anything happens. <div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/d/de459281f3d61ddde4174e96fe317cfec9b80038.png" data-download-href="/uploads/short-url/vIj3uMy2r7zqb6BlRQh8F4GR4CY.png?dl=1" title="" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/d/de459281f3d61ddde4174e96fe317cfec9b80038.png" alt="" data-base62-sha1="vIj3uMy2r7zqb6BlRQh8F4GR4CY" width="624" height="103" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/d/de459281f3d61ddde4174e96fe317cfec9b80038_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">800√ó132 7.71 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p>Success! We can continue analyzing this function within our documented IDA instance as this function is located in the second stage payload.</p>
<p>It‚Äôs important to note that interestingly enough ‚Äì this function is called previously at <strong>loc_402085</strong> when the <strong>func_CRC32Hash</strong> returns a hashed value for the current executing process name which matches a hardcoded hash.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/a/aa09c32846f1d7e5923b5290b9636fbe6ea59c80.png" data-download-href="/uploads/short-url/oge5jlIezM9rmMYpJnEnbgsc3Ze.png?dl=1" title="" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/optimized/2X/a/aa09c32846f1d7e5923b5290b9636fbe6ea59c80_2_624x229.png" alt="" data-base62-sha1="oge5jlIezM9rmMYpJnEnbgsc3Ze" width="624" height="229" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/a/aa09c32846f1d7e5923b5290b9636fbe6ea59c80_2_624x229.png, https://0x00sec.s3.amazonaws.com/optimized/2X/a/aa09c32846f1d7e5923b5290b9636fbe6ea59c80_2_936x343.png 1.5x, https://0x00sec.s3.amazonaws.com/original/2X/a/aa09c32846f1d7e5923b5290b9636fbe6ea59c80.png 2x" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/a/aa09c32846f1d7e5923b5290b9636fbe6ea59c80_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">1019√ó374 19.7 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div><br>
I quickly assumed that this is a method to detect if the binary is running from <strong>svchost</strong>, because as we seen in the malware‚Äôs execution process tree, it executes <strong>svchost</strong> twice. I later confirmed this check by renaming the sample to <strong>svchost.exe</strong> and it worked:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/e/e4b3e1f3965b971dbc44b271abaadf17932b3be6.png" data-download-href="/uploads/short-url/wDcg7ssmiAEBTh0v8zBHsyfuhXo.png?dl=1" title="" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/optimized/2X/e/e4b3e1f3965b971dbc44b271abaadf17932b3be6_2_624x80.png" alt="" data-base62-sha1="wDcg7ssmiAEBTh0v8zBHsyfuhXo" width="624" height="80" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/e/e4b3e1f3965b971dbc44b271abaadf17932b3be6_2_624x80.png, https://0x00sec.s3.amazonaws.com/optimized/2X/e/e4b3e1f3965b971dbc44b271abaadf17932b3be6_2_936x120.png 1.5x, https://0x00sec.s3.amazonaws.com/original/2X/e/e4b3e1f3965b971dbc44b271abaadf17932b3be6.png 2x" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/e/e4b3e1f3965b971dbc44b271abaadf17932b3be6_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">1237√ó158 17 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p>Let‚Äôs continue with the analysis.</p>
<p>This function first resolves a few Internet WINAPIs:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/4/44d64d01cda38f0da1a5286cb44ab8a6317be6bb.png" alt="" data-base62-sha1="9OXBwZeFbSCfbJKW1Ryhh27GM5B" width="624" height="203"></p>
<p>Then a strange string located at offset <strong>0x0413C7C</strong> is passed into a code block and decrypted by a very simple algorithm:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/7/7d06b77944eb466372c1b340bf37176129d82db6.png" alt="" data-base62-sha1="hQ24BrwLgSZML4XkBdgpEPS7ftI" width="242" height="203"></p>
<p>So, our encrypted byte sequence:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/0/07a3b606bf78465dfb9334773ac0c999f431a9ce.png" alt="" data-base62-sha1="15A5G20rwZHsvTqHNSbqtFdb7cO" width="608" height="18"></p>
<p>Returns:<br>
<img src="../../../0x00sec.s3.amazonaws.com/original/2X/5/55c25aa5b35e4173635d1bffe774051c9560ea17.png" alt="" data-base62-sha1="ceEZaU1g8mbVcMBpfpdgbT8Q8xV" width="439" height="34"></p>
<p>Which resolves to <strong>[Redacted]</strong><br>
<img src="../../../0x00sec.s3.amazonaws.com/original/2X/2/2b6a5c18203384236d79ec780242fef9f8437a69.png" alt="" data-base62-sha1="6c4pao0NHaQEZBybSU5zH7ZBKjf" width="499" height="191"></p>
<p>Hmm‚Ä¶ This might indicate stenography is involved. Let‚Äôs continue with the analysis</p>
<p>This pastebin link is passed into <strong>sub_401290</strong> this function returns the image link contained within the pastebin and saves it within the memory.</p>
<p>This resolved link is passed into <strong>sub_4013A0</strong>, first the function reads the contents of the image file linked passed into it. Using <strong>sub_401290</strong> which I renamed to <strong>func_ReadWebContents</strong></p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/4/42778a1e92da889e27b8655b91c62db039f4bf49.png" alt="" data-base62-sha1="9tZCLGJufbkNgcqt6X9pUTEG6P7" width="340" height="335"></p>
<p>Then the function decodes a string located with <strong>qword_413CA4</strong><br>
<img src="../../../0x00sec.s3.amazonaws.com/original/2X/1/124a57751021f00a4b1b6be49d668e5be9499abe.png" alt="" data-base62-sha1="2BNRYSpBSVXwatHMIY4DC21sxpY" width="339" height="16"></p>
<p>Which resolves to <strong>output.jpg</strong>, then it computes a path to the Temp directory and converts the it to a WCHAR type string, then specially picked bytes are extracted from the data section to compute this path:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/2/28475db7c4c10f22a7b1ad87ea677a5b71c63ee4.png" alt="" data-base62-sha1="5KjZZOemWYigmxNmaDZik45zIuU" width="422" height="21"></p>
<p>Then <strong>CreateDirectory</strong> is invoked to create the <strong>cruloader</strong> folder, after which the <strong>output.jpg</strong> file string is append to this path to create the following string:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/0/0a153237646743396fb9996e6254a70ee212edce.png" alt="" data-base62-sha1="1rcbBQ0qub21DxEiGrmHUJbvNH8" width="502" height="24"></p>
<p><strong>CreateFileW</strong> is then invoked to create this file:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/a/aeef65d105d85f1c451d0d29cf4391241c449060.png" alt="" data-base62-sha1="oXxZcrLdsTyuZ75nuzHD2K1VYoo" width="367" height="188"></p>
<p>Then the PNG file extracted from the previous website is copied into this file using <strong>WriteFile</strong><br>
<div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/4/4f974c44154e67a449b4af9675d43f4d16647d21.png" data-download-href="/uploads/short-url/bm5Sdo961shw9oaJ5aV4OEqAJqx.png?dl=1" title="" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/4/4f974c44154e67a449b4af9675d43f4d16647d21.png" alt="" data-base62-sha1="bm5Sdo961shw9oaJ5aV4OEqAJqx" width="624" height="325" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/4/4f974c44154e67a449b4af9675d43f4d16647d21_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">763√ó398 29 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/7/7e3e07072d78ed53d49fb66a45ca8c65d6987658.png" data-download-href="/uploads/short-url/i0N3nqF30BoEU1l0DcHOGTYemBq.png?dl=1" title="" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/optimized/2X/7/7e3e07072d78ed53d49fb66a45ca8c65d6987658_2_357x220.png" alt="" data-base62-sha1="i0N3nqF30BoEU1l0DcHOGTYemBq" width="357" height="220" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/7/7e3e07072d78ed53d49fb66a45ca8c65d6987658_2_357x220.png, https://0x00sec.s3.amazonaws.com/optimized/2X/7/7e3e07072d78ed53d49fb66a45ca8c65d6987658_2_535x330.png 1.5x, https://0x00sec.s3.amazonaws.com/optimized/2X/7/7e3e07072d78ed53d49fb66a45ca8c65d6987658_2_714x440.png 2x" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/7/7e3e07072d78ed53d49fb66a45ca8c65d6987658_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">717√ó442 19.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div><br>
Afterwards the sample attempts to locate a string <strong>‚Äúredaolurc‚Äù</strong> (which is <strong>cruloader</strong> reversed) within the image data download</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/c/c98c2544bd281b4a22015219e5b5d3fd8496ad0e.png" data-download-href="/uploads/short-url/sKYeo7n8mJY3NyfFtUHl4c8yIsC.png?dl=1" title="" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/optimized/2X/c/c98c2544bd281b4a22015219e5b5d3fd8496ad0e_2_624x193.png" alt="" data-base62-sha1="sKYeo7n8mJY3NyfFtUHl4c8yIsC" width="624" height="193" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/c/c98c2544bd281b4a22015219e5b5d3fd8496ad0e_2_624x193.png, https://0x00sec.s3.amazonaws.com/original/2X/c/c98c2544bd281b4a22015219e5b5d3fd8496ad0e.png 1.5x, https://0x00sec.s3.amazonaws.com/original/2X/c/c98c2544bd281b4a22015219e5b5d3fd8496ad0e.png 2x" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/c/c98c2544bd281b4a22015219e5b5d3fd8496ad0e_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">760√ó235 59 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p>After locating the string within the image data, this offset is used to access encrypted data. The data is xored with <strong>xmmword</strong>(which is 128-bit) 40 times. The xor key is <strong>0x61</strong>(‚Äòa‚Äô). One could also notice that there are a lot of ‚Äòa‚Äô characters within the encoded payload. These ‚Äòa‚Äô characters are actually zeroes within the binary, because 0 ^ 0x61 = 0x61 so this payload isn‚Äôt obfuscated with high class obfuscation as on could infer this pretty quickly.</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/d/d33941f3cefe393d2fa4de90ce90c6e3dee11293.png" alt="" data-base62-sha1="u8zq36M3Ju3Ac7SvxnFzYungx5F" width="540" height="14"></p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/b/b7ad3069fb08a03094966453f4bfffd2cbb9f8c0.png" alt="" data-base62-sha1="qcSqQHmjxTWzzc70Z2s9EarTDEY" width="400" height="449"></p>
<p>And the result is a valid PE file:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/1/1b2451ba414f635fb70c20639f45b8c16c01e59e.png" alt="" data-base62-sha1="3S6HJiwLyvFitui9PNHM3eNSNXM" width="598" height="170"></p>
<p>After dumping this PE I‚Äôve observed it within IDA and it would appear as if this is the final payload!</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/1/13610ade6b92d083d79d8766f48c67e64e9ce873.png" data-download-href="/uploads/short-url/2LqZ2cbMSh71Id7IZXYUc4WNrTt.png?dl=1" title="" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/1/13610ade6b92d083d79d8766f48c67e64e9ce873.png" alt="" data-base62-sha1="2LqZ2cbMSh71Id7IZXYUc4WNrTt" width="624" height="162" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/1/13610ade6b92d083d79d8766f48c67e64e9ce873_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">787√ó204 6.1 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p>This PE Is then mapped, relocated and then fixed with <strong>VirtualProtect</strong> and finally injected into <strong>svchost.exe</strong> again within the function sub_401750 this executing the final payload.</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/7/72e4a4d8e1099066780f7a6aae9e4184b622cdb6.png" alt="" data-base62-sha1="gooixmmm1g7w25z47RNUpWU7uku" width="474" height="201"></p>
<p>And that‚Äôs pretty much it!</p>
<hr>
<h2>Automation</h2>
<p>Alright, Let‚Äôs begin attempting to automate the process of extracting all payloads and dumping them on disk.</p>
<p>We begin with the resource section; this one is pretty easy.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/5/5f035540468d2a90a48eab2d620dab67ada359a0.png" data-download-href="/uploads/short-url/dywv2s2V9gU8jpoK8hfy2QPv41q.png?dl=1" title="" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/5/5f035540468d2a90a48eab2d620dab67ada359a0.png" alt="" data-base62-sha1="dywv2s2V9gU8jpoK8hfy2QPv41q" width="624" height="37" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/5/5f035540468d2a90a48eab2d620dab67ada359a0_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">1279√ó76 10.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p>First we begin looking for a string at offset 0x60 + 0xc from the begging of the resource section, and load the string which is 16 bytes in length.</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/2/29171d42d54c8d1ad8ed4bb9048f07c7a592a2a2.png" alt="" data-base62-sha1="5Rv66rokx0ge8HGZhb64icEL5PI" width="483" height="104"></p>
<p>Then, we load the rest of the payload into another variable</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/d/d9fd7e4247d4a5329651c9ea51ac38b717ded42a.png" data-download-href="/uploads/short-url/v6qIv4B10bxZDEeLQcrq0HAgryy.png?dl=1" title="" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/d/d9fd7e4247d4a5329651c9ea51ac38b717ded42a.png" alt="" data-base62-sha1="v6qIv4B10bxZDEeLQcrq0HAgryy" width="624" height="272" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/d/d9fd7e4247d4a5329651c9ea51ac38b717ded42a_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">950√ó414 20.7 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p>Then we use the ARC4 python module to decrypt this data and dump it on disk</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/2/2b3f3084f08e1556a29cdea2ccb88a9d7287100a.png" alt="" data-base62-sha1="6azUG4fcBS6TVh44jrgAFoOzdr4" width="457" height="197"></p>
<p>Now as we posses the second payload, we must locate the pastebin URL inside the PE file.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/1/1378a7914b3ec171a43c00abd7feec56fa1f347d.png" data-download-href="/uploads/short-url/2Mfzx9Y3I0Guqfqsg8kqPPi3WG1.png?dl=1" title="" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/1/1378a7914b3ec171a43c00abd7feec56fa1f347d.png" alt="" data-base62-sha1="2Mfzx9Y3I0Guqfqsg8kqPPi3WG1" width="624" height="147" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/1/1378a7914b3ec171a43c00abd7feec56fa1f347d_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">848√ó200 19.9 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p>We know our URL is located two <strong>XMM_WORDS</strong> (32 bytes) in size after the offset of the string <strong>‚Äúcruloader‚Äù</strong> so let‚Äôs set this up:</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/1/125c137c4c9818d5a831f3365428e29395dfc35f.png" alt="" data-base62-sha1="2CpRJlvLCEwmLqVgLoFAbGThxTx" width="276" height="66"></p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/3/3cbe2aae17347503af50cbd9083e2b4d0b54586d.png" data-download-href="/uploads/short-url/8Fm4RV2bNftl5dPHsLIsgSKuUqh.png?dl=1" title="" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/3/3cbe2aae17347503af50cbd9083e2b4d0b54586d.png" alt="" data-base62-sha1="8Fm4RV2bNftl5dPHsLIsgSKuUqh" width="624" height="247" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/3/3cbe2aae17347503af50cbd9083e2b4d0b54586d_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">925√ó366 21.7 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p>We calculate the offset by locating the <strong>‚Äúcruloader‚Äù</strong> string, adding 3 bytes to skip the null bytes and then jumping after both irrelevant <strong>XMM_WORDS</strong>. We extract our data and we set the <strong>XOR</strong> key to 0xC5</p>
<p>Then for each byte extracted we perform a four <strong>ROL</strong> and then a xor to match the decryption algorithm</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/e/e3747a462e8b93a1f1e5f63ed5a437390c3b6c57.png" alt="" data-base62-sha1="ws9W9yE07LclKn659Dq4ZtkhqPZ" width="301" height="231"></p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/7/7187043c0d0abba2c3056c644e744a06416988fd.png" alt="" data-base62-sha1="gcjdZQrUSWdCUCQ28hAc1DhVEId" width="526" height="89"></p>
<p>We then use <strong>URLLIB</strong> to extract the pastebin URL and then we use that same lib to extract the contents of the payload image</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/c/c14ba4926aa668dd625d670a6d319a91514c6ce6.png" alt="" data-base62-sha1="rzYdnP2H6erq9a0RD3KtSfJmKAS" width="549" height="143"></p>
<p>Finally, to locate the payload within the <strong>PNG</strong> payload file we locate the reverse <strong>‚Äúcruloader‚Äù</strong> string, extract the payload and then xor it with <strong>0x61</strong>.</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/d/dc2e61293f10b43bafb58b23982dba5912771b6f.png" data-download-href="/uploads/short-url/vpOpuDq0Bj9jH14DotlaqT5hH5B.png?dl=1" title="" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/d/dc2e61293f10b43bafb58b23982dba5912771b6f.png" alt="" data-base62-sha1="vpOpuDq0Bj9jH14DotlaqT5hH5B" width="624" height="153" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/d/dc2e61293f10b43bafb58b23982dba5912771b6f_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">853√ó209 8.55 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p>And that‚Äôs it! Easy as that!</p>
<p>I really enjoyed this challenge and I‚Äôm looking forward to continuing the course <img src="../../../0x00sec.org/images/emoji/twitter/blushc164.html?v=9" title=":blush:" class="emoji" alt=":blush:"><br>
Hope you enjoyed reading this!</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>


            
          </div>
          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/markeurope.html'><span itemprop='name'>markeurope</span></a>
                (Mark Europe)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2020-07-26T23:03:40Z' class='post-time'>
                    July 26, 2020, 11:03pm
                  </time>
                  <meta itemprop='dateModified' content='2020-07-26T23:03:40Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>too complicated but thank you</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_3' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/system.html'><span itemprop='name'>system</span></a>
                (system)
                  Closed 
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2020-11-25T04:47:59Z' class='post-time'>
                    November 25, 2020,  4:47am
                  </time>
                  <meta itemprop='dateModified' content='2020-11-25T04:47:59Z'>
              <span itemprop='position'>3</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>This topic was automatically closed after 121 days. New replies are no longer allowed.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
    </div>


    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../index.html' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../categories.html' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../guidelines.html' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../tos.html' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../privacy.html' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    <script src="../../../external.html?link=http://instant.page/3.0.0" type="module" defer="" integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1" nonce="uDXpzoDAVQATvRC9OcWRnDM7j"></script>
  </body>
  
</html>
