<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>A simple Linux Crypter - Malware - 0x00sec - The Home of the Hacker</title>
    <meta name="description" content="As @dtm has explained us how to write a crypter for Windows, and @TheDoctor has done the same for C#, Iâ€™m going to talk about how to build similar stuff for GNU/Linux. This post is kind of based on something else I wrote&amp;hellip;">
    <meta name="generator" content="Discourse 3.6.0.beta2-latest - https://github.com/discourse/discourse version 3b1964f3ed8bdc2f181e2abccb1b116e4b814db5">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.html">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.html">
<meta name="theme-color" media="all" content="#171616">

<meta name="color-scheme" content="dark">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="537.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">

    
    <link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4.css_%3b%20filename_%3dUTF-8%27%27color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" class="light-scheme" data-scheme-id="15"/>

<link href="../../stylesheets/common_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27common_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common"  />

  <link href="../../stylesheets/mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile"  />
  <link href="../../stylesheets/desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop"  />



    <link href="../../stylesheets/chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="chat"  />
    <link href="../../stylesheets/checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="checklist"  />
    <link href="../../stylesheets/discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-cakeday"  />
    <link href="../../stylesheets/discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="../../stylesheets/discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="../../stylesheets/discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="../../stylesheets/discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="../../stylesheets/discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="../../stylesheets/discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-solved"  />
    <link href="../../stylesheets/discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-templates"  />
    <link href="../../stylesheets/discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-topic-voting"  />
    <link href="../../stylesheets/docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="../../stylesheets/footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="../../stylesheets/poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="poll"  />
    <link href="../../stylesheets/spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="../../stylesheets/chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="chat_mobile"  />
    <link href="../../stylesheets/discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-solved_mobile"  />
    <link href="../../stylesheets/discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-topic-voting_mobile"  />
    <link href="../../stylesheets/chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="chat_desktop"  />
    <link href="../../stylesheets/discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="discourse-topic-voting_desktop"  />
    <link href="../../stylesheets/poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="poll_desktop"  />

  <link href="../../stylesheets/common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960db.css_%3b%20filename_%3dUTF-8%27%27common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960dba97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="57" data-theme-name="0x00sec-v2"/>
    <link href="../../stylesheets/mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38.css_%3b%20filename_%3dUTF-8%27%27mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile_theme" data-theme-id="4" data-theme-name="mobile chrome"/>
    <link href="../../stylesheets/desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2"/>

    <link rel="stylesheet" href="../../../external.html?link=https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="../../../external.html?link=https://s3.amazonaws.com/0x00sec/highlight.pack.js" nonce="9BCwesBBpnUBGFWSZP9102Hy9"></script>
<script defer="" src="../../theme-javascripts/05954ff525aceb8daa8b585f92d758d311ae7077.js_%3b%20filename_%3dUTF-8%27%2705954ff525aceb8daa8b585f92d758d311ae7077a97f.js?__ws=d.clarkee.co.uk" data-theme-id="40" nonce="9BCwesBBpnUBGFWSZP9102Hy9"></script>
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;A simple Linux Crypter&#39;" href="537.rss" />
    <meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://d.clarkee.co.uk/uploads/default/original/2X/2/27a5373af868edade07624e8205c46e79c247445.jpeg" />
<meta property="og:image" content="https://d.clarkee.co.uk/uploads/default/original/2X/2/27a5373af868edade07624e8205c46e79c247445.jpeg" />
<meta property="og:url" content="https://d.clarkee.co.uk/t/a-simple-linux-crypter/537" />
<meta name="twitter:url" content="https://d.clarkee.co.uk/t/a-simple-linux-crypter/537" />
<meta property="og:title" content="A simple Linux Crypter" />
<meta name="twitter:title" content="A simple Linux Crypter" />
<meta property="og:description" content="As @dtm has explained us how to write a crypter for Windows, and @TheDoctor has done the same for C#, Iâ€™m going to talk about how to build similar stuff for GNU/Linux. This post is kind of based on something else I wrote some months ago for a different community. I had tried to make a twist of the original paper, butâ€¦ to be honest, it is difficult to come up with something simpler.  I will skip the scan-time crypter. There are no big differences compared to what has already been said in this com..." />
<meta name="twitter:description" content="As @dtm has explained us how to write a crypter for Windows, and @TheDoctor has done the same for C#, Iâ€™m going to talk about how to build similar stuff for GNU/Linux. This post is kind of based on something else I wrote some months ago for a different community. I had tried to make a twist of the original paper, butâ€¦ to be honest, it is difficult to come up with something simpler.  I will skip the scan-time crypter. There are no big differences compared to what has already been said in this com..." />
<meta property="og:article:section" content="Malware" />
<meta property="og:article:section:color" content="F7941D" />
<meta property="og:article:tag" content="malware" />
<meta property="og:article:tag" content="elf" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="6 mins ðŸ•‘" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="23 â¤" />
<meta property="article:published_time" content="2016-06-01T21:07:35+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    <div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">
  <!--<a href="https://git.0x00sec.org" class="dow-menu">GitLab</a>  
  <a href="https://blog.0x00sec.org/irc" class="dow-menu">IRC</a>!-->
  <a href="../../../external.html?link=https://init.0x00sec.org/" class="dow-menu">Init</a>
  <a href="../../../external.html?link=https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
  <a href="../../../external.html?link=https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
    <header>
  <a href="../../index.html">0x00sec - The Home of the Hacker</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="537.html">A simple Linux Crypter</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/malware/56.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #F7941D'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Malware</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../tag/malware.html' class='discourse-tag' rel="tag">malware</a>, 
            <a href='../../tag/elf.html' class='discourse-tag' rel="tag">elf</a>
        </div>
      </div>
  </div>

  

    <div itemscope itemtype='../../../external.html?link=http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='A simple Linux Crypter'>
      <link itemprop='url' href='537.html'>
      <meta itemprop='datePublished' content='2016-06-01T21:07:34Z'>
        <meta itemprop='articleSection' content='Malware'>
      <meta itemprop='keywords' content='malware, elf'>
      <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
        <meta itemprop='name' content='0x00sec - The Home of the Hacker'>
          <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
            <meta itemprop='url' content='../../uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.html'>
          </div>
      </div>


          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/0x00pf.html'><span itemprop='name'>0x00pf</span></a>
                (pico)
              </span>

                <link itemprop="mainEntityOfPage" href="537.html">


              <span class="crawler-post-infos">
                  <time  datetime='2016-06-01T21:07:35Z' class='post-time'>
                    June 1, 2016,  9:07pm
                  </time>
                  <meta itemprop='dateModified' content='2016-06-09T20:11:05Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>As <a class="mention" href="../../u/dtm.html">@dtm</a> has explained us how to write a crypter for Windows, and <a class="mention" href="../../u/thedoctor-2.html">@TheDoctor</a> has done the same for C#, Iâ€™m going to talk about how to build similar stuff for GNU/Linux. This post is kind of based on something else I wrote some months ago for a different community. I had tried to make a twist of the original paper, butâ€¦ to be honest, it is difficult to come up with something simpler.</p>
<p>I will skip the scan-time crypter. There are no big differences compared to what has already been said in this community. So, by now, you should know enough to build such a crypter for GNU/Linux, following what my colleagues have already explained to you.</p>
<p>The technique Iâ€™m going to present is pretty simple and can only secure relatively small parts of the binary. I will first briefly describe how the system works  and then present you a possible implementation.</p>
<h1><a name="p-2569-the-technique-1" class="anchor" href="#p-2569-the-technique-1"></a>The Technique</h1>
<p>This technique allows you to crypt parts of your application using whatever algorithm you want. As usual I will use the classical XOR encoder so we do not spend time talking about cryptography and we can focus on the crypter itself.</p>
<p>We will have to write a small program that will encrypt parts of the application we want to secure (we will name this the <em>off-line crypter</em>). The secured application will also need a couple of functions (the so-called <em>stub</em>) to decrypt at run-time the secured parts.</p>
<p>In order to easily identify which parts of the application we want secured, we will be pushing them into a special section within the ELF file. Your programâ€™s code usually ends up in the <code>.text</code> section but, you are free to create additional sections for code or data in your program. And that is what we are going to do.</p>
<p>This way, the <strong>off-line crypter</strong> can examine the binary we want to process and easily find the parts that have to be encrypted, and the parts that have to remain unencrypted.</p>
<p>Enough theory, letâ€™s start looking at the off-line crypter</p>
<h1><a name="p-2569-a-simple-crypter-2" class="anchor" href="#p-2569-a-simple-crypter-2"></a>A Simple Crypter</h1>
<p>The off-line crypter is surprisingly simple. We will make use of a couple of function we have already used in the post ( <a href="../../../external.html?link=https://0x00sec.org/t/elfun-file-injector/410" rel="noopener nofollow ugc">ELFun File Injector</a>). I will not discuss them again in this post.</p>
<p>The functions Iâ€™m talking about are:</p>
<ul>
<li><code>get_file_size</code>. This function returns the size in bytes of an opened file</li>
<li><code>elfi_find_section</code>. This function returns a pointer to an ELF section structure for a memory mapped ELF file.</li>
</ul>
<p>Be free to check the post mentioned above for details.</p>
<p>In addition to these two function we will need a XOR encoder function. Something like this:</p>
<pre><code class="lang-auto">#define KEY_MASK 0x7
static char key[8] ="ABCDEFGH";

void
xor_block (unsigned char *data, int len)
{
  int i;
  for (i = 0; i &lt; len; data[i] ^= key[i &amp; KEY_MASK], i++);
}
</code></pre>
<p>This time Iâ€™m forcing a power of two length on the key so we can use the AND operator instead of the MODULUS operator. Just for fun.</p>
<p>And that is it. Now, we have all the elements to write our encoding functions. Here it is:</p>
<pre><code class="lang-auto">int
encode (char *f)
{
  int            fd, len;
  unsigned char *p;
  Elf64_Shdr    *s;

  printf ("+ Encoding\n");
  if ((fd = open (f, O_RDWR, 0)) &lt; 0) DIE ("open");
  len = (get_file_size (fd));
  if ((p = mmap (0, len, 
		 PROT_READ | PROT_WRITE, 
		 MAP_SHARED, fd, 0)) == MAP_FAILED) DIE ("mmap");

  if ((s = elfi_find_section (p, ".secure")) == NULL)
    {
      fprintf (stderr, "- No secure section found... Nothing to do!\n");
      close (fd);
      exit (1);
    }

  xor_block (p+s-&gt;sh_offset, s-&gt;sh_size);

  /* Store Offset and size */
  *((int*)  (p + 0x09)) = s-&gt;sh_offset;
  *((short*)(p + 0x0d)) = s-&gt;sh_size;

  printf ("+ Offsets: 0x%x, 0x%x\n", s-&gt;sh_offset, s-&gt;sh_size);
  close (fd);
}
</code></pre>
<p>This function may look scary at first glance but it is actually a pretty simple function.</p>
<p>The first thing we do is to open the file we want to crypt and map it in memory. This code is actually also used in the ELFun post. Mapping the file in memory is just a convenient way to modify it, without having to use <code>lseek</code>, <code>read</code> and <code>write</code> functions.</p>
<p>Once our file is in memory we can search for our special section. We had named it <code>.secure</code>, but you can actually use any name you want. Using the <code>elfi_find_section</code> function we get a pointer to an ELF section structure containing all the section details. Specifically, we are interested in the sectionâ€™s file offset and the sectionâ€™s size.</p>
<p>Next step is to use this information, the offset and size of the section, to crypt that memory block using our XOR crypt function. Finally, we store the offset and the size in the ELF header, so the run-time decrypt function can quickly find out which memory block needs to be processed.</p>
<p>The ELF header contains, at the very beginning a 16 bytes field including some generic information (the ELF magic number, word-length, endianess,â€¦). The last 7 bytes of this field are reserved for future uses. Well, this is a future use, isnâ€™t it?. That means that we can store up to 7 bytes in the header starting at offset 0x09.</p>
<p>This is what the last two lines in the function do. We use 4 bytes (an <code>int</code>) to store the offset to the section, and 2 bytes (a <code>short</code>) to store the size of the sectionâ€¦ and we still have 1 extra free byte!!</p>
<p>Now we can close our file and dump all our changes into the file in the disk, effectively applying all these changes to the program file.</p>
<h1><a name="p-2569-a-secured-program-3" class="anchor" href="#p-2569-a-secured-program-3"></a>A Secured Program.</h1>
<p>In order to test our off-line crypter we need a test program with some code in a section named â€˜.securedâ€™ and containing a bit of code able to decrypt anything on that section (our <strong>stub</strong>).</p>
<p>First, letâ€™s produce a <code>main</code> function.</p>
<pre><code class="lang-auto">int
main (int argc, char *argv[])
{
  uncrypt ();
  secure_main (argc, argv);
}
</code></pre>
<p>Sure. We do not need much more. First we uncrypt the secured parts (this is our stubâ€¦ probably I should had call it stub :), and then we run the rest of the program. In this case we just call the function <code>secure_main</code> that will contain the code we want to secure.</p>
<p>Next point is how to push <code>secure_main</code> into the <code>.secure</code> section so our off-line crypter can find it and do its stuff.</p>
<p>The easiest way to force some functions in a specific section is to use the so-called GCCâ€™s function attributesâ€¦ the <code>__attribute__</code> keyword (<a href="../../../external.html?link=https://gcc.gnu.org/onlinedocs/gcc/Function-Attributes.html" class="inline-onebox" rel="noopener nofollow ugc">Function Attributes (Using the GNU Compiler Collection (GCC))</a>) will do the trick:</p>
<pre><code class="lang-auto">#define CRYPT_ME __attribute__((section(".secure")))

CRYPT_ME int
secure_main (int argc, char *argv[])
{
  printf ("This was crypted!\n");
  getchar ();
  return 0;
}
</code></pre>
<p>For convenience, we have defined a pre-processor macro so we just prefix any function definition with that macro to push it into the <code>.secure</code> section. Yes, that is it.</p>
<h2><a name="p-2569-the-uncrypt-function-4" class="anchor" href="#p-2569-the-uncrypt-function-4"></a>The UNCRYPT Function</h2>
<p>So, the last part of our system is the <code>uncrypt</code> function. Once again, all that pointer gymnastics at the beginning may look intimidating, but the concept behind this is pretty simple:</p>
<ol>
<li>Get the offset and size of the section to uncrypt. We have conveniently stored this information in the ELF header</li>
<li>Find out the memory page the encrypted code is located so we can change permissions (we need to decrypt it)</li>
<li>Run the XOR function on the section</li>
<li>Restore permissions on the memory block so the binary does not look <em>suspicious at run-time</em>.</li>
</ol>
<p>Letâ€™s take a quick look to the function before diving into the details.</p>
<pre><code class="lang-auto">#define DEFAULT_EP ((unsigned char*)0x400000)

int
uncrypt ()
{
  int   p   = *((int   *)(DEFAULT_EP + 0x09));
  int   len = *((short *)(DEFAULT_EP + 0x0d));

  /* Change Permissions */
  unsigned char *ptr       = DEFAULT_EP + p;
  unsigned char *ptr1      = DEFAULT_EP + p + len;
  size_t         pagesize  = sysconf(_SC_PAGESIZE);
  uintptr_t      pagestart = (uintptr_t)ptr &amp; -pagesize;
  int            psize     = (ptr1 - (unsigned char*)pagestart);

  /* Make the pages writable...*/
  if (mprotect ((void*)pagestart, psize, PROT_READ | PROT_WRITE | PROT_EXEC) &lt; 0)
    perror ("mprotect:");

  xor_block (DEFAULT_EP + p, len);
  if (mprotect ((void*)pagestart, psize, PROT_READ | PROT_EXEC) &lt; 0)
    perror ("mprotect:");

  printf ("+ Ready to run!\n");
}
</code></pre>
<p>Letâ€™s dissect the function.</p>
<h2><a name="p-2569-getting-the-offset-and-size-5" class="anchor" href="#p-2569-getting-the-offset-and-size-5"></a>Getting the Offset and Size</h2>
<p>The first thing to do is to retrieve the section offset and size. These values were stored in the ELF header by the off-line crypter, and now we have to retrieve them.</p>
<p>So, when a program is executed, the beginning of the file is directly loaded at a default memory address. For 64bits ELF Linux files, this address is <code>0x400000</code>. To keep it simple we just assume that this is always the case.</p>
<blockquote>
<p>You can force the loading of the program in a different address using special linker flags. Also note that PIE (Position Independent Executables) binaries are mapped at different addresses.</p>
</blockquote>
<p>What all this means, is that the ELF header (the same bytes at the beginning of the program file) is available at address <code>0x4000000</code>, and therefore we can easily retrieve our data from the header at offsets <code>0x09</code> and <code>0x0d</code>. This is what the two first lines do.</p>
<h2><a name="p-2569-finding-the-codes-pages-6" class="anchor" href="#p-2569-finding-the-codes-pages-6"></a>Finding the Codeâ€™s Pages</h2>
<p>Well, this probably needs some explanation. We need to use the system call <code>mprotect</code> to change the memory permissions of our <code>.secure</code> section. Executable code goes into segments with the read and the execution permissions, but not the write permission. We want to decrypt a memory block located in that area, and for that, either we allocate another memory block to write the decoded bytes and then do some manipulations of the op-codes (something that may be a bit complex), or we just change permissions and decode in-place.</p>
<p>So, <code>mprotect</code> expects as first parameter a pointer that is page alignedâ€¦ Check the man page if you do not believe me.</p>
<p>There is no reason for our <code>.secure</code> section to be page aligned. Actually, it will probably be somewhere in the middle of a page, or even laying between two different pages. So, we have to find out the page boundary for the memory block we are interested on. Then, we can change the page permissions to decrypt the code store there, and write it back in the same place.</p>
<h2><a name="p-2569-understanding-paging-7" class="anchor" href="#p-2569-understanding-paging-7"></a>Understanding Paging</h2>
<p>If you are already familiar with concept of <em>Memory Page</em> you can skip this section. Otherwise keep reading.</p>
<p>There are two main memory management strategies: Pagination and Segmentation. In practice, you will always find a combination of both: Segmented Pagination or Paged Segmentation (roughly). At the end, it all depends on the support provided by the processor. Actually the support provided by the <strong>MMU</strong> (<em>Memory Management Unit</em>). Modern processors have an integrated MMU, but old ones use to have an external one (another chip in the board).</p>
<p>Anyway, the processor will keep a table of pages or segments, depending on how it was designed, and will provide mechanisms to assign, among other things permissions to them. This is the basis for virtual memory managementâ€¦ we need the processor to produce <em>page faults</em> to swap in and out pieces of memoryâ€¦ Anyway, we want to change those permissions, otherwise, the MMU will generate a exceptionâ€¦ a segmentation fault.</p>
<p>From our application point of view, segments are defined by the ELF format as a base address and a size. An those segment will span through one or more pages. Pages are just defined by a page size. Think about them as an array. The whole memory gets organized in chunks of the page size. Letâ€™s see how a 1Mb memory looks when it is organized in 4Kb pages (4096 bytes or in hexadecimal <code>0x1000</code>):</p>
<pre><code>0x00000  |-----------|
         |           | 
         |...........| 0x00XXX
         |           | 
0x01000  |-----------|
         |           | 
         |...........| 0x01XXX
         |           | 
0x02000  |-----------|
             ...       0xffXXX
0xff000  |-----------| 0xfffff
</code></pre>
<p>So, the two high bits in the address, represents the page number/index, and the rest of the nibbles in the address, represents the offset within the page. Something like this:</p>
<p><code>0xPPOOO</code></p>
<ul>
<li><code>0xPP</code> : Page index (increases every <code>0x1000</code> bytes or 4Kb)</li>
<li><code>0xOOO</code> : Offset within page 0xPP (ranging from 0 to <code>0xfff</code>)</li>
</ul>
<p>If we just delete the last 3 nibbles of the address we are actually getting the page base address (<code>0XPP000</code>).</p>
<p>If you pay attention, you will see that, if our page size is, for instance <code>0x1000</code>, we can always get the page base address ANDing any address with the mask <code>0xff000</code>. Such an operation will delete the lower 3 nibbles (12 bits) in the address and automatically provide the base page address we need for <code>mprotect</code>.</p>
<p>So, given a page size, for instance <code>0x1000</code>, the mask we need is actually the arithmetic negative of that value, for our example <code>-0x1000</code> = <code>0xff000</code>.</p>
<h2><a name="p-2569-back-to-the-crypter-8" class="anchor" href="#p-2569-back-to-the-crypter-8"></a>Back to the Crypter</h2>
<p>Now, you should easily understand what the code in the <code>uncrypt</code> function does. It calculates the base page address of the page where the starting address of the <code>.secure</code> section (stored in the ELF header) is located. Then, we recalculate the size of our block with respect to the page base address, so we pass the right size to the <code>mprotect</code> system call. I think you understand why (code spanning multiple pages).</p>
<p>Now we can finally change permissions.</p>
<pre><code class="lang-auto">mprotect ((void*)pagestart, psize, PROT_READ | PROT_WRITE | PROT_EXEC) 
</code></pre>
<p>The <code>mprotect</code> will add write permissions (<code>PROT_WRITE</code>) to the pages were our crypted code is, so we can just run <code>xor_block</code> directly on the code and decrypt it.</p>
<p>After that, we call again <code>mprotect</code> to restore the permissions so our process does not look suspicious.</p>
<p>Well, all this thing is actually pretty simple. I think that trying to explain it for everybody I have manage to make this look very complicatedâ€¦ It is not, really.</p>
<h1><a name="p-2569-testing-9" class="anchor" href="#p-2569-testing-9"></a>Testing</h1>
<p>OK, letâ€™s do some testing to see in practice how all this works.</p>
<p>First, letâ€™s compile our test program. We have called it <code>prog</code> and it will run a function called <code>secure_main</code> that just prints a message and waits for the user to press a key:</p>
<pre><code>$ make prog
$ readelf -h prog | grep Magic
 Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00
$ objdump -d prog | grep -A 15 "\.secure"
Disassembly of section .secure:

00000000004008d8 &lt;secure_main&gt;:
  4008d8:	55                   	push   %rbp
  4008d9:	48 89 e5             	mov    %rsp,%rbp
  4008dc:	48 83 ec 10          	sub    $0x10,%rsp
  4008e0:	89 7d fc             	mov    %edi,-0x4(%rbp)
  4008e3:	48 89 75 f0          	mov    %rsi,-0x10(%rbp)
  4008e7:	bf 14 09 40 00       	mov    $0x400914,%edi
  4008ec:	e8 1f fc ff ff       	callq  400510 &lt;puts@plt&gt;
  4008f1:	e8 4a fc ff ff       	callq  400540 &lt;getchar@plt&gt;
  4008f6:	b8 00 00 00 00       	mov    $0x0,%eax
  4008fb:	c9                   	leaveq
  4008fc:	c3                   	retq
</code></pre>
<p>We can see that our Magic field in the ELF header looks good (all those 0s at the end), and that we have a normal function in the <code>.secure</code> section that prints something and then waits for the user input (<code>puts</code> + <code>getchar</code>).</p>
<p>Letâ€™s run our off-line crypter against this innocent program:</p>
<pre><code>$ ./crypter_rt prog
+ Encoding
+ 31 section in file. Looking for section '.secure'
+ Offsets: 0x8d8, 0x25
$ readelf -h prog | grep Magic
  Magic:   7f 45 4c 46 02 01 01 00 00 d8 08 00 00 25 00 00
$ objdump -d prog  | grep -A15 "\.secure"
Disassembly of section .secure:

00000000004008d8 &lt;secure_main&gt;:
  4008d8:	14 0a                	adc    $0xa,%al
  4008da:	ca a1 0d             	lret   $0xda1
  4008dd:	c5 ab 58 c8          	vaddsd %xmm0,%xmm10,%xmm1
  4008e1:	3f                   	(bad)
  4008e2:	bf 0c cc 33 b7       	mov    $0xb733cc0c,%edi
  4008e7:	f7 55 4b             	notl   0x4b(%rbp)
  4008ea:	03 44 ad 59          	add    0x59(%rbp,%rbp,4),%eax
  4008ee:	bb b7 be aa 09       	mov    $0x9aabeb7,%ebx
  4008f3:	b8 ba b9 ff 48       	mov    $0x48ffb9ba,%eax
  4008f8:	41                   	rex.B
  4008f9:	42                   	rex.X
  4008fa:	43                   	rex.XB
  4008fb:	8d                   	.byte 0x8d
</code></pre>
<p>Now, the headerâ€™s <code>Magic</code> field contains some data. Actually the offset and size (the off-line crypter prints the values for you to check). The <code>.secure</code> section is now cryptedâ€¦ objdump cannot make sense out of it. However, if we run the program:</p>
<pre><code>$ ./prog
+ Ready to run!
This was crypted!
</code></pre>
<p>It works OK!</p>
<p>I have added the <code>getchar</code> function to stop the program execution so we can check the run-time memory map of the process. Run the program and while the process is waiting for the key, find out the process PID:</p>
<p><code>ps ax | grep prog</code></p>
<p>Then check the memory map with the command:</p>
<pre><code>$ cat /proc/PID/maps

00400000-00401000 r-xp 00000000 08:06 6700454                            /home/pico/prog
00600000-00601000 r--p 00000000 08:06 6700454                            /home/pico/prog
00601000-00602000 rw-p 00001000 08:06 6700454                            /home/pico/prog
7f8614f19000-7f86150cd000 r-xp 00000000 08:06 14224791                   /lib/x86_64-linux-gnu/libc-2.15.so
...
</code></pre>
<p>You can see how the code is mapped at <code>0x400000</code>  with read and execution permissions, but without write permissions (first line). You can try to remove the second <code>mprotect</code> in the <code>uncrypt</code> function and check how the run-time memory map will look like. A process with a executable and writable memory block is just suspiciousâ€¦</p>
<p>As usual, you can get the source code from github to play with it:</p>
<aside class="onebox githubfolder" data-onebox-src="../../../external.html?link=https://github.com/0x00pf/0x00sec_code/tree/master/crypter">
  <header class="source">
      <img src="../../../external.html?link=https://github.githubassets.com/favicons/favicon.svg" class="site-icon" alt="" width="32" height="32">

      <a href="../../../external.html?link=https://github.com/0x00pf/0x00sec_code/tree/master/crypter" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>

  <article class="onebox-body">
    <h3><a href="../../../external.html?link=https://github.com/0x00pf/0x00sec_code/tree/master/crypter" target="_blank" rel="noopener nofollow ugc">0x00sec_code/crypter at master Â· 0x00pf/0x00sec_code</a></h3>


  <p><span class="label1">Code for my 0x00sec.org posts. Contribute to 0x00pf/0x00sec_code development by creating an account on GitHub.</span></p>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<h1><a name="p-2569-next-10" class="anchor" href="#p-2569-next-10"></a>Next</h1>
<p>This crypter is very basic and there is a lot of room for improvement, but I hope you have got some tools to walk the next steps on your own. Anyway, I will drop a couple of ideas for you:</p>
<ul>
<li>Store the pointer and size of the memory portion to crypt somewhere else in the file instead of using the ELF headerâ€¦</li>
<li>Find alternative ways to specify the block (or blocks) of memory to encrypt/decrypt, instead of using the suspicious <code>.secure</code> section.</li>
<li>Use the ideas on the ELFun tutorial to inject your stub on any program so your can crypt programs even if they do not include the <strong>stub</strong> code.</li>
<li>What about crypt/decrypt on demand?..</li>
</ul>
<p>Looking forward to your progress!</p>
<p>Happy Hacking!<br>
pico</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="11" />
              <span class='post-likes'>11 Likes</span>
            </div>

                <div class='crawler-linkback-list' itemscope itemtype='../../../external.html?link=http://schema.org/ItemList'>
                      <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                        <a itemprop='url' href="../../../external.html?link=https://0x00sec.org/t/polycrypt-experiments-on-self-modifying-programs/857">PolyCrypt. Experiments on Self-Modifying Programs</a>
                        <meta itemprop='position' content='4'>
                      </div>
                      <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                        <a itemprop='url' href="../../../external.html?link=https://0x00sec.org/t/elfun-file-injector/410/23">ELFun File Injector</a>
                        <meta itemprop='position' content='5'>
                      </div>
                </div>

            
          </div>
          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/_py.html'><span itemprop='name'>_py</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-06-01T22:06:10Z' class='post-time'>
                    June 1, 2016, 10:06pm
                  </time>
                  <meta itemprop='dateModified' content='2016-06-01T22:06:10Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>A lot to take in but educational at the same time. Good stuff pico!</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>


            
          </div>
          <div id='post_3' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/0x00pf.html'><span itemprop='name'>0x00pf</span></a>
                (pico)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-06-01T22:17:11Z' class='post-time'>
                    June 1, 2016, 10:17pm
                  </time>
                  <meta itemprop='dateModified' content='2016-06-01T22:17:11Z'>
              <span itemprop='position'>3</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Thanks <span class="mention">@airth</span> for the positive feedback. It is pretty much appreciated coming from you</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_4' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/oaktree.html'><span itemprop='name'>oaktree</span></a>
                (oaktree)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-06-01T22:25:02Z' class='post-time'>
                    June 1, 2016, 10:25pm
                  </time>
                  <meta itemprop='dateModified' content='2016-06-01T22:25:02Z'>
              <span itemprop='position'>4</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Youâ€™d lost me at the whole pagination thing, but then I scrolled down and saw your tangent and was relieved!</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_5' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/_py.html'><span itemprop='name'>_py</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-06-01T22:34:02Z' class='post-time'>
                    June 1, 2016, 10:34pm
                  </time>
                  <meta itemprop='dateModified' content='2016-06-01T22:34:02Z'>
              <span itemprop='position'>5</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Do you recommend any ELF, PE structure documentation?</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_6' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/oaktree.html'><span itemprop='name'>oaktree</span></a>
                (oaktree)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-06-01T23:24:50Z' class='post-time'>
                    June 1, 2016, 11:24pm
                  </time>
                  <meta itemprop='dateModified' content='2016-06-01T23:24:50Z'>
              <span itemprop='position'>6</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Wouldnâ€™t you just look at the <a href="../../../external.html?link=https://en.wikipedia.org/wiki/COFF" rel="nofollow noopener">COFF</a> and maybe some RFCs?</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_7' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/_py.html'><span itemprop='name'>_py</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-06-01T23:57:09Z' class='post-time'>
                    June 1, 2016, 11:57pm
                  </time>
                  <meta itemprop='dateModified' content='2016-06-01T23:57:09Z'>
              <span itemprop='position'>7</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>I have looked at a bunch of links. <a class="mention" href="../../u/0x00pf.html">@0x00pf</a> just seems to know more than the links I read.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_8' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/oaktree.html'><span itemprop='name'>oaktree</span></a>
                (oaktree)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-06-01T23:58:40Z' class='post-time'>
                    June 1, 2016, 11:58pm
                  </time>
                  <meta itemprop='dateModified' content='2016-06-01T23:58:40Z'>
              <span itemprop='position'>8</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Thatâ€™s always exciting, when a person you know seems to know more than Google (<em>about a subject</em>).</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="3" />
              <span class='post-likes'>3 Likes</span>
            </div>


            
          </div>
          <div id='post_9' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/0x00pf.html'><span itemprop='name'>0x00pf</span></a>
                (pico)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-06-02T05:12:22Z' class='post-time'>
                    June 2, 2016,  5:12am
                  </time>
                  <meta itemprop='dateModified' content='2016-06-02T05:12:22Z'>
              <span itemprop='position'>9</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>I know. That part was a bit messyâ€¦ and I re-wrote it a couple of times. I probably should try again in a week or two <img src="../../../0x00sec.org/images/emoji/twitter/slight_smilec164.html?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_10' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/0x00pf.html'><span itemprop='name'>0x00pf</span></a>
                (pico)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-06-02T05:15:12Z' class='post-time'>
                    June 2, 2016,  5:15am
                  </time>
                  <meta itemprop='dateModified' content='2016-06-02T05:15:12Z'>
              <span itemprop='position'>10</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p><span class="mention">@airth</span>, the best are the specification<br>
<aside class="onebox pdf">
  <header class="source">
      <a href="../../../external.html?link=https://refspecs.linuxbase.org/elf/elf.pdf" target="_blank" rel="nofollow noopener">refspecs.linuxbase.org</a>
  </header>
  <article class="onebox-body">
    <a href="../../../external.html?link=https://refspecs.linuxbase.org/elf/elf.pdf" target="_blank" rel="nofollow noopener"><span class="pdf-onebox-logo"></span></a>
<h3><a href="../../../external.html?link=https://refspecs.linuxbase.org/elf/elf.pdf" target="_blank" rel="nofollow noopener">elf.pdf</a></h3>

<p class="filesize">337.12 KB</p>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
</p>
<p>and the includes (<code>/usr/include/elf.h</code>). There are many pages describing the format but, once you now what is it about, the specification is the main document you need.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_11' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/0x00pf.html'><span itemprop='name'>0x00pf</span></a>
                (pico)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-06-02T05:33:46Z' class='post-time'>
                    June 2, 2016,  5:33am
                  </time>
                  <meta itemprop='dateModified' content='2016-06-02T05:33:46Z'>
              <span itemprop='position'>11</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote no-group" data-username="oaktree" data-post="6" data-topic="537" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../user_avatar/d.clarkee.co.uk/oaktree/48/4077_2.png" class="avatar"> oaktree:</div>
<blockquote>
<p>Wouldnâ€™t you just look at the COFF and maybe some RFCs?</p>
</blockquote>
</aside>
<p>COFF is indeed a reference for PEâ€¦ but ELF is not based on COFF. Anyway, they share a lot of concepts.<br>
Also thanks for your words ;), thatâ€™s appreciated</p>
<aside class="quote no-group" data-username="airth" data-post="7" data-topic="537">
<div class="title">
<div class="quote-controls"></div>
 airth:</div>
<blockquote>
<p>I have looked at a bunch of links</p>
</blockquote>
</aside>
<p>I have found myself this link very useful.</p>
<aside class="onebox allowlistedgeneric" data-onebox-src="../../../external.html?link=https://phrack.org/issues/58/5">
  <header class="source">
      <img src="../../../phrack.org/favicon-32x32.png" class="site-icon" alt="" width="32" height="32">

      <a href="../../../external.html?link=https://phrack.org/issues/58/5" target="_blank" rel="noopener nofollow ugc">Phrack</a>
  </header>

  <article class="onebox-body">
    <img width="" height="" src="../../../phrack.org/images/p40ylogo.html" class="thumbnail" alt="">

<h3><a href="../../../external.html?link=https://phrack.org/issues/58/5" target="_blank" rel="noopener nofollow ugc">Runtime binary encryption</a></h3>

  <p>Click to read the article on phrack</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>It is 15 years old, but the ELF format havenâ€™t change much since that <img src="../../images/emoji/twitter/slight_smile8e5e.png?v=15" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"> (and phrackâ€¦ well itâ€™s phrack). For the young onesâ€¦ that code at the end is <strong>uuencoded</strong> . The Silvio Cesare papers (in the references of the phrack article) were really goodâ€¦ apparently old those paper about <em>virus</em> have disappear from the Internetâ€¦ OK I havenâ€™t searched in deep, but the works from Mr Cesare should just pop-up in any regular search.</p>
<p>Maybe is because of this:</p>
<aside class="onebox wikipedia" data-onebox-src="../../../external.html?link=https://en.wikipedia.org/wiki/Silvio_Cesare#Controversies">
  <header class="source">

      <a href="../../../external.html?link=https://en.wikipedia.org/wiki/Silvio_Cesare#Controversies" target="_blank" rel="noopener nofollow ugc">en.wikipedia.org</a>
  </header>

  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:250/333;"><img src="../../../upload.wikimedia.org/wikipedia/commons/thumb/d/dd/Silvio_pondering_the_enormity_of_his_invention.jpg/250px-Silvio_pondering_the_enormity_of_his_invention.jpg" class="thumbnail" width="250" height="333"></div>

<h3><a href="../../../external.html?link=https://en.wikipedia.org/wiki/Silvio_Cesare#Controversies" target="_blank" rel="noopener nofollow ugc">Silvio Cesare</a></h3>

<p>
 Silvio Cesare (/tÊƒÉ›ËˆzÃ¦reÉª/ chez-ARR-ay)[citation needed] is an Australian security researcher known for his multiple articles in phrack, talks at numerous security conferences including Defcon and Black Hat Briefings. Silvio is also a former member of w00w00. His security research includes an IDS evasion bug in the widely deployed Snort software. Silvio holds a PhD in Computer Science from Deakin University and is the co-founder of the security conference BSides Canberra. He earned Silvio is th...</p>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>


            
          </div>
          <div id='post_12' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/pry0cc.html'><span itemprop='name'>pry0cc</span></a>
                (Leader &amp; Offsec Engineer &amp; Forum Daddy)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-06-02T08:47:24Z' class='post-time'>
                    June 2, 2016,  8:47am
                  </time>
                  <meta itemprop='dateModified' content='2016-06-02T08:47:24Z'>
              <span itemprop='position'>12</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>AWESOME Job man. This is really good. Everything from the code to the writing is quality!</p>
<p>â€œPointer gymnasticsâ€ made me crack up <img src="../../../0x00sec.org/images/emoji/twitter/smileyc164.html?v=9" title=":smiley:" class="emoji" alt=":smiley:"></p>
<p>Canâ€™t wait to see your next article <img src="../../../0x00sec.org/images/emoji/twitter/winkc164.html?v=9" title=":wink:" class="emoji" alt=":wink:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_13' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/system.html'><span itemprop='name'>system</span></a>
                (system)
                  Closed 
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-01-21T00:42:10Z' class='post-time'>
                    January 21, 2018, 12:42am
                  </time>
                  <meta itemprop='dateModified' content='2018-01-21T00:42:10Z'>
              <span itemprop='position'>13</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>This topic was automatically closed after 30 days. New replies are no longer allowed.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
    </div>


    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../index.html' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../categories.html' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../guidelines.html' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../tos.html' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../privacy.html' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    <script src="../../../external.html?link=http://instant.page/3.0.0" type="module" defer="" integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1" nonce="9BCwesBBpnUBGFWSZP9102Hy9"></script>
  </body>
  
</html>
