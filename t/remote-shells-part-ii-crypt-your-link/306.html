<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Remote Shells. Part II. Crypt your link - Networking - 0x00sec - The Home of the Hacker</title>
    <meta name="description" content="In Part I of this series we learn how to enable a very basic remote shell access to a machine. In this second part we are going to modify the code to support some level of manipulation of the data transmitted over the li&amp;hellip;">
    <meta name="generator" content="Discourse 3.6.0.beta2-latest - https://github.com/discourse/discourse version 3b1964f3ed8bdc2f181e2abccb1b116e4b814db5">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.html">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.html">
<meta name="theme-color" media="all" content="#171616">

<meta name="color-scheme" content="dark">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="306.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">

    
    <link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4.css_%3b%20filename_%3dUTF-8%27%27color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" class="light-scheme" data-scheme-id="15"/>

<link href="../../stylesheets/common_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27common_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common"  />

  <link href="../../stylesheets/mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile"  />
  <link href="../../stylesheets/desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop"  />



    <link href="../../stylesheets/chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="chat"  />
    <link href="../../stylesheets/checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="checklist"  />
    <link href="../../stylesheets/discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-cakeday"  />
    <link href="../../stylesheets/discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="../../stylesheets/discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="../../stylesheets/discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="../../stylesheets/discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="../../stylesheets/discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="../../stylesheets/discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-solved"  />
    <link href="../../stylesheets/discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-templates"  />
    <link href="../../stylesheets/discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-topic-voting"  />
    <link href="../../stylesheets/docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="../../stylesheets/footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="../../stylesheets/poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="poll"  />
    <link href="../../stylesheets/spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="../../stylesheets/chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="chat_mobile"  />
    <link href="../../stylesheets/discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-solved_mobile"  />
    <link href="../../stylesheets/discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-topic-voting_mobile"  />
    <link href="../../stylesheets/chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="chat_desktop"  />
    <link href="../../stylesheets/discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="discourse-topic-voting_desktop"  />
    <link href="../../stylesheets/poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="poll_desktop"  />

  <link href="../../stylesheets/common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960db.css_%3b%20filename_%3dUTF-8%27%27common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960dba97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="57" data-theme-name="0x00sec-v2"/>
    <link href="../../stylesheets/mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38.css_%3b%20filename_%3dUTF-8%27%27mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile_theme" data-theme-id="4" data-theme-name="mobile chrome"/>
    <link href="../../stylesheets/desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2"/>

    <link rel="stylesheet" href="../../../external.html?link=https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="../../../external.html?link=https://s3.amazonaws.com/0x00sec/highlight.pack.js" nonce="gugd3qre92OTAzvcc3tmHV9FC"></script>
<script defer="" src="../../theme-javascripts/05954ff525aceb8daa8b585f92d758d311ae7077.js_%3b%20filename_%3dUTF-8%27%2705954ff525aceb8daa8b585f92d758d311ae7077a97f.js?__ws=d.clarkee.co.uk" data-theme-id="40" nonce="gugd3qre92OTAzvcc3tmHV9FC"></script>
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Remote Shells. Part II. Crypt your link&#39;" href="306.rss" />
    <meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://0x00sec.s3.amazonaws.com/original/2X/a/a35c2bf9477f702a5322cfd1c8f54353d79c1d16.png" />
<meta property="og:image" content="https://0x00sec.s3.amazonaws.com/original/2X/a/a35c2bf9477f702a5322cfd1c8f54353d79c1d16.png" />
<meta property="og:url" content="https://d.clarkee.co.uk/t/remote-shells-part-ii-crypt-your-link/306" />
<meta name="twitter:url" content="https://d.clarkee.co.uk/t/remote-shells-part-ii-crypt-your-link/306" />
<meta property="og:title" content="Remote Shells. Part II. Crypt your link" />
<meta name="twitter:title" content="Remote Shells. Part II. Crypt your link" />
<meta property="og:description" content="In Part I of this series we learn how to enable a very basic remote shell access to a machine. In this second part we are going to modify the code to support some level of manipulation of the data transmitted over the link. Specifically, we are going to encrypt the data stream‚Ä¶ :o  LEVEL: Beginner  How are we going to do that? In order to crypt our communication, we need something in front of the shell that gets the data from/to the network and crypts/decrypts it. This can be done in many differ..." />
<meta name="twitter:description" content="In Part I of this series we learn how to enable a very basic remote shell access to a machine. In this second part we are going to modify the code to support some level of manipulation of the data transmitted over the link. Specifically, we are going to encrypt the data stream‚Ä¶ :o  LEVEL: Beginner  How are we going to do that? In order to crypt our communication, we need something in front of the shell that gets the data from/to the network and crypts/decrypts it. This can be done in many differ..." />
<meta property="og:article:section" content="Networking" />
<meta property="og:article:section:color" content="8C6238" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="5 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="20 ‚ù§" />
<meta property="article:published_time" content="2016-05-11T18:25:06+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    <div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">
  <!--<a href="https://git.0x00sec.org" class="dow-menu">GitLab</a>  
  <a href="https://blog.0x00sec.org/irc" class="dow-menu">IRC</a>!-->
  <a href="../../../external.html?link=https://init.0x00sec.org/" class="dow-menu">Init</a>
  <a href="../../../external.html?link=https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
  <a href="../../../external.html?link=https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
    <header>
  <a href="../../index.html">0x00sec - The Home of the Hacker</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="306.html">Remote Shells. Part II. Crypt your link</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/networking/63.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #8C6238'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Networking</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='../../../external.html?link=http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Remote Shells. Part II. Crypt your link'>
      <link itemprop='url' href='306.html'>
      <meta itemprop='datePublished' content='2016-05-11T18:25:06Z'>
        <meta itemprop='articleSection' content='Networking'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
        <meta itemprop='name' content='0x00sec - The Home of the Hacker'>
          <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
            <meta itemprop='url' content='../../uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.html'>
          </div>
      </div>


          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/0x00pf.html'><span itemprop='name'>0x00pf</span></a>
                (pico)
              </span>

                <link itemprop="mainEntityOfPage" href="306.html">

                <link itemprop="image" href="../../../0x00sec.s3.amazonaws.com/original/2X/a/a35c2bf9477f702a5322cfd1c8f54353d79c1d16.png">

              <span class="crawler-post-infos">
                  <time  datetime='2016-05-11T18:25:06Z' class='post-time'>
                    May 11, 2016,  6:25pm
                  </time>
                  <meta itemprop='dateModified' content='2016-05-11T18:25:06Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>In <a href="../../../external.html?link=https://0x00sec.org/t/remote-shells-part-i/269/1">Part I</a> of this series we learn how to enable a very basic remote shell access to a machine. In this second part we are going to modify the code to support some level of manipulation of the data transmitted over the link. Specifically, we are going to encrypt the data stream‚Ä¶ :o</p>
<p><strong>LEVEL: Beginner</strong></p>
<h2>How are we going to do that?</h2>
<p>In order to crypt our communication, we need something in front of the shell that gets the data from/to the network and crypts/decrypts it. This can be done in many different ways.</p>
<p>This time we have choose to launch the shell as a separated child process and use a <strong>socketpair</strong> to transfer the data received/sent through the network to the shell process.  The father process will then crypt and decrypt the data going into/coming from the network/shell. This may look a bit confusing at first glance, but that is just because of my writing :).</p>
<p>A <strong>socketpair</strong> is just a pair of sockets that are immediately connected. Something like running the client and server code in just one system call. Conceptually they behave as a <strong>pipe</strong> but the main difference is that the sockets are bidirectional in opposition to a pipe where one of the file descriptors is read only and the other one is write only.</p>
<p><strong>socketpairs</strong> are a convenient IPC (InterProcess Communication) mechanism and fits pretty well in our network oriented use case‚Ä¶ because they are sockets after all.</p>
<h2>Spawning a shell</h2>
<p>Let‚Äôs start from our previous example and add a couple of functions. The first one will set up the socket pair and create a new process (using <strong>fork</strong>). Let‚Äôs take a first look to the whole function before continuing.</p>
<pre><code class="lang-auto">void
secure_shell (int s)
{
  pid_t  pid;
  int    sp[2];

  /* Create a socketpair to talk to the child process */
  if ((socketpair (AF_UNIX, SOCK_STREAM, 0, sp)) &lt; 0)
    {
      perror ("socketpair:");
      exit (1);
    }

  /* Fork a child process */
  if ((pid = fork ()) &lt; 0)
    {
      perror ("fork:");
      exit (1);
    }
  else
    if (!pid) /* If we are the child Process */
      {
	close (sp[1]);
	close (s);

	/* Start the shell as in part I*/
	start_shell (sp[0]);
	/* This function will never return */
      }

  /* At this point we are the father process */
  close (sp[0]);

  printf ("+ Starting async read loop\n");
  async_read (s, sp[1]);

}

</code></pre>
<p>First, we create a socket pair using the syscall <strong>socketpair</strong>). The last parameter is an array where we will get our pair of sockets. Obviously we can only use local sockets (<code>AF_UNIX</code> or <code>AF_LOCAL</code> they are the same) at least on GNU/Linux. As mentioned before, those sockets will be connected meaning that, what you send through one of them is received in the other, and the other way around. This is very convenient as we do not have to write all those <code>bind</code>, <code>listen</code>, <code>accept</code> and <code>connect</code>‚Ä¶ We get all that with just one system call.</p>
<p>Once we have our socket pair we will create a new process using the <strong>fork</strong> syscall. The <code>fork</code> system call creates a new process as  an identical image of the calling process, same code, same data, same open files, same sockets‚Ä¶ The only difference between the child process and the father process is that the <code>pid</code> variable will be 0 for the child and will be the child pid for the father.</p>
<p>So we check the <code>pid</code> variable and if we are the child (<code>!pid</code>) we close the file descriptors that we do not need anymore and we just start a shell using the <code>start_shell</code> function from Part I, but passing as parameter one of the connected sockets returned by <code>socketpair</code>.</p>
<p>Everything from this point on is the same that with our first remote code in Part I, but instead of feeding data into our shell directly from the network, we will be sending/receiving data using the counterpart socket provided by <code>socketpair</code>.</p>
<h2>Asynchronous Read</h2>
<p>The last part of the <code>secure_shell</code> function is executed by the father process. It calls a function that we have named <code>async_read</code>. This function will do the following:</p>
<ul>
<li>Whenever something is received from the network, it will decode the data and send it to the shell using the counterpart socket we have got from the <code>socketpair</code> system call.</li>
<li>At the same time, whenever the shell produces some output, the function will read that data, crypt it and send it through the network.</li>
</ul>
<p>It make sense, isn‚Äôt it?. Now we just need to figure out how to implement this. Well, for instance, let‚Äô use the <code>select</code> system call (we could use <code>poll</code> but I will reserve it for a later post).</p>
<p>So, this is the code for the <code>async_read</code> function</p>
<pre><code class="lang-auto">void
async_read (int s, int s1)
{
  fd_set         rfds;
  struct timeval tv;
  int            max = s &gt; s1 ? s : s1;
  int            len, r;
  char           buffer[1024];

  max++;
  while (1)
    {
      FD_ZERO(&amp;rfds);
      FD_SET(s,&amp;rfds);
      FD_SET(s1,&amp;rfds);

      /* Time out. */
      tv.tv_sec = 1;
      tv.tv_usec = 0;

      if ((r = select (max, &amp;rfds, NULL, NULL, &amp;tv)) &lt; 0)
	{
	  perror ("select:");
	  exit (EXIT_FAILURE);
	}
      else if (r &gt; 0) /* If there is data to process */
	{
	  if (FD_ISSET(s, &amp;rfds))
	    {
	      memset (buffer, 0, 1024);
	      if ((len = read (s, buffer, 1024)) &lt;= 0) 	exit (1);
	      memfrob (buffer, len);

	      write (s1, buffer, len);
	    }
	  if (FD_ISSET(s1, &amp;rfds))
	    {
	      memset (buffer, 0, 1024);
	      if ((len = read (s1, buffer, 1024)) &lt;= 0) exit (1);

	      memfrob (buffer, len);
	      write (s, buffer, len);
	    }
	}
    }
}
</code></pre>
<p>This is a standard <code>select</code> loop for a network application. It is nothing really special about it, but, in case you haven‚Äôt seen one before (there is a first time for everything), here it come a brief explanation.</p>
<p><code>select</code> let us monitor many file descriptor at once. We provide the syscall with a list of file descriptors to monitor and, whenever there is data to read, it is possible to write or an exception happen on any of them, <code>select</code> will let us know. Let‚Äôs see how to use it.</p>
<p><code>select</code> requires at least 2 non-NULL parameters, and you should usually use three:</p>
<ul>
<li>An integer indicating the highest-numbered file descriptor to monitor plus 1. Check the declaration of variable max to see what does that mean (note: file descriptors are just integers).</li>
<li>A File descriptor set that will contain the list of file descriptors to monitor for reading (this is the fd_set variable)</li>
<li>A timeout. When the timeout is NULL, select will block until something happens in any of the file descriptors passed as parameters. If a timeout is specified, the function will return if nothing have happened during the period of time indicated by the timeout.</li>
</ul>
<p>The two <code>NULL</code> parameters are additional file descriptors sets for writing and for exceptions, but we are not going to talk about those now.</p>
<p>The system call returns the number of file descriptors that have data to be read (because we are only using the read file descriptor set) or 0 if the call has timed out.</p>
<p>For the reader convenience we repeat the code to set up the select call here.</p>
<pre><code class="lang-auto">      FD_ZERO(&amp;rfds);
      FD_SET(s,&amp;rfds);
      FD_SET(s1,&amp;rfds);

      /* Time out. */
      tv.tv_sec = 1;
      tv.tv_usec = 0;

      if ((r = select (max, &amp;rfds, NULL, NULL, &amp;tv)) &lt; 0)
	{
	  perror ("select:");
	  exit (EXIT_FAILURE);
	}
</code></pre>
<p>Before each call to <code>select</code> we always have to initialize the file descriptor set. This is done with two macros. <code>FD_ZERO</code> initializes the set. <code>FD_SET</code> allow us to add file descriptors to the set. In our case we have to add our network connected socket (<code>s</code>) and also our paired socket (<code>s1</code>).</p>
<p>The timeout is specified with a <code>struct timeval</code> type that gives us microseconds resolution. In our case we have set the timeout to 1 second.</p>
<p>At this point we can call select and wait for the data to come.</p>
<h2>Processing the data</h2>
<p><code>select</code> tell us that we have got something in some of the file descriptors in our set, but we have to find out which one actually received the data. Again, let‚Äôs repeat the relevant code here for convenience.</p>
<pre><code class="lang-auto">	  if (FD_ISSET(s, &amp;rfds))
	    {
	      memset (buffer, 0, 1024);
	      if ((len = read (s, buffer, 1024)) &lt;= 0) 	exit (1);
	      memfrob (buffer, len);

	      write (s1, buffer, len);
	    }
	  if (FD_ISSET(s1, &amp;rfds))
	    {
	      memset (buffer, 0, 1024);
	      if ((len = read (s1, buffer, 1024)) &lt;= 0) exit (1);

	      memfrob (buffer, len);
	      write (s, buffer, len);
	    }
</code></pre>
<p>In the general case you will have a loop to check every file descriptor in your set. In this case we only have 2 so a couple of if will do the trick. Think about it as a loop <a href="../../../external.html?link=https://en.wikipedia.org/wiki/Loop_unrolling" rel="noopener nofollow ugc">unrolling optimization</a> :). Yes, all right, we can make the if block into a function‚Ä¶ But‚Ä¶ I have to leave something for you to try <img src="../../../0x00sec.org/images/emoji/twitter/winkc164.html?v=9" title=":wink:" class="emoji" alt=":wink:"> (actually there is a reason for this but it is out of scope at this point)</p>
<p>So, if we get data in our network socket, we just read the data, decrypt it and resend it to our shell. If we get data from our shell, we read it, we crypt it and we send it back to the network client.</p>
<p>That‚Äôs it. The <code>memfrob</code> function does a XOR crypting with key (<a href="../../../external.html?link=https://en.wikipedia.org/wiki/The_Hitchhiker's_Guide_to_the_Galaxy_(novel)" rel="noopener nofollow ugc">42</a>). The greatest thing about XOR crypting is that the same function can be used for crypt and decrypt. Other than that, with a 1 byte long key (42 in this case) it is pretty useless.</p>
<h2>A Secure Client</h2>
<p>OK, now we have a way to receive and send crypt data from/to our shell. We need a counterpart to our program that can deal with this crypt data. No problem, we just need to make a small change to our main function, and we will be done.</p>
<p>The new <code>main</code> function looks like this:</p>
<pre><code class="lang-auto">int
main (int argc, char *argv[])
{
  /* FIXME: Check command-line arguments */
  if (argv[1][0] == 'c')
    secure_shell (client_init (argv[2], atoi(argv[3])));
  else if (argv[1][0] == 's')
    secure_shell (server_init (atoi(argv[2])));
  else if (argv[1][0] == 'a')
    async_read (client_init (argv[2], atoi(argv[3])), 0);
  else if (argv[1][0] == 'b')
    async_read (server_init (atoi(argv[2])), 0);
		  
  return 0;
}
</code></pre>
<p>We exploit the fact that everything on UNIX is a file descriptor. Using file descriptor 0 (that is the standard input or <code>stdin</code>), and our <code>async_read</code> function we get automatically a working secure client.</p>
<p>Using that trick, two additional flags had been added to launch the application as a client for direct and reverse remote shell access.</p>
<h2>Testing again</h2>
<p>Now, you already know how to compile your program so, let‚Äôs go straight to test our secure remote shell.</p>
<p>Open two terminals to run the shell and the client and also fire up your preferred sniffer. You may want to use wireshark and take advantage of its nice ‚ÄúFollow TCP Stream‚Äù feature. Now, start capturing traffic in the loopback interface.</p>
<p>In one terminal type:</p>
<pre><code class="lang-auto">$ ./rss s 5000
</code></pre>
<p>In the other terminal type</p>
<pre><code class="lang-auto">$ ./rss a 127.0.0.1 5000
</code></pre>
<p>Everything will look like our original remote shell. Just type a couple of commands and then go back to wireshark and take a look to what was sent through the network‚Ä¶ Sure, that is how a XOR crypted shell session looks like!</p>
<h2>NEXT</h2>
<p>For the time being, the NEXT step I leave it to you, appreciated reader. There is a bunch of things you can try with very little modification of this small program.</p>
<ul>
<li>Try to add a password to only allow authorized user access your remote shell</li>
<li>Try to use a proper crypto algorithm‚Ä¶openssl somebody?</li>
<li>Try to use a different communication protocol‚Ä¶ what about using an IRC channel to access your remote shell</li>
<li>Try to access special commands in the server and not just forward everything to the shell (this is a generalization of the first point)</li>
</ul>
<p>Let‚Äôs see what you come out with‚Ä¶</p>
<p>As usual you can find all the source code at:</p>
<aside class="onebox allowlistedgeneric">
  <header class="source">
      <img src="../../../external.html?link=https://github.githubassets.com/favicons/favicon.svg" class="site-icon" width="32" height="32">
      <a href="../../../external.html?link=https://github.com/0x00pf/0x00sec_code" target="_blank" rel="noopener nofollow ugc">GitHub</a>
  </header>
  <article class="onebox-body">
    <img src="../../../0x00sec.s3.amazonaws.com/original/2X/a/a35c2bf9477f702a5322cfd1c8f54353d79c1d16.png" class="thumbnail" width="" height="">

<h3><a href="../../../external.html?link=https://github.com/0x00pf/0x00sec_code" target="_blank" rel="noopener nofollow ugc">0x00pf/0x00sec_code</a></h3>

<p>Code for my 0x00sec.org posts. Contribute to 0x00pf/0x00sec_code development by creating an account on GitHub.</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Happy Hacking!</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="12" />
              <span class='post-likes'>12 Likes</span>
            </div>

                <div class='crawler-linkback-list' itemscope itemtype='../../../external.html?link=http://schema.org/ItemList'>
                      <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                        <a itemprop='url' href="../../../external.html?link=https://0x00sec.org/t/remote-shells-part-iv-the-invisible-remote-shell/743">Remote Shells Part IV. The Invisible Remote Shell</a>
                        <meta itemprop='position' content='5'>
                      </div>
                      <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                        <a itemprop='url' href="../../../external.html?link=https://0x00sec.org/t/how-do-those-hackers-tools-work-proxychains/426">How do those hackers&#39; tools work? Proxychains</a>
                        <meta itemprop='position' content='6'>
                      </div>
                </div>

            
          </div>
          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/_py.html'><span itemprop='name'>_py</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-05-11T19:29:46Z' class='post-time'>
                    May 11, 2016,  7:29pm
                  </time>
                  <meta itemprop='dateModified' content='2016-05-11T19:29:46Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Quality as always pico, keep it up <img src="../../../0x00sec.org/images/emoji/twitter/slight_smilec164.html?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_3' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/pry0cc.html'><span itemprop='name'>pry0cc</span></a>
                (Leader &amp; Offsec Engineer &amp; Forum Daddy)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-05-12T12:39:23Z' class='post-time'>
                    May 12, 2016, 12:39pm
                  </time>
                  <meta itemprop='dateModified' content='2016-05-12T12:39:23Z'>
              <span itemprop='position'>3</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Quality article Pico! I‚Äôve been meaning to leave a comment the last couple of days, and I‚Äôve finally got around to it.</p>
<p>I‚Äôm so glad we have found you, you really are a valuable asset. These articles are very high quality <img src="../../../0x00sec.org/images/emoji/twitter/winkc164.html?v=9" title=":wink:" class="emoji" alt=":wink:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_4' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/IoTh1nkN0t.html'><span itemprop='name'>IoTh1nkN0t</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-05-12T12:59:34Z' class='post-time'>
                    May 12, 2016, 12:59pm
                  </time>
                  <meta itemprop='dateModified' content='2016-05-12T13:59:29Z'>
              <span itemprop='position'>4</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Grade A! Love it <img src="../../../0x00sec.org/images/emoji/twitter/smileyc164.html?v=9" title=":smiley:" class="emoji" alt=":smiley:"></p>
<p>I‚Äôll take the challenge for the proper encryption ^^<br>
Was thinking of PGP. I‚Äôll see if I can make that work, It‚Äôs about time to learn some encryption.</p>
<p>Also thanks for sharing the meaning of life <img src="../../../0x00sec.org/images/emoji/twitter/winkc164.html?v=9" title=":wink:" class="emoji" alt=":wink:"><br>
I couldnt find the 42 anywhere in the source though.</p>
<p>EDIT: Oops, I should check man pages before asking stupid questions ^^</p>
<p>EDIT2: Ended up learning Cryptography, gonna take a while for the PGP encrypted version.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>


            
          </div>
          <div id='post_5' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/0x00pf.html'><span itemprop='name'>0x00pf</span></a>
                (pico)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-05-12T15:49:53Z' class='post-time'>
                    May 12, 2016,  3:49pm
                  </time>
                  <meta itemprop='dateModified' content='2016-05-12T15:49:53Z'>
              <span itemprop='position'>5</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Thanks everybody for the positive feedback!</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_6' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/oaktree.html'><span itemprop='name'>oaktree</span></a>
                (oaktree)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-05-12T15:50:09Z' class='post-time'>
                    May 12, 2016,  3:50pm
                  </time>
                  <meta itemprop='dateModified' content='2016-05-12T15:50:09Z'>
              <span itemprop='position'>6</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>I‚Äôm going to have to read this a few times‚Ä¶</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_7' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/0x00pf.html'><span itemprop='name'>0x00pf</span></a>
                (pico)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-05-12T15:51:58Z' class='post-time'>
                    May 12, 2016,  3:51pm
                  </time>
                  <meta itemprop='dateModified' content='2016-05-12T15:51:58Z'>
              <span itemprop='position'>7</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Yeah‚Ä¶ I know‚Ä¶ my English is not the best</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_8' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/pry0cc.html'><span itemprop='name'>pry0cc</span></a>
                (Leader &amp; Offsec Engineer &amp; Forum Daddy)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-05-12T21:51:16Z' class='post-time'>
                    May 12, 2016,  9:51pm
                  </time>
                  <meta itemprop='dateModified' content='2016-05-12T21:51:16Z'>
              <span itemprop='position'>8</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>No your english is great! It‚Äôs the pure complexity that I think the reason why Oaktree will have to re-read this a few times! I think I will have to re-read this a few times myself!</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_9' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/IoTh1nkN0t.html'><span itemprop='name'>IoTh1nkN0t</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-05-12T23:19:17Z' class='post-time'>
                    May 12, 2016, 11:19pm
                  </time>
                  <meta itemprop='dateModified' content='2016-05-12T23:19:17Z'>
              <span itemprop='position'>9</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>OpenSSL is more complex then I thought.<br>
I was trying to do a copy-pasta, no clue how it works version, but it was no good.<br>
Currently learning the OpenSSL protocol.<br>
If I use OpenSSL, I don‚Äôt need the fork and childprocess right?</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_10' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/0x00pf.html'><span itemprop='name'>0x00pf</span></a>
                (pico)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-05-13T05:18:24Z' class='post-time'>
                    May 13, 2016,  5:18am
                  </time>
                  <meta itemprop='dateModified' content='2016-05-13T05:18:24Z'>
              <span itemprop='position'>10</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>True‚Ä¶ OpenSSL is not easy and the documentation is not the best either.</p>
<p>Regarding the forking I have to check but I think you have to use the openSSL functions to read/write crypt data. I do not think that just a <strong>dup2</strong> will work.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_11' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/oaktree.html'><span itemprop='name'>oaktree</span></a>
                (oaktree)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-05-13T13:12:00Z' class='post-time'>
                    May 13, 2016,  1:12pm
                  </time>
                  <meta itemprop='dateModified' content='2016-05-13T13:12:00Z'>
              <span itemprop='position'>11</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Yeah I meant that it‚Äôs kinda complex.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

                <div class='crawler-linkback-list' itemscope itemtype='../../../external.html?link=http://schema.org/ItemList'>
                      <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                        <a itemprop='url' href="../../../external.html?link=https://0x00sec.org/t/1337-of-the-w33k-5-9-5-13-2016/340">1337 of the w33k (5/9 - 5/13, 2016)</a>
                        <meta itemprop='position' content='1'>
                      </div>
                </div>

            
          </div>
          <div id='post_12' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/IoTh1nkN0t.html'><span itemprop='name'>IoTh1nkN0t</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-05-13T19:04:39Z' class='post-time'>
                    May 13, 2016,  7:04pm
                  </time>
                  <meta itemprop='dateModified' content='2016-05-13T19:04:39Z'>
              <span itemprop='position'>12</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>dup2 does work, you can use BIO/SSL_get_fd and BIO/SSL_set_fd</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_13' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/0x00pf.html'><span itemprop='name'>0x00pf</span></a>
                (pico)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-05-13T22:07:21Z' class='post-time'>
                    May 13, 2016, 10:07pm
                  </time>
                  <meta itemprop='dateModified' content='2016-05-13T22:07:21Z'>
              <span itemprop='position'>13</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>As far as I understood how it works, you indeed have a socket at the very end to send/receive the data through the network, but it looks like OpenSSL works on top of the the socket. According to the examples I checked, you need to call <code>BIO/SSL_write</code> and <code>BIO/SSL_read</code> to crypt and decrypt.</p>
<p>I think that if you just dup the underlying file descriptor you will be sending the crypt data (received from the network) to the shell. If that is correct, the code should be similar to the one in this post, but instead of calling <code>write</code> and <code>read</code> on the network socket (within <code>async_read</code>) you will have to call <code>SSL_write</code> and <code>SSL_read</code>.</p>
<p><code>SSL_get_fd</code> and <code>SSL_set_fd</code> will be needed to setup the <code>select</code> fd sets and manage the <code>accept</code> call and so on.</p>
<p>I think it works like that, but I haven‚Äôt tried myself. Anyhow, looks like you are getting there. I‚Äôm looking forward to see your implementation!</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_14' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/IoTh1nkN0t.html'><span itemprop='name'>IoTh1nkN0t</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-05-13T22:15:01Z' class='post-time'>
                    May 13, 2016, 10:15pm
                  </time>
                  <meta itemprop='dateModified' content='2016-05-13T22:15:01Z'>
              <span itemprop='position'>14</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Yes I already got to that part and got the client side encrypted. However setting up the server side is a whole different story it seems. I found good documentation on the server side lacking and am currently researching. This is the reason I decided to learn OpenSSL from the ground up. I‚Äôll try throwing something together first a la ‚ÄòI don‚Äôt know why, but it works‚Äô.</p>
<p><a href="../../../external.html?link=http://www.ibm.com/developerworks/library/l-openssl/" rel="nofollow noopener">http://www.ibm.com/developerworks/library/l-openssl/</a> - tutorial, set up a client<br>
<a href="../../../external.html?link=https://www.openssl.org/docs/manmaster/" rel="nofollow noopener">https://www.openssl.org/docs/manmaster/</a> - man pages for OpenSSL<br>
Are some interesting sites for anyone that‚Äôs interested in OpenSSL programming.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_15' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/IoTh1nkN0t.html'><span itemprop='name'>IoTh1nkN0t</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-05-15T00:43:54Z' class='post-time'>
                    May 15, 2016, 12:43am
                  </time>
                  <meta itemprop='dateModified' content='2016-05-15T23:05:13Z'>
              <span itemprop='position'>15</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Nope you were right after all, dup2 doesn‚Äôt seem to be possible <img src="../../../0x00sec.org/images/emoji/twitter/sweat_smilec164.html?v=9" title=":sweat_smile:" class="emoji" alt=":sweat_smile:"><br>
I‚Äôm continuing this journey <img src="../../../0x00sec.org/images/emoji/twitter/relievedc164.html?v=9" title=":relieved:" class="emoji" alt=":relieved:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_16' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/system.html'><span itemprop='name'>system</span></a>
                (system)
                  Closed 
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-01-21T00:37:55Z' class='post-time'>
                    January 21, 2018, 12:37am
                  </time>
                  <meta itemprop='dateModified' content='2018-01-21T00:37:55Z'>
              <span itemprop='position'>16</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>This topic was automatically closed after 30 days. New replies are no longer allowed.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
    </div>


    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../index.html' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../categories.html' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../guidelines.html' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../tos.html' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../privacy.html' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    <script src="../../../external.html?link=http://instant.page/3.0.0" type="module" defer="" integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1" nonce="gugd3qre92OTAzvcc3tmHV9FC"></script>
  </body>
  
</html>
