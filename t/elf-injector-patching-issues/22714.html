<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>ELF Injector Patching Issues - Malware - 0x00sec - The Home of the Hacker</title>
    <meta name="description" content="Iâ€™ve been working on an ELFInjector inspired by @0x00pf  and analyzing his code and  using his payload from his github: 0x00sec_code/elfun/payload.asm at master Â· 0x00pf/0x00sec_code Â· GitHub 
My Code: https://github.com&amp;hellip;">
    <meta name="generator" content="Discourse 3.6.0.beta2-latest - https://github.com/discourse/discourse version 3b1964f3ed8bdc2f181e2abccb1b116e4b814db5">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.html">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.html">
<meta name="theme-color" media="all" content="#171616">

<meta name="color-scheme" content="dark">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="22714.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">

    
    <link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4.css_%3b%20filename_%3dUTF-8%27%27color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" class="light-scheme" data-scheme-id="15"/>

<link href="../../stylesheets/common_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27common_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common"  />

  <link href="../../stylesheets/mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile"  />
  <link href="../../stylesheets/desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop"  />



    <link href="../../stylesheets/chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="chat"  />
    <link href="../../stylesheets/checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="checklist"  />
    <link href="../../stylesheets/discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-cakeday"  />
    <link href="../../stylesheets/discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="../../stylesheets/discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="../../stylesheets/discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="../../stylesheets/discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="../../stylesheets/discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="../../stylesheets/discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-solved"  />
    <link href="../../stylesheets/discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-templates"  />
    <link href="../../stylesheets/discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-topic-voting"  />
    <link href="../../stylesheets/docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="../../stylesheets/footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="../../stylesheets/poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="poll"  />
    <link href="../../stylesheets/spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="../../stylesheets/chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="chat_mobile"  />
    <link href="../../stylesheets/discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-solved_mobile"  />
    <link href="../../stylesheets/discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-topic-voting_mobile"  />
    <link href="../../stylesheets/chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="chat_desktop"  />
    <link href="../../stylesheets/discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="discourse-topic-voting_desktop"  />
    <link href="../../stylesheets/poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="poll_desktop"  />

  <link href="../../stylesheets/common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960db.css_%3b%20filename_%3dUTF-8%27%27common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960dba97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="57" data-theme-name="0x00sec-v2"/>
    <link href="../../stylesheets/mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38.css_%3b%20filename_%3dUTF-8%27%27mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile_theme" data-theme-id="4" data-theme-name="mobile chrome"/>
    <link href="../../stylesheets/desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2"/>

    <link rel="stylesheet" href="../../../external.html?link=https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="../../../external.html?link=https://s3.amazonaws.com/0x00sec/highlight.pack.js" nonce="463RbNH2QqV82yaGwC4UoTAY7"></script>
<script defer="" src="../../theme-javascripts/05954ff525aceb8daa8b585f92d758d311ae7077.js_%3b%20filename_%3dUTF-8%27%2705954ff525aceb8daa8b585f92d758d311ae7077a97f.js?__ws=d.clarkee.co.uk" data-theme-id="40" nonce="463RbNH2QqV82yaGwC4UoTAY7"></script>
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;ELF Injector Patching Issues&#39;" href="22714.rss" />
    <meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://d.clarkee.co.uk/uploads/default/original/2X/2/27a5373af868edade07624e8205c46e79c247445.jpeg" />
<meta property="og:image" content="https://d.clarkee.co.uk/uploads/default/original/2X/2/27a5373af868edade07624e8205c46e79c247445.jpeg" />
<meta property="og:url" content="https://d.clarkee.co.uk/t/elf-injector-patching-issues/22714" />
<meta name="twitter:url" content="https://d.clarkee.co.uk/t/elf-injector-patching-issues/22714" />
<meta property="og:title" content="ELF Injector Patching Issues" />
<meta name="twitter:title" content="ELF Injector Patching Issues" />
<meta property="og:description" content="Iâ€™ve been working on an ELFInjector inspired by @0x00pf  and analyzing his code and  using his payload from his github: 0x00sec_code/elfun/payload.asm at master Â· 0x00pf/0x00sec_code Â· GitHub  My Code: https://github.com/digitalXmage/Elf-Injector-learning-  Everything works as expected, I Successfully insert the payload and if i donâ€™t change the entry point, the original code runs, as expected. If i change the entry point to the payload offset in the target file. The payload runs, However a segf..." />
<meta name="twitter:description" content="Iâ€™ve been working on an ELFInjector inspired by @0x00pf  and analyzing his code and  using his payload from his github: 0x00sec_code/elfun/payload.asm at master Â· 0x00pf/0x00sec_code Â· GitHub  My Code: https://github.com/digitalXmage/Elf-Injector-learning-  Everything works as expected, I Successfully insert the payload and if i donâ€™t change the entry point, the original code runs, as expected. If i change the entry point to the payload offset in the target file. The payload runs, However a segf..." />
<meta property="og:article:section" content="Malware" />
<meta property="og:article:section:color" content="F7941D" />
<meta property="og:article:tag" content="programming" />
<meta property="og:article:tag" content="linux" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="2 mins ðŸ•‘" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="11 â¤" />
<meta property="article:published_time" content="2020-08-15T11:24:52+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    <div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">
  <!--<a href="https://git.0x00sec.org" class="dow-menu">GitLab</a>  
  <a href="https://blog.0x00sec.org/irc" class="dow-menu">IRC</a>!-->
  <a href="../../../external.html?link=https://init.0x00sec.org/" class="dow-menu">Init</a>
  <a href="../../../external.html?link=https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
  <a href="../../../external.html?link=https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
    <header>
  <a href="../../index.html">0x00sec - The Home of the Hacker</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="22714.html">ELF Injector Patching Issues</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/malware/56.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #F7941D'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Malware</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../tag/programming.html' class='discourse-tag' rel="tag">programming</a>, 
            <a href='../../tag/linux.html' class='discourse-tag' rel="tag">linux</a>
        </div>
      </div>
  </div>

  

    <div itemscope itemtype='../../../external.html?link=http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='ELF Injector Patching Issues'>
      <link itemprop='url' href='22714.html'>
      <meta itemprop='datePublished' content='2020-08-15T11:24:52Z'>
        <meta itemprop='articleSection' content='Malware'>
      <meta itemprop='keywords' content='programming, linux'>
      <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
        <meta itemprop='name' content='0x00sec - The Home of the Hacker'>
          <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
            <meta itemprop='url' content='../../uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.html'>
          </div>
      </div>


          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/digitalXmage.html'><span itemprop='name'>digitalXmage</span></a>
                (...)
              </span>

                <link itemprop="mainEntityOfPage" href="22714.html">


              <span class="crawler-post-infos">
                  <time  datetime='2020-08-15T11:24:52Z' class='post-time'>
                    August 15, 2020, 11:24am
                  </time>
                  <meta itemprop='dateModified' content='2020-08-15T11:35:41Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Iâ€™ve been working on an ELFInjector inspired by <a class="mention" href="../../u/0x00pf.html">@0x00pf</a>  and analyzing his code and  using his payload from his github: <a href="../../../external.html?link=https://github.com/0x00pf/0x00sec_code/blob/master/elfun/payload.asm" class="inline-onebox" rel="noopener nofollow ugc">0x00sec_code/elfun/payload.asm at master Â· 0x00pf/0x00sec_code Â· GitHub</a></p>
<p>My Code: <a href="../../../external.html?link=https://github.com/digitalXmage/Elf-Injector-learning-" rel="noopener nofollow ugc">https://github.com/digitalXmage/Elf-Injector-learning-</a></p>
<p>Everything works as expected, I Successfully insert the payload and if i donâ€™t change the entry point, the original code runs, as expected. If i change the entry point to the payload offset in the target file. The payload runs, However a segfault happens at the jmp instruction. It seems. So the issue seems to occur when I then have to patch the jmp instruction of the payload to jump back to the original entry point.</p>
<p>So Iâ€™m guessing that the elf injector is not editing the jmp instruction correctly. Hereâ€™s the function for the patching:</p>
<pre><code>#define RET_PATTERN 0x11111111

struct file_info   /*[0] = starting address and [1] = size*/
{
uint64_t cave[2];
uint64_t next_seg[2];
uint64_t text_seg[2];
uint64_t ep;
uint64_t payload_size;
} file;
</code></pre>
<p>*Further Down Injector.c , we have the following function for patching (which makes use<br>
of struct file_info which contains information about the target file and the payload)</p>
<pre><code>/*insert the extracted payload into the code cave*/
void insert_payload(Elf64_Shdr payload,int no_segs,Elf64_Phdr *phdr,Elf64_Ehdr *ehdr,uint8_t *mem,uint8_t *payload_data)
{
    /*find .text segment*/
    for(int i=0;i&lt;=no_segs;i++)
    {
    	if(phdr[i].p_type==PT_LOAD &amp;&amp; phdr[i].p_flags == 5)
	    {

	    	/*increase the size of text segment to accomadate the payload*/
	    	phdr[i].p_memsz += (file.payload_size);
    		phdr[i].p_filesz += (file.payload_size);
	
		

	    	/*move the payload at the end of the segment(start of code cave)*/
	    	memmove(mem+file.cave[0],payload_data + payload.sh_offset,payload.sh_size);


	    	/*patch return address*/
	    	unsigned char *ptr;
		    long data;
		    int y,r;
		
		 /*pointer to code*/
	        ptr = (unsigned char *)mem+file.cave[0];

		 for(y=0;y&lt;(int)file.payload_size;y++)
		 {
			/*get value under pointer pluss offset*/
			data = *((long*)(ptr+y));
			r = data ^(long)RET_PATTERN;

			/*check matching pattern*/
			if(r==0)
			{
				printf("*return address found*\n");
				printf("+ Pattern %1x found at offset %d -&gt; %1x\n",RET_PATTERN,y,file.ep);
				*((long *)(ptr+y)) = file.ep; //set jmp instruction of payload to original entry point 
				break;
			}
		}			
			ehdr-&gt;e_entry = file.cave[0]; //set entry point to the code cave
		
	       	break;	
	}
}	
}
</code></pre>
<p>*Testing the code</p>
<blockquote>
<p>./compile<br>
./injector target payload<br>
./target<br>
This file has been infected for 0x00SEC<br>
Segmentation fault</p>
</blockquote>
<p>Iâ€™ve done some debugging with gdb on injector.c and I canâ€™t seem to find the problem. Iâ€™m patching the jmp instruction to the correct address, being the targetâ€™s original entry point. I even looked through the assembly program, which appears the segmentation fault occurs. However it seems my injector.c isnâ€™t patching as expected, even though it seems to? And is able to find the jmp instruction in memory.</p>
<p>Honestly This is my last resort. I wouldnâ€™t of posted here, If i wasnâ€™t desperate and tried everything i could think of. Like i say To get a better understanding and test yourself, Go to my github link for the code, and Itâ€™s annotated for easy reading etc.</p>
<p>I just donâ€™t seem to understand why the patching isnâ€™t working as expected? Iâ€™m 90% sure the segmentation fault occurs because of the jmp instruction, and thus shouldnâ€™t occur when we change the payloadâ€™s jmp instruction to a valid address in memory.</p>
<p>*Note: My code is a very rough draft, Apologies for any confusion or readability issues. ANd Iâ€™m aware some variables are unused. This was just a quick draft.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>


            
          </div>
          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/messede.html'><span itemprop='name'>messede</span></a>
                (Messede Degod)
              </span>


                <link itemprop="image" href="../../../0x00sec.s3.amazonaws.com/original/2X/0/0a5275a8383f802573f2fb5c2f73151a55cc5f24.png">

              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2020-08-16T07:24:51Z' class='post-time'>
                    August 16, 2020,  7:24am
                  </time>
                  <meta itemprop='dateModified' content='2020-08-16T07:24:51Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p><div class="lightbox-wrapper"><a class="lightbox" href="../../../0x00sec.s3.amazonaws.com/original/2X/0/0a5275a8383f802573f2fb5c2f73151a55cc5f24.png" data-download-href="/uploads/short-url/1tjrv7cfeR3RPETs6LC2630xO9m.png?dl=1" title="image"><img src="../../../0x00sec.s3.amazonaws.com/optimized/2X/0/0a5275a8383f802573f2fb5c2f73151a55cc5f24_2_690x72.png" alt="image" data-base62-sha1="1tjrv7cfeR3RPETs6LC2630xO9m" width="690" height="72" srcset="https://0x00sec.s3.amazonaws.com/optimized/2X/0/0a5275a8383f802573f2fb5c2f73151a55cc5f24_2_690x72.png, https://0x00sec.s3.amazonaws.com/optimized/2X/0/0a5275a8383f802573f2fb5c2f73151a55cc5f24_2_1035x108.png 1.5x, https://0x00sec.s3.amazonaws.com/optimized/2X/0/0a5275a8383f802573f2fb5c2f73151a55cc5f24_2_1380x144.png 2x" data-small-upload="../../../0x00sec.s3.amazonaws.com/optimized/2X/0/0a5275a8383f802573f2fb5c2f73151a55cc5f24_2_10x10.png"><div class="meta"><svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1818Ã—191 44.5 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg></div></a></div></p>
<p>------------------[Payload]-----------------|------------------------[Patched Binary]-----------------------------------------</p>
<p>The jump is never made in the target (patched) binary , i guess the payload is not being patched properly , some offset issue probably .</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_3' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/digitalXmage.html'><span itemprop='name'>digitalXmage</span></a>
                (...)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2020-08-18T10:16:15Z' class='post-time'>
                    August 18, 2020, 10:16am
                  </time>
                  <meta itemprop='dateModified' content='2020-08-18T10:16:15Z'>
              <span itemprop='position'>3</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Thanks for replying. What software are you using to analyze the code?</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_4' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/messede.html'><span itemprop='name'>messede</span></a>
                (Messede Degod)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2020-08-18T11:27:44Z' class='post-time'>
                    August 18, 2020, 11:27am
                  </time>
                  <meta itemprop='dateModified' content='2020-08-18T11:27:44Z'>
              <span itemprop='position'>4</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Its radare2<br>
<a href="../../../external.html?link=https://www.radare.org/r/" class="onebox" target="_blank">https://www.radare.org/r/</a></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_5' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/0x00pf.html'><span itemprop='name'>0x00pf</span></a>
                (pico)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2020-08-31T19:31:21Z' class='post-time'>
                    August 31, 2020,  7:31pm
                  </time>
                  <meta itemprop='dateModified' content='2020-08-31T19:31:21Z'>
              <span itemprop='position'>5</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Hi <a class="mention" href="../../u/digitalxmage-2.html">@digitalXmage</a>,</p>
<p>Are you maybe working with PIE binaries?. Check this out.</p>
<p><a href="../../../external.html?link=https://0x00sec.org/t/segfaults-with-polycrypt-tutorial/6713" class="onebox" target="_blank" rel="noopener nofollow ugc">https://0x00sec.org/t/segfaults-with-polycrypt-tutorial/6713</a></p>
<p>and this</p>
<p><a href="../../../external.html?link=https://0x00sec.org/t/issues-with-elf-file-injection-tutorial-by-pico/8029" class="onebox" target="_blank" rel="noopener nofollow ugc">https://0x00sec.org/t/issues-with-elf-file-injection-tutorial-by-pico/8029</a></p>
<p>The method doesnâ€™t work with PIE, it needs to be updated to use a <code>RIP</code> relative jump instead of the absolute jump used in the original post, because an absolute jump doesnâ€™t work on a PIE binary as it may be anywhere in memory</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_6' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/digitalXmage.html'><span itemprop='name'>digitalXmage</span></a>
                (...)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2020-09-05T20:24:36Z' class='post-time'>
                    September 5, 2020,  8:24pm
                  </time>
                  <meta itemprop='dateModified' content='2020-09-05T20:24:36Z'>
              <span itemprop='position'>6</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Thank you, Itâ€™s been a real help and insight. I managed to solve it, But i Donâ€™t know how to edit the original post.</p>
<p>What i Did was, I followed the the algorithm for patching, However instead of patching the payload in binary form, I patched the actual source code of the payload and copied the source code into the code cave , the text segment. And it seemed to of worked.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_7' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/0x00pf.html'><span itemprop='name'>0x00pf</span></a>
                (pico)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2020-09-05T20:31:51Z' class='post-time'>
                    September 5, 2020,  8:31pm
                  </time>
                  <meta itemprop='dateModified' content='2020-09-05T20:31:51Z'>
              <span itemprop='position'>7</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <aside class="quote no-group" data-username="digitalXmage" data-post="6" data-topic="22714">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="24" height="24" src="../../letter_avatar_proxy/v4/letter/d/ea666f/48.png" class="avatar"> digitalXmage:</div>
<blockquote>
<p>I patched the actual source code of the payload and copied the source code into the code cave</p>
</blockquote>
</aside>
<p>That sounds weird. Can you show us the code?</p>
<p>Also, I noticed that I updated my repos for this issue. You can check a possible solution here:</p>
<aside class="onebox githubfolder" data-onebox-src="../../../external.html?link=https://github.com/0x00pf/0x00sec_code/tree/master/elfpie">
  <header class="source">
      <img src="../../../external.html?link=https://github.githubassets.com/favicons/favicon.svg" class="site-icon" alt="" width="32" height="32">

      <a href="../../../external.html?link=https://github.com/0x00pf/0x00sec_code/tree/master/elfpie" target="_blank" rel="noopener nofollow ugc">github.com</a>
  </header>

  <article class="onebox-body">
    <h3><a href="../../../external.html?link=https://github.com/0x00pf/0x00sec_code/tree/master/elfpie" target="_blank" rel="noopener nofollow ugc">0x00sec_code/elfpie at master Â· 0x00pf/0x00sec_code</a></h3>


  <p><span class="label1">Code for my 0x00sec.org posts. Contribute to 0x00pf/0x00sec_code development by creating an account on GitHub.</span></p>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<p>There is an alternative solution from <a class="mention" href="../../u/jbx81.html">@jbx81</a>  in this post</p>
<p><a href="../../../external.html?link=https://0x00sec.org/t/doubt-infect-elf/13605/4" class="onebox" target="_blank" rel="noopener nofollow ugc">https://0x00sec.org/t/doubt-infect-elf/13605/4</a></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_8' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/digitalXmage.html'><span itemprop='name'>digitalXmage</span></a>
                (...)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2020-09-05T21:02:21Z' class='post-time'>
                    September 5, 2020,  9:02pm
                  </time>
                  <meta itemprop='dateModified' content='2020-09-05T21:05:47Z'>
              <span itemprop='position'>8</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Awesome will take a look. So just to clarify as I think I didnâ€™t explain it well.</p>
<p>I didnâ€™t use the typical payload executable per say, I used nasm and changed the format to a .bin (flat form binary). I then did the usual of mapping the Host file. Setting up the code cave, I then opened up the .bin payload onto the heap, I then changed/patched the return address to the hostâ€™s original entry point, and Then I memmoved the opened payload on the heap into the code cave(after patching) Which seemed to of worked for some reason. Whereas if i patched after inserting the payload into the code cave,It didnâ€™t patch it.</p>
<p>However It only works with ELF of type exec. Iâ€™m assuming Itâ€™s because the address space doesnâ€™t change? But itâ€™s still a hunch , Iâ€™m still learning.</p>
<p>Here is the github to my new solved version. I need to find a way of infecting Dyn shared files. However Iâ€™m currently still working on that. And your information in this post has helped so much!</p>
<p><a href="../../../external.html?link=https://github.com/digitalXmage/Trojan-Virus" rel="nofollow noopener">https://github.com/digitalXmage/Trojan-Virus</a></p>
<p>Thank you for your posts btw(And everyone else) But you in particular have been a massive source of knowledge and inspiration. And have ignited my passion for Binary patching(Iâ€™m working on more binary patching projects) I even follow you on github. Iâ€™m looking forward to your next project man <img src="../../../0x00sec.org/images/emoji/twitter/slight_smilec164.html?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>


            
          </div>
          <div id='post_9' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/0x00pf.html'><span itemprop='name'>0x00pf</span></a>
                (pico)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2020-09-05T21:14:57Z' class='post-time'>
                    September 5, 2020,  9:14pm
                  </time>
                  <meta itemprop='dateModified' content='2020-09-05T21:14:57Z'>
              <span itemprop='position'>9</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>I see now. You should be closer to your goals now because a binary PIE is basically a shared library. I havenâ€™t played with libraries myself but looks like an interesting project. Do not forget to post your findings here</p>
<p>Thanks for reading my posts and Iâ€™m very glad to hear they helped you.</p>
<p>Looking forward to know more about those binary patching projects</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>


            
          </div>
          <div id='post_10' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/0xN3utr0n.html'><span itemprop='name'>0xN3utr0n</span></a>
                (N3utr0n)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2020-10-17T14:17:13Z' class='post-time'>
                    October 17, 2020,  2:17pm
                  </time>
                  <meta itemprop='dateModified' content='2020-10-17T18:36:41Z'>
              <span itemprop='position'>10</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Hi, sorry if Iâ€™m bumping the thread, I was just passing by and noticed this interesting post. While learning I also went through all the trouble of making an <a href="../../../external.html?link=https://github.com/0xN3utr0n/Noteme" rel="noopener nofollow ugc">infector</a> by myself, and perhaps mine could be of some help to <a class="mention" href="../../u/digitalxmage-2.html">@digitalXmage</a> since it can infect shared objects.</p>
<p>PS: I too am very grateful to <a class="mention" href="../../u/0x00pf.html">@0x00pf</a>, he was a great inspiration back then when I started.  <img src="../../../0x00sec.org/images/emoji/twitter/slight_smilec164.html?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>


            
          </div>
          <div id='post_11' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/system.html'><span itemprop='name'>system</span></a>
                (system)
                  Closed 
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2020-12-15T03:29:50Z' class='post-time'>
                    December 15, 2020,  3:29am
                  </time>
                  <meta itemprop='dateModified' content='2020-12-15T03:29:50Z'>
              <span itemprop='position'>11</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>This topic was automatically closed after 121 days. New replies are no longer allowed.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
    </div>


    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../index.html' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../categories.html' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../guidelines.html' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../tos.html' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../privacy.html' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    <script src="../../../external.html?link=http://instant.page/3.0.0" type="module" defer="" integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1" nonce="463RbNH2QqV82yaGwC4UoTAY7"></script>
  </body>
  
</html>
