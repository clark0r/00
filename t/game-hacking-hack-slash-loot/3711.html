<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Game Hacking: Hack, Slash, Loot - Reverse Engineering - 0x00sec - The Home of the Hacker</title>
<meta name="description" content="So recently I’ve been re-motivated to do some more game hacking and I thought that I’d do another article to introduce more aspects on top of what I’ve already shown from my previous ones. In the following document, I’ll&amp;hellip;">
<meta name="generator" content="Discourse 3.1.0.beta6 - https://github.com/discourse/discourse version 80a1709965fa59da824b2e3392976fc6fc898f80">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.png">
<meta name="theme-color" media="all" content="#171616">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="3711.html" />
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">
<link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_a5ef387651921c3e4c7aa1108536015ba8299efb.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" class="light-scheme" />
<link href="../../stylesheets/desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop" />
<link href="../../stylesheets/chat_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="chat" />
<link href="../../stylesheets/discourse-details_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-details" />
<link href="../../stylesheets/discourse-lazy-videos_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-lazy-videos" />
<link href="../../stylesheets/discourse-local-dates_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-local-dates" />
<link href="../../stylesheets/discourse-narrative-bot_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-narrative-bot" />
<link href="../../stylesheets/discourse-presence_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-presence" />
<link href="../../stylesheets/discourse-spoiler-alert_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-spoiler-alert" />
<link href="../../stylesheets/docker_manager_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="docker_manager" />
<link href="../../stylesheets/poll_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="poll" />
<link href="../../stylesheets/chat_desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="chat_desktop" />
<link href="../../stylesheets/poll_desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="poll_desktop" />
<link href="../../stylesheets/desktop_theme_46_f36ade55bf80933494fe3b5fab518f477de3bd4e.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2" />
<link href="../../stylesheets/desktop_theme_57_8c0e890a61cdb4c5833a9f9c96664ed164e7d645.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="57" data-theme-name="0x00sec-v2" />
<link rel="stylesheet" href="https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="https://s3.amazonaws.com/0x00sec/highlight.pack.js"></script>
<link rel="preload" href="../../theme-javascripts/440fd21108f5ba9e5dfe06cca9fc842569d5a874.js%3F__ws=0x00sec.org" as="script">
<script defer src="../../theme-javascripts/440fd21108f5ba9e5dfe06cca9fc842569d5a874.js%3F__ws=0x00sec.org" data-theme-id="40"></script>
<link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Game Hacking: Hack, Slash, Loot&#39;" href="3711.rss" />
<meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://0x00sec.s3.amazonaws.com/original/2X/1/16ea1261a05917f93767f2a6fee6f36e7110aa8b.JPG" />
<meta property="og:image" content="https://0x00sec.s3.amazonaws.com/original/2X/1/16ea1261a05917f93767f2a6fee6f36e7110aa8b.JPG" />
<meta property="og:url" content="https://0x00sec.org/t/game-hacking-hack-slash-loot/3711" />
<meta name="twitter:url" content="https://0x00sec.org/t/game-hacking-hack-slash-loot/3711" />
<meta property="og:title" content="Game Hacking: Hack, Slash, Loot" />
<meta name="twitter:title" content="Game Hacking: Hack, Slash, Loot" />
<meta property="og:description" content="So recently I’ve been re-motivated to do some more game hacking and I thought that I’d do another article to introduce more aspects on top of what I’ve already shown from my previous ones. In the following document, I’ll be detailing the usage of DLL injection and its advantages, a fundamental concept of how games may store specific data and how to identify them. Along the way, I will be talking about the ASLR environment and how to adapt code to such scenarios. Finally, I will be discussing how..." />
<meta name="twitter:description" content="So recently I’ve been re-motivated to do some more game hacking and I thought that I’d do another article to introduce more aspects on top of what I’ve already shown from my previous ones. In the following document, I’ll be detailing the usage of DLL injection and its advantages, a fundamental concept of how games may store specific data and how to identify them. Along the way, I will be talking about the ASLR environment and how to adapt code to such scenarios. Finally, I will be discussing how..." />
<meta property="og:article:section" content="Reverse Engineering" />
<meta property="og:article:section:color" content="12A89D" />
<meta property="og:article:tag" content="reverseengineering" />
<meta property="og:article:tag" content="tutorial" />
<meta property="og:article:tag" content="gamehacking" />
<meta property="og:article:tag" content="tools" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="6 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="26 ❤" />
<meta property="article:published_time" content="2017-09-25T10:40:09+00:00" />
<meta property="og:ignore_canonical" content="true" />
</head>
<body class="crawler ">
<div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">

<a href="https://init.0x00sec.org" class="dow-menu">Init</a>
<a href="https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
<a href="https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
<header>
<a href="../../index.html">
0x00sec - The Home of the Hacker
</a>
</header>
<div id="main-outlet" class="wrap" role="main">
<div id="topic-title">
<h1>
<a href="3711.html">Game Hacking: Hack, Slash, Loot</a>
</h1>
<div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
<span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a href="../../c/reverse-engineering/58.html" class="badge-wrapper bullet" itemprop="item">
<span class="badge-category-bg" style="background-color: #12A89D"></span>
<span class="badge-category clear-badge">
<span class="category-name" itemprop="name">Reverse Engineering</span>
</span>
</a>
<meta itemprop="position" content="1" />
</span>
</div>
<div class="topic-category">
<div class="discourse-tags list-tags">
<a href="../../tag/reverseengineering.html" class="discourse-tag" rel="tag">reverseengineering</a>,
<a href="../../tag/tutorial.html" class="discourse-tag" rel="tag">tutorial</a>,
<a href="../../tag/gamehacking.html" class="discourse-tag" rel="tag">gamehacking</a>,
<a href="../../tag/tools.html" class="discourse-tag" rel="tag">tools</a>
</div>
</div>
</div>
<div itemscope itemtype="http://schema.org/DiscussionForumPosting">
<meta itemprop="headline" content="Game Hacking: Hack, Slash, Loot">
<meta itemprop="articleSection" content="Reverse Engineering">
<meta itemprop="keywords" content="reverseengineering, tutorial, gamehacking, tools">
<div itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="0x00sec - The Home of the Hacker">
<div itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
<meta itemprop="url" content="https://0x00sec.org/uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.png">
</div>
</div>
<div id="post_1" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/dtm"><span itemprop="name">dtm</span></a>
</span>
<link itemprop="mainEntityOfPage" href="3711.html">
<link itemprop="image" href="https://0x00sec.s3.amazonaws.com/original/2X/1/16ea1261a05917f93767f2a6fee6f36e7110aa8b.JPG">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-09-25T10:40:09Z" class="post-time">
September 25, 2017, 10:40am
</time>
<meta itemprop="dateModified" content="2018-07-23T12:34:58Z">
<span itemprop="position">1</span>
</span>
</div>
<div class="post" itemprop="articleBody">
<p>So recently I’ve been re-motivated to do some more game hacking and I thought that I’d do another article to introduce more aspects on top of what I’ve already shown from my previous ones. In the following document, I’ll be detailing the usage of DLL injection and its advantages, a fundamental concept of how games may store specific data and how to identify them. Along the way, I will be talking about the ASLR environment and how to adapt code to such scenarios. Finally, I will be discussing how to code a <a href="https://en.wikipedia.org/wiki/Trainer_(games)">trainer</a> in the form of a DLL.</p>
<p>The game that we will be using to demonstrate these ideas is <em><a href="http://www.hackslashloot.com/">Hack, Slash, Loot</a></em> which has a demo version that you can download if you wish to follow along.</p>
<h4>Author Assigned Level: Newbie</h4>
<h4>Community Assigned Level:</h4>
<div class="poll" data-poll-status="open" data-poll-type="regular" data-poll-name="poll">
<div>
<div class="poll-container">
<ul>
<li data-poll-option-id="e1c1af66349ae633fa9ffd223d9e01f3">Newbie</li>
<li data-poll-option-id="48cde21e0fcdef5aef447a332bb6dcc0">Wannabe</li>
<li data-poll-option-id="f0d5a092a44bae0d9f0734127a07fe91">Hacker</li>
<li data-poll-option-id="d0be935ef28646b5afecbf524d510b85">Wizard</li>
<li data-poll-option-id="cc5e4d9a5dc2c4d9aa641ef7a2a97876">Guru</li>
</ul>
</div>
<div class="poll-info">
<p>
<span class="info-number">0</span>
<span class="info-label">voters</span>
</p>
</div>
</div>
</div>
<h4>Assumed Knowledge</h4>
<ul>
<li>Windows API</li>
<li>C++</li>
<li>x86 Intel Assembly</li>
<li>Basic Cheat Engine usage</li>
<li>Virtual memory</li>
<li>DLL injection</li>
<li>Data Execution Prevention (DEP)</li>
</ul>
<h4>Expected Outcomes</h4>
<ul>
<li>Understand the advantages of using DLL injection over external process data manipulation</li>
<li>Understand the basic concept of data structures in games</li>
<li>Learn how to adapt code in an ASLR environment</li>
<li>Learn how to modify assembly inline</li>
<li>Learn how to program a basic trainer in C++</li>
</ul>
<h4>Disclaimer</h4>
<p>This information is based on the information that I have researched myself and is therefore subject to the possibility of providing incorrect data. If such incorrect data exists, please notify me and I will fix it when I am available.</p>
<hr>
<h1>DLL Injection</h1>
<p>I’ve covered DLL injection in previous articles but just for completeness, I will give a brief overview of it. DLL injection is simply the act of forcing a process to load a DLL. There are many different ways to perform this but the most common and easiest method is to call <code>LoadLibrary</code> from within the target process and passing the full path of the DLL as a parameter. Here is some sample code that represents the procedure.</p>
<pre><code class="lang-cpp">    // Get size of the full DLL path
	DWORD dwDllPathLen = strlen(lpszDllPath);
    // Allocate space for the DLL string
	LPVOID lpDllPathString = VirtualAllocEx(hProcess, NULL, dwDllPathLen, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);
    // Write the DLL string into the allocated space
	SIZE_T dwWritten = 0;
	WriteProcessMemory(hProcess, lpBaseAddress, lpszDllPath, dwDllPathLen, &amp;dwWritten);
    // Get handle to the module which has LoadLibrary
	HMODULE hModule = GetModuleHandle("kernel32.dll");
    // Get address of LoadLibrary
	LPVOID lpLoadLibrary = GetProcAddress(hModule, "LoadLibraryA");
    // Execute LoadLibrary with the DLL string as the parameter
	CreateRemoteThread(hProcess, NULL, 0, (LPTHREAD_START_ROUTINE)lpLoadLibrary, lpDllPathString, 0, NULL);
</code></pre>
<p>Space will first be allocated for the <em>full</em> path of the DLL in the target process as a parameter for <code>LoadLibrary</code>. Once space has been allocated, the path string will be written using <code>WriteProcessMemory</code>. The <code>LoadLibrary</code> address will be retrieved using <code>GetModuleHandle</code> with the <code>kernel32.dll</code> parameter and <code>GetProcAddress</code>. Now that we have <code>LoadLibrary</code> and the DLL path string, we simply execute a thread in the target process at <code>LoadLibrary</code> using <code>CreateRemoteThread</code>, passing the DLL path string as a parameter.</p>
<p>In summary, we are forcing the target process to execute</p>
<pre><code class="lang-cpp">    LoadLibrary("DLL's full path string");
</code></pre>
<h3>DLL Injection vs External Process Data Manipulation</h3>
<p>So just some motivation, we want to be able to modify data within a process to be able to force it to do what we want. This can be done in two ways, the first I call <em>external process data manipulation</em>, I’ve already covered in previous game hacking articles. Essentially, it uses the <code>ReadProcessMemory</code> and <code>WriteProcessMemory</code> functions to query and change data given a specified process handle. But constantly calling these functions is a bit awkward and wouldn’t it be a bit better if we could just modify it by simply assigning it like a normal variable, i.e. <code>player.health = 9999</code>?</p>
<p>DLL injection offers the solution to this problem. In the context of an injected DLL, the target process’s data in memory is treated like normal meaning that we can read and write data by reading an address and then assigning it a value using the assignment operator.</p>
<pre><code class="lang-cpp">   int *health = (int *)ADDR_HEALTH_VALUE;
   *health = 9999;
</code></pre>
<p>So obviously, it is more favourable to be in this situation purely due to its simplicity.</p>
<hr>
<h1>Finding Values</h1>
<p>Since basic use of Cheat Engine is assumed knowledge, we will skip the setup and dive straight into scanning for values of interest. So boot up the game and CE and let’s first find the address of the health. Here I’ve found mine and have modified it to confirm that it’s correct.</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/2X/1/16ea1261a05917f93767f2a6fee6f36e7110aa8b.JPG" width="690" height="435"></p>
<p>Cool. So I can change my health to whatever I want but that’s easy and not very exciting. Let’s go a bit further and identify the underlying assembly which changes our health value by right-clicking the address and then selecting <code>Find out what writes to this address</code>. It will ask if you want to attach a debugger so just confirm that you want to and then it will open up a window. Simply trigger your health value so that CE can detect the instruction(s). When it shows up, select it and click <code>Show disassembler</code> on the right.</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/2X/9/92c6748727c5c88931d12027b3119ae7d5caf34c.JPG" width="690" height="365"></p>
<h3>Identifying Data Structures</h3>
<p>Immediately we can deduce that the <code>sub</code> instruction is where the program decreases our health value where <code>eax</code> holds the value of the amount and directly after it, there is a <code>cmp</code> instruction with 0 which is very likely where it checks if we are dead. Note down the address of the <code>sub</code> instruction as we will be using it later in our trainer. What’s interesting to note is that the health value is obtained with an offset from <code>ebx</code> because that is exactly what it would look like if it was referencing some sort of data structure like an array or a struct. To examine what <code>ebx</code> is, let’s place a breakpoint (F5) and then re-trigger our health.</p>
<p>As the breakpoint is hit, it will show us the value of <code>ebx</code>. Let’s use CE to examine this data structure by going to the <code>Tools</code> menu of the disassembler, then selecting <code>Dissect data/structures</code>. Plug in the value of <code>ebx</code> in the edit box labelled <code>Group 1</code> then go to the <code>Structures</code> menu and select <code>Define new structure</code>. Leave everything as default and let CE do all the heavy lifting and it will present a list of values at different offsets.</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/2X/4/415ca1399dfc8c5b619bbdb355d4dc150b2520dc.JPG" width="690" height="373"></p>
<p>Notice that at offset 50, we can see our health. But what are all these other values? Let’s head back to the game and see if we can find out. Actually, there is a sort of <em>slight</em> matching of values.</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/2X/0/07a0adf92bf32dae070fba38b5fcb3454de85af0.JPG" width="603" height="500"></p>
<p>Let’s confirm it by modifying the values in the struct and see if it is reflected in the game…</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/2X/8/8f0e28cf85a433ca42e57a071634501a51929b94.JPG" width="597" height="500"></p>
<p>Neat stuff! We can spend hours trying to decipher the structure members but I will leave that up to you if you wish to do it.</p>
<p>The final task that we need to do before moving onto coding the trainer is to know where we can find the address of the player struct. Luckily, this is easy for us to do. Return back to the main CE window and scan for the address of the player struct (make sure the hex checkbox is ticked) and we will be given an address in green text. This means that this is a <em>static</em> address and will never change.</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/2X/5/5dbbea0b95357605824c4bd9a76d852713a34f68.JPG" width="609" height="500"></p>
<hr>
<h1>Programming a Trainer</h1>
<h3>Dealing with ASLR</h3>
<p>Before we start coding the trainer, I’d like to bring up the concept of <a href="https://en.wikipedia.org/wiki/Address_space_layout_randomization">Address Space Layout Randomisation</a> (ASLR). ASLR is a technique used by the operating system as a security measure to counteract exploitation methods like buffer overflows. The idea is to have the process’s addresses randomised so that it would be impossible to tell where certain data existed.</p>
<p>What’s relevant to game hacking is the randomisation of the process’s base address and it needs to be understood so that it’s possible to adapt our code to such a volatile environment. Do not worry, the solution is pretty simple, at least for what we are doing. All we need is the <em>offset</em> of a certain address and then dynamically calculate the address in accordance to the base address. How do we get the offset of a target address? Simply subtract the base address of the process from it: <code>offset = targetAddress - baseAddress</code>. How do we dynamically calculate the new address in an ASLR’d process? <code>targetAddress = getBaseAddress() + offset</code>. Easy!</p>
<p>We can see here that the process was loaded at address <code>0x400000</code> which means that we can calculate the offsets of certain addresses of interests, namely the address which has the instruction to subtract our health (<code>0x547D6E</code>) and the address which holds the address of the player struct (<code>0xBA6140</code>).</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/2X/7/7810095b62001fc87805fd980b9bd0dd55027e5c.JPG" width="690" height="439"></p>
<h3>Programming the Trainer</h3>
<p>We’ll start off by creating a <code>Trainer</code> class where we will define the player struct and the methods we want. I’ve already gone ahead and deciphered some other members of the struct.</p>
<p><strong>Trainer.h</strong></p>
<pre><code class="lang-cpp">#ifndef __TRAINER_H__
#define __TRAINER_H__

#define ADDR_OFFSET_PLAYER_STRUCT 0x7A6140
#define ADDR_OFFSET_SUBTRACT_HEALTH 0x147D6E

typedef struct _player {
	void *unknown1;
	int unknown2;
	void *unknown3;
	void *unknown4;
	int unknown5;
	int unknown6;
	int unknown7;
	int unknown8;
	int unknown9;
	void *unknown10;
	int unknown11;
	unsigned int faceDirection;	// 1 (right) or 0xFFFFFFFF (left)
	int unknown12;
	int baseMeleeAttack;	// accuracy
	int baseRangedAttack;
	int baseMagicAttack;
	int baseArmour;
	int baseMeleeDamage;
	int baseRangedDamage;
	int baseMagicDamage;
	int health;
	int resistance;
	int vulnerability;
	int unknown14;
} player;

class Trainer {
	private:
	unsigned int baseAddress;
	player *p;
	bool isGodmode;
	static Trainer *t_instance;    // Singleton; ignore

	Trainer();
	~Trainer();
	Trainer(Trainer&amp; other) {}    // Singleton; ignore
	Trainer&amp; operator=(Trainer&amp; other) {}    // Singleton; ignore

	public:
	static const int MELEE = 0;
	static const int RANGED = 1;
	static const int MAGIC = 2;
	static Trainer *instance();    // Singleton; ignore
	void Reset();
	void ModifyHealth(int health);
	void EnableGodmode(bool enable);
	void ModifyArmour(int armour);
	void ModifyAttack(int type, int attack);
	void ModifyDamage(int type, int damage);
	bool IsGodmode();
};

#endif // !__TRAINER_H__
</code></pre>
<p>I’ve defined this class as a <em>Singleton</em> meaning that it will only allow a single instance of this player class to exist at any given time since this is a single-player game. This is an optional trait so ignore this if it complicates things.</p>
<p>When defining the player struct, it is important that we replicate the members exactly in terms of order and data type however, it is possible to truncate it if we do not know any other further details. At the top, I’ve defined some offset values for the location of the player struct and the instruction that subtracts health. Do you understand how I calculated those values?</p>
<p>Let’s now define the methods.</p>
<pre><code class="lang-cpp">#include &lt;Windows.h&gt;

#include "Trainer.h"

// initialise trainer instance
Trainer *Trainer::t_instance = 0;    // Singleton; ignore

/*
 * Initialise the base address and obtain the 
 * address of the player struct. Default disable
 * godmode.
 *
 * Note that we must start a new game before 
 * applying any h4x otherwise the address will
 * not contain a valid player struct.
 */
Trainer::Trainer() {
	// player struct at 00BA6140
	this-&gt;baseAddress = reinterpret_cast&lt;unsigned int&gt;(::GetModuleHandle(TEXT("HackSlashLoot.exe")));
	this-&gt;p = reinterpret_cast&lt;player *&gt;(*reinterpret_cast&lt;unsigned int *&gt;(this-&gt;baseAddress + ADDR_OFFSET_PLAYER_STRUCT));
	this-&gt;isGodmode = false;
}

Trainer::~Trainer() {
}

/*
 * Return the existing instance of the Trainer
 */
Trainer * Trainer::instance() {
	if (!t_instance)
		t_instance = new Trainer();
	return t_instance;
}

/*
 * In case we retrieve the player struct 
 * before starting a new game.
 */
void Trainer::Reset() {
	this-&gt;p = reinterpret_cast&lt;player *&gt;(*reinterpret_cast&lt;unsigned int *&gt;(this-&gt;baseAddress + ADDR_OFFSET_PLAYER_STRUCT));
}

/*
 * Change the health of the player.
 * Param : new health
 */
void Trainer::ModifyHealth(int health) {
	this-&gt;p-&gt;health = health;
}

/*
 * Change the player's base armour.
 * Param : new armour
 */
void Trainer::ModifyArmour(int armour) {
	this-&gt;p-&gt;baseArmour = armour;
}

/*
 * Change the attack (accuracy) value.
 * Param : type of attack
 * Param : new attack value
 */
void Trainer::ModifyAttack(int type, int attack) {
	if (type == Trainer::MELEE)
		this-&gt;p-&gt;baseMeleeAttack = attack;
	else if (type == Trainer::RANGED)
		this-&gt;p-&gt;baseRangedAttack = attack;
	else if (type == Trainer::MAGIC)
		this-&gt;p-&gt;baseMagicAttack = attack;
}

/*
* Change the damage value.
* Param : type of damage
* Param : new damage value
*/
void Trainer::ModifyDamage(int type, int damage) {
	if (type == Trainer::MELEE)
		this-&gt;p-&gt;baseMeleeDamage = damage;
	else if (type == Trainer::RANGED)
		this-&gt;p-&gt;baseRangedDamage = damage;
	else if (type == Trainer::MAGIC)
		this-&gt;p-&gt;baseMagicDamage = damage;
}

/*
 * Enables or disables godmode.
 * Param : true to enable, false to disable
 */
void Trainer::EnableGodmode(bool enable) {
	this-&gt;isGodmode = enable;
	void *takeDamageAddr = reinterpret_cast&lt;void *&gt;(this-&gt;baseAddress + ADDR_OFFSET_SUBTRACT_HEALTH);
	DWORD flOldProtect = 0;
	::VirtualProtect(takeDamageAddr, 3, PAGE_EXECUTE_READWRITE, &amp;flOldProtect);
	if (this-&gt;isGodmode) {
		*reinterpret_cast&lt;unsigned char *&gt;(takeDamageAddr) = 0x90;
		*(reinterpret_cast&lt;unsigned char *&gt;(takeDamageAddr) + 1) = 0x90;
		*(reinterpret_cast&lt;unsigned char *&gt;(takeDamageAddr) + 2) = 0x90;
	} else {
		*reinterpret_cast&lt;unsigned char *&gt;(takeDamageAddr) = 0x29;
		*(reinterpret_cast&lt;unsigned char *&gt;(takeDamageAddr) + 1) = 0x43;
		*(reinterpret_cast&lt;unsigned char *&gt;(takeDamageAddr) + 2) = 0x50;
	}
	::VirtualProtect(takeDamageAddr, 3, flOldProtect, &amp;flOldProtect);
}

/*
 * Returns true if godmode is enabled, otherwise false.
 */
bool Trainer::IsGodmode() {
	return this-&gt;isGodmode;
}
</code></pre>
<p>Most of these methods are self-explanatory and you can see that they modify values using the assignment operator because the DLL will be under the same context as the game’s process.</p>
<p>The first important thing I want to cover is the <code>baseAddress</code> field which is initialised in <code>Trainer</code>'s constructor. Using <code>GetModuleHandle</code> with the string of the process’s executable module, we can dynamically retrieve the base address which we can then use to dynamically calculate specific addresses. Directly underneath, the line of code utilises the <code>baseAddress</code> field is to calculate the address that stores the player struct.</p>
<p>The second important thing is the <code>EnableGodmode</code> method. Note how I’ve used <code>VirtualProtect</code> to allow write access of the address where the instruction to subtract health exists. This is due to DEP which I’ve covered previously. To apply godmode, we can just <code>nop</code> the subtraction and then we can restore the original bytes to disable it.</p>
<h3>Coding the DLL</h3>
<p>The DLL is not much different than coding a standard executable. Instead of using <code>main</code> or <code>WinMain</code>, we use the <code>DllMain</code> entry point.</p>
<pre><code class="lang-cpp">BOOL APIENTRY DllMain(HINSTANCE hInstDll, DWORD fdwReason, LPVOID lpReserved) {
	switch (fdwReason) {
		case DLL_PROCESS_ATTACH:
			::CreateThread(NULL, 0, reinterpret_cast&lt;LPTHREAD_START_ROUTINE&gt;(StartInterface), reinterpret_cast&lt;LPVOID&gt;(hInstDll), 0, NULL);
			break;
	}

	return TRUE;
}
</code></pre>
<p>The only major difference here is the <code>fdwReason</code> parameter which defines the circumstances under which the entry point is called. There are four of them but we will only focus on when the DLL is initially attached to the target process, AKA <code>DLL_PROCESS_ATTACH</code>. Once the DLL has been injected, it will call <code>DllMain</code> with the <code>DLL_PROCESS_ATTACH</code> reason and execute our code. Since I wish to persist the interface to allow the user to continuously access the trainer, I must use the <code>CreateThread</code> function to start another function to handle it, otherwise the main application will hang. Finally, we <em>must</em> return <code>TRUE</code> else the DLL will be detached from the process as a result. I will leave the interface for you to design; it may be a console or graphical interface, or perhaps you could set global hotkeys or hook the keyboard. The choice is yours.</p>
<h3>Injecting the DLL</h3>
<p>Thankfully, we do not need to download any DLL injectors because CE comes with one! To access it, open the memory viewer (or disassembler/debugger), then go to the <code>Tools</code> menu and select <code>Inject DLL</code>, then proceed to locate your DLL and press <code>Open</code> in the dialog. Here is what mine looks like:</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/2X/e/ef97c21ef667069173fe50fbf1481d6829a60d87.JPG" width="551" height="320"></p>
<hr>
<h1>Conclusions</h1>
<p>So what have we (hopefully) learned?</p>
<ul>
<li>DLL injection has a significant advantage over the usage of <code>ReadProcessMemory</code> and <code>WriteProcessMemory</code> because of the simplicity it provides</li>
<li>We’ve also identified a member of a data structure which we then looked further to locate the entire struct and then played around with to see what would be reflected in the game, then translated this structure into our own trainer so that we can change them on demand</li>
<li>Understanding how to dynamically calculate addresses using offsets and the process’s base address will enable us to handle ASLR environments</li>
<li>Modifying assembly inline and how to bypass DEP by using <code>VirtualProtect</code>
</li>
</ul>
<p>As usual, you can find my code on the <a href="https://gitlab.s-3.tech/93aef0ce4dd141ece6f5/0x00sec-code-dump/tree/master/HSLTrainer">GitLab</a> or <a href="https://github.com/NtRaiseHardError/HSLTrainer">GitHub</a>.</p>
<p>Thanks for the read!</p>
<p>– <em>dtm</em></p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="20" />
<span class="post-likes">20 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_2" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/kl0wny"><span itemprop="name">kl0wny</span></a>
(Kl0wn)
</span>
<link itemprop="mainEntityOfPage" href="3711.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-09-26T20:59:43Z" class="post-time">
September 26, 2017, 8:59pm
</time>
<meta itemprop="dateModified" content="2017-09-26T20:59:43Z">
<span itemprop="position">2</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Did you use a special library for the interface you made? Or just win32?</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_3" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/jtara"><span itemprop="name">jtara</span></a>
(James T)
</span>
<link itemprop="mainEntityOfPage" href="3711.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-09-26T21:10:53Z" class="post-time">
September 26, 2017, 9:10pm
</time>
<meta itemprop="dateModified" content="2017-09-27T01:38:58Z">
<span itemprop="position">3</span>
</span>
</div>
<div class="post" itemprop="text">
<p>There’s a typo between <code>Trainer.cpp</code> and <code>Trainer.h</code>. Rename variable in <code>_player</code> struct in <code>Trainer.h</code> from <code>baseArmour</code> to <code>baseArmor</code>. I was going to make pull req. to fix, but idk what this <a href="https://gitlab.s-3.tech" rel="nofollow noopener">https://gitlab.s-3.tech</a> thing is.</p>
<p>edit: looks like this was fixed, if not, errors read through IDE should make it easy to fix</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="2" />
<span class="post-likes">2 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_4" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/lantern-shadowclaw"><span itemprop="name">lantern-shadowclaw</span></a>
(Austin)
</span>
<link itemprop="mainEntityOfPage" href="3711.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-09-26T21:16:05Z" class="post-time">
September 26, 2017, 9:16pm
</time>
<meta itemprop="dateModified" content="2017-09-26T21:16:05Z">
<span itemprop="position">4</span>
</span>
</div>
<div class="post" itemprop="text">
<p>0x00sec’s gitlab go to init and you can navigate to the gitlab and setup an account</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_5" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/dtm"><span itemprop="name">dtm</span></a>
</span>
<link itemprop="mainEntityOfPage" href="3711.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-09-26T22:37:01Z" class="post-time">
September 26, 2017, 10:37pm
</time>
<meta itemprop="dateModified" content="2017-09-26T22:51:57Z">
<span itemprop="position">5</span>
</span>
</div>
<div class="post" itemprop="text">
<p>This is pure Win32, I used the resource editor in Visual Studio for the GUI. If you’re talking about the different looking “skin”, it’s a theme I use.</p>
<p><a class="mention" href="https://0x00sec.org/u/jtara">@jtara</a> Thanks for spotting that!</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_6" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/jtara"><span itemprop="name">jtara</span></a>
(James T)
</span>
<link itemprop="mainEntityOfPage" href="3711.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-09-26T22:53:28Z" class="post-time">
September 26, 2017, 10:53pm
</time>
<meta itemprop="dateModified" content="2017-09-26T22:53:28Z">
<span itemprop="position">6</span>
</span>
</div>
<div class="post" itemprop="text">
<p>I couldn’t get this to work.</p>
<p>Why is the base address of the process of the game consistently 0x400000 ?</p>
<p>Just to test my offsets I calculated, I should be able to dissect data/structures using the address (baseAddress + offset) right? Well, this isn’t giving me the expected player struct.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_7" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/dtm"><span itemprop="name">dtm</span></a>
</span>
<link itemprop="mainEntityOfPage" href="3711.html">
<link itemprop="image" href="https://0x00sec.s3.amazonaws.com/original/2X/f/f38127bdf2a7f7d4861c22619f66fa6707157255.JPG">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-09-26T23:06:21Z" class="post-time">
September 26, 2017, 11:06pm
</time>
<meta itemprop="dateModified" content="2017-09-26T23:40:56Z">
<span itemprop="position">7</span>
</span>
</div>
<div class="post" itemprop="text">
<aside class="quote no-group" data-username="jtara" data-post="6" data-topic="3711">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/j/71c47a/40.png" class="avatar"> jtara:</div>
<blockquote>
<p>Why is the base address of the process of the game consistently 0x400000</p>
</blockquote>
</aside>
<p>The developer may not have enabled dynamic base addressing when compiling it.</p>
<aside class="quote no-group" data-username="jtara" data-post="6" data-topic="3711">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar_proxy/v4/letter/j/71c47a/40.png" class="avatar"> jtara:</div>
<blockquote>
<p>Just to test my offsets I calculated, I should be able to dissect data/structures using the address (baseAddress + offset) right? Well, this isn’t giving me the expected player struct.</p>
</blockquote>
</aside>
<p>Did you leave all the values as default? It should look something like this:</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/2X/f/f38127bdf2a7f7d4861c22619f66fa6707157255.JPG" width="673" height="499"></p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/2X/b/bce6511034c3fdd02ca3cb73325203f0a37ac20a.JPG" width="678" height="500"></p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/2X/e/ef7a1025be3dcc8c8ef60c671f726f457f5f4b23.JPG" width="690" height="459"></p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="2" />
<span class="post-likes">2 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_8" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/jtara"><span itemprop="name">jtara</span></a>
(James T)
</span>
<link itemprop="mainEntityOfPage" href="3711.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-09-27T00:21:54Z" class="post-time">
September 27, 2017, 12:21am
</time>
<meta itemprop="dateModified" content="2017-09-27T00:21:54Z">
<span itemprop="position">8</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Thanks, I got it working with</p>
<pre><code>void StartInterface(LPVOID lpParam) {
	Trainer::instance()-&gt;ModifyAttack(0, 999);
	Trainer::instance()-&gt;ModifyDamage(0, 123);
	Trainer::instance()-&gt;ModifyHealth(456);
}
</code></pre>
<ol>
<li>
<p>I had to figure out which static address was needed for player struct and health as there were several for each. I attached a debugger to find out what writes to this other address whose value is health (usually) which changed the value of the incorrect static addresses.</p>
</li>
<li>
<p>Got the correct offsets, then had to clean, rebuild and compile the solution / project in Visual Studio to get the dll to inject.</p>
</li>
</ol>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_9" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/udha"><span itemprop="name">udha</span></a>
(Nicholas Meredith)
</span>
<link itemprop="mainEntityOfPage" href="3711.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-10-05T23:00:58Z" class="post-time">
October 5, 2017, 11:00pm
</time>
<meta itemprop="dateModified" content="2017-10-05T23:00:58Z">
<span itemprop="position">9</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Loving the article, it will help me refresh myself on cheat engine <img src="../../images/emoji/twitter/slight_smile.png%3Fv=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"> - but just a tip, if possible please use PNG images for screenshots rather than JPEG. Because PNG uses a lossless compression, the images stay clean and crisp around text and sharp pixel-perfect details; unlike a lossy compression such as JPEG. For screenshots especially PNG will typically result in smaller file sizes too!</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_10" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/dtm"><span itemprop="name">dtm</span></a>
Closed
</span>
<link itemprop="mainEntityOfPage" href="3711.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-12-16T04:10:08Z" class="post-time">
December 16, 2017, 4:10am
</time>
<meta itemprop="dateModified" content="2017-12-16T04:10:08Z">
<span itemprop="position">10</span>
</span>
</div>
<div class="post" itemprop="text">
<p>This topic was automatically closed after 30 days. New replies are no longer allowed.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
</div>
</div>
<footer class="container wrap">
<nav class="crawler-nav">
<ul>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../index.html" itemprop="url">Home </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../categories.html" itemprop="url">Categories </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="https://0x00sec.org/guidelines" itemprop="url">FAQ/Guidelines </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../tos.html" itemprop="url">Terms of Service </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../privacy.html" itemprop="url">Privacy Policy </a>
</span>
</li>
</ul>
</nav>
<p class="powered-by-link">Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>
<script src="https://instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
</body>
</html>
