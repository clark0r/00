<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Bypassing SNI filtering : Feat DPITunnel, Zapret and Geneva - Networking - 0x00sec - The Home of the Hacker</title>
<meta name="description" content="Hey Everyone, i was recently  browsing a anti-censorship awesome list and i came across few tools with some really cool tricks to bypass SNI based filtering mechanisms, i think these tools deserves more attention and are&amp;hellip;">
<meta name="generator" content="Discourse 3.1.0.beta6 - https://github.com/discourse/discourse version 80a1709965fa59da824b2e3392976fc6fc898f80">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.png">
<meta name="theme-color" media="all" content="#171616">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="31001.html" />
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">
<link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_a5ef387651921c3e4c7aa1108536015ba8299efb.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" class="light-scheme" />
<link href="../../stylesheets/desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop" />
<link href="../../stylesheets/chat_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="chat" />
<link href="../../stylesheets/discourse-details_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-details" />
<link href="../../stylesheets/discourse-lazy-videos_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-lazy-videos" />
<link href="../../stylesheets/discourse-local-dates_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-local-dates" />
<link href="../../stylesheets/discourse-narrative-bot_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-narrative-bot" />
<link href="../../stylesheets/discourse-presence_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-presence" />
<link href="../../stylesheets/discourse-spoiler-alert_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-spoiler-alert" />
<link href="../../stylesheets/docker_manager_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="docker_manager" />
<link href="../../stylesheets/poll_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="poll" />
<link href="../../stylesheets/chat_desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="chat_desktop" />
<link href="../../stylesheets/poll_desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="poll_desktop" />
<link href="../../stylesheets/desktop_theme_46_f36ade55bf80933494fe3b5fab518f477de3bd4e.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2" />
<link href="../../stylesheets/desktop_theme_57_8c0e890a61cdb4c5833a9f9c96664ed164e7d645.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="57" data-theme-name="0x00sec-v2" />
<link rel="stylesheet" href="https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="https://s3.amazonaws.com/0x00sec/highlight.pack.js"></script>
<link rel="preload" href="../../theme-javascripts/440fd21108f5ba9e5dfe06cca9fc842569d5a874.js%3F__ws=0x00sec.org" as="script">
<script defer src="../../theme-javascripts/440fd21108f5ba9e5dfe06cca9fc842569d5a874.js%3F__ws=0x00sec.org" data-theme-id="40"></script>
<link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Bypassing SNI filtering : Feat DPITunnel, Zapret and Geneva&#39;" href="31001.rss" />
<meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://0x00sec.s3.amazonaws.com/original/3X/2/5/25119fede2c5afa2e49fd1bdfa528553b982e681.png" />
<meta property="og:image" content="https://0x00sec.s3.amazonaws.com/original/3X/2/5/25119fede2c5afa2e49fd1bdfa528553b982e681.png" />
<meta property="og:url" content="https://0x00sec.org/t/bypassing-sni-filtering-feat-dpitunnel-zapret-and-geneva/31001" />
<meta name="twitter:url" content="https://0x00sec.org/t/bypassing-sni-filtering-feat-dpitunnel-zapret-and-geneva/31001" />
<meta property="og:title" content="Bypassing SNI filtering : Feat DPITunnel, Zapret and Geneva" />
<meta name="twitter:title" content="Bypassing SNI filtering : Feat DPITunnel, Zapret and Geneva" />
<meta property="og:description" content="Hey Everyone, i was recently  browsing a anti-censorship awesome list and i came across few tools with some really cool tricks to bypass SNI based filtering mechanisms, i think these tools deserves more attention and are really worth sharing so here we are.  Understanding SNI Before we dive into how these tools actually works lets understand what SNI is, SNI stands for Server Name Indication its a part of the TLS protocol (a header to be exact) which lets the webserver decide which TLS certifica..." />
<meta name="twitter:description" content="Hey Everyone, i was recently  browsing a anti-censorship awesome list and i came across few tools with some really cool tricks to bypass SNI based filtering mechanisms, i think these tools deserves more attention and are really worth sharing so here we are.  Understanding SNI Before we dive into how these tools actually works lets understand what SNI is, SNI stands for Server Name Indication its a part of the TLS protocol (a header to be exact) which lets the webserver decide which TLS certifica..." />
<meta property="og:article:section" content="Networking" />
<meta property="og:article:section:color" content="8C6238" />
<meta property="og:article:tag" content="linux" />
<meta property="og:article:tag" content="bypass" />
<meta property="og:article:tag" content="networking" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="7 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="16 ❤" />
<meta property="article:published_time" content="2022-09-02T06:42:35+00:00" />
<meta property="og:ignore_canonical" content="true" />
</head>
<body class="crawler ">
<div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">

<a href="https://init.0x00sec.org" class="dow-menu">Init</a>
<a href="https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
<a href="https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
<header>
<a href="../../index.html">
0x00sec - The Home of the Hacker
</a>
</header>
<div id="main-outlet" class="wrap" role="main">
<div id="topic-title">
<h1>
<a href="31001.html">Bypassing SNI filtering : Feat DPITunnel, Zapret and Geneva</a>
</h1>
<div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
<span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a href="../../c/networking/63.html" class="badge-wrapper bullet" itemprop="item">
<span class="badge-category-bg" style="background-color: #8C6238"></span>
<span class="badge-category clear-badge">
<span class="category-name" itemprop="name">Networking</span>
</span>
</a>
<meta itemprop="position" content="1" />
</span>
</div>
<div class="topic-category">
<div class="discourse-tags list-tags">
<a href="../../tag/linux.html" class="discourse-tag" rel="tag">linux</a>,
<a href="../../tag/bypass.html" class="discourse-tag" rel="tag">bypass</a>,
<a href="../../tag/networking.html" class="discourse-tag" rel="tag">networking</a>
</div>
</div>
</div>
<div itemscope itemtype="http://schema.org/DiscussionForumPosting">
<meta itemprop="headline" content="Bypassing SNI filtering : Feat DPITunnel, Zapret and Geneva">
<meta itemprop="articleSection" content="Networking">
<meta itemprop="keywords" content="linux, bypass, networking">
<div itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="0x00sec - The Home of the Hacker">
<div itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
<meta itemprop="url" content="https://0x00sec.org/uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.png">
</div>
</div>
<div id="post_1" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/messede"><span itemprop="name">messede</span></a>
</span>
<link itemprop="mainEntityOfPage" href="31001.html">
<link itemprop="image" href="https://0x00sec.s3.amazonaws.com/original/3X/2/5/25119fede2c5afa2e49fd1bdfa528553b982e681.png">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2022-09-02T06:42:35Z" class="post-time">
September 2, 2022, 6:42am
</time>
<meta itemprop="dateModified" content="2022-09-06T13:39:24Z">
<span itemprop="position">1</span>
</span>
</div>
<div class="post" itemprop="articleBody">
<p>Hey Everyone, i was recently browsing a anti-censorship <a>awesome list</a> and i came across few tools with some really cool tricks to bypass SNI based filtering mechanisms, i think these tools deserves more attention and are really worth sharing so here we are.</p>
<h2>Understanding SNI</h2>
<p>Before we dive into how these tools actually works lets understand what SNI is, SNI stands for Server Name Indication its a part of the TLS protocol (a header to be exact) which lets the webserver decide which TLS certificate has to be offered to a client when it is hosting multiple websites.
Lets fire up wireshark and take a quick look at this SNI header, we will
use the filter <code>ssl.handshake.extension.type == "server_name"</code> to make our lives easier and try connecting to 0x00sec.org, now wireshark should hide everything except the Client Hello packets which are sent during the TLS handshake, lets take a look...</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://0x00sec.s3.amazonaws.com/original/3X/2/5/25119fede2c5afa2e49fd1bdfa528553b982e681.png" data-download-href="/uploads/short-url/5hVquanLlgcZyNm74sHHP7BKoVj.png?dl=1" title="TLS-Client-Hello" rel="noopener nofollow ugc"><img src="https://0x00sec.s3.amazonaws.com/optimized/3X/2/5/25119fede2c5afa2e49fd1bdfa528553b982e681_2_601x500.png" alt="TLS-Client-Hello" data-base62-sha1="5hVquanLlgcZyNm74sHHP7BKoVj" width="601" height="500" srcset="https://0x00sec.s3.amazonaws.com/optimized/3X/2/5/25119fede2c5afa2e49fd1bdfa528553b982e681_2_601x500.png, https://0x00sec.s3.amazonaws.com/original/3X/2/5/25119fede2c5afa2e49fd1bdfa528553b982e681.png 1.5x, https://0x00sec.s3.amazonaws.com/original/3X/2/5/25119fede2c5afa2e49fd1bdfa528553b982e681.png 2x" data-small-upload="https://0x00sec.s3.amazonaws.com/optimized/3X/2/5/25119fede2c5afa2e49fd1bdfa528553b982e681_2_10x10.png"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">TLS-Client-Hello</span><span class="informations">879×731 91.6 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg>
</div></a></div></p>
<p>expanding the server_name TLS extension reveals us the SNI header, now some of you must be wondering - isn't TLS supposed encrypt everything ?, actually no lets see why. Say we have a webserver hosting a few sites (on the same ip) via plain HTTP, when a user requests a site the webserver just looks at the HTTP Host header field in the clients HTTP request serves up the appropriate site, everything works fine.</p>
<pre><code>========================
GET /index.html HTTP/<span>1.1</span>    _
<span>Host:</span> ctf<span>.0</span>x00sec<span>.org</span>        \              ======================
                              \             WEBSERVER (<span>133.7</span><span>.133</span><span>.7</span>)
                                ---------&gt;    --server.conf--
========================      / &lt;---------      ctf<span>.0</span>x00sec<span>.org</span> -&gt;  /var/www/html/ctf
GET /index.html HTTP/<span>1.1</span>    _/                  <span>0x00</span><span>sec</span><span>.org</span>     -&gt;  /var/www/html/forum
<span>Host:</span> <span>0x00</span><span>sec</span><span>.org</span>
</code></pre><p>Now lets add TLS to the mix, to establish a TLS connection we first need the TLS certificates which are unique to each site<sup>1</sup>, and to get the appropriate TLS certs we need to tell the server which site we are trying to connect to, this is where SNI comes in, it "indicates" what "server name" we are trying to connect to so that the server can give us the appropriate certificates, well now why is the SNI field unencrypted ?, thats simply because we havent established a secure connection yet and SNI is required to establish that secure connection in the first place! ( its somewhat like the chicken and egg problem). During the time in which SNI was introduced(around 2003), TLS simply did not want to deal with the overhead of coming up with a way to hide the SNI field and decided to let it be (in other words it was acceptable, a hostname was not really that confidential), the same TLS standard continue to be widely followed/used today.</p>
<h2>The Impact Of Unencrypted SNIs</h2>
<p>Blocking sites/services has been a favourite past time of many ISPs and governments around the world, in the early days everything was plaintext and intercepting proxies did the job, as networks grew in size and ssl started gaining popularity it became unrealistic to inspect traffic with proxies, everybody switched over to filtering DNS requests although this worked quite well for some time, with the advent of technologies like DoH(DNS over Https) and DoT(DNS over TLS) DNS filtering too became a thing of the past, when all hope seemed lost firewall vendors turned to that one part of TLS that remained unencrypted... SNI!!.</p>
<h2>How SNI Inspection Works</h2>
<p>Lets say we want to connect to 0x00sec.org from our pc, the TCP connection would look like this:</p>
<pre><code>                                           [+------+------+]
OUR-PC [<span>123.123</span><span>.1</span><span>.3</span> : <span>62123</span> ] =============[F-I-R-E-W-A-L-L]============&gt; [<span>443</span>  : <span>133.7</span><span>.133</span><span>.7</span>] 0x00sec.org
          Our <span>Ip</span>      Random               [+------+------+]              HTTPS    Servers <span>Ip</span>
                    Source Port                                       Standard Port
</code></pre><p>The blocking process is fairly straight forward, every time a TLS client hello is sent, the firewall just extracts the SNI field(the hostname) from the packet and compares it against a blocklist, when a match is found the hello packet can simply be dropped preventing the client from establishing the TLS connection. Dropping TLS client hello's as i mentioned before is only practical in smaller networks with limited traffic (i.e in cases of colleges, corporate networks), in case of ISPs inspecting and dropping packets on the gateway would be very costly and impractical due the heavy load ISPs generally are under, thus ISPs usually mirror the traffic<sup>2</sup> into a inspection device, the inspecting device matches the extracted SNI field against a blocklist as well, but to block the traffic it forges a TCP reset packet with the ip and port of the server (in our case 133.7.133.7 and 443 ) and sends it to client (i.e 123.123.1.3 on port 62123), fooling the client into thinking that the server has terminated the TCP connection thus effectively preventing the client from further communicating with the server, this method might not be 100% accurate since the reset packet can get lost during transmission, but that is within a acceptable margin, this method is what makes censorship possible at the level of ISPs.</p>
<h2>Bypassing SNI Inspection - A Review of Techniques Used For Circumvention</h2>
<p>Before we begin lets consider a simple representation of a TLS client hello packet for the sake of conversation.</p>
<pre><code>  +---------------------------+-----------------------------+
  | <span>SRC</span> IP: <span>123.123</span><span>.1</span><span>.3</span>       |     <span>DST</span> ISP: <span>133.7</span><span>.133</span><span>.7</span>    |     <span>// IP</span>
  +---------------------------+-----------------------------+
  | <span>SRC</span> PORT: <span>45637</span>           |     <span>DST</span> PORT: <span>443</span>           |     <span>// TCP</span>
  +---------------------------+-----------------------------+
  | <span>TLS</span> Ver |<span>..TLS</span>.Stuff....  | <span>SNI</span>:Server-Name: <span>0x00</span>sec.org|     <span>// TLS</span>  Client Hello  
  +---------------------------+-----------------------------+
</code></pre><p> <b>1) Split the Client hello at SNI field :</b> As i have mentioned before the filtering process is interested in the Server Name indicated by the SNI, this process expects the entire TLS Client Hello to be present in a single packet<sup>3</sup>, to evade this filtering process we segment the TLS data in half such that SNI server name is not completely in one portion, we then transmit those portions as separate TCP segments. </p>
<pre><code>  SEGMENT <span>1</span>: 
  +---------------------------+-----------------------------+
  | SRC IP: <span>123.123</span><span>.1</span><span>.3</span>       |     DST ISP: <span>133.7</span><span>.133</span><span>.7</span>    |     <span>// IP</span>
  +---------------------------+-----------------------------+
  | SRC PORT: <span>45637</span>           |     DST PORT: <span>443</span>           |     <span>// TCP</span>
  +---------------------------+-----------------------------+
  | TLS Ver |..TLS.Stuff....  |   SNI:Server-Name: <span>0x00</span>     |     <span>// Partial TLS Client Hello  </span>
  +---------------------------+-----------------------------+
</code>
<code>
  SEGMENT <span>2</span>: 
  +---------------------------+-----------------------------+
  | SRC IP: <span>123.123</span><span>.1</span><span>.3</span>       |     DST ISP: <span>133.7</span><span>.133</span><span>.7</span>    |     <span>// IP</span>
  +---------------------------+-----------------------------+
  | SRC PORT: <span>45637</span>           |     DST PORT: <span>443</span>           |     <span>// TCP</span>
  +---------------------------+-----------------------------+
  | sec.org................................................ |     <span>// Partial TLS Client Hello  </span>
  +---------------------------+-----------------------------+
</code></pre><p> when the first TCP segment is seen by the filter, it would immediate recognize it as TLS Client hello since the first portion has the appropriate TLS application header, but when it extracts the SNI servername it only gets the partial hostname (ex: 0x00 instead of 0x00sec.org), since the partial hostname doesnt match against any of the blocklists the packet is let through, as far as the second segment is concerned it has no meaningfull application header and hence is not processed by the filter and let through.</p>
<p> <b> 2) Split and send the client hello in random order :</b> This is variation of the first method except we send the segments in reverse or random order<sup>4</sup>, this is done in order to bypass certain filters which can reassemble segments but expects the segments to be sent in the right order.</p>
<p> <b>3) Use TCP window size to fragment the server hello :</b> Most filtering processes only analyze outbound packets (i.e packets originating from clients, TLS client hello in our case), but there are a few which analyze inbound packets as well, in such a case if the server hello is analyzed, it would contain a "certificate common name" (which again is nothing but hostname for which the TLS certificate was issued), which might match against the blocklist. In this situation we need to achive something similar to the first technique but from the servers end, we thus advertise a small TCP Window size which would force the server to split the server hello across multiple TCP segments hence achieving evasion.</p>
<p> <b>4) Send Fake client hello with an allowed SNI, but with a TTL not long enough to reach server :</b> In some scenarios, once a TLS client hello has been analyzed by the filter and allowed to pass, that particular TCP stream is ignored, any further inbound or outbound packets from that stream will not be analyzed, this is done inorder to reduce the amount of processing that a filter has to perform since a TLS client hello is sent only once per TLS session. We now can send a TLS client hello with a fake SNI-Server Name of a random allowed site (say wikipedia.org) but with a TTL(time to live) value just enough to reach the filter but not the actual server, thus effectively preventing our TCP stream from being further analyzed, now we can send the actual TLS client hello and go on with our business.</p>
<pre><code>        ____________                      ____\ /____                      __^____^__
      <span>&lt;[Your Machine]&gt;</span>                   |<span>Your Router</span>|<span>                    [</span>|<span>Firewall</span>|<span>]          
  +-----------------------+        +-----------------------+        +-----------------------+
  </span>|<span> DST: 133.7.133.7      </span>|<span>        </span>|<span> DST: 133.7.133.7      </span>|<span>        </span>|<span> DST: 133.7.133.7      </span>|
  |<span> SNI: wiki.org </span>|<span> TTL: 3</span>|<span>  ====&gt; </span>|<span> SNI: wiki.org </span>|<span> TTL: 2</span>|<span>  ====&gt; </span>|<span> SNI: wiki.org </span>|<span> TTL: 1</span>|<span> ===&gt;</span>|
  +-----------------------+        +-----------------------+        +-----------------------+    ||
                                                                                                 ||
  |<span>&lt;=============================================================================================&lt;</span>|
  ||<span>   
  </span>||<span>    [[Some interm Router]]               [[ The Webserver - 0x00sec.org @ 133.7.133.7]]
  </span>||<span>  +-----------------------+             
  </span>||<span>  </span>|<span> DST: 133.7.133.7      </span>|<span>   \/                  &lt; packet doesnt arrive &gt;
  </span>|<span>==&gt;</span>|<span> SNI: wiki.org </span>|<span> TTL: 0</span>|<span>   /\
      +-----------------------+
<pre><code>      TTL Becomes Zero Packet 
            is dropped
</code></pre>
</span></code><p><code></code></p></pre> <b> 5) Corrupting the checksum :</b> This is variation of the 4th technique, but here instead of using TTL to prevent the fake TLS client hello from reaching the server, we allow the client hello to reach the server, but we corrupt its checksum value, filters usually dont validate the checksum of packets to avoid overhead, but the client and server are fully compliant TCP implementations and will drop any packets with bad checksums, we can then send the real client hello and go on with our business. (This method has few caveats check note 5)<p></p><p></p>
<pre><code>        ____________                      __^____^__                      
      <span>&lt;[Your Machine]&gt;</span>                   [|<span>Firewall</span>|<span>]              [[ Webserver - 0x00sec.org]] 
  +-----------------------+        +-----------------------+        +-----------------------+
  </span>|<span> DST: 133.7.133.7      </span>|<span>        </span>|<span> DST: 133.7.133.7      </span>|<span>        </span>|<span> DST: 133.7.133.7      </span>|
  |<span> SNI: wiki.us</span>|<span> BADCHKSM</span>|<span>  ====&gt; </span>|<span> SNI: wiki.us</span>|<span> BADCHKSM</span>|<span>  ====&gt; </span>|<span> SNI: wiki.us</span>|<span> BADCHKSM</span>|
  +-----------------------+        +-----------------------+        +-----------------------+

                                   . wiki.us is not blocked          \/   Packet has bad         
                                     allow packet to pass            /\   checksum drop it

                                   . Further packets from the
                                     TCP stream is no longer
                                     processed
</code></pre><p>These are the most common techniques used by circumvention tools, but there are many others, one of tools Geneva
</p><p>goes the extra mile by developing tailored bypass mechanisms depending on the censor, Geneva is really cool project and you can read more about it <a href="https://geneva.cs.umd.edu/" rel="noopener nofollow ugc">here</a></p><p></p>
<h2>Attempts To Solve The Unencrypted SNI Problem</h2>
<ul>
<li>ESNI/ECH (Encrypted SNI/ Encrypted Client Hello): There are RFC drafts discussing these possibilities but there are also legitmate concerns regarding their implementation, ESNI/ECH would completely blind firewall and other filtering devices in educational institutions, SNI also serves as a possible IOC for SEIMs, but it is possible to block ESNI/ECH and force the client to fall back to regular methods, The Great Firewall has been observed doing this <a href="https://geneva.cs.umd.edu/posts/china-censors-esni/esni/" rel="noopener nofollow ugc">since mid 2020</a> </li>
</ul>
<h2>Alternative Use Cases Of These Tools</h2>
<ul>
<li>In pentest, red teaming scenarios : <ul>
<li>Can enable access to blocked services (ex: telegram), which can be used for exfiltration</li>
<li>Provide better opsec for your beacon/agent by hiding the C2 hostnames from the firewall</li>
</ul>
</li>
</ul>
<h2>Scenarios In Which These Tools Likely Will Not Help</h2>
<ul>
<li>The fragmentation attack performed by these tools will not work against proxies which perform SNI filtering (ex: Squid), since proxies generally reassemble TCP fragments before inspection.</li>
<li>In cases of ip filtering (ex: blackholeing 133.7.133.7)</li>
<li>In cases where UDP is being filtered out (DPITunnel only works for TCP traffic)</li>
</ul>
<h2>Notes</h2>
<ol>
<li>
<p>There are exception to certificates being unique to a site, in case of subdomains, a single wild card certificate (ex: certificate for *.0x00sec.org) can be utilized by all the subdomains of a site.</p>
</li>
<li>
<p>Port Mirroring or a similar feature is usually available in switches and other routing devices where a (physical) port can be configured for monitoring purposes, a copy of all packets flowing through the device is sent to this port, a machine can be connected to this monitoring port with its network interface in promiscous mode, all passing traffic can now be inspected by listening on this interface without any processing overhead on the gateway.</p>
</li>
<li>
<p>Most filtering implementation expect the entire client hello to be part of a single TCP packet, because that generally is the case, though it is possible to segment the client hello across multiple TCP packets, in such a scenario the filtering process would be required to reassemble the tcp segments before analyzing them, this is computationally costly and thus not implemented in mainstream filtering products, one exception in this case is "The Great Firewall" which is said to have reassembly capability.</p>
</li>
<li>
<p>Out of order delivery is feature of TCP, the reciever buffers segments recieved in random order untill all segments of a sequence arrive, it then reassembles and delivers them to the application layer.</p>
</li>
<li>
<p>Many home routers may drop packets with bad checksum, the kernel paramter net.netfilter.nf_conntrack_checksum
can be set to 0 to prevent this.</p>
</li>
</ol>
<h2>Tools :</h2>
<ol>
<li>
<p><a href="https://github.com/Kkevsterrr/geneva/" rel="noopener nofollow ugc">https://github.com/Kkevsterrr/geneva/</a> (Linux) (recommended) </p>
</li>
<li>
<p><a href="https://github.com/zhenyolka/DPITunnel-cli" rel="noopener nofollow ugc">https://github.com/zhenyolka/DPITunnel-cli</a> (Linux) (recommended, personal choice)</p>
</li>
<li>
<p><a href="https://github.com/bol-van/zapret" rel="noopener nofollow ugc">https://github.com/bol-van/zapret</a> (Linux,BSD) (recommended)</p>
</li>
<li>
<p><a href="https://github.com/ValdikSS/GoodbyeDPI" rel="noopener nofollow ugc">https://github.com/ValdikSS/GoodbyeDPI</a> (Linux)</p>
</li>
<li>
<p><a href="https://github.com/SadeghHayeri/GreenTunnel" rel="noopener nofollow ugc">https://github.com/SadeghHayeri/GreenTunnel</a> (windows)</p>
</li>
<li>
<p><a href="https://github.com/macronut/ghostcp" rel="noopener nofollow ugc">https://github.com/macronut/ghostcp</a> (windows)</p>
</li>
<li>
<p><a href="https://github.com/zhenyolka/DPITunnel-android" rel="noopener nofollow ugc">https://github.com/zhenyolka/DPITunnel-android</a> (android)</p>
</li>
</ol>
<h2>References :</h2>
<ol>
<li>
<p><a href="https://github.com/bol-van/zapret/blob/master/docs/readme.eng.md" rel="noopener nofollow ugc">https://github.com/bol-van/zapret/blob/master/docs/readme.eng.md</a></p>
</li>
<li>
<p><a href="https://geneva.cs.umd.edu/papers/geneva_ccs19.pdf" rel="noopener nofollow ugc">https://geneva.cs.umd.edu/papers/geneva_ccs19.pdf</a> </p>
</li>
<li>
<p><a href="https://hal.inria.fr/hal-01202712/document" rel="noopener nofollow ugc">https://hal.inria.fr/hal-01202712/document</a></p>
</li>
<li>
<p><a href="https://blog.torproject.org/learning-more-about-gfws-active-probing-system" rel="noopener nofollow ugc">https://blog.torproject.org/learning-more-about-gfws-active-probing-system</a></p>
</li>
<li>
<p><a href="https://habr.com/ru/post/335436/" rel="noopener nofollow ugc">https://habr.com/ru/post/335436/</a></p>
</li>
</ol>
<h2>Further Reading :</h2>
<ol>
<li>
<p><a href="https://geneva.cs.umd.edu/posts/india-sni-filtering/" rel="noopener nofollow ugc">https://geneva.cs.umd.edu/posts/india-sni-filtering/</a></p>
</li>
<li>
<p><a href="https://geneva.cs.umd.edu/posts/iran-whitelister/" rel="noopener nofollow ugc">https://geneva.cs.umd.edu/posts/iran-whitelister/</a></p>
</li>
<li>
<p><a href="https://geneva.cs.umd.edu/posts/china-censors-esni/esni/" rel="noopener nofollow ugc">https://geneva.cs.umd.edu/posts/china-censors-esni/esni/</a></p>
</li>
<li>
<p><a href="https://citizenlab.ca/2018/04/planet-netsweeper/" rel="noopener nofollow ugc">https://citizenlab.ca/2018/04/planet-netsweeper/</a></p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=zcC5K7QTdvM" rel="noopener nofollow ugc">How the Great Firewall Discovers Hidden Circumvention Servers</a></p>
</li>
<li>
<p><a href="https://geneva.cs.umd.edu/posts/" rel="noopener nofollow ugc">https://geneva.cs.umd.edu/posts/</a></p>
</li>
</ol>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="10" />
<span class="post-likes">10 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
<div class="crawler-linkback-list" itemscope itemtype="http://schema.org/ItemList">
<div itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="url" href="../techniques-to-bypass-and-attack-ips-ids-firewall-help/37017/4.html">Techniques to bypass and attack IPS/IDS/Firewall / Help</a>
<meta itemprop="position" content="21">
</div>
</div>
</div>
<div id="post_2" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/c0z"><span itemprop="name">c0z</span></a>
(Impetus Omnia Omnem Impetum)
</span>
<link itemprop="mainEntityOfPage" href="31001.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2022-09-06T06:19:12Z" class="post-time">
September 6, 2022, 6:19am
</time>
<meta itemprop="dateModified" content="2022-09-06T06:19:12Z">
<span itemprop="position">2</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Very interesting analysis and post about SNI and DPI from an enterprise routers view with offensive operations in mind. I didn’t know about SNI and it’s use in DPI, as that’s still not a super deeply explored field for me.</p>
<p>Thanks for the content!</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="3" />
<span class="post-likes">3 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_3" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/messede"><span itemprop="name">messede</span></a>
</span>
<link itemprop="mainEntityOfPage" href="31001.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2022-09-06T08:44:20Z" class="post-time">
September 6, 2022, 8:44am
</time>
<meta itemprop="dateModified" content="2022-09-06T08:44:20Z">
<span itemprop="position">3</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Im making a matrix of what firewall products can actually be bypassed, could you test DPITunnel against any commercial firewall accessible to you ?</p>
<p>I was able to test it against sophos and can confirm that it works.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_4" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/c0z"><span itemprop="name">c0z</span></a>
(Impetus Omnia Omnem Impetum)
</span>
<link itemprop="mainEntityOfPage" href="31001.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2022-09-15T00:19:59Z" class="post-time">
September 15, 2022, 12:19am
</time>
<meta itemprop="dateModified" content="2022-09-15T00:19:59Z">
<span itemprop="position">4</span>
</span>
</div>
<div class="post" itemprop="text">
<p>I can. But I don’t believe we have a license that encompasses DPI, I’ll still test it though.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_5" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/messede"><span itemprop="name">messede</span></a>
</span>
<link itemprop="mainEntityOfPage" href="31001.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2022-09-15T08:01:37Z" class="post-time">
September 15, 2022, 8:01am
</time>
<meta itemprop="dateModified" content="2022-09-15T08:01:37Z">
<span itemprop="position">5</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Thank you!, what product do you use by the way ?</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_6" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/c0z"><span itemprop="name">c0z</span></a>
(Impetus Omnia Omnem Impetum)
</span>
<link itemprop="mainEntityOfPage" href="31001.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2022-09-16T03:18:18Z" class="post-time">
September 16, 2022, 3:18am
</time>
<meta itemprop="dateModified" content="2022-09-16T03:18:18Z">
<span itemprop="position">6</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Sent you a DM… (character limit)</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_7" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/system"><span itemprop="name">system</span></a>
(system)
Closed
</span>
<link itemprop="mainEntityOfPage" href="31001.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2023-01-01T22:43:35Z" class="post-time">
January 1, 2023, 10:43pm
</time>
<meta itemprop="dateModified" content="2023-01-01T22:43:35Z">
<span itemprop="position">7</span>
</span>
</div>
<div class="post" itemprop="text">
<p>This topic was automatically closed after 121 days. New replies are no longer allowed.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_8" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/messede"><span itemprop="name">messede</span></a>
Opened
</span>
<link itemprop="mainEntityOfPage" href="31001.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2023-09-20T16:39:57Z" class="post-time">
September 20, 2023, 4:39pm
</time>
<meta itemprop="dateModified" content="2023-09-20T16:39:57Z">
<span itemprop="position">8</span>
</span>
</div>
<div class="post" itemprop="text">
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_9" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/messede"><span itemprop="name">messede</span></a>
</span>
<link itemprop="mainEntityOfPage" href="31001.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2023-09-20T16:47:29Z" class="post-time">
September 20, 2023, 4:47pm
</time>
<meta itemprop="dateModified" content="2023-09-20T16:47:29Z">
<span itemprop="position">9</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Another neat trick many of you can use is to pass the <code>--enable-quic --quic-version=h3-29</code> flag while starting chromium/brave/chrome to force enable http3/QUIC, you can verify that it works by visiting: <a href="https://http3.is">https://http3.is</a>. (ofcourse the said webserver would have to support QUIC), since no SNI’s are involved most ISP implementations can be bypassed.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
</div>
</div>
<footer class="container wrap">
<nav class="crawler-nav">
<ul>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../index.html" itemprop="url">Home </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../categories.html" itemprop="url">Categories </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="https://0x00sec.org/guidelines" itemprop="url">FAQ/Guidelines </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../tos.html" itemprop="url">Terms of Service </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../privacy.html" itemprop="url">Privacy Policy </a>
</span>
</li>
</ul>
</nav>
<p class="powered-by-link">Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>
<script src="https://instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
</body>
</html>
